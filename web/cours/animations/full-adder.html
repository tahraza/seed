<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Additionneur Complet (Full Adder) - Animation Interactive</title>
    <link rel="stylesheet" href="common.css">
    <style>
        .construction-section { margin-top: 30px; border: 2px solid #4a5568; border-radius: 12px; overflow: hidden; }
        .construction-header { background: #2d3748; padding: 15px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .construction-header:hover { background: #4a5568; }
        .construction-header h3 { margin: 0; color: #e2e8f0; font-size: 1.1rem; }
        .construction-toggle { color: #4299e1; font-size: 1.5rem; transition: transform 0.3s; }
        .construction-content { display: none; padding: 20px; background: #1a202c; }
        .construction-content.open { display: block; }
        .construction-toggle.open { transform: rotate(180deg); }
        .construction-formula { text-align: center; padding: 15px; background: #2d3748; border-radius: 8px; margin-bottom: 20px; font-family: 'Courier New', monospace; font-size: 1rem; color: #e2e8f0; }
        .construction-formula .highlight { color: #48bb78; font-weight: bold; }
        .component-links { display: flex; gap: 10px; justify-content: center; margin-top: 15px; flex-wrap: wrap; }
        .component-link { padding: 8px 16px; background: #4299e1; color: white; text-decoration: none; border-radius: 6px; font-size: 14px; }
        .component-link:hover { background: #3182ce; }
        .construction-explanation { color: #a0aec0; font-size: 14px; line-height: 1.6; margin: 15px 0; }
    </style>
</head>
<body>
    <h1>Additionneur Complet (Full Adder)</h1>
    <p class="subtitle">Additionne trois bits - A, B et Carry-In</p>

    <div class="container">
        <p class="instructions">Cliquez sur les entrees A, B et Cin pour changer leur valeur</p>

        <svg class="circuit-svg" viewBox="0 0 400 200" xmlns="http://www.w3.org/2000/svg">
            <!-- Main box representation -->
            <rect class="gate-body" x="140" y="50" width="120" height="100" rx="8"/>

            <!-- Input wires with right angles -->
            <path id="wireA" class="wire off" d="M 40 70 L 100 70 L 100 75 L 140 75"/>
            <path id="wireB" class="wire off" d="M 40 100 L 100 100 L 100 100 L 140 100"/>
            <path id="wireCin" class="wire off" d="M 40 130 L 100 130 L 100 125 L 140 125"/>

            <!-- Output wires -->
            <path id="wireSum" class="wire off" d="M 260 80 L 360 80"/>
            <path id="wireCout" class="wire off" d="M 260 120 L 360 120"/>

            <!-- Input A toggle -->
            <g class="input-toggle" onclick="toggleInput('A')">
                <circle id="inputA" cx="40" cy="70" r="16" fill="#e53e3e"/>
                <text x="40" y="75" text-anchor="middle" fill="white" font-weight="bold" font-size="14">0</text>
            </g>

            <!-- Input B toggle -->
            <g class="input-toggle" onclick="toggleInput('B')">
                <circle id="inputB" cx="40" cy="100" r="16" fill="#e53e3e"/>
                <text x="40" y="105" text-anchor="middle" fill="white" font-weight="bold" font-size="14">0</text>
            </g>

            <!-- Input Cin toggle -->
            <g class="input-toggle" onclick="toggleInput('C')">
                <circle id="inputCin" cx="40" cy="130" r="16" fill="#4299e1"/>
                <text x="40" y="135" text-anchor="middle" fill="white" font-weight="bold" font-size="14">0</text>
            </g>

            <!-- Sum output indicator -->
            <circle id="outputSum" cx="360" cy="80" r="16" fill="#e53e3e"/>
            <text id="outputSumText" x="360" y="85" text-anchor="middle" fill="white" font-weight="bold" font-size="14">0</text>

            <!-- Carry out output indicator -->
            <circle id="outputCout" cx="360" cy="120" r="16" fill="#e53e3e"/>
            <text id="outputCoutText" x="360" y="125" text-anchor="middle" fill="white" font-weight="bold" font-size="14">0</text>

            <!-- Labels -->
            <text class="label label-input" x="40" y="48" text-anchor="middle">A</text>
            <text class="label label-input" x="15" y="105" text-anchor="middle">B</text>
            <text class="label" x="40" y="162" text-anchor="middle" fill="#4299e1">Cin</text>
            <text class="label label-output" x="360" y="58" text-anchor="middle">SUM</text>
            <text class="label label-output" x="360" y="152" text-anchor="middle">Cout</text>
            <text x="200" y="105" text-anchor="middle" fill="#a0aec0" font-size="12">FULL ADDER</text>
        </svg>

        <div style="text-align: center; margin: 20px 0; font-family: 'Courier New', monospace;">
            <div style="font-size: 24px;">
                <span id="visualA" style="color: #fc8181;">0</span>
                <span style="color: #a0aec0;"> + </span>
                <span id="visualB" style="color: #fc8181;">0</span>
                <span style="color: #a0aec0;"> + </span>
                <span id="visualCin" style="color: #4299e1;">0</span>
                <span style="color: #a0aec0;"> = </span>
                <span id="visualCout" style="color: #f6ad55;">0</span>
                <span id="visualSum" style="color: #48bb78;">0</span>
            </div>
            <div style="font-size: 14px; color: #718096; margin-top: 5px;">
                Resultat decimal: <span id="decResult" style="color: #48bb78;">0</span>
            </div>
        </div>

        <div class="status">
            <div class="status-item">
                <span>A =</span>
                <span id="statusA" class="status-value off">0</span>
            </div>
            <div class="status-item">
                <span>B =</span>
                <span id="statusB" class="status-value off">0</span>
            </div>
            <div class="status-item">
                <span>Cin =</span>
                <span id="statusCin" class="status-value off" style="color: #4299e1;">0</span>
            </div>
            <div class="status-item">
                <span>SUM =</span>
                <span id="statusSum" class="status-value off">0</span>
            </div>
            <div class="status-item">
                <span>Cout =</span>
                <span id="statusCout" class="status-value off">0</span>
            </div>
        </div>

        <div style="text-align: center; margin: 20px 0; padding: 15px; background: #2d3748; border-radius: 8px;">
            <p style="color: #e2e8f0; font-family: 'Courier New', monospace;">
                SUM = A XOR B XOR Cin | Cout = (A AND B) OR (Cin AND (A XOR B))
            </p>
        </div>

        <table class="truth-table">
            <thead>
                <tr><th>A</th><th>B</th><th>Cin</th><th>SUM</th><th>Cout</th></tr>
            </thead>
            <tbody id="truthTable">
                <tr class="active"><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td></tr>
                <tr><td>0</td><td>0</td><td>1</td><td>1</td><td>0</td></tr>
                <tr><td>0</td><td>1</td><td>0</td><td>1</td><td>0</td></tr>
                <tr><td>0</td><td>1</td><td>1</td><td>0</td><td>1</td></tr>
                <tr><td>1</td><td>0</td><td>0</td><td>1</td><td>0</td></tr>
                <tr><td>1</td><td>0</td><td>1</td><td>0</td><td>1</td></tr>
                <tr><td>1</td><td>1</td><td>0</td><td>0</td><td>1</td></tr>
                <tr><td>1</td><td>1</td><td>1</td><td>1</td><td>1</td></tr>
            </tbody>
        </table>

        <div class="controls">
            <button class="btn btn-secondary" onclick="reset()">Reset</button>
            <button id="animBtn" class="btn btn-primary" onclick="animate()">Animation Auto</button>
        </div>

        <!-- Construction Section -->
        <div class="construction-section">
            <div class="construction-header" onclick="toggleConstruction()">
                <h3>Voir la Construction</h3>
                <span class="construction-toggle" id="constructionToggle">&#9660;</span>
            </div>
            <div class="construction-content" id="constructionContent">
                <div class="construction-formula">
                    <span class="highlight">Full Adder</span> = 2 x Half Adder + OR
                </div>

                <p class="construction-explanation">
                    L'additionneur complet utilise deux demi-additionneurs en cascade.
                    Le premier additionne A et B, le second ajoute Cin au resultat.
                    La retenue finale est le OR des deux retenues intermediaires.
                </p>

                <svg viewBox="0 0 480 160" xmlns="http://www.w3.org/2000/svg" style="max-width: 480px; margin: 0 auto; display: block;">
                    <!-- Inputs -->
                    <path class="wire off" d="M 30 40 L 70 40"/>
                    <path class="wire off" d="M 30 70 L 70 70"/>
                    <path class="wire off" d="M 30 130 L 200 130 L 200 90"/>

                    <!-- HA1 -->
                    <rect x="70" y="30" width="70" height="50" rx="6" fill="#2d3748" stroke="#4299e1" stroke-width="2"/>
                    <text x="105" y="60" text-anchor="middle" fill="#4299e1" font-size="10">HA1</text>

                    <!-- HA1 to HA2 -->
                    <path class="wire on" d="M 140 45 L 180 45 L 180 55"/>
                    <path class="wire off" d="M 140 65 L 160 65 L 160 130 L 300 130"/>

                    <!-- HA2 -->
                    <rect x="180" y="45" width="70" height="50" rx="6" fill="#2d3748" stroke="#48bb78" stroke-width="2"/>
                    <text x="215" y="75" text-anchor="middle" fill="#48bb78" font-size="10">HA2</text>

                    <!-- HA2 to OR -->
                    <path class="wire on" d="M 250 60 L 420 40"/>
                    <path class="wire off" d="M 250 80 L 280 80 L 280 115 L 300 115"/>

                    <!-- OR gate -->
                    <path d="M 290 100 Q 310 120 290 140 Q 330 140 350 140 Q 380 120 350 100 Q 330 100 290 100 Z" fill="#2d3748" stroke="#f6ad55" stroke-width="2"/>
                    <text x="335" y="125" text-anchor="middle" fill="#f6ad55" font-size="9">OR</text>

                    <!-- OR output -->
                    <path class="wire off" d="M 380 120 L 420 120"/>

                    <!-- Input labels -->
                    <circle cx="30" cy="40" r="10" fill="#e53e3e"/>
                    <text x="30" y="44" text-anchor="middle" fill="white" font-size="9">A</text>
                    <circle cx="30" cy="70" r="10" fill="#e53e3e"/>
                    <text x="30" y="74" text-anchor="middle" fill="white" font-size="9">B</text>
                    <circle cx="30" cy="130" r="10" fill="#4299e1"/>
                    <text x="30" y="134" text-anchor="middle" fill="white" font-size="8">Cin</text>

                    <!-- Outputs -->
                    <circle cx="420" cy="40" r="12" fill="#48bb78"/>
                    <text x="420" y="44" text-anchor="middle" fill="white" font-size="9">S</text>
                    <circle cx="420" cy="120" r="12" fill="#f6ad55"/>
                    <text x="420" y="124" text-anchor="middle" fill="white" font-size="8">Co</text>

                    <!-- Labels -->
                    <text x="420" y="25" fill="#48bb78" font-size="9" text-anchor="middle">SUM</text>
                    <text x="420" y="145" fill="#f6ad55" font-size="9" text-anchor="middle">Cout</text>
                    <text x="105" y="25" fill="#718096" font-size="8" text-anchor="middle">A+B</text>
                    <text x="215" y="40" fill="#718096" font-size="8" text-anchor="middle">(A+B)+Cin</text>
                </svg>

                <p class="construction-explanation" style="text-align: center; margin-top: 15px;">
                    <strong>Etapes:</strong><br>
                    1. HA1: sum1 = A XOR B, carry1 = A AND B<br>
                    2. HA2: SUM = sum1 XOR Cin, carry2 = sum1 AND Cin<br>
                    3. Cout = carry1 OR carry2
                </p>

                <div class="component-links">
                    <a href="half-adder.html" class="component-link">Voir Half Adder</a>
                    <a href="or.html" class="component-link">Voir OR</a>
                    <a href="add16.html" class="component-link">Voir Add16</a>
                </div>
            </div>
        </div>
    </div>

    <nav class="nav" style="margin-top: 20px;">
        <a href="index.html">Index</a>
        <a href="half-adder.html">Demi-Additionneur</a>
        <a href="add16.html">Additionneur 16-bit</a>
        <a href="alu.html">ALU</a>
    </nav>

    <script>
        let inputs = { A: 0, B: 0, C: 0 };
        let animating = false;

        function updateAnimBtn() {
            const btn = document.getElementById('animBtn');
            btn.textContent = animating ? 'Stop' : 'Animation Auto';
            btn.classList.toggle('animating', animating);
        }

        function fullAdder(a, b, cin) {
            const sum = a ^ b ^ cin;
            const cout = (a & b) | (cin & (a ^ b));
            return { sum, cout };
        }

        function toggleInput(input) {
            if (animating) return;
            inputs[input] = 1 - inputs[input];
            updateCircuit();
        }

        function updateCircuit() {
            const result = fullAdder(inputs.A, inputs.B, inputs.C);
            const total = inputs.A + inputs.B + inputs.C;

            document.getElementById('inputA').setAttribute('fill', inputs.A ? '#48bb78' : '#e53e3e');
            document.getElementById('inputB').setAttribute('fill', inputs.B ? '#48bb78' : '#e53e3e');
            document.getElementById('inputCin').setAttribute('fill', inputs.C ? '#48bb78' : '#4299e1');
            document.querySelector('#inputA + text').textContent = inputs.A;
            document.querySelector('#inputB + text').textContent = inputs.B;
            document.querySelector('#inputCin + text').textContent = inputs.C;

            document.getElementById('wireA').className.baseVal = 'wire ' + (inputs.A ? 'on' : 'off');
            document.getElementById('wireB').className.baseVal = 'wire ' + (inputs.B ? 'on' : 'off');
            document.getElementById('wireCin').className.baseVal = 'wire ' + (inputs.C ? 'on' : 'off');
            document.getElementById('wireSum').className.baseVal = 'wire ' + (result.sum ? 'on' : 'off');
            document.getElementById('wireCout').className.baseVal = 'wire ' + (result.cout ? 'on' : 'off');

            document.getElementById('outputSum').setAttribute('fill', result.sum ? '#48bb78' : '#e53e3e');
            document.getElementById('outputSumText').textContent = result.sum;
            document.getElementById('outputCout').setAttribute('fill', result.cout ? '#48bb78' : '#e53e3e');
            document.getElementById('outputCoutText').textContent = result.cout;

            document.getElementById('visualA').textContent = inputs.A;
            document.getElementById('visualB').textContent = inputs.B;
            document.getElementById('visualCin').textContent = inputs.C;
            document.getElementById('visualSum').textContent = result.sum;
            document.getElementById('visualCout').textContent = result.cout;
            document.getElementById('decResult').textContent = total;

            document.getElementById('statusA').textContent = inputs.A;
            document.getElementById('statusA').className = 'status-value ' + (inputs.A ? 'on' : 'off');
            document.getElementById('statusB').textContent = inputs.B;
            document.getElementById('statusB').className = 'status-value ' + (inputs.B ? 'on' : 'off');
            document.getElementById('statusCin').textContent = inputs.C;
            document.getElementById('statusSum').textContent = result.sum;
            document.getElementById('statusSum').className = 'status-value ' + (result.sum ? 'on' : 'off');
            document.getElementById('statusCout').textContent = result.cout;
            document.getElementById('statusCout').className = 'status-value ' + (result.cout ? 'on' : 'off');

            const rows = document.querySelectorAll('#truthTable tr');
            const index = inputs.A * 4 + inputs.B * 2 + inputs.C;
            rows.forEach((row, i) => row.className = i === index ? 'active' : '');
        }

        function reset() {
            animating = false;
            updateAnimBtn();
            inputs = { A: 0, B: 0, C: 0 };
            updateCircuit();
        }

        async function animate() {
            if (animating) {
                animating = false;
                updateAnimBtn();
                return;
            }
            animating = true;
            updateAnimBtn();

            while (animating) {
                for (let i = 0; i < 8; i++) {
                    if (!animating) break;
                    inputs.A = (i >> 2) & 1;
                    inputs.B = (i >> 1) & 1;
                    inputs.C = i & 1;
                    updateCircuit();
                    await new Promise(r => setTimeout(r, 1000));
                }
            }
            updateAnimBtn();
        }

        function toggleConstruction() {
            document.getElementById('constructionContent').classList.toggle('open');
            document.getElementById('constructionToggle').classList.toggle('open');
        }

        updateCircuit();
    </script>
</body>
</html>
