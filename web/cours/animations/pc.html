<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PC (Program Counter) - Animation Interactive</title>
    <link rel="stylesheet" href="common.css">
    <style>
        .pc-display {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            border-radius: 16px;
            margin: 20px 0;
        }
        .pc-value {
            font-size: 4rem;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #48bb78;
            text-shadow: 0 0 20px rgba(72, 187, 120, 0.5);
        }
        .pc-binary {
            font-size: 1rem;
            color: #718096;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
        }
        .mode-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        .mode-btn {
            padding: 15px 25px;
            border: 3px solid #4a5568;
            border-radius: 10px;
            background: #2d3748;
            color: #e2e8f0;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
        }
        .mode-btn:hover {
            border-color: #4299e1;
            background: #4a5568;
        }
        .mode-btn.active {
            border-color: #48bb78;
            background: #276749;
        }
        .mode-btn .mode-icon {
            font-size: 24px;
            display: block;
            margin-bottom: 5px;
        }
        .jump-input {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        .jump-input input {
            padding: 12px 20px;
            border: 2px solid #4a5568;
            border-radius: 8px;
            background: #1a202c;
            color: #e2e8f0;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            width: 120px;
            text-align: center;
        }
        .history-display {
            display: flex;
            gap: 5px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        .history-item {
            padding: 8px 12px;
            background: #2d3748;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #a0aec0;
        }
        .history-item.current {
            background: #4299e1;
            color: white;
        }
    </style>
</head>
<body>
    <h1>PC - Program Counter</h1>
    <p class="subtitle">Compteur de programme avec modes: Reset, Jump, Increment, Hold</p>

    <div class="container">
        <svg class="circuit-svg" viewBox="0 0 500 220" xmlns="http://www.w3.org/2000/svg">
            <!-- PC box -->
            <rect class="gate-body" x="150" y="40" width="200" height="140" rx="15" stroke="#48bb78" stroke-width="3"/>

            <!-- Internal MUX representation -->
            <path d="M 180 70 L 220 80 L 220 120 L 180 130 Z" fill="#4a5568" stroke="#718096"/>
            <text x="200" y="105" text-anchor="middle" fill="#a0aec0" font-size="8">MUX</text>

            <!-- Internal Register -->
            <rect x="250" y="75" width="70" height="50" rx="5" fill="#4a5568" stroke="#718096"/>
            <text x="285" y="105" text-anchor="middle" fill="#a0aec0" font-size="8">REG</text>

            <!-- Increment feedback loop -->
            <path class="wire on" d="M 320 100 L 340 100 L 340 160 L 170 160 L 170 120 L 180 120"
                  stroke-dasharray="4" stroke="#f6ad55" fill="none" stroke-width="2"/>
            <text x="255" y="175" text-anchor="middle" fill="#f6ad55" font-size="10">+1 (increment)</text>

            <!-- Control wires -->
            <path id="wireReset" class="wire off" d="M 50 60 L 150 60 L 150 80 L 180 85"/>
            <path id="wireJump" class="wire off" d="M 50 100 L 100 100 L 100 95 L 180 95"/>
            <path id="wireInc" class="wire off" d="M 50 140 L 100 140 L 100 115 L 180 115"/>

            <!-- Jump address input -->
            <path id="wireAddr" class="wire off" d="M 50 180 L 180 180 L 180 125"/>

            <!-- Output wire -->
            <path id="wireOut" class="wire on" d="M 320 100 L 450 100"/>

            <!-- Clock -->
            <path id="wireClk" class="wire off" d="M 285 180 L 285 125"/>

            <!-- Control indicators -->
            <g class="input-toggle" onclick="setMode('reset')">
                <circle id="resetCircle" cx="50" cy="60" r="15" fill="#4a5568"/>
                <text x="50" y="64" text-anchor="middle" fill="white" font-size="10">R</text>
            </g>

            <g class="input-toggle" onclick="setMode('jump')">
                <circle id="jumpCircle" cx="50" cy="100" r="15" fill="#4a5568"/>
                <text x="50" y="104" text-anchor="middle" fill="white" font-size="10">J</text>
            </g>

            <g class="input-toggle" onclick="setMode('inc')">
                <circle id="incCircle" cx="50" cy="140" r="15" fill="#4a5568"/>
                <text x="50" y="144" text-anchor="middle" fill="white" font-size="10">I</text>
            </g>

            <!-- Jump address indicator -->
            <rect x="20" y="165" width="60" height="30" rx="6" fill="#4299e1"/>
            <text id="addrText" x="50" y="185" text-anchor="middle" fill="white" font-size="12">0</text>

            <!-- Clock button -->
            <g class="input-toggle" onclick="clockPulse()">
                <rect id="clockBtn" x="260" y="175" width="50" height="30" rx="6" fill="#f6ad55"/>
                <text x="285" y="195" text-anchor="middle" fill="white" font-size="12">CLK</text>
            </g>

            <!-- Output -->
            <circle id="outputCircle" cx="450" cy="100" r="22" fill="#48bb78"/>
            <text id="outputText" x="450" y="106" text-anchor="middle" fill="white" font-weight="bold" font-size="16">0</text>

            <!-- Labels -->
            <text class="label" x="15" y="45" fill="#fc8181" font-size="10">reset</text>
            <text class="label" x="15" y="90" fill="#48bb78" font-size="10">jump</text>
            <text class="label" x="15" y="130" fill="#f6ad55" font-size="10">inc</text>
            <text class="label" x="50" y="160" fill="#4299e1" font-size="10" text-anchor="middle">addr</text>
            <text class="label label-output" x="450" y="70">PC</text>

            <text x="250" y="30" text-anchor="middle" fill="#a0aec0" font-size="14">PROGRAM COUNTER</text>
        </svg>

        <div class="pc-display">
            <div class="pc-value" id="pcValue">0</div>
            <div class="pc-binary" id="pcBinary">00000000</div>
        </div>

        <div class="mode-buttons">
            <button class="mode-btn" id="btnReset" onclick="setMode('reset')">
                <span class="mode-icon">↺</span>
                RESET (PC = 0)
            </button>
            <button class="mode-btn" id="btnJump" onclick="setMode('jump')">
                <span class="mode-icon">→</span>
                JUMP (PC = addr)
            </button>
            <button class="mode-btn active" id="btnInc" onclick="setMode('inc')">
                <span class="mode-icon">+1</span>
                INCREMENT (PC++)
            </button>
            <button class="mode-btn" id="btnHold" onclick="setMode('hold')">
                <span class="mode-icon">⏸</span>
                HOLD (PC = PC)
            </button>
        </div>

        <div class="jump-input" id="jumpInput" style="display: none;">
            <span style="color: #a0aec0;">Adresse de saut:</span>
            <input type="number" id="jumpAddr" value="0" min="0" max="255" onchange="updateJumpAddr()">
        </div>

        <h3 style="text-align: center; color: #a0aec0; margin-top: 20px;">Historique</h3>
        <div class="history-display" id="history"></div>

        <div class="status">
            <div class="status-item">
                <span>Mode =</span>
                <span id="statusMode" style="color: #f6ad55;">inc</span>
            </div>
            <div class="status-item">
                <span>PC =</span>
                <span id="statusPC" class="status-value on">0</span>
            </div>
        </div>

        <div style="text-align: center; margin: 20px 0; padding: 15px; background: #2d3748; border-radius: 8px;">
            <p style="color: #a0aec0; margin-bottom: 10px;">Priorite des modes (du plus haut au plus bas):</p>
            <p style="color: #e2e8f0; font-family: 'Courier New', monospace; font-size: 14px;">
                1. reset → PC = 0<br>
                2. jump → PC = address<br>
                3. inc → PC = PC + 1<br>
                4. hold → PC = PC
            </p>
        </div>

        <div class="controls">
            <button class="btn btn-secondary" onclick="reset()">Reset</button>
            <button id="animBtn" class="btn btn-primary" onclick="animate()">Demo Execution</button>
        </div>
    </div>

    <nav class="nav" style="margin-top: 20px;">
        <a href="index.html">Index</a>
        <a href="register.html">Registre</a>
        <a href="ram.html">RAM</a>
        <a href="alu.html">ALU</a>
    </nav>

    <script>
        let pc = 0;
        let mode = 'inc';
        let jumpAddr = 0;
        let history = [0];
        let animating = false;
        const maxHistory = 15;

        function updateAnimBtn() {
            const btn = document.getElementById('animBtn');
            btn.textContent = animating ? 'Stop' : 'Demo Execution';
            btn.classList.toggle('animating', animating);
        }


        function toBinary(n, bits = 8) {
            return n.toString(2).padStart(bits, '0');
        }

        function setMode(m) {
            mode = m;
            updateDisplay();
        }

        function updateJumpAddr() {
            jumpAddr = parseInt(document.getElementById('jumpAddr').value) || 0;
            jumpAddr = Math.max(0, Math.min(255, jumpAddr));
            document.getElementById('jumpAddr').value = jumpAddr;
            document.getElementById('addrText').textContent = jumpAddr;
        }

        async function clockPulse() {
            if (animating) return;

            const clockBtn = document.getElementById('clockBtn');
            clockBtn.setAttribute('fill', '#48bb78');
            document.getElementById('wireClk').className.baseVal = 'wire on';

            // Apply mode
            switch (mode) {
                case 'reset':
                    pc = 0;
                    break;
                case 'jump':
                    pc = jumpAddr;
                    break;
                case 'inc':
                    pc = (pc + 1) % 256;
                    break;
                case 'hold':
                    // PC stays the same
                    break;
            }

            history.push(pc);
            if (history.length > maxHistory) history.shift();

            updateDisplay();

            await new Promise(r => setTimeout(r, 300));
            clockBtn.setAttribute('fill', '#f6ad55');
            document.getElementById('wireClk').className.baseVal = 'wire off';
        }

        function updateDisplay() {
            // Update PC display
            document.getElementById('pcValue').textContent = pc;
            document.getElementById('pcBinary').textContent = toBinary(pc);
            document.getElementById('outputText').textContent = pc;

            // Update mode buttons
            ['reset', 'jump', 'inc', 'hold'].forEach(m => {
                document.getElementById('btn' + m.charAt(0).toUpperCase() + m.slice(1))
                    .classList.toggle('active', mode === m);
            });

            // Show/hide jump input
            document.getElementById('jumpInput').style.display = mode === 'jump' ? 'flex' : 'none';

            // Update control indicators
            document.getElementById('resetCircle').setAttribute('fill', mode === 'reset' ? '#e53e3e' : '#4a5568');
            document.getElementById('jumpCircle').setAttribute('fill', mode === 'jump' ? '#48bb78' : '#4a5568');
            document.getElementById('incCircle').setAttribute('fill', mode === 'inc' ? '#f6ad55' : '#4a5568');

            document.getElementById('wireReset').className.baseVal = 'wire ' + (mode === 'reset' ? 'on' : 'off');
            document.getElementById('wireJump').className.baseVal = 'wire ' + (mode === 'jump' ? 'on' : 'off');
            document.getElementById('wireInc').className.baseVal = 'wire ' + (mode === 'inc' ? 'on' : 'off');
            document.getElementById('wireAddr').className.baseVal = 'wire ' + (mode === 'jump' ? 'on' : 'off');

            // Update status
            document.getElementById('statusMode').textContent = mode;
            document.getElementById('statusPC').textContent = pc;

            // Update history
            const historyDiv = document.getElementById('history');
            historyDiv.innerHTML = '';
            history.forEach((val, i) => {
                const item = document.createElement('span');
                item.className = 'history-item' + (i === history.length - 1 ? ' current' : '');
                item.textContent = val;
                historyDiv.appendChild(item);
            });
        }

        function reset() {
            animating = false;
            updateAnimBtn();
            pc = 0;
            mode = 'inc';
            jumpAddr = 0;
            history = [0];
            document.getElementById('jumpAddr').value = 0;
            updateDisplay();
        }

        async function animate() {
            if (animating) {
                animating = false;
                updateAnimBtn();
                return;
            }
            animating = true;
            updateAnimBtn();

            // Demo: simulate program execution
            const sequence = [
                { mode: 'inc' }, { clock: true },  // 1
                { mode: 'inc' }, { clock: true },  // 2
                { mode: 'inc' }, { clock: true },  // 3
                { mode: 'jump', addr: 10 }, { clock: true },  // Jump to 10
                { mode: 'inc' }, { clock: true },  // 11
                { mode: 'inc' }, { clock: true },  // 12
                { mode: 'hold' }, { clock: true }, // Still 12
                { mode: 'hold' }, { clock: true }, // Still 12
                { mode: 'inc' }, { clock: true },  // 13
                { mode: 'reset' }, { clock: true }, // Back to 0
                { mode: 'inc' }, { clock: true },  // 1
                { mode: 'inc' }, { clock: true },  // 2
            ];

            for (const action of sequence) {
                if (!animating) break;

                if (action.mode) {
                    setMode(action.mode);
                    if (action.addr !== undefined) {
                        jumpAddr = action.addr;
                        document.getElementById('jumpAddr').value = action.addr;
                        document.getElementById('addrText').textContent = action.addr;
                    }
                    await new Promise(r => setTimeout(r, 400));
                }

                if (action.clock) {
                    await clockPulse();
                    await new Promise(r => setTimeout(r, 500));
                }
            }

            animating = false;
            updateAnimBtn();
        }

        // Initialize
        updateDisplay();
    </script>
</body>
</html>
