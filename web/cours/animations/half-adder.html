<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demi-Additionneur (Half Adder) - Animation Interactive</title>
    <link rel="stylesheet" href="common.css">
    <style>
        .construction-section { margin-top: 30px; border: 2px solid #4a5568; border-radius: 12px; overflow: hidden; }
        .construction-header { background: #2d3748; padding: 15px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .construction-header:hover { background: #4a5568; }
        .construction-header h3 { margin: 0; color: #e2e8f0; font-size: 1.1rem; }
        .construction-toggle { color: #4299e1; font-size: 1.5rem; transition: transform 0.3s; }
        .construction-content { display: none; padding: 20px; background: #1a202c; }
        .construction-content.open { display: block; }
        .construction-toggle.open { transform: rotate(180deg); }
        .construction-formula { text-align: center; padding: 15px; background: #2d3748; border-radius: 8px; margin-bottom: 20px; font-family: 'Courier New', monospace; font-size: 1.1rem; color: #e2e8f0; }
        .construction-formula .highlight { color: #48bb78; font-weight: bold; }
        .component-links { display: flex; gap: 10px; justify-content: center; margin-top: 15px; flex-wrap: wrap; }
        .component-link { padding: 8px 16px; background: #4299e1; color: white; text-decoration: none; border-radius: 6px; font-size: 14px; }
        .component-link:hover { background: #3182ce; }
        .construction-explanation { color: #a0aec0; font-size: 14px; line-height: 1.6; margin: 15px 0; }
    </style>
</head>
<body>
    <h1>Demi-Additionneur (Half Adder)</h1>
    <p class="subtitle">Additionne deux bits - SUM et CARRY</p>

    <div class="container">
        <p class="instructions">Cliquez sur les entrees A et B pour changer leur valeur</p>

        <svg class="circuit-svg" viewBox="0 0 400 200" xmlns="http://www.w3.org/2000/svg">
            <!-- Input wires with right angles -->
            <path id="wireA" class="wire off" d="M 40 60 L 80 60"/>
            <path id="wireB" class="wire off" d="M 40 140 L 80 140"/>

            <!-- Split wires to gates -->
            <path id="wireAXor" class="wire off" d="M 80 60 L 80 75 L 120 75"/>
            <path id="wireBXor" class="wire off" d="M 80 140 L 80 105 L 120 105"/>
            <path id="wireAAnd" class="wire off" d="M 80 60 L 80 40 L 240 40 L 240 75 L 260 75"/>
            <path id="wireBAnd" class="wire off" d="M 80 140 L 80 160 L 240 160 L 240 105 L 260 105"/>

            <!-- Output wires -->
            <path id="wireSum" class="wire off" d="M 210 90 L 360 60"/>
            <path id="wireCarry" class="wire off" d="M 350 90 L 360 140"/>

            <!-- XOR gate (for SUM) -->
            <path class="gate-body" d="M 110 60 Q 130 90 110 120"/>
            <path class="gate-body" d="M 120 60 Q 140 90 120 120 Q 160 120 190 120 Q 220 90 190 60 Q 160 60 120 60 Z"/>

            <!-- AND gate (for CARRY) -->
            <path class="gate-body" d="M 260 60 L 260 120 L 300 120 Q 340 120 340 90 Q 340 60 300 60 Z"/>

            <!-- Input A toggle -->
            <g class="input-toggle" onclick="toggleInput('A')">
                <circle id="inputA" cx="40" cy="60" r="16" fill="#e53e3e"/>
                <text x="40" y="65" text-anchor="middle" fill="white" font-weight="bold" font-size="14">0</text>
            </g>

            <!-- Input B toggle -->
            <g class="input-toggle" onclick="toggleInput('B')">
                <circle id="inputB" cx="40" cy="140" r="16" fill="#e53e3e"/>
                <text x="40" y="145" text-anchor="middle" fill="white" font-weight="bold" font-size="14">0</text>
            </g>

            <!-- Sum output indicator -->
            <circle id="outputSum" cx="360" cy="60" r="16" fill="#e53e3e"/>
            <text id="outputSumText" x="360" y="65" text-anchor="middle" fill="white" font-weight="bold" font-size="14">0</text>

            <!-- Carry output indicator -->
            <circle id="outputCarry" cx="360" cy="140" r="16" fill="#e53e3e"/>
            <text id="outputCarryText" x="360" y="145" text-anchor="middle" fill="white" font-weight="bold" font-size="14">0</text>

            <!-- Labels -->
            <text class="label label-input" x="40" y="38" text-anchor="middle">A</text>
            <text class="label label-input" x="40" y="172" text-anchor="middle">B</text>
            <text class="label label-output" x="360" y="38" text-anchor="middle">SUM</text>
            <text class="label label-output" x="360" y="172" text-anchor="middle">CARRY</text>
            <text x="165" y="95" text-anchor="middle" fill="#a0aec0" font-size="10">XOR</text>
            <text x="300" y="95" text-anchor="middle" fill="#a0aec0" font-size="10">AND</text>
        </svg>

        <div style="text-align: center; margin: 20px 0; font-family: 'Courier New', monospace; font-size: 24px;">
            <span id="visualA" style="color: #fc8181;">0</span>
            <span style="color: #a0aec0;"> + </span>
            <span id="visualB" style="color: #fc8181;">0</span>
            <span style="color: #a0aec0;"> = </span>
            <span id="visualCarry" style="color: #63b3ed;">0</span>
            <span id="visualSum" style="color: #48bb78;">0</span>
            <span style="color: #718096; font-size: 14px;"> (binaire)</span>
        </div>

        <div class="status">
            <div class="status-item">
                <span>A =</span>
                <span id="statusA" class="status-value off">0</span>
            </div>
            <div class="status-item">
                <span>B =</span>
                <span id="statusB" class="status-value off">0</span>
            </div>
            <div class="status-item">
                <span>SUM =</span>
                <span id="statusSum" class="status-value off">0</span>
            </div>
            <div class="status-item">
                <span>CARRY =</span>
                <span id="statusCarry" class="status-value off">0</span>
            </div>
        </div>

        <div style="text-align: center; margin: 20px 0; padding: 15px; background: #2d3748; border-radius: 8px;">
            <p style="color: #e2e8f0; font-family: 'Courier New', monospace;">
                SUM = A XOR B | CARRY = A AND B
            </p>
        </div>

        <table class="truth-table">
            <thead>
                <tr><th>A</th><th>B</th><th>SUM</th><th>CARRY</th></tr>
            </thead>
            <tbody id="truthTable">
                <tr class="active"><td>0</td><td>0</td><td>0</td><td>0</td></tr>
                <tr><td>0</td><td>1</td><td>1</td><td>0</td></tr>
                <tr><td>1</td><td>0</td><td>1</td><td>0</td></tr>
                <tr><td>1</td><td>1</td><td>0</td><td>1</td></tr>
            </tbody>
        </table>

        <div class="controls">
            <button class="btn btn-secondary" onclick="reset()">Reset</button>
            <button id="animBtn" class="btn btn-primary" onclick="animate()">Animation Auto</button>
        </div>

        <!-- Construction Section -->
        <div class="construction-section">
            <div class="construction-header" onclick="toggleConstruction()">
                <h3>Voir la Construction</h3>
                <span class="construction-toggle" id="constructionToggle">&#9660;</span>
            </div>
            <div class="construction-content" id="constructionContent">
                <div class="construction-formula">
                    <span class="highlight">SUM</span> = XOR(A, B)<br>
                    <span class="highlight">CARRY</span> = AND(A, B)
                </div>

                <p class="construction-explanation">
                    Le demi-additionneur est le circuit arithmetique le plus simple. Il additionne 2 bits
                    sans retenue entrante. XOR donne la somme (1 si exactement un bit est 1),
                    AND donne la retenue (1 si les deux bits sont 1).
                </p>

                <svg viewBox="0 0 380 140" xmlns="http://www.w3.org/2000/svg" style="max-width: 380px; margin: 0 auto; display: block;">
                    <!-- Input A -->
                    <path id="consWireA" class="wire off" d="M 30 40 L 70 40"/>
                    <path id="consWireAXor" class="wire off" d="M 70 40 L 100 40 L 100 50 L 120 50"/>
                    <path id="consWireAAnd" class="wire off" d="M 70 40 L 70 100 L 120 100"/>

                    <!-- Input B -->
                    <path id="consWireB" class="wire off" d="M 30 70 L 50 70"/>
                    <path id="consWireBXor" class="wire off" d="M 50 70 L 90 70 L 90 60 L 120 60"/>
                    <path id="consWireBAnd" class="wire off" d="M 50 70 L 50 110 L 120 110"/>

                    <!-- Outputs -->
                    <path id="consWireSum" class="wire off" d="M 210 55 L 350 35"/>
                    <path id="consWireCarry" class="wire off" d="M 210 105 L 350 105"/>

                    <!-- XOR gate -->
                    <path d="M 110 35 Q 130 55 110 75" fill="none" stroke="#4299e1" stroke-width="2"/>
                    <path d="M 120 35 Q 140 55 120 75 Q 160 75 185 75 Q 210 55 185 35 Q 160 35 120 35 Z" fill="#2d3748" stroke="#4299e1" stroke-width="2"/>
                    <text x="160" y="60" text-anchor="middle" fill="#4299e1" font-size="9">XOR</text>

                    <!-- AND gate -->
                    <path d="M 120 85 L 120 125 L 155 125 Q 190 125 190 105 Q 190 85 155 85 Z" fill="#2d3748" stroke="#48bb78" stroke-width="2"/>
                    <text x="155" y="110" text-anchor="middle" fill="#48bb78" font-size="9">AND</text>

                    <!-- Inputs -->
                    <circle id="consInputA" cx="30" cy="40" r="12" fill="#e53e3e"/>
                    <text id="consInputTextA" x="30" y="44" text-anchor="middle" fill="white" font-weight="bold" font-size="10">0</text>
                    <circle id="consInputB" cx="30" cy="70" r="12" fill="#e53e3e"/>
                    <text id="consInputTextB" x="30" y="74" text-anchor="middle" fill="white" font-weight="bold" font-size="10">0</text>

                    <!-- Outputs -->
                    <circle id="consOutputSum" cx="350" cy="35" r="12" fill="#e53e3e"/>
                    <text id="consOutputTextSum" x="350" y="39" text-anchor="middle" fill="white" font-weight="bold" font-size="10">0</text>
                    <circle id="consOutputCarry" cx="350" cy="105" r="12" fill="#e53e3e"/>
                    <text id="consOutputTextCarry" x="350" y="109" text-anchor="middle" fill="white" font-weight="bold" font-size="10">0</text>

                    <!-- Labels -->
                    <text x="15" y="44" fill="#a0aec0" font-size="9">A</text>
                    <text x="15" y="74" fill="#a0aec0" font-size="9">B</text>
                    <text x="350" y="20" fill="#4299e1" font-size="9" text-anchor="middle">SUM</text>
                    <text x="350" y="125" fill="#48bb78" font-size="9" text-anchor="middle">CARRY</text>
                </svg>

                <p class="construction-explanation" style="text-align: center; margin-top: 15px;">
                    <strong>Table de verite:</strong><br>
                    0+0 = 0, carry 0 | 0+1 = 1, carry 0<br>
                    1+0 = 1, carry 0 | 1+1 = 0, carry 1 (=2 en binaire)
                </p>

                <div class="component-links">
                    <a href="xor.html" class="component-link">Voir XOR</a>
                    <a href="and.html" class="component-link">Voir AND</a>
                    <a href="full-adder.html" class="component-link">Voir Full Adder</a>
                </div>
            </div>
        </div>
    </div>

    <nav class="nav" style="margin-top: 20px;">
        <a href="index.html">Index</a>
        <a href="full-adder.html">Additionneur Complet</a>
        <a href="add16.html">Additionneur 16-bit</a>
        <a href="alu.html">ALU</a>
    </nav>

    <script>
        let inputs = { A: 0, B: 0 };
        let animating = false;

        function updateAnimBtn() {
            const btn = document.getElementById('animBtn');
            btn.textContent = animating ? 'Stop' : 'Animation Auto';
            btn.classList.toggle('animating', animating);
        }

        function halfAdder(a, b) {
            return { sum: a ^ b, carry: a & b };
        }

        function toggleInput(input) {
            if (animating) return;
            inputs[input] = 1 - inputs[input];
            updateCircuit();
        }

        function updateCircuit() {
            const result = halfAdder(inputs.A, inputs.B);

            document.getElementById('inputA').setAttribute('fill', inputs.A ? '#48bb78' : '#e53e3e');
            document.getElementById('inputB').setAttribute('fill', inputs.B ? '#48bb78' : '#e53e3e');
            document.querySelector('#inputA + text').textContent = inputs.A;
            document.querySelector('#inputB + text').textContent = inputs.B;

            document.getElementById('wireA').className.baseVal = 'wire ' + (inputs.A ? 'on' : 'off');
            document.getElementById('wireB').className.baseVal = 'wire ' + (inputs.B ? 'on' : 'off');
            document.getElementById('wireAXor').className.baseVal = 'wire ' + (inputs.A ? 'on' : 'off');
            document.getElementById('wireBXor').className.baseVal = 'wire ' + (inputs.B ? 'on' : 'off');
            document.getElementById('wireAAnd').className.baseVal = 'wire ' + (inputs.A ? 'on' : 'off');
            document.getElementById('wireBAnd').className.baseVal = 'wire ' + (inputs.B ? 'on' : 'off');
            document.getElementById('wireSum').className.baseVal = 'wire ' + (result.sum ? 'on' : 'off');
            document.getElementById('wireCarry').className.baseVal = 'wire ' + (result.carry ? 'on' : 'off');

            document.getElementById('outputSum').setAttribute('fill', result.sum ? '#48bb78' : '#e53e3e');
            document.getElementById('outputSumText').textContent = result.sum;
            document.getElementById('outputCarry').setAttribute('fill', result.carry ? '#48bb78' : '#e53e3e');
            document.getElementById('outputCarryText').textContent = result.carry;

            document.getElementById('visualA').textContent = inputs.A;
            document.getElementById('visualB').textContent = inputs.B;
            document.getElementById('visualSum').textContent = result.sum;
            document.getElementById('visualCarry').textContent = result.carry;

            document.getElementById('statusA').textContent = inputs.A;
            document.getElementById('statusA').className = 'status-value ' + (inputs.A ? 'on' : 'off');
            document.getElementById('statusB').textContent = inputs.B;
            document.getElementById('statusB').className = 'status-value ' + (inputs.B ? 'on' : 'off');
            document.getElementById('statusSum').textContent = result.sum;
            document.getElementById('statusSum').className = 'status-value ' + (result.sum ? 'on' : 'off');
            document.getElementById('statusCarry').textContent = result.carry;
            document.getElementById('statusCarry').className = 'status-value ' + (result.carry ? 'on' : 'off');

            const rows = document.querySelectorAll('#truthTable tr');
            const index = inputs.A * 2 + inputs.B;
            rows.forEach((row, i) => row.className = i === index ? 'active' : '');
        }

        function reset() {
            animating = false;
            updateAnimBtn();
            inputs = { A: 0, B: 0 };
            updateCircuit();
        }

        async function animate() {
            if (animating) {
                animating = false;
                updateAnimBtn();
                return;
            }
            animating = true;
            updateAnimBtn();

            const states = [[0, 0], [0, 1], [1, 0], [1, 1]];
            while (animating) {
                for (const [a, b] of states) {
                    if (!animating) break;
                    inputs.A = a;
                    inputs.B = b;
                    updateCircuit();
                    await new Promise(r => setTimeout(r, 1200));
                }
            }
            updateAnimBtn();
        }

        function toggleConstruction() {
            document.getElementById('constructionContent').classList.toggle('open');
            document.getElementById('constructionToggle').classList.toggle('open');
        }

        function updateConstructionCircuit() {
            const result = halfAdder(inputs.A, inputs.B);

            document.getElementById('consInputA').setAttribute('fill', inputs.A ? '#48bb78' : '#e53e3e');
            document.getElementById('consInputTextA').textContent = inputs.A;
            document.getElementById('consInputB').setAttribute('fill', inputs.B ? '#48bb78' : '#e53e3e');
            document.getElementById('consInputTextB').textContent = inputs.B;

            document.getElementById('consWireA').className.baseVal = 'wire ' + (inputs.A ? 'on' : 'off');
            document.getElementById('consWireAXor').className.baseVal = 'wire ' + (inputs.A ? 'on' : 'off');
            document.getElementById('consWireAAnd').className.baseVal = 'wire ' + (inputs.A ? 'on' : 'off');
            document.getElementById('consWireB').className.baseVal = 'wire ' + (inputs.B ? 'on' : 'off');
            document.getElementById('consWireBXor').className.baseVal = 'wire ' + (inputs.B ? 'on' : 'off');
            document.getElementById('consWireBAnd').className.baseVal = 'wire ' + (inputs.B ? 'on' : 'off');
            document.getElementById('consWireSum').className.baseVal = 'wire ' + (result.sum ? 'on' : 'off');
            document.getElementById('consWireCarry').className.baseVal = 'wire ' + (result.carry ? 'on' : 'off');

            document.getElementById('consOutputSum').setAttribute('fill', result.sum ? '#48bb78' : '#e53e3e');
            document.getElementById('consOutputTextSum').textContent = result.sum;
            document.getElementById('consOutputCarry').setAttribute('fill', result.carry ? '#48bb78' : '#e53e3e');
            document.getElementById('consOutputTextCarry').textContent = result.carry;
        }

        const originalUpdateCircuit = updateCircuit;
        updateCircuit = function() {
            originalUpdateCircuit();
            updateConstructionCircuit();
        };

        updateCircuit();
    </script>
</body>
</html>
