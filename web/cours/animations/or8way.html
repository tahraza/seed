<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Or8Way - Animation Interactive</title>
    <link rel="stylesheet" href="common.css">
    <style>
        .input-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 6px;
            margin: 15px 0;
        }
        .input-cell {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #e53e3e;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 50px;
        }
        .input-cell.on { background: #48bb78; }
        .input-cell .bit-label { font-size: 9px; color: rgba(255,255,255,0.7); }
        .input-cell .bit-value { font-size: 18px; font-weight: bold; color: white; }
    </style>
</head>
<body>
    <h1>Or8Way</h1>
    <p class="subtitle">OU logique sur 8 bits - Detecte si au moins un bit est a 1</p>

    <div class="container">
        <p class="instructions">Cliquez sur les bits pour les activer/desactiver</p>

        <svg class="circuit-svg" viewBox="0 0 400 220" xmlns="http://www.w3.org/2000/svg">
            <!-- Input wires -->
            <path id="wire0" class="wire off" d="M 60 30 L 140 70"/>
            <path id="wire1" class="wire off" d="M 60 55 L 140 80"/>
            <path id="wire2" class="wire off" d="M 60 80 L 140 90"/>
            <path id="wire3" class="wire off" d="M 60 105 L 140 100"/>
            <path id="wire4" class="wire off" d="M 60 130 L 140 110"/>
            <path id="wire5" class="wire off" d="M 60 155 L 140 120"/>
            <path id="wire6" class="wire off" d="M 60 180 L 140 130"/>
            <path id="wire7" class="wire off" d="M 60 205 L 140 140"/>

            <!-- Output wire -->
            <path id="wireOut" class="wire off" d="M 260 110 L 350 110"/>

            <!-- OR8Way gate -->
            <path class="gate-body" d="M 130 55 Q 160 110 130 165 Q 200 165 240 165 Q 290 110 240 55 Q 200 55 130 55 Z"/>

            <!-- Input indicators -->
            <circle id="in0" cx="60" cy="30" r="10" fill="#e53e3e" class="input-toggle" onclick="toggleBit(0)"/>
            <circle id="in1" cx="60" cy="55" r="10" fill="#e53e3e" class="input-toggle" onclick="toggleBit(1)"/>
            <circle id="in2" cx="60" cy="80" r="10" fill="#e53e3e" class="input-toggle" onclick="toggleBit(2)"/>
            <circle id="in3" cx="60" cy="105" r="10" fill="#e53e3e" class="input-toggle" onclick="toggleBit(3)"/>
            <circle id="in4" cx="60" cy="130" r="10" fill="#e53e3e" class="input-toggle" onclick="toggleBit(4)"/>
            <circle id="in5" cx="60" cy="155" r="10" fill="#e53e3e" class="input-toggle" onclick="toggleBit(5)"/>
            <circle id="in6" cx="60" cy="180" r="10" fill="#e53e3e" class="input-toggle" onclick="toggleBit(6)"/>
            <circle id="in7" cx="60" cy="205" r="10" fill="#e53e3e" class="input-toggle" onclick="toggleBit(7)"/>

            <!-- Output indicator -->
            <circle id="outputCircle" cx="350" cy="110" r="16" fill="#e53e3e"/>
            <text id="outputText" x="350" y="115" text-anchor="middle" fill="white" font-weight="bold" font-size="14">0</text>

            <!-- Labels -->
            <text x="30" y="35" fill="#718096" font-size="9">in[0]</text>
            <text x="30" y="60" fill="#718096" font-size="9">in[1]</text>
            <text x="30" y="85" fill="#718096" font-size="9">in[2]</text>
            <text x="30" y="110" fill="#718096" font-size="9">in[3]</text>
            <text x="30" y="135" fill="#718096" font-size="9">in[4]</text>
            <text x="30" y="160" fill="#718096" font-size="9">in[5]</text>
            <text x="30" y="185" fill="#718096" font-size="9">in[6]</text>
            <text x="30" y="210" fill="#718096" font-size="9">in[7]</text>
            <text class="label label-output" x="350" y="88" text-anchor="middle">OUT</text>
            <text x="200" y="115" text-anchor="middle" fill="#a0aec0" font-size="12">OR8</text>
        </svg>

        <h3 style="text-align: center; color: #a0aec0;">Entrees (cliquez pour basculer)</h3>
        <div class="input-grid" id="inputGrid"></div>

        <div class="status">
            <div class="status-item">
                <span>Entree =</span>
                <span id="statusIn" style="color: #4299e1; font-family: 'Courier New', monospace;">00000000</span>
            </div>
            <div class="status-item">
                <span>Bits a 1 =</span>
                <span id="statusCount" style="color: #f6ad55;">0</span>
            </div>
            <div class="status-item">
                <span>OUT =</span>
                <span id="statusOut" class="status-value off">0</span>
            </div>
        </div>

        <div style="text-align: center; margin: 20px 0; padding: 15px; background: #2d3748; border-radius: 8px;">
            <p style="color: #e2e8f0; font-family: 'Courier New', monospace;">
                OUT = in[0] OR in[1] OR ... OR in[7]
            </p>
        </div>

        <div class="controls">
            <button class="btn btn-secondary" onclick="reset()">Tout a 0</button>
            <button class="btn btn-secondary" onclick="setAll()">Tout a 1</button>
            <button id="animBtn" class="btn btn-primary" onclick="animate()">Animation Auto</button>
        </div>
    </div>

    <nav class="nav" style="margin-top: 20px;">
        <a href="index.html">Index</a>
        <a href="or.html">OR</a>
        <a href="and.html">AND</a>
        <a href="alu.html">ALU</a>
    </nav>

    <script>
        let bits = [0, 0, 0, 0, 0, 0, 0, 0];
        let animating = false;

        function updateAnimBtn() {
            const btn = document.getElementById('animBtn');
            btn.textContent = animating ? 'Stop' : 'Animation Auto';
            btn.classList.toggle('animating', animating);
        }

        function toggleBit(i) {
            if (animating) return;
            bits[i] = 1 - bits[i];
            updateCircuit();
        }

        function renderInputGrid() {
            const grid = document.getElementById('inputGrid');
            grid.innerHTML = '';
            for (let i = 0; i < 8; i++) {
                const cell = document.createElement('div');
                cell.className = 'input-cell' + (bits[i] ? ' on' : '');
                cell.onclick = () => toggleBit(i);
                cell.innerHTML = `<span class="bit-label">bit ${i}</span><span class="bit-value">${bits[i]}</span>`;
                grid.appendChild(cell);
            }
        }

        function updateCircuit() {
            const output = bits.some(b => b === 1) ? 1 : 0;
            const count = bits.filter(b => b === 1).length;

            for (let i = 0; i < 8; i++) {
                document.getElementById('in' + i).setAttribute('fill', bits[i] ? '#48bb78' : '#e53e3e');
                document.getElementById('wire' + i).className.baseVal = 'wire ' + (bits[i] ? 'on' : 'off');
            }

            document.getElementById('wireOut').className.baseVal = 'wire ' + (output ? 'on' : 'off');
            document.getElementById('outputCircle').setAttribute('fill', output ? '#48bb78' : '#e53e3e');
            document.getElementById('outputText').textContent = output;

            document.getElementById('statusIn').textContent = bits.join('');
            document.getElementById('statusCount').textContent = count;
            document.getElementById('statusOut').textContent = output;
            document.getElementById('statusOut').className = 'status-value ' + (output ? 'on' : 'off');

            renderInputGrid();
        }

        function reset() {
            animating = false;
            updateAnimBtn();
            bits = [0, 0, 0, 0, 0, 0, 0, 0];
            updateCircuit();
        }

        function setAll() {
            if (animating) return;
            bits = [1, 1, 1, 1, 1, 1, 1, 1];
            updateCircuit();
        }

        async function animate() {
            if (animating) {
                animating = false;
                updateAnimBtn();
                return;
            }
            animating = true;
            updateAnimBtn();

            bits = [0, 0, 0, 0, 0, 0, 0, 0];
            updateCircuit();

            while (animating) {
                for (let i = 0; i < 8; i++) {
                    if (!animating) break;
                    bits[i] = 1;
                    updateCircuit();
                    await new Promise(r => setTimeout(r, 400));
                }
                await new Promise(r => setTimeout(r, 500));
                for (let i = 0; i < 8; i++) {
                    if (!animating) break;
                    bits[i] = 0;
                    updateCircuit();
                    await new Promise(r => setTimeout(r, 400));
                }
                await new Promise(r => setTimeout(r, 500));
            }
            updateAnimBtn();
        }

        updateCircuit();
    </script>
</body>
</html>
