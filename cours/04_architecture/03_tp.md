---
marp: true
theme: seed-tp
paginate: true
header: "Seed - TP Chapitre 04"
---

# TP Chapitre 04 : Programmation Assembleur A32

## Objectifs pratiques

- √âcrire et ex√©cuter des programmes assembleur
- Utiliser le simulateur A32
- Ma√Ætriser les boucles et conditions
- Manipuler la m√©moire et les p√©riph√©riques

**Dur√©e estim√©e :** 2h

**Pr√©requis :** TD Chapitre 04 termin√©

---

## Pr√©paration

### Acc√®s au Simulateur

üëâ [Ouvrir le Simulateur A32](https://seed.music-music.fr/)

S√©lectionnez **A32 Assembly** dans le menu.

**Interface :**
- Zone code (gauche)
- Registres (droite)
- M√©moire (bas)
- Contr√¥les : Run, Step, Reset

---

## Exercice 1 : Premier Programme

**Objectif :** V√©rifier que l'environnement fonctionne

### Code

```asm
; Mon premier programme A32
.text
.global _start

_start:
    MOV R0, #42       ; R0 = 42
    MOV R1, #10       ; R1 = 10
    ADD R2, R0, R1    ; R2 = R0 + R1
    HALT
```

### Validation

üëâ [Ex√©cuter dans le simulateur](https://seed.music-music.fr/)

‚úÖ Apr√®s ex√©cution, R2 doit contenir **52**

---

## Exercice 2 : Op√©rations Arithm√©tiques

**Objectif :** Pratiquer ADD, SUB, MUL

### Code √† compl√©ter

```asm
.text
.global _start

_start:
    ; a = 15, b = 7
    MOV R0, #15
    MOV R1, #7

    ; c = a + b
    ; TODO: R2 = ?

    ; d = a - b
    ; TODO: R3 = ?

    ; e = a * b (utiliser MUL)
    ; TODO: R4 = ?

    HALT
```

### Validation

‚úÖ R2 = 22, R3 = 8, R4 = 105

üëâ [Ex√©cuter](https://seed.music-music.fr/)

---

### Solution Exercice 2

<details>
<summary>Solution</summary>

```asm
.text
.global _start

_start:
    MOV R0, #15
    MOV R1, #7

    ADD R2, R0, R1    ; c = 22
    SUB R3, R0, R1    ; d = 8
    MUL R4, R0, R1    ; e = 105

    HALT
```

</details>

---

## Exercice 3 : Condition Simple

**Objectif :** Utiliser CMP et branchements

### Probl√®me

Calculer le maximum de R0 et R1, stocker dans R2.

```asm
.text
.global _start

_start:
    MOV R0, #25
    MOV R1, #17

    ; TODO: R2 = max(R0, R1)
    ; Utiliser CMP, B.GT (ou B.LT), et des labels

    HALT
```

üëâ [Ouvrir l'exercice](https://seed.music-music.fr/)

---

### Solution avec branchement

<details>
<summary>Solution</summary>

```asm
.text
.global _start

_start:
    MOV R0, #25
    MOV R1, #17

    CMP R0, R1
    B.GT r0_greater
    MOV R2, R1        ; R1 est plus grand
    B end_max
r0_greater:
    MOV R2, R0        ; R0 est plus grand
end_max:
    HALT
```

</details>

---

### Solution avec pr√©dication

<details>
<summary>Solution alternative</summary>

```asm
.text
.global _start

_start:
    MOV R0, #25
    MOV R1, #17

    CMP R0, R1
    MOV.GE R2, R0     ; Si R0 >= R1
    MOV.LT R2, R1     ; Si R0 < R1

    HALT
```

Plus √©l√©gant ! Pas de branchement = plus rapide.

</details>

---

## Exercice 4 : Boucle - Somme de 1 √† N

**Objectif :** Impl√©menter une boucle

### Probl√®me

Calculer la somme 1 + 2 + ... + N (N dans R0).

```asm
.text
.global _start

_start:
    MOV R0, #10       ; N = 10
    MOV R1, #0        ; sum = 0
    MOV R2, #1        ; i = 1

    ; TODO: Boucle while (i <= N)
    ;       sum += i
    ;       i++

    ; R1 devrait contenir 55
    HALT
```

üëâ [Ouvrir l'exercice](https://seed.music-music.fr/)

---

### Solution Exercice 4

<details>
<summary>Solution</summary>

```asm
.text
.global _start

_start:
    MOV R0, #10       ; N
    MOV R1, #0        ; sum
    MOV R2, #1        ; i

loop:
    CMP R2, R0
    B.GT done         ; si i > N, sortir
    ADD R1, R1, R2    ; sum += i
    ADD R2, R2, #1    ; i++
    B loop

done:
    HALT              ; R1 = 55
```

V√©rification : 1+2+3+4+5+6+7+8+9+10 = 55 ‚úì

</details>

---

## Exercice 5 : Fibonacci

**Objectif :** Boucle avec deux variables

### Probl√®me

Calculer le N-i√®me nombre de Fibonacci.
F(0)=0, F(1)=1, F(n)=F(n-1)+F(n-2)

```asm
.text
.global _start

_start:
    MOV R0, #10       ; N = 10

    ; TODO: Calculer F(10) dans R3
    ; F(10) = 55

    HALT
```

üëâ [Ouvrir l'exercice](https://seed.music-music.fr/)

---

### Solution Fibonacci

<details>
<summary>Solution</summary>

```asm
.text
.global _start

_start:
    MOV R0, #10       ; N
    MOV R1, #0        ; F(n-2) = 0
    MOV R2, #1        ; F(n-1) = 1
    MOV R4, #0        ; compteur

    CMP R0, #0
    B.EQ fib_zero
    CMP R0, #1
    B.EQ fib_one

fib_loop:
    ADD R3, R1, R2    ; F(n) = F(n-2) + F(n-1)
    MOV R1, R2        ; F(n-2) = F(n-1)
    MOV R2, R3        ; F(n-1) = F(n)
    ADD R4, R4, #1
    CMP R4, R0
    B.LT fib_loop
    B done

fib_zero:
    MOV R3, #0
    B done

fib_one:
    MOV R3, #1

done:
    HALT              ; R3 = F(N)
```

</details>

---

## Exercice 6 : Acc√®s M√©moire

**Objectif :** Utiliser LDR et STR

### Probl√®me

Lire une valeur en m√©moire, la doubler, la r√©√©crire.

```asm
.data
    value: .word 21   ; Variable en m√©moire

.text
.global _start

_start:
    LDR R0, =value    ; R0 = adresse de value

    ; TODO:
    ; 1. Lire value dans R1
    ; 2. Doubler R1
    ; 3. √âcrire R1 dans value

    HALT
```

üëâ [Ouvrir l'exercice](https://seed.music-music.fr/)

---

### Solution Exercice 6

<details>
<summary>Solution</summary>

```asm
.data
    value: .word 21

.text
.global _start

_start:
    LDR R0, =value    ; Adresse
    LDR R1, [R0]      ; Lire : R1 = 21
    ADD R1, R1, R1    ; Doubler : R1 = 42
    STR R1, [R0]      ; √âcrire en m√©moire
    HALT
```

</details>

---

## Exercice 7 : Parcours de Tableau

**Objectif :** Indexation m√©moire

### Probl√®me

Trouver le maximum dans un tableau de 5 √©l√©ments.

```asm
.data
    array: .word 12, 45, 7, 89, 23
    size:  .word 5

.text
.global _start

_start:
    LDR R0, =array    ; Adresse du tableau
    LDR R1, =size
    LDR R1, [R1]      ; Taille

    ; TODO: Trouver le max dans R2

    HALT              ; R2 devrait √™tre 89
```

üëâ [Ouvrir l'exercice](https://seed.music-music.fr/)

---

### Solution Tableau

<details>
<summary>Solution</summary>

```asm
.data
    array: .word 12, 45, 7, 89, 23
    size:  .word 5

.text
.global _start

_start:
    LDR R0, =array
    LDR R1, =size
    LDR R1, [R1]      ; size = 5

    LDR R2, [R0]      ; max = array[0]
    MOV R3, #1        ; i = 1

loop:
    CMP R3, R1
    B.GE done

    ADD R4, R0, R3, LSL #2  ; R4 = &array[i]
    LDR R5, [R4]      ; R5 = array[i]

    CMP R5, R2
    MOV.GT R2, R5     ; si array[i] > max

    ADD R3, R3, #1
    B loop

done:
    HALT              ; R2 = 89
```

</details>

---

## Exercice 8 : Dessiner un Pixel

**Objectif :** Utiliser le MMIO

### Rappel

- √âcran : `0x00400000`
- 320√ó200 pixels, 1 bit/pixel
- 40 octets par ligne

### Code

```asm
.text
.global _start

_start:
    ; Allumer pixel (0, 0)
    LDR R0, =0x00400000
    MOV R1, #0x80         ; Bit 7
    STRB R1, [R0]

    ; TODO: Allumer pixel (8, 0)
    ; TODO: Allumer pixel (0, 1)

    HALT
```

üëâ [Ouvrir l'exercice](https://seed.music-music.fr/)

---

### Solution Pixels

<details>
<summary>Solution</summary>

```asm
.text
.global _start

_start:
    LDR R0, =0x00400000

    ; Pixel (0, 0) - octet 0, bit 7
    MOV R1, #0x80
    STRB R1, [R0]

    ; Pixel (8, 0) - octet 1, bit 7
    MOV R1, #0x80
    STRB R1, [R0, #1]

    ; Pixel (0, 1) - octet 40 (ligne suivante), bit 7
    MOV R1, #0x80
    STRB R1, [R0, #40]

    HALT
```

</details>

---

## Exercice 9 : Dessiner une Ligne (D√©fi)

**Objectif :** Combiner boucle et MMIO

Dessinez une ligne horizontale de 32 pixels √† la ligne 10.

<details>
<summary>Indice</summary>

- Ligne 10 commence √† : 0x00400000 + (10 √ó 40) = 0x00400190
- 32 pixels = 4 octets (8 pixels par octet)
- √âcrire 0xFF dans chaque octet

</details>

üëâ [Ouvrir l'exercice](https://seed.music-music.fr/)

---

### Solution Ligne

<details>
<summary>Solution</summary>

```asm
.text
.global _start

_start:
    LDR R0, =0x00400190  ; Ligne 10
    MOV R1, #0xFF        ; 8 pixels blancs
    MOV R2, #0           ; compteur

loop:
    STRB R1, [R0, R2]    ; √âcrire octet
    ADD R2, R2, #1
    CMP R2, #4           ; 4 octets = 32 pixels
    B.LT loop

    HALT
```

</details>

---

## R√©capitulatif

### Programmes √©crits

| Exercice | Concept |
|:---------|:--------|
| Premier programme | MOV, ADD |
| Arithm√©tique | ADD, SUB, MUL |
| Maximum | CMP, B.cond, pr√©dication |
| Somme | Boucle while |
| Fibonacci | Variables multiples |
| M√©moire | LDR, STR |
| Tableau | Indexation |
| Pixel | MMIO |
| Ligne | Boucle + MMIO |

---

## Validation Finale

### Checklist

- [ ] Ex√©cuter un programme simple
- [ ] Utiliser les conditions (CMP, B.EQ, etc.)
- [ ] √âcrire une boucle
- [ ] Acc√©der √† la m√©moire (LDR/STR)
- [ ] Dessiner sur l'√©cran (MMIO)

### Prochaine √©tape

‚û°Ô∏è **Chapitre 05 : CPU** ‚Äî Construire le processeur qui ex√©cute ces instructions !

üìö **R√©f√©rence :** Livre Seed, Chapitre 04 - Architecture
