<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 550 400" width="550" height="400">
  <defs>
    <style>
      .state { stroke: #374151; stroke-width: 2; rx: 8; }
      .title-box { stroke: #7c3aed; stroke-width: 2; fill: #f3e8ff; rx: 6; }
      .label { font-family: sans-serif; font-size: 10px; fill: #1f2937; }
      .state-name { font-family: sans-serif; font-size: 11px; fill: #1f2937; font-weight: bold; }
      .state-code { font-family: monospace; font-size: 9px; fill: #6b7280; }
      .condition { font-family: sans-serif; font-size: 9px; fill: #374151; }
      .title { font-family: sans-serif; font-size: 12px; font-weight: bold; fill: #7c3aed; }
      .arrow { stroke: #374151; stroke-width: 2; fill: none; }
    </style>
    <marker id="arr" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#374151"/>
    </marker>
  </defs>

  <!-- Title -->
  <rect class="title-box" x="20" y="10" width="510" height="30"/>
  <text class="title" x="275" y="30" text-anchor="middle">MACHINE A ETATS - CacheController</text>

  <!-- Reset arrow -->
  <line class="arrow" x1="200" y1="60" x2="200" y2="85" marker-end="url(#arr)"/>
  <text class="label" x="170" y="70">reset</text>

  <!-- IDLE State -->
  <rect class="state" x="130" y="90" width="140" height="80" fill="#dcfce7"/>
  <text class="state-name" x="200" y="115" text-anchor="middle">IDLE</text>
  <text class="state-code" x="200" y="132" text-anchor="middle">(00)</text>
  <text class="label" x="200" y="155" text-anchor="middle">Attente de</text>
  <text class="label" x="200" y="168" text-anchor="middle">requete</text>

  <!-- Hit loop back to IDLE -->
  <path class="arrow" d="M 270 130 Q 320 90, 270 90 Q 200 70, 130 90 Q 100 100, 130 130" marker-end="url(#arr)"/>
  <text class="condition" x="310" y="80">hit=1</text>
  <text class="label" x="310" y="95">(reponse immediate)</text>

  <!-- Arrow to FETCH -->
  <line class="arrow" x1="200" y1="170" x2="200" y2="200" marker-end="url(#arr)"/>
  <text class="condition" x="210" y="190">req=1 AND miss=1</text>

  <!-- FETCH State -->
  <rect class="state" x="130" y="205" width="140" height="80" fill="#fef3c7"/>
  <text class="state-name" x="200" y="230" text-anchor="middle">FETCH</text>
  <text class="state-code" x="200" y="247" text-anchor="middle">(01)</text>
  <text class="label" x="200" y="270" text-anchor="middle">Charger ligne</text>
  <text class="label" x="200" y="283" text-anchor="middle">depuis RAM</text>

  <!-- Arrow to WRITEBACK -->
  <line class="arrow" x1="200" y1="285" x2="200" y2="310" marker-end="url(#arr)"/>
  <text class="condition" x="210" y="303">mem_ready=1</text>

  <!-- WRITEBACK State -->
  <rect class="state" x="130" y="315" width="140" height="80" fill="#e0e7ff"/>
  <text class="state-name" x="200" y="340" text-anchor="middle">WRITEBACK</text>
  <text class="state-code" x="200" y="357" text-anchor="middle">(10)</text>
  <text class="label" x="200" y="375" text-anchor="middle">Ecrire dans</text>
  <text class="label" x="200" y="388" text-anchor="middle">le cache</text>

  <!-- Arrow back to IDLE -->
  <path class="arrow" d="M 130 355 L 50 355 L 50 130 L 130 130" marker-end="url(#arr)"/>
  <text class="condition" x="30" y="245">mem_ready=1</text>

  <!-- Legend -->
  <rect x="320" y="150" width="200" height="130" fill="#f9fafb" stroke="#e5e7eb" rx="4"/>
  <text class="label" x="420" y="170" text-anchor="middle" font-weight="bold">Signaux</text>
  <text class="label" x="330" y="190">req: requete CPU</text>
  <text class="label" x="330" y="208">hit: donnee trouvee en cache</text>
  <text class="label" x="330" y="226">miss: donnee absente</text>
  <text class="label" x="330" y="244">mem_ready: RAM prete</text>
  <text class="label" x="330" y="270" fill="#059679">Temps hit: ~1 ns</text>
  <text class="label" x="330" y="285" fill="#dc2626">Temps miss: ~100 ns</text>
</svg>
