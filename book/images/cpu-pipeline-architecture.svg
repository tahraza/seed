<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 750 280" width="750" height="280">
  <defs>
    <style>
      .stage { stroke: #374151; stroke-width: 2; rx: 6; }
      .reg { stroke: #9333ea; stroke-width: 2; fill: #f3e8ff; rx: 3; }
      .unit { stroke: #059669; stroke-width: 1.5; fill: #d1fae5; rx: 4; }
      .wire { stroke: #374151; stroke-width: 1.5; fill: none; }
      .label { font-family: sans-serif; font-size: 10px; fill: #1f2937; font-weight: bold; }
      .sublabel { font-family: sans-serif; font-size: 8px; fill: #6b7280; }
      .title { font-family: sans-serif; font-size: 14px; font-weight: bold; fill: #1e3a8a; }
    </style>
    <marker id="arr" markerWidth="6" markerHeight="5" refX="6" refY="2.5" orient="auto">
      <polygon points="0 0, 6 2.5, 0 5" fill="#374151"/>
    </marker>
  </defs>

  <!-- Title -->
  <text class="title" x="375" y="25" text-anchor="middle">Architecture CPU Pipeline 5 Etages</text>

  <!-- Stage boxes -->
  <rect x="30" y="50" width="90" height="120" fill="#fef3c7" class="stage"/>
  <text class="label" x="75" y="75" text-anchor="middle">IF</text>
  <text class="sublabel" x="75" y="95" text-anchor="middle">Fetch</text>

  <rect x="170" y="50" width="90" height="120" fill="#dcfce7" class="stage"/>
  <text class="label" x="215" y="75" text-anchor="middle">ID</text>
  <text class="sublabel" x="215" y="95" text-anchor="middle">Decode</text>

  <rect x="310" y="50" width="90" height="120" fill="#dbeafe" class="stage"/>
  <text class="label" x="355" y="75" text-anchor="middle">EX</text>
  <text class="sublabel" x="355" y="95" text-anchor="middle">Execute</text>

  <rect x="450" y="50" width="90" height="120" fill="#e0e7ff" class="stage"/>
  <text class="label" x="495" y="75" text-anchor="middle">MEM</text>
  <text class="sublabel" x="495" y="95" text-anchor="middle">Memory</text>

  <rect x="590" y="50" width="90" height="120" fill="#fce7f3" class="stage"/>
  <text class="label" x="635" y="75" text-anchor="middle">WB</text>
  <text class="sublabel" x="635" y="95" text-anchor="middle">Writeback</text>

  <!-- Pipeline registers -->
  <rect x="130" y="55" width="30" height="110" class="reg"/>
  <text class="sublabel" x="145" y="115" text-anchor="middle" transform="rotate(-90,145,115)">IF/ID</text>

  <rect x="270" y="55" width="30" height="110" class="reg"/>
  <text class="sublabel" x="285" y="115" text-anchor="middle" transform="rotate(-90,285,115)">ID/EX</text>

  <rect x="410" y="55" width="30" height="110" class="reg"/>
  <text class="sublabel" x="425" y="115" text-anchor="middle" transform="rotate(-90,425,115)">EX/MEM</text>

  <rect x="550" y="55" width="30" height="110" class="reg"/>
  <text class="sublabel" x="565" y="115" text-anchor="middle" transform="rotate(-90,565,115)">MEM/WB</text>

  <!-- Arrows between stages -->
  <line class="wire" x1="120" y1="110" x2="130" y2="110" marker-end="url(#arr)"/>
  <line class="wire" x1="160" y1="110" x2="170" y2="110" marker-end="url(#arr)"/>
  <line class="wire" x1="260" y1="110" x2="270" y2="110" marker-end="url(#arr)"/>
  <line class="wire" x1="300" y1="110" x2="310" y2="110" marker-end="url(#arr)"/>
  <line class="wire" x1="400" y1="110" x2="410" y2="110" marker-end="url(#arr)"/>
  <line class="wire" x1="440" y1="110" x2="450" y2="110" marker-end="url(#arr)"/>
  <line class="wire" x1="540" y1="110" x2="550" y2="110" marker-end="url(#arr)"/>
  <line class="wire" x1="580" y1="110" x2="590" y2="110" marker-end="url(#arr)"/>

  <!-- Control units -->
  <rect x="185" y="195" width="90" height="35" class="unit"/>
  <text class="sublabel" x="230" y="210" text-anchor="middle">Hazard</text>
  <text class="sublabel" x="230" y="222" text-anchor="middle">Detect</text>

  <rect x="325" y="195" width="90" height="35" class="unit"/>
  <text class="sublabel" x="370" y="210" text-anchor="middle">Forward</text>
  <text class="sublabel" x="370" y="222" text-anchor="middle">Unit</text>

  <!-- Stall signal -->
  <line class="wire" x1="185" y1="212" x2="75" y2="212" stroke="#dc2626"/>
  <line class="wire" x1="75" y1="212" x2="75" y2="170" stroke="#dc2626" marker-end="url(#arr)"/>
  <text class="sublabel" x="110" y="208" fill="#dc2626">stall</text>

  <!-- Flush signal -->
  <path class="wire" d="M 75 250 L 75 175 L 145 175" stroke="#f59e0b" stroke-dasharray="4,2"/>
  <text class="sublabel" x="90" y="248" fill="#f59e0b">flush (branch)</text>

  <!-- Forward paths -->
  <path class="wire" d="M 370 195 L 370 185 L 355 185 L 355 170" stroke="#059669" marker-end="url(#arr)"/>
  <text class="sublabel" x="380" y="182" fill="#059669">forward</text>

  <!-- Legend -->
  <rect x="30" y="250" width="15" height="10" fill="#f3e8ff" stroke="#9333ea" stroke-width="1"/>
  <text class="sublabel" x="50" y="258">Registres Pipeline</text>
  <rect x="140" y="250" width="15" height="10" fill="#d1fae5" stroke="#059669" stroke-width="1"/>
  <text class="sublabel" x="160" y="258">Unites de Controle</text>
</svg>
