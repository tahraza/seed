<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr" xml:lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Tahiry RAZAFINDRALAMBO" />
  <meta name="dcterms.date" content="2026-01-01" />
  <title>L'Architecture Codex</title>
  <style>
    html {
      font-family: DejaVu Serif;
      font-size: 11pt;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    svg {
      height: auto;
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: DejaVu Sans Mono;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        background-color: #232629;
        color: #7a7c7d;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #7a7c7d;  padding-left: 4px; }
    div.sourceCode
      { color: #cfcfc2; background-color: #232629; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #cfcfc2; } /* Normal */
    code span.al { color: #95da4c; background-color: #4d1f24; font-weight: bold; } /* Alert */
    code span.an { color: #3f8058; } /* Annotation */
    code span.at { color: #2980b9; } /* Attribute */
    code span.bn { color: #f67400; } /* BaseN */
    code span.bu { color: #7f8c8d; } /* BuiltIn */
    code span.cf { color: #fdbc4b; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #3daee9; } /* Char */
    code span.cn { color: #27aeae; font-weight: bold; } /* Constant */
    code span.co { color: #7a7c7d; } /* Comment */
    code span.cv { color: #7f8c8d; } /* CommentVar */
    code span.do { color: #a43340; } /* Documentation */
    code span.dt { color: #2980b9; } /* DataType */
    code span.dv { color: #f67400; } /* DecVal */
    code span.er { color: #da4453; text-decoration: underline; } /* Error */
    code span.ex { color: #0099ff; font-weight: bold; } /* Extension */
    code span.fl { color: #f67400; } /* Float */
    code span.fu { color: #8e44ad; } /* Function */
    code span.im { color: #27ae60; } /* Import */
    code span.in { color: #c45b00; } /* Information */
    code span.kw { color: #cfcfc2; font-weight: bold; } /* Keyword */
    code span.op { color: #cfcfc2; } /* Operator */
    code span.ot { color: #27ae60; } /* Other */
    code span.pp { color: #27ae60; } /* Preprocessor */
    code span.re { color: #2980b9; background-color: #153042; } /* RegionMarker */
    code span.sc { color: #3daee9; } /* SpecialChar */
    code span.ss { color: #da4453; } /* SpecialString */
    code span.st { color: #f44f4f; } /* String */
    code span.va { color: #27aeae; } /* Variable */
    code span.vs { color: #da4453; } /* VerbatimString */
    code span.wa { color: #da4453; } /* Warning */
  </style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">L'Architecture Codex</h1>
<p class="subtitle">De la Porte Logique au Système d’Exploitation
32-bits</p>
<p class="author">Tahiry RAZAFINDRALAMBO</p>
<p class="date">2026</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#larchitecture-codex-guide-de-létudiant"
id="toc-larchitecture-codex-guide-de-létudiant"><span
class="toc-section-number">1</span> L’Architecture Codex : Guide de
l’Étudiant</a>
<ul>
<li><a href="#table-des-matières" id="toc-table-des-matières"><span
class="toc-section-number">1.1</span> Table des Matières</a></li>
<li><a href="#comment-utiliser-ce-guide"
id="toc-comment-utiliser-ce-guide"><span
class="toc-section-number">1.2</span> Comment utiliser ce guide</a></li>
</ul></li>
<li><a href="#introduction" id="toc-introduction"><span
class="toc-section-number">2</span> Introduction</a>
<ul>
<li><a href="#le-mystère-de-lordinateur"
id="toc-le-mystère-de-lordinateur"><span
class="toc-section-number">2.1</span> Le Mystère de
l’Ordinateur</a></li>
<li><a href="#pourquoi-construire-un-ordinateur"
id="toc-pourquoi-construire-un-ordinateur"><span
class="toc-section-number">2.2</span> Pourquoi Construire un Ordinateur
?</a>
<ul>
<li><a href="#le-problème-de-la-boîte-noire"
id="toc-le-problème-de-la-boîte-noire"><span
class="toc-section-number">2.2.1</span> Le problème de la “boîte
noire”</a></li>
<li><a href="#lapproche-du-nand-au-tetris"
id="toc-lapproche-du-nand-au-tetris"><span
class="toc-section-number">2.2.2</span> L’approche “Du NAND au
Tetris”</a></li>
</ul></li>
<li><a href="#ce-que-vous-allez-construire"
id="toc-ce-que-vous-allez-construire"><span
class="toc-section-number">2.3</span> Ce que Vous Allez Construire</a>
<ul>
<li><a href="#la-beauté-de-labstraction"
id="toc-la-beauté-de-labstraction"><span
class="toc-section-number">2.3.1</span> La beauté de
l’abstraction</a></li>
</ul></li>
<li><a href="#larchitecture-codex-a32"
id="toc-larchitecture-codex-a32"><span
class="toc-section-number">2.4</span> L’Architecture Codex A32</a>
<ul>
<li><a href="#pourquoi-ces-changements"
id="toc-pourquoi-ces-changements"><span
class="toc-section-number">2.4.1</span> Pourquoi ces changements
?</a></li>
</ul></li>
<li><a href="#ce-que-vous-allez-apprendre"
id="toc-ce-que-vous-allez-apprendre"><span
class="toc-section-number">2.5</span> Ce que Vous Allez
Apprendre</a></li>
<li><a href="#vos-outils" id="toc-vos-outils"><span
class="toc-section-number">2.6</span> Vos Outils</a>
<ul>
<li><a href="#les-outils-en-ligne-de-commande"
id="toc-les-outils-en-ligne-de-commande"><span
class="toc-section-number">2.6.1</span> Les Outils en Ligne de
Commande</a></li>
<li><a href="#le-simulateur-web-recommandé"
id="toc-le-simulateur-web-recommandé"><span
class="toc-section-number">2.6.2</span> Le Simulateur Web
(Recommandé)</a></li>
<li><a href="#le-cpu-visualizer" id="toc-le-cpu-visualizer"><span
class="toc-section-number">2.6.3</span> Le CPU Visualizer</a></li>
</ul></li>
<li><a href="#comment-utiliser-ce-livre"
id="toc-comment-utiliser-ce-livre"><span
class="toc-section-number">2.7</span> Comment Utiliser ce Livre</a>
<ul>
<li><a href="#lapproche-recommandée"
id="toc-lapproche-recommandée"><span
class="toc-section-number">2.7.1</span> L’approche recommandée</a></li>
<li><a href="#si-vous-êtes-bloqué" id="toc-si-vous-êtes-bloqué"><span
class="toc-section-number">2.7.2</span> Si vous êtes bloqué</a></li>
</ul></li>
<li><a href="#la-grande-aventure-commence"
id="toc-la-grande-aventure-commence"><span
class="toc-section-number">2.8</span> La Grande Aventure
Commence</a></li>
</ul></li>
<li><a href="#logique-booléenne" id="toc-logique-booléenne"><span
class="toc-section-number">3</span> Logique Booléenne</a>
<ul>
<li><a href="#où-en-sommes-nous" id="toc-où-en-sommes-nous"><span
class="toc-section-number">3.1</span> Où en sommes-nous ?</a></li>
<li><a href="#pourquoi-le-binaire" id="toc-pourquoi-le-binaire"><span
class="toc-section-number">3.2</span> Pourquoi le Binaire ?</a>
<ul>
<li><a href="#la-question-fondamentale"
id="toc-la-question-fondamentale"><span
class="toc-section-number">3.2.1</span> La question
fondamentale</a></li>
<li><a href="#du-voltage-au-bit" id="toc-du-voltage-au-bit"><span
class="toc-section-number">3.2.2</span> Du voltage au bit</a></li>
<li><a href="#labstraction-qui-libère"
id="toc-labstraction-qui-libère"><span
class="toc-section-number">3.2.3</span> L’abstraction qui
libère</a></li>
</ul></li>
<li><a href="#la-porte-nand-notre-axiome"
id="toc-la-porte-nand-notre-axiome"><span
class="toc-section-number">3.3</span> La Porte NAND : Notre Axiome</a>
<ul>
<li><a href="#pourquoi-partir-du-nand"
id="toc-pourquoi-partir-du-nand"><span
class="toc-section-number">3.3.1</span> Pourquoi partir du NAND
?</a></li>
<li><a href="#table-de-vérité-nand" id="toc-table-de-vérité-nand"><span
class="toc-section-number">3.3.2</span> Table de Vérité NAND</a></li>
<li><a href="#symbole-graphique" id="toc-symbole-graphique"><span
class="toc-section-number">3.3.3</span> Symbole graphique</a></li>
</ul></li>
<li><a href="#construction-des-portes-élémentaires"
id="toc-construction-des-portes-élémentaires"><span
class="toc-section-number">3.4</span> Construction des Portes
Élémentaires</a>
<ul>
<li><a href="#a.-not-inverseur-linversion-de-la-réalité"
id="toc-a.-not-inverseur-linversion-de-la-réalité"><span
class="toc-section-number">3.4.1</span> A. NOT (Inverseur) — L’inversion
de la réalité</a></li>
<li><a href="#b.-and-et-la-conjonction"
id="toc-b.-and-et-la-conjonction"><span
class="toc-section-number">3.4.2</span> B. AND (Et) — La
conjonction</a></li>
<li><a href="#c.-or-ou-lalternative"
id="toc-c.-or-ou-lalternative"><span
class="toc-section-number">3.4.3</span> C. OR (Ou) —
L’alternative</a></li>
<li><a href="#d.-xor-ou-exclusif-la-différence"
id="toc-d.-xor-ou-exclusif-la-différence"><span
class="toc-section-number">3.4.4</span> D. XOR (Ou Exclusif) — La
différence</a></li>
<li><a href="#e.-multiplexeur-mux-laiguilleur"
id="toc-e.-multiplexeur-mux-laiguilleur"><span
class="toc-section-number">3.4.5</span> E. Multiplexeur (Mux) —
L’aiguilleur</a></li>
<li><a href="#f.-démultiplexeur-dmux-linverse-de-laiguilleur"
id="toc-f.-démultiplexeur-dmux-linverse-de-laiguilleur"><span
class="toc-section-number">3.4.6</span> F. Démultiplexeur (DMux) —
L’inverse de l’aiguilleur</a></li>
</ul></li>
<li><a href="#le-lien-avec-lordinateur-complet"
id="toc-le-lien-avec-lordinateur-complet"><span
class="toc-section-number">3.5</span> Le Lien avec l’Ordinateur
Complet</a>
<ul>
<li><a href="#du-nand-au-cpu-la-feuille-de-route"
id="toc-du-nand-au-cpu-la-feuille-de-route"><span
class="toc-section-number">3.5.1</span> Du NAND au CPU : La feuille de
route</a></li>
</ul></li>
<li><a href="#description-matérielle-codex-hdl"
id="toc-description-matérielle-codex-hdl"><span
class="toc-section-number">3.6</span> Description Matérielle (Codex
HDL)</a>
<ul>
<li><a href="#pourquoi-un-langage-de-description"
id="toc-pourquoi-un-langage-de-description"><span
class="toc-section-number">3.6.1</span> Pourquoi un langage de
description ?</a></li>
<li><a href="#structure-dun-fichier-.hdl"
id="toc-structure-dun-fichier-.hdl"><span
class="toc-section-number">3.6.2</span> Structure d’un fichier
<code>.hdl</code></a></li>
<li><a href="#vocabulaire-essentiel"
id="toc-vocabulaire-essentiel"><span
class="toc-section-number">3.6.3</span> Vocabulaire essentiel</a></li>
<li><a href="#règles-de-connexion" id="toc-règles-de-connexion"><span
class="toc-section-number">3.6.4</span> Règles de connexion</a></li>
<li><a href="#bus-vecteurs-de-bits" id="toc-bus-vecteurs-de-bits"><span
class="toc-section-number">3.6.5</span> Bus (Vecteurs de bits)</a></li>
<li><a href="#exemple-complet-xor-en-hdl"
id="toc-exemple-complet-xor-en-hdl"><span
class="toc-section-number">3.6.6</span> Exemple complet : XOR en
HDL</a></li>
</ul></li>
<li><a href="#portes-multi-entrées-et-multi-bits"
id="toc-portes-multi-entrées-et-multi-bits"><span
class="toc-section-number">3.7</span> Portes Multi-Entrées et
Multi-Bits</a>
<ul>
<li><a href="#généralisation-à-n-entrées"
id="toc-généralisation-à-n-entrées"><span
class="toc-section-number">3.7.1</span> Généralisation à N
Entrées</a></li>
<li><a href="#multiplexeurs-multi-entrées"
id="toc-multiplexeurs-multi-entrées"><span
class="toc-section-number">3.7.2</span> Multiplexeurs
Multi-Entrées</a></li>
<li><a href="#démultiplexeurs-multi-sorties"
id="toc-démultiplexeurs-multi-sorties"><span
class="toc-section-number">3.7.3</span> Démultiplexeurs
Multi-Sorties</a></li>
<li><a href="#portes-sur-n-bits-bus"
id="toc-portes-sur-n-bits-bus"><span
class="toc-section-number">3.7.4</span> Portes sur N Bits (Bus)</a></li>
<li><a href="#pourquoi-cest-important"
id="toc-pourquoi-cest-important"><span
class="toc-section-number">3.7.5</span> Pourquoi c’est Important
?</a></li>
</ul></li>
<li><a href="#exercices-pratiques" id="toc-exercices-pratiques"><span
class="toc-section-number">3.8</span> Exercices Pratiques</a>
<ul>
<li><a href="#exercices-sur-le-simulateur-web"
id="toc-exercices-sur-le-simulateur-web"><span
class="toc-section-number">3.8.1</span> Exercices sur le Simulateur
Web</a></li>
<li><a href="#comment-lancer-le-simulateur-web"
id="toc-comment-lancer-le-simulateur-web"><span
class="toc-section-number">3.8.2</span> Comment lancer le simulateur web
?</a></li>
<li><a href="#alternative-tests-en-ligne-de-commande"
id="toc-alternative-tests-en-ligne-de-commande"><span
class="toc-section-number">3.8.3</span> Alternative : Tests en ligne de
commande</a></li>
</ul></li>
<li><a href="#défis-supplémentaires"
id="toc-défis-supplémentaires"><span
class="toc-section-number">3.9</span> Défis Supplémentaires</a>
<ul>
<li><a href="#défi-1-minimiser-le-nombre-de-nand"
id="toc-défi-1-minimiser-le-nombre-de-nand"><span
class="toc-section-number">3.9.1</span> Défi 1 : Minimiser le nombre de
NAND</a></li>
<li><a href="#défi-2-implémenter-implies"
id="toc-défi-2-implémenter-implies"><span
class="toc-section-number">3.9.2</span> Défi 2 : Implémenter
IMPLIES</a></li>
<li><a href="#défi-3-mux-à-4-entrées"
id="toc-défi-3-mux-à-4-entrées"><span
class="toc-section-number">3.9.3</span> Défi 3 : Mux à 4
entrées</a></li>
</ul></li>
<li><a href="#ce-quil-faut-retenir" id="toc-ce-quil-faut-retenir"><span
class="toc-section-number">3.10</span> Ce qu’il faut retenir</a></li>
<li><a href="#auto-évaluation" id="toc-auto-évaluation"><span
class="toc-section-number">3.11</span> Auto-évaluation</a>
<ul>
<li><a href="#questions-de-compréhension"
id="toc-questions-de-compréhension"><span
class="toc-section-number">3.11.1</span> Questions de
compréhension</a></li>
<li><a href="#mini-défi-pratique" id="toc-mini-défi-pratique"><span
class="toc-section-number">3.11.2</span> Mini-défi pratique</a></li>
<li><a href="#checklist-de-validation"
id="toc-checklist-de-validation"><span
class="toc-section-number">3.11.3</span> Checklist de
validation</a></li>
</ul></li>
</ul></li>
<li><a href="#arithmétique-binaire" id="toc-arithmétique-binaire"><span
class="toc-section-number">4</span> Arithmétique Binaire</a>
<ul>
<li><a href="#où-en-sommes-nous-1" id="toc-où-en-sommes-nous-1"><span
class="toc-section-number">4.1</span> Où en sommes-nous ?</a></li>
<li><a href="#pourquoi-larithmétique-est-elle-si-importante"
id="toc-pourquoi-larithmétique-est-elle-si-importante"><span
class="toc-section-number">4.2</span> Pourquoi l’Arithmétique est-elle
si Importante ?</a>
<ul>
<li><a href="#au-cœur-de-tout-calcul"
id="toc-au-cœur-de-tout-calcul"><span
class="toc-section-number">4.2.1</span> Au cœur de tout calcul</a></li>
<li><a href="#ce-que-nous-allons-construire"
id="toc-ce-que-nous-allons-construire"><span
class="toc-section-number">4.2.2</span> Ce que nous allons
construire</a></li>
</ul></li>
<li><a href="#représentation-des-nombres"
id="toc-représentation-des-nombres"><span
class="toc-section-number">4.3</span> Représentation des Nombres</a>
<ul>
<li><a href="#le-système-binaire-base-2"
id="toc-le-système-binaire-base-2"><span
class="toc-section-number">4.3.1</span> Le Système Binaire (Base
2)</a></li>
<li><a href="#taille-des-nombres-dans-codex"
id="toc-taille-des-nombres-dans-codex"><span
class="toc-section-number">4.3.2</span> Taille des nombres dans
Codex</a></li>
<li><a href="#les-nombres-négatifs-le-complément-à-2"
id="toc-les-nombres-négatifs-le-complément-à-2"><span
class="toc-section-number">4.3.3</span> Les Nombres Négatifs : Le
Complément à 2</a></li>
<li><a href="#comment-obtenir-le-complément-à-2-la-valeur-négative"
id="toc-comment-obtenir-le-complément-à-2-la-valeur-négative"><span
class="toc-section-number">4.3.4</span> Comment obtenir le complément à
2 (la valeur négative) ?</a></li>
<li><a href="#pourquoi-le-complément-à-2-est-il-génial"
id="toc-pourquoi-le-complément-à-2-est-il-génial"><span
class="toc-section-number">4.3.5</span> Pourquoi le complément à 2
est-il génial ?</a></li>
</ul></li>
<li><a href="#laddition-binaire" id="toc-laddition-binaire"><span
class="toc-section-number">4.4</span> L’Addition Binaire</a>
<ul>
<li><a href="#les-règles-de-base-sur-1-bit"
id="toc-les-règles-de-base-sur-1-bit"><span
class="toc-section-number">4.4.1</span> Les règles de base (sur 1
bit)</a></li>
<li><a href="#exemple-daddition-sur-4-bits"
id="toc-exemple-daddition-sur-4-bits"><span
class="toc-section-number">4.4.2</span> Exemple d’addition sur 4
bits</a></li>
</ul></li>
<li><a href="#le-demi-additionneur-half-adder"
id="toc-le-demi-additionneur-half-adder"><span
class="toc-section-number">4.5</span> Le Demi-Additionneur (Half
Adder)</a>
<ul>
<li><a href="#table-de-vérité" id="toc-table-de-vérité"><span
class="toc-section-number">4.5.1</span> Table de vérité</a></li>
<li><a href="#linsight-clé" id="toc-linsight-clé"><span
class="toc-section-number">4.5.2</span> L’insight clé</a></li>
<li><a href="#schéma-du-circuit" id="toc-schéma-du-circuit"><span
class="toc-section-number">4.5.3</span> Schéma du circuit</a></li>
<li><a href="#limitation" id="toc-limitation"><span
class="toc-section-number">4.5.4</span> Limitation</a></li>
</ul></li>
<li><a href="#ladditionneur-complet-full-adder"
id="toc-ladditionneur-complet-full-adder"><span
class="toc-section-number">4.6</span> L’Additionneur Complet (Full
Adder)</a>
<ul>
<li><a href="#interface" id="toc-interface"><span
class="toc-section-number">4.6.1</span> Interface</a></li>
<li><a href="#table-de-vérité-1" id="toc-table-de-vérité-1"><span
class="toc-section-number">4.6.2</span> Table de vérité</a></li>
<li><a href="#comment-le-construire"
id="toc-comment-le-construire"><span
class="toc-section-number">4.6.3</span> Comment le construire ?</a></li>
</ul></li>
<li><a href="#ladditionneur-32-bits-ripple-carry-adder"
id="toc-ladditionneur-32-bits-ripple-carry-adder"><span
class="toc-section-number">4.7</span> L’Additionneur 32-bits (Ripple
Carry Adder)</a>
<ul>
<li><a href="#schéma-simplifié" id="toc-schéma-simplifié"><span
class="toc-section-number">4.7.1</span> Schéma simplifié</a></li>
<li><a href="#le-compromis-du-ripple-carry"
id="toc-le-compromis-du-ripple-carry"><span
class="toc-section-number">4.7.2</span> Le compromis du Ripple
Carry</a></li>
</ul></li>
<li><a href="#lalu-arithmetic-logic-unit"
id="toc-lalu-arithmetic-logic-unit"><span
class="toc-section-number">4.8</span> L’ALU (Arithmetic Logic Unit)</a>
<ul>
<li><a href="#pourquoi-combiner-arithmétique-et-logique"
id="toc-pourquoi-combiner-arithmétique-et-logique"><span
class="toc-section-number">4.8.1</span> Pourquoi combiner arithmétique
et logique ?</a></li>
<li><a href="#interface-de-lalu-codex"
id="toc-interface-de-lalu-codex"><span
class="toc-section-number">4.8.2</span> Interface de l’ALU
Codex</a></li>
<li><a href="#les-opérations-de-lalu"
id="toc-les-opérations-de-lalu"><span
class="toc-section-number">4.8.3</span> Les Opérations de l’ALU</a></li>
<li><a href="#comment-implémenter-la-soustraction"
id="toc-comment-implémenter-la-soustraction"><span
class="toc-section-number">4.8.4</span> Comment implémenter la
soustraction ?</a></li>
<li><a href="#les-drapeaux-flags" id="toc-les-drapeaux-flags"><span
class="toc-section-number">4.8.5</span> Les Drapeaux (Flags)</a></li>
<li><a href="#comment-calculer-les-drapeaux"
id="toc-comment-calculer-les-drapeaux"><span
class="toc-section-number">4.8.6</span> Comment calculer les drapeaux
?</a></li>
<li><a href="#quand-utiliser-chaque-drapeau"
id="toc-quand-utiliser-chaque-drapeau"><span
class="toc-section-number">4.8.7</span> Quand Utiliser Chaque Drapeau
?</a></li>
</ul></li>
<li><a href="#la-multiplication-matérielle"
id="toc-la-multiplication-matérielle"><span
class="toc-section-number">4.9</span> La Multiplication Matérielle</a>
<ul>
<li><a href="#le-principe-multiplication-à-la-main"
id="toc-le-principe-multiplication-à-la-main"><span
class="toc-section-number">4.9.1</span> Le Principe : Multiplication à
la Main</a></li>
<li><a href="#lalgorithme-des-produits-partiels"
id="toc-lalgorithme-des-produits-partiels"><span
class="toc-section-number">4.9.2</span> L’Algorithme des Produits
Partiels</a></li>
<li><a href="#structure-du-multiplicateur-8-bits-mul8"
id="toc-structure-du-multiplicateur-8-bits-mul8"><span
class="toc-section-number">4.9.3</span> Structure du Multiplicateur
8-bits (Mul8)</a></li>
<li><a href="#addition-en-arbre-wallace-tree"
id="toc-addition-en-arbre-wallace-tree"><span
class="toc-section-number">4.9.4</span> Addition en Arbre (Wallace
Tree)</a></li>
<li><a href="#pourquoi-le-résultat-est-sur-16-bits"
id="toc-pourquoi-le-résultat-est-sur-16-bits"><span
class="toc-section-number">4.9.5</span> Pourquoi le Résultat est sur 16
bits ?</a></li>
<li><a href="#extension-à-32-bits-mul32"
id="toc-extension-à-32-bits-mul32"><span
class="toc-section-number">4.9.6</span> Extension à 32 bits
(Mul32)</a></li>
<li><a href="#optimisations-dans-les-vrais-processeurs"
id="toc-optimisations-dans-les-vrais-processeurs"><span
class="toc-section-number">4.9.7</span> Optimisations dans les Vrais
Processeurs</a></li>
<li><a href="#pourquoi-mul-nest-pas-dans-lalu"
id="toc-pourquoi-mul-nest-pas-dans-lalu"><span
class="toc-section-number">4.9.8</span> Pourquoi MUL n’est pas dans
l’ALU ?</a></li>
</ul></li>
<li><a href="#architecture-de-lalu" id="toc-architecture-de-lalu"><span
class="toc-section-number">4.10</span> Architecture de l’ALU</a></li>
<li><a href="#exercices-pratiques-1"
id="toc-exercices-pratiques-1"><span
class="toc-section-number">4.11</span> Exercices Pratiques</a>
<ul>
<li><a href="#exercices-sur-le-simulateur-web-1"
id="toc-exercices-sur-le-simulateur-web-1"><span
class="toc-section-number">4.11.1</span> Exercices sur le Simulateur
Web</a></li>
<li><a href="#conseils-pour-lalu" id="toc-conseils-pour-lalu"><span
class="toc-section-number">4.11.2</span> Conseils pour l’ALU</a></li>
<li><a href="#conseils-pour-le-multiplicateur-mul8"
id="toc-conseils-pour-le-multiplicateur-mul8"><span
class="toc-section-number">4.11.3</span> Conseils pour le Multiplicateur
(Mul8)</a></li>
<li><a href="#tests-en-ligne-de-commande"
id="toc-tests-en-ligne-de-commande"><span
class="toc-section-number">4.11.4</span> Tests en ligne de
commande</a></li>
</ul></li>
<li><a href="#défis-supplémentaires-1"
id="toc-défis-supplémentaires-1"><span
class="toc-section-number">4.12</span> Défis Supplémentaires</a>
<ul>
<li><a href="#défi-1-carry-lookahead"
id="toc-défi-1-carry-lookahead"><span
class="toc-section-number">4.12.1</span> Défi 1 : Carry
Lookahead</a></li>
<li><a href="#défi-2-multiplicateur"
id="toc-défi-2-multiplicateur"><span
class="toc-section-number">4.12.2</span> Défi 2 :
Multiplicateur</a></li>
<li><a href="#défi-3-comparateur" id="toc-défi-3-comparateur"><span
class="toc-section-number">4.12.3</span> Défi 3 : Comparateur</a></li>
</ul></li>
<li><a href="#le-lien-avec-le-cpu" id="toc-le-lien-avec-le-cpu"><span
class="toc-section-number">4.13</span> Le Lien avec le CPU</a></li>
<li><a href="#ce-quil-faut-retenir-1"
id="toc-ce-quil-faut-retenir-1"><span
class="toc-section-number">4.14</span> Ce qu’il faut retenir</a></li>
<li><a href="#auto-évaluation-1" id="toc-auto-évaluation-1"><span
class="toc-section-number">4.15</span> Auto-évaluation</a>
<ul>
<li><a href="#questions-de-compréhension-1"
id="toc-questions-de-compréhension-1"><span
class="toc-section-number">4.15.1</span> Questions de
compréhension</a></li>
<li><a href="#mini-défi-pratique-1" id="toc-mini-défi-pratique-1"><span
class="toc-section-number">4.15.2</span> Mini-défi pratique</a></li>
<li><a href="#checklist-de-validation-1"
id="toc-checklist-de-validation-1"><span
class="toc-section-number">4.15.3</span> Checklist de
validation</a></li>
</ul></li>
</ul></li>
<li><a href="#logique-séquentielle-et-mémoire"
id="toc-logique-séquentielle-et-mémoire"><span
class="toc-section-number">5</span> Logique Séquentielle et Mémoire</a>
<ul>
<li><a href="#où-en-sommes-nous-2" id="toc-où-en-sommes-nous-2"><span
class="toc-section-number">5.1</span> Où en sommes-nous ?</a></li>
<li><a href="#pourquoi-la-mémoire-est-elle-fondamentale"
id="toc-pourquoi-la-mémoire-est-elle-fondamentale"><span
class="toc-section-number">5.2</span> Pourquoi la Mémoire est-elle
Fondamentale ?</a>
<ul>
<li><a href="#le-problème-de-létat" id="toc-le-problème-de-létat"><span
class="toc-section-number">5.2.1</span> Le problème de l’état</a></li>
<li><a href="#ce-que-stocke-la-mémoire"
id="toc-ce-que-stocke-la-mémoire"><span
class="toc-section-number">5.2.2</span> Ce que stocke la
mémoire</a></li>
<li><a href="#combinatoire-vs-séquentiel"
id="toc-combinatoire-vs-séquentiel"><span
class="toc-section-number">5.2.3</span> Combinatoire vs
Séquentiel</a></li>
</ul></li>
<li><a href="#le-temps-et-lhorloge-clock"
id="toc-le-temps-et-lhorloge-clock"><span
class="toc-section-number">5.3</span> Le Temps et l’Horloge (Clock)</a>
<ul>
<li><a href="#le-problème-de-la-synchronisation"
id="toc-le-problème-de-la-synchronisation"><span
class="toc-section-number">5.3.1</span> Le problème de la
synchronisation</a></li>
<li><a href="#front-montant-rising-edge"
id="toc-front-montant-rising-edge"><span
class="toc-section-number">5.3.2</span> Front montant (Rising
Edge)</a></li>
<li><a href="#fréquence-dhorloge" id="toc-fréquence-dhorloge"><span
class="toc-section-number">5.3.3</span> Fréquence d’horloge</a></li>
</ul></li>
<li><a href="#la-bascule-d-d-flip-flop-dff"
id="toc-la-bascule-d-d-flip-flop-dff"><span
class="toc-section-number">5.4</span> La Bascule D (D Flip-Flop /
DFF)</a>
<ul>
<li><a href="#interface-1" id="toc-interface-1"><span
class="toc-section-number">5.4.1</span> Interface</a></li>
<li><a href="#comportement" id="toc-comportement"><span
class="toc-section-number">5.4.2</span> Comportement</a></li>
<li><a href="#pourquoi-est-ce-utile"
id="toc-pourquoi-est-ce-utile"><span
class="toc-section-number">5.4.3</span> Pourquoi est-ce utile ?</a></li>
<li><a href="#comment-fonctionne-une-dff-en-interne"
id="toc-comment-fonctionne-une-dff-en-interne"><span
class="toc-section-number">5.4.4</span> Comment fonctionne une DFF en
interne ?</a></li>
</ul></li>
<li><a href="#le-registre-1-bit-bit"
id="toc-le-registre-1-bit-bit"><span
class="toc-section-number">5.5</span> Le Registre 1-bit (Bit)</a>
<ul>
<li><a href="#le-problème" id="toc-le-problème"><span
class="toc-section-number">5.5.1</span> Le problème</a></li>
<li><a href="#la-solution-la-rétroaction"
id="toc-la-solution-la-rétroaction"><span
class="toc-section-number">5.5.2</span> La solution : la
rétroaction</a></li>
<li><a href="#cest-magique" id="toc-cest-magique"><span
class="toc-section-number">5.5.3</span> C’est magique !</a></li>
</ul></li>
<li><a href="#le-registre-32-bits" id="toc-le-registre-32-bits"><span
class="toc-section-number">5.6</span> Le Registre 32-bits</a>
<ul>
<li><a href="#du-bit-au-mot" id="toc-du-bit-au-mot"><span
class="toc-section-number">5.6.1</span> Du bit au mot</a></li>
<li><a href="#le-rôle-des-registres-dans-le-cpu"
id="toc-le-rôle-des-registres-dans-le-cpu"><span
class="toc-section-number">5.6.2</span> Le rôle des registres dans le
CPU</a></li>
</ul></li>
<li><a href="#la-ram-random-access-memory"
id="toc-la-ram-random-access-memory"><span
class="toc-section-number">5.7</span> La RAM (Random Access Memory)</a>
<ul>
<li><a href="#du-registre-à-la-mémoire"
id="toc-du-registre-à-la-mémoire"><span
class="toc-section-number">5.7.1</span> Du registre à la
mémoire</a></li>
<li><a href="#interface-de-la-ram" id="toc-interface-de-la-ram"><span
class="toc-section-number">5.7.2</span> Interface de la RAM</a></li>
<li><a href="#comment-ça-marche" id="toc-comment-ça-marche"><span
class="toc-section-number">5.7.3</span> Comment ça marche ?</a></li>
<li><a href="#exemple-ram8-8-mots-de-32-bits"
id="toc-exemple-ram8-8-mots-de-32-bits"><span
class="toc-section-number">5.7.4</span> Exemple : RAM8 (8 mots de 32
bits)</a></li>
<li><a href="#construction-hiérarchique-de-grandes-rams"
id="toc-construction-hiérarchique-de-grandes-rams"><span
class="toc-section-number">5.7.5</span> Construction hiérarchique de
grandes RAMs</a></li>
</ul></li>
<li><a href="#le-compteur-de-programme-pc"
id="toc-le-compteur-de-programme-pc"><span
class="toc-section-number">5.8</span> Le Compteur de Programme (PC)</a>
<ul>
<li><a href="#pourquoi-est-il-spécial"
id="toc-pourquoi-est-il-spécial"><span
class="toc-section-number">5.8.1</span> Pourquoi est-il spécial
?</a></li>
<li><a href="#les-trois-modes-du-pc"
id="toc-les-trois-modes-du-pc"><span
class="toc-section-number">5.8.2</span> Les trois modes du PC</a></li>
<li><a href="#schéma-simplifié-1" id="toc-schéma-simplifié-1"><span
class="toc-section-number">5.8.3</span> Schéma simplifié</a></li>
<li><a href="#le-lien-avec-lexécution-du-programme"
id="toc-le-lien-avec-lexécution-du-programme"><span
class="toc-section-number">5.8.4</span> Le lien avec l’exécution du
programme</a></li>
</ul></li>
<li><a href="#les-différents-types-de-mémoire"
id="toc-les-différents-types-de-mémoire"><span
class="toc-section-number">5.9</span> Les Différents Types de
Mémoire</a></li>
<li><a href="#exercices-pratiques-2"
id="toc-exercices-pratiques-2"><span
class="toc-section-number">5.10</span> Exercices Pratiques</a>
<ul>
<li><a href="#exercices-sur-le-simulateur-web-2"
id="toc-exercices-sur-le-simulateur-web-2"><span
class="toc-section-number">5.10.1</span> Exercices sur le Simulateur
Web</a></li>
<li><a href="#ordre-de-progression-recommandé"
id="toc-ordre-de-progression-recommandé"><span
class="toc-section-number">5.10.2</span> Ordre de progression
recommandé</a></li>
<li><a href="#prérequis" id="toc-prérequis"><span
class="toc-section-number">5.10.3</span> Prérequis</a></li>
<li><a href="#tests-en-ligne-de-commande-1"
id="toc-tests-en-ligne-de-commande-1"><span
class="toc-section-number">5.10.4</span> Tests en ligne de
commande</a></li>
</ul></li>
<li><a href="#défis-supplémentaires-2"
id="toc-défis-supplémentaires-2"><span
class="toc-section-number">5.11</span> Défis Supplémentaires</a>
<ul>
<li><a href="#défi-1-ram-avec-deux-ports-de-lecture"
id="toc-défi-1-ram-avec-deux-ports-de-lecture"><span
class="toc-section-number">5.11.1</span> Défi 1 : RAM avec deux ports de
lecture</a></li>
<li><a href="#défi-2-compteur-avec-valeur-maximale"
id="toc-défi-2-compteur-avec-valeur-maximale"><span
class="toc-section-number">5.11.2</span> Défi 2 : Compteur avec valeur
maximale</a></li>
<li><a href="#défi-3-registre-à-décalage-shift-register"
id="toc-défi-3-registre-à-décalage-shift-register"><span
class="toc-section-number">5.11.3</span> Défi 3 : Registre à décalage
(Shift Register)</a></li>
</ul></li>
<li><a href="#le-lien-avec-la-suite"
id="toc-le-lien-avec-la-suite"><span
class="toc-section-number">5.12</span> Le Lien avec la Suite</a></li>
<li><a href="#ce-quil-faut-retenir-2"
id="toc-ce-quil-faut-retenir-2"><span
class="toc-section-number">5.13</span> Ce qu’il faut retenir</a></li>
<li><a href="#auto-évaluation-2" id="toc-auto-évaluation-2"><span
class="toc-section-number">5.14</span> Auto-évaluation</a>
<ul>
<li><a href="#questions-de-compréhension-2"
id="toc-questions-de-compréhension-2"><span
class="toc-section-number">5.14.1</span> Questions de
compréhension</a></li>
<li><a href="#mini-défi-pratique-2" id="toc-mini-défi-pratique-2"><span
class="toc-section-number">5.14.2</span> Mini-défi pratique</a></li>
<li><a href="#checklist-de-validation-2"
id="toc-checklist-de-validation-2"><span
class="toc-section-number">5.14.3</span> Checklist de
validation</a></li>
</ul></li>
</ul></li>
<li><a href="#architecture-machine-isa-a32"
id="toc-architecture-machine-isa-a32"><span
class="toc-section-number">6</span> Architecture Machine (ISA A32)</a>
<ul>
<li><a href="#où-en-sommes-nous-3" id="toc-où-en-sommes-nous-3"><span
class="toc-section-number">6.1</span> Où en sommes-nous ?</a></li>
<li><a href="#quest-ce-quune-architecture"
id="toc-quest-ce-quune-architecture"><span
class="toc-section-number">6.2</span> Qu’est-ce qu’une Architecture
?</a>
<ul>
<li><a href="#le-contrat-fondamental"
id="toc-le-contrat-fondamental"><span
class="toc-section-number">6.2.1</span> Le contrat fondamental</a></li>
<li><a href="#codex-a32-une-architecture-risc-moderne"
id="toc-codex-a32-une-architecture-risc-moderne"><span
class="toc-section-number">6.2.2</span> Codex A32 : Une architecture
RISC moderne</a></li>
</ul></li>
<li><a href="#pourquoi-risc-larchitecture-loadstore"
id="toc-pourquoi-risc-larchitecture-loadstore"><span
class="toc-section-number">6.3</span> Pourquoi RISC ? L’architecture
Load/Store</a>
<ul>
<li><a href="#cisc-vs-risc" id="toc-cisc-vs-risc"><span
class="toc-section-number">6.3.1</span> CISC vs RISC</a></li>
<li><a href="#la-règle-dor-loadstore"
id="toc-la-règle-dor-loadstore"><span
class="toc-section-number">6.3.2</span> La règle d’or
Load/Store</a></li>
</ul></li>
<li><a href="#le-cycle-de-vie-dune-instruction"
id="toc-le-cycle-de-vie-dune-instruction"><span
class="toc-section-number">6.4</span> Le Cycle de Vie d’une
Instruction</a></li>
<li><a href="#les-registres-le-plan-de-travail"
id="toc-les-registres-le-plan-de-travail"><span
class="toc-section-number">6.5</span> Les Registres : Le Plan de
Travail</a>
<ul>
<li><a href="#vue-densemble" id="toc-vue-densemble"><span
class="toc-section-number">6.5.1</span> Vue d’ensemble</a></li>
<li><a href="#rôles-des-registres" id="toc-rôles-des-registres"><span
class="toc-section-number">6.5.2</span> Rôles des registres</a></li>
<li><a href="#le-cas-spécial-de-r15-pc"
id="toc-le-cas-spécial-de-r15-pc"><span
class="toc-section-number">6.5.3</span> Le cas spécial de R15
(PC)</a></li>
</ul></li>
<li><a href="#la-carte-mémoire-memory-map"
id="toc-la-carte-mémoire-memory-map"><span
class="toc-section-number">6.6</span> La Carte Mémoire (Memory Map)</a>
<ul>
<li><a href="#organisation-de-la-mémoire-codex"
id="toc-organisation-de-la-mémoire-codex"><span
class="toc-section-number">6.6.1</span> Organisation de la mémoire
Codex</a></li>
<li><a href="#le-memory-mapped-io-mmio"
id="toc-le-memory-mapped-io-mmio"><span
class="toc-section-number">6.6.2</span> Le Memory-Mapped I/O
(MMIO)</a></li>
</ul></li>
<li><a href="#le-format-des-instructions"
id="toc-le-format-des-instructions"><span
class="toc-section-number">6.7</span> Le Format des Instructions</a>
<ul>
<li><a href="#les-bits-de-condition-31-28"
id="toc-les-bits-de-condition-31-28"><span
class="toc-section-number">6.7.1</span> Les bits de condition
(31-28)</a></li>
<li><a href="#les-classes-dinstructions-27-25"
id="toc-les-classes-dinstructions-27-25"><span
class="toc-section-number">6.7.2</span> Les classes d’instructions
(27-25)</a></li>
</ul></li>
<li><a href="#les-instructions-en-détail"
id="toc-les-instructions-en-détail"><span
class="toc-section-number">6.8</span> Les Instructions en Détail</a>
<ul>
<li><a href="#a.-opérations-arithmétiques-et-logiques"
id="toc-a.-opérations-arithmétiques-et-logiques"><span
class="toc-section-number">6.8.1</span> A. Opérations Arithmétiques et
Logiques</a></li>
<li><a href="#b.-accès-mémoire-loadstore"
id="toc-b.-accès-mémoire-loadstore"><span
class="toc-section-number">6.8.2</span> B. Accès Mémoire
(Load/Store)</a></li>
<li><a href="#c.-branchements" id="toc-c.-branchements"><span
class="toc-section-number">6.8.3</span> C. Branchements</a></li>
</ul></li>
<li><a href="#la-pile-stack" id="toc-la-pile-stack"><span
class="toc-section-number">6.9</span> La Pile (Stack)</a>
<ul>
<li><a href="#fonctionnement" id="toc-fonctionnement"><span
class="toc-section-number">6.9.1</span> Fonctionnement</a></li>
<li><a href="#push-et-pop-manuel" id="toc-push-et-pop-manuel"><span
class="toc-section-number">6.9.2</span> Push et Pop (manuel)</a></li>
</ul></li>
<li><a href="#exemples-de-programmes"
id="toc-exemples-de-programmes"><span
class="toc-section-number">6.10</span> Exemples de Programmes</a>
<ul>
<li><a href="#exemple-1-somme-de-1-à-n"
id="toc-exemple-1-somme-de-1-à-n"><span
class="toc-section-number">6.10.1</span> Exemple 1 : Somme de 1 à
N</a></li>
<li><a href="#exemple-2-maximum-de-deux-nombres-avec-prédication"
id="toc-exemple-2-maximum-de-deux-nombres-avec-prédication"><span
class="toc-section-number">6.10.2</span> Exemple 2 : Maximum de deux
nombres (avec prédication)</a></li>
<li><a href="#exemple-3-dessiner-un-pixel"
id="toc-exemple-3-dessiner-un-pixel"><span
class="toc-section-number">6.10.3</span> Exemple 3 : Dessiner un
pixel</a></li>
</ul></li>
<li><a href="#gestion-des-erreurs-traps"
id="toc-gestion-des-erreurs-traps"><span
class="toc-section-number">6.11</span> Gestion des Erreurs
(Traps)</a></li>
<li><a href="#exercices-pratiques-3"
id="toc-exercices-pratiques-3"><span
class="toc-section-number">6.12</span> Exercices Pratiques</a>
<ul>
<li><a href="#exercices-sur-le-simulateur-web-3"
id="toc-exercices-sur-le-simulateur-web-3"><span
class="toc-section-number">6.12.1</span> Exercices sur le Simulateur
Web</a></li>
<li><a href="#tests-en-ligne-de-commande-2"
id="toc-tests-en-ligne-de-commande-2"><span
class="toc-section-number">6.12.2</span> Tests en ligne de
commande</a></li>
</ul></li>
<li><a href="#ce-quil-faut-retenir-3"
id="toc-ce-quil-faut-retenir-3"><span
class="toc-section-number">6.13</span> Ce qu’il faut retenir</a></li>
<li><a href="#auto-évaluation-3" id="toc-auto-évaluation-3"><span
class="toc-section-number">6.14</span> Auto-évaluation</a>
<ul>
<li><a href="#questions-de-compréhension-3"
id="toc-questions-de-compréhension-3"><span
class="toc-section-number">6.14.1</span> Questions de
compréhension</a></li>
<li><a href="#mini-défi-pratique-3" id="toc-mini-défi-pratique-3"><span
class="toc-section-number">6.14.2</span> Mini-défi pratique</a></li>
<li><a href="#checklist-de-validation-3"
id="toc-checklist-de-validation-3"><span
class="toc-section-number">6.14.3</span> Checklist de
validation</a></li>
</ul></li>
</ul></li>
<li><a href="#le-processeur-cpu" id="toc-le-processeur-cpu"><span
class="toc-section-number">7</span> Le Processeur (CPU)</a>
<ul>
<li><a href="#où-en-sommes-nous-4" id="toc-où-en-sommes-nous-4"><span
class="toc-section-number">7.1</span> Où en sommes-nous ?</a></li>
<li><a href="#deux-implémentations-du-cpu"
id="toc-deux-implémentations-du-cpu"><span
class="toc-section-number">7.2</span> Deux Implémentations du CPU</a>
<ul>
<li><a href="#cpu-mono-cycle-simulateur-rust"
id="toc-cpu-mono-cycle-simulateur-rust"><span
class="toc-section-number">7.2.1</span> CPU Mono-cycle (Simulateur
Rust)</a></li>
<li><a href="#cpu-pipeline-hdl" id="toc-cpu-pipeline-hdl"><span
class="toc-section-number">7.2.2</span> CPU Pipeline (HDL)</a></li>
<li><a href="#pourquoi-deux-implémentations"
id="toc-pourquoi-deux-implémentations"><span
class="toc-section-number">7.2.3</span> Pourquoi deux implémentations
?</a></li>
</ul></li>
<li><a href="#quest-ce-quun-cpu" id="toc-quest-ce-quun-cpu"><span
class="toc-section-number">7.3</span> Qu’est-ce qu’un CPU ?</a>
<ul>
<li><a href="#le-chef-dorchestre" id="toc-le-chef-dorchestre"><span
class="toc-section-number">7.3.1</span> Le chef d’orchestre</a></li>
<li><a href="#ce-que-nous-avons-construit-jusquici"
id="toc-ce-que-nous-avons-construit-jusquici"><span
class="toc-section-number">7.3.2</span> Ce que nous avons construit
jusqu’ici</a></li>
<li><a href="#ce-quil-reste-à-construire"
id="toc-ce-quil-reste-à-construire"><span
class="toc-section-number">7.3.3</span> Ce qu’il reste à
construire</a></li>
</ul></li>
<li><a href="#architecture-du-cpu-data-path"
id="toc-architecture-du-cpu-data-path"><span
class="toc-section-number">7.4</span> Architecture du CPU (Data
Path)</a>
<ul>
<li><a href="#les-flux-de-données" id="toc-les-flux-de-données"><span
class="toc-section-number">7.4.1</span> Les flux de données</a></li>
</ul></li>
<li><a href="#les-composants-du-cpu"
id="toc-les-composants-du-cpu"><span
class="toc-section-number">7.5</span> Les Composants du CPU</a>
<ul>
<li><a href="#le-compteur-de-programme-pc-1"
id="toc-le-compteur-de-programme-pc-1"><span
class="toc-section-number">7.5.1</span> 1. Le Compteur de Programme
(PC)</a></li>
<li><a href="#le-décodeur-decoder" id="toc-le-décodeur-decoder"><span
class="toc-section-number">7.5.2</span> 2. Le Décodeur
(Decoder)</a></li>
<li><a href="#lunité-de-contrôle-control"
id="toc-lunité-de-contrôle-control"><span
class="toc-section-number">7.5.3</span> 3. L’Unité de Contrôle
(Control)</a></li>
<li><a href="#le-vérificateur-de-condition-condcheck"
id="toc-le-vérificateur-de-condition-condcheck"><span
class="toc-section-number">7.5.4</span> 4. Le Vérificateur de Condition
(CondCheck)</a></li>
<li><a href="#le-banc-de-registres-regfile"
id="toc-le-banc-de-registres-regfile"><span
class="toc-section-number">7.5.5</span> 5. Le Banc de Registres
(RegFile)</a></li>
<li><a href="#les-multiplexeurs" id="toc-les-multiplexeurs"><span
class="toc-section-number">7.5.6</span> 6. Les Multiplexeurs</a></li>
</ul></li>
<li><a href="#du-format-dinstruction-au-hardware"
id="toc-du-format-dinstruction-au-hardware"><span
class="toc-section-number">7.6</span> Du Format d’Instruction au
Hardware</a>
<ul>
<li><a href="#rappel-format-dune-instruction-a32"
id="toc-rappel-format-dune-instruction-a32"><span
class="toc-section-number">7.6.1</span> Rappel : Format d’une
Instruction A32</a></li>
<li><a href="#mapping-isa-hardware" id="toc-mapping-isa-hardware"><span
class="toc-section-number">7.6.2</span> Mapping ISA → Hardware</a></li>
<li><a href="#exemple-détaillé-add-r1-r2-r3"
id="toc-exemple-détaillé-add-r1-r2-r3"><span
class="toc-section-number">7.6.3</span> Exemple Détaillé : ADD R1, R2,
R3</a></li>
<li><a href="#exemple-détaillé-ldr-r0-r1-8"
id="toc-exemple-détaillé-ldr-r0-r1-8"><span
class="toc-section-number">7.6.4</span> Exemple Détaillé : LDR R0, [R1,
#8]</a></li>
<li><a href="#exemple-détaillé-b.eq-label"
id="toc-exemple-détaillé-b.eq-label"><span
class="toc-section-number">7.6.5</span> Exemple Détaillé : B.EQ
label</a></li>
<li><a href="#schéma-récapitulatif" id="toc-schéma-récapitulatif"><span
class="toc-section-number">7.6.6</span> Schéma Récapitulatif</a></li>
</ul></li>
<li><a href="#le-cycle-dexécution-en-détail"
id="toc-le-cycle-dexécution-en-détail"><span
class="toc-section-number">7.7</span> Le Cycle d’Exécution en Détail</a>
<ul>
<li><a href="#phase-1-fetch-récupération"
id="toc-phase-1-fetch-récupération"><span
class="toc-section-number">7.7.1</span> Phase 1 : Fetch
(Récupération)</a></li>
<li><a href="#phase-2-decode-décodage"
id="toc-phase-2-decode-décodage"><span
class="toc-section-number">7.7.2</span> Phase 2 : Decode
(Décodage)</a></li>
<li><a href="#phase-3-register-read-lecture-des-registres"
id="toc-phase-3-register-read-lecture-des-registres"><span
class="toc-section-number">7.7.3</span> Phase 3 : Register Read (Lecture
des registres)</a></li>
<li><a href="#phase-4-execute-exécution"
id="toc-phase-4-execute-exécution"><span
class="toc-section-number">7.7.4</span> Phase 4 : Execute
(Exécution)</a></li>
<li><a href="#phase-5-memory-accès-mémoire"
id="toc-phase-5-memory-accès-mémoire"><span
class="toc-section-number">7.7.5</span> Phase 5 : Memory (Accès
mémoire)</a></li>
<li><a href="#phase-6-writeback-écriture"
id="toc-phase-6-writeback-écriture"><span
class="toc-section-number">7.7.6</span> Phase 6 : Writeback
(Écriture)</a></li>
<li><a href="#phase-7-pc-update" id="toc-phase-7-pc-update"><span
class="toc-section-number">7.7.7</span> Phase 7 : PC Update</a></li>
</ul></li>
<li><a href="#implémentation-du-cpu-en-hdl"
id="toc-implémentation-du-cpu-en-hdl"><span
class="toc-section-number">7.8</span> Implémentation du CPU en
HDL</a></li>
<li><a href="#exercices-pratiques-4"
id="toc-exercices-pratiques-4"><span
class="toc-section-number">7.9</span> Exercices Pratiques</a>
<ul>
<li><a href="#exercices-sur-le-simulateur-web-4"
id="toc-exercices-sur-le-simulateur-web-4"><span
class="toc-section-number">7.9.1</span> Exercices sur le Simulateur
Web</a></li>
<li><a href="#ordre-de-progression" id="toc-ordre-de-progression"><span
class="toc-section-number">7.9.2</span> Ordre de progression</a></li>
<li><a href="#tests-en-ligne-de-commande-3"
id="toc-tests-en-ligne-de-commande-3"><span
class="toc-section-number">7.9.3</span> Tests en ligne de
commande</a></li>
</ul></li>
<li><a href="#cpu-visualizer-loutil-interactif"
id="toc-cpu-visualizer-loutil-interactif"><span
class="toc-section-number">7.10</span> CPU Visualizer : L’Outil
Interactif</a>
<ul>
<li><a href="#accéder-au-visualizer"
id="toc-accéder-au-visualizer"><span
class="toc-section-number">7.10.1</span> Accéder au Visualizer</a></li>
<li><a href="#fonctionnalités-du-visualizer"
id="toc-fonctionnalités-du-visualizer"><span
class="toc-section-number">7.10.2</span> Fonctionnalités du
Visualizer</a></li>
<li><a href="#les-démos-intégrées" id="toc-les-démos-intégrées"><span
class="toc-section-number">7.10.3</span> Les Démos Intégrées</a></li>
<li><a href="#contrôles" id="toc-contrôles"><span
class="toc-section-number">7.10.4</span> Contrôles</a></li>
<li><a href="#charger-votre-propre-code"
id="toc-charger-votre-propre-code"><span
class="toc-section-number">7.10.5</span> Charger Votre Propre
Code</a></li>
<li><a href="#exercice-pratique" id="toc-exercice-pratique"><span
class="toc-section-number">7.10.6</span> Exercice Pratique</a></li>
</ul></li>
<li><a href="#conseils-de-débogage" id="toc-conseils-de-débogage"><span
class="toc-section-number">7.11</span> Conseils de Débogage</a>
<ul>
<li><a href="#le-pc-reste-à-0" id="toc-le-pc-reste-à-0"><span
class="toc-section-number">7.11.1</span> Le PC reste à 0 ?</a></li>
<li><a href="#les-branchements-ne-marchent-pas"
id="toc-les-branchements-ne-marchent-pas"><span
class="toc-section-number">7.11.2</span> Les branchements ne marchent
pas ?</a></li>
<li><a href="#rien-ne-sécrit-dans-les-registres"
id="toc-rien-ne-sécrit-dans-les-registres"><span
class="toc-section-number">7.11.3</span> Rien ne s’écrit dans les
registres ?</a></li>
<li><a href="#ldrstr-ne-fonctionne-pas"
id="toc-ldrstr-ne-fonctionne-pas"><span
class="toc-section-number">7.11.4</span> LDR/STR ne fonctionne pas
?</a></li>
</ul></li>
<li><a href="#aller-plus-loin-le-cpu-pipeline"
id="toc-aller-plus-loin-le-cpu-pipeline"><span
class="toc-section-number">7.12</span> Aller Plus Loin : Le CPU
Pipeline</a>
<ul>
<li><a href="#pourquoi-le-cpu-single-cycle-est-lent"
id="toc-pourquoi-le-cpu-single-cycle-est-lent"><span
class="toc-section-number">7.12.1</span> Pourquoi le CPU Single-Cycle
est Lent</a></li>
<li><a href="#le-pipeline-à-5-étages"
id="toc-le-pipeline-à-5-étages"><span
class="toc-section-number">7.12.2</span> Le Pipeline à 5 Étages</a></li>
<li><a href="#visualisation-du-pipeline-en-action"
id="toc-visualisation-du-pipeline-en-action"><span
class="toc-section-number">7.12.3</span> Visualisation du Pipeline en
Action</a></li>
<li><a href="#les-registres-de-pipeline"
id="toc-les-registres-de-pipeline"><span
class="toc-section-number">7.12.4</span> Les Registres de
Pipeline</a></li>
<li><a href="#les-aléas-hazards" id="toc-les-aléas-hazards"><span
class="toc-section-number">7.12.5</span> Les Aléas (Hazards)</a></li>
<li><a href="#architecture-complète-du-cpu-pipeline"
id="toc-architecture-complète-du-cpu-pipeline"><span
class="toc-section-number">7.12.6</span> Architecture Complète du CPU
Pipeline</a></li>
<li><a href="#exercices-pratiques-projet-6"
id="toc-exercices-pratiques-projet-6"><span
class="toc-section-number">7.12.7</span> Exercices Pratiques : Projet
6</a></li>
<li><a href="#comment-tester-le-cpu-pipeline-hdl"
id="toc-comment-tester-le-cpu-pipeline-hdl"><span
class="toc-section-number">7.12.8</span> Comment Tester le CPU Pipeline
HDL</a></li>
<li><a href="#résumé-pipeline-vs-single-cycle"
id="toc-résumé-pipeline-vs-single-cycle"><span
class="toc-section-number">7.12.9</span> Résumé : Pipeline vs
Single-Cycle</a></li>
<li><a href="#pour-aller-encore-plus-loin"
id="toc-pour-aller-encore-plus-loin"><span
class="toc-section-number">7.12.10</span> Pour Aller Encore Plus
Loin</a></li>
</ul></li>
<li><a href="#le-lien-avec-la-suite-1"
id="toc-le-lien-avec-la-suite-1"><span
class="toc-section-number">7.13</span> Le Lien avec la Suite</a>
<ul>
<li><a href="#le-parcours-complet" id="toc-le-parcours-complet"><span
class="toc-section-number">7.13.1</span> Le parcours complet</a></li>
</ul></li>
<li><a href="#ce-quil-faut-retenir-4"
id="toc-ce-quil-faut-retenir-4"><span
class="toc-section-number">7.14</span> Ce qu’il faut retenir</a></li>
<li><a href="#auto-évaluation-4" id="toc-auto-évaluation-4"><span
class="toc-section-number">7.15</span> Auto-évaluation</a>
<ul>
<li><a href="#questions-de-compréhension-4"
id="toc-questions-de-compréhension-4"><span
class="toc-section-number">7.15.1</span> Questions de
compréhension</a></li>
<li><a href="#mini-défi-pratique-4" id="toc-mini-défi-pratique-4"><span
class="toc-section-number">7.15.2</span> Mini-défi pratique</a></li>
<li><a href="#checklist-de-validation-4"
id="toc-checklist-de-validation-4"><span
class="toc-section-number">7.15.3</span> Checklist de
validation</a></li>
</ul></li>
</ul></li>
<li><a href="#lassembleur" id="toc-lassembleur"><span
class="toc-section-number">8</span> L’Assembleur</a>
<ul>
<li><a href="#où-en-sommes-nous-5" id="toc-où-en-sommes-nous-5"><span
class="toc-section-number">8.1</span> Où en sommes-nous ?</a></li>
<li><a href="#le-rôle-de-lassembleur"
id="toc-le-rôle-de-lassembleur"><span
class="toc-section-number">8.2</span> Le Rôle de l’Assembleur</a>
<ul>
<li><a href="#du-texte-au-binaire" id="toc-du-texte-au-binaire"><span
class="toc-section-number">8.2.1</span> Du texte au binaire</a></li>
<li><a href="#les-trois-tâches-de-lassembleur"
id="toc-les-trois-tâches-de-lassembleur"><span
class="toc-section-number">8.2.2</span> Les trois tâches de
l’assembleur</a></li>
</ul></li>
<li><a href="#la-stratégie-des-deux-passes"
id="toc-la-stratégie-des-deux-passes"><span
class="toc-section-number">8.3</span> La Stratégie des Deux Passes</a>
<ul>
<li><a href="#pourquoi-deux-passes" id="toc-pourquoi-deux-passes"><span
class="toc-section-number">8.3.1</span> Pourquoi deux passes ?</a></li>
<li><a href="#passe-1-construction-de-la-table-des-symboles"
id="toc-passe-1-construction-de-la-table-des-symboles"><span
class="toc-section-number">8.3.2</span> Passe 1 : Construction de la
Table des Symboles</a></li>
<li><a href="#passe-2-génération-du-code"
id="toc-passe-2-génération-du-code"><span
class="toc-section-number">8.3.3</span> Passe 2 : Génération du
Code</a></li>
</ul></li>
<li><a href="#sections-et-directives"
id="toc-sections-et-directives"><span
class="toc-section-number">8.4</span> Sections et Directives</a>
<ul>
<li><a href="#les-sections" id="toc-les-sections"><span
class="toc-section-number">8.4.1</span> Les Sections</a></li>
<li><a href="#les-directives" id="toc-les-directives"><span
class="toc-section-number">8.4.2</span> Les Directives</a></li>
</ul></li>
<li><a href="#exemple-dencodage" id="toc-exemple-dencodage"><span
class="toc-section-number">8.5</span> Exemple d’Encodage</a>
<ul>
<li><a href="#étape-1-identifier-linstruction"
id="toc-étape-1-identifier-linstruction"><span
class="toc-section-number">8.5.1</span> Étape 1 : Identifier
l’instruction</a></li>
<li><a href="#étape-2-déterminer-la-classe"
id="toc-étape-2-déterminer-la-classe"><span
class="toc-section-number">8.5.2</span> Étape 2 : Déterminer la
classe</a></li>
<li><a href="#étape-3-assembler-les-bits"
id="toc-étape-3-assembler-les-bits"><span
class="toc-section-number">8.5.3</span> Étape 3 : Assembler les
bits</a></li>
</ul></li>
<li><a href="#la-gestion-des-grandes-constantes"
id="toc-la-gestion-des-grandes-constantes"><span
class="toc-section-number">8.6</span> La Gestion des Grandes
Constantes</a>
<ul>
<li><a href="#le-problème-1" id="toc-le-problème-1"><span
class="toc-section-number">8.6.1</span> Le problème</a></li>
<li><a href="#la-solution-le-literal-pool"
id="toc-la-solution-le-literal-pool"><span
class="toc-section-number">8.6.2</span> La solution : Le Literal
Pool</a></li>
</ul></li>
<li><a href="#exercices-pratiques-5"
id="toc-exercices-pratiques-5"><span
class="toc-section-number">8.7</span> Exercices Pratiques</a>
<ul>
<li><a href="#exercices-sur-le-simulateur-web-5"
id="toc-exercices-sur-le-simulateur-web-5"><span
class="toc-section-number">8.7.1</span> Exercices sur le Simulateur
Web</a></li>
<li><a href="#exercice-manuel-encodage"
id="toc-exercice-manuel-encodage"><span
class="toc-section-number">8.7.2</span> Exercice manuel :
Encodage</a></li>
<li><a href="#exercice-table-des-symboles"
id="toc-exercice-table-des-symboles"><span
class="toc-section-number">8.7.3</span> Exercice : Table des
symboles</a></li>
<li><a href="#utilisation-de-loutil-cli"
id="toc-utilisation-de-loutil-cli"><span
class="toc-section-number">8.7.4</span> Utilisation de l’outil
CLI</a></li>
</ul></li>
<li><a href="#ce-quil-faut-retenir-5"
id="toc-ce-quil-faut-retenir-5"><span
class="toc-section-number">8.8</span> Ce qu’il faut retenir</a></li>
<li><a href="#auto-évaluation-5" id="toc-auto-évaluation-5"><span
class="toc-section-number">8.9</span> Auto-évaluation</a>
<ul>
<li><a href="#questions-de-compréhension-5"
id="toc-questions-de-compréhension-5"><span
class="toc-section-number">8.9.1</span> Questions de
compréhension</a></li>
<li><a href="#mini-défi-pratique-5" id="toc-mini-défi-pratique-5"><span
class="toc-section-number">8.9.2</span> Mini-défi pratique</a></li>
<li><a href="#checklist-de-validation-5"
id="toc-checklist-de-validation-5"><span
class="toc-section-number">8.9.3</span> Checklist de validation</a></li>
</ul></li>
</ul></li>
<li><a href="#construction-du-compilateur"
id="toc-construction-du-compilateur"><span
class="toc-section-number">9</span> Construction du Compilateur</a>
<ul>
<li><a href="#où-en-sommes-nous-6" id="toc-où-en-sommes-nous-6"><span
class="toc-section-number">9.1</span> Où en sommes-nous ?</a></li>
<li><a href="#le-rôle-du-compilateur"
id="toc-le-rôle-du-compilateur"><span
class="toc-section-number">9.2</span> Le Rôle du Compilateur</a>
<ul>
<li><a href="#pourquoi-un-compilateur"
id="toc-pourquoi-un-compilateur"><span
class="toc-section-number">9.2.1</span> Pourquoi un compilateur
?</a></li>
<li><a href="#les-étapes-de-compilation"
id="toc-les-étapes-de-compilation"><span
class="toc-section-number">9.2.2</span> Les étapes de
compilation</a></li>
</ul></li>
<li><a href="#les-phases-du-compilateur"
id="toc-les-phases-du-compilateur"><span
class="toc-section-number">9.3</span> Les Phases du Compilateur</a>
<ul>
<li><a href="#phase-1-lexer-analyse-lexicale"
id="toc-phase-1-lexer-analyse-lexicale"><span
class="toc-section-number">9.3.1</span> Phase 1 : Lexer (Analyse
Lexicale)</a></li>
<li><a href="#phase-2-parser-analyse-syntaxique"
id="toc-phase-2-parser-analyse-syntaxique"><span
class="toc-section-number">9.3.2</span> Phase 2 : Parser (Analyse
Syntaxique)</a></li>
<li><a href="#phase-3-génération-de-code"
id="toc-phase-3-génération-de-code"><span
class="toc-section-number">9.3.3</span> Phase 3 : Génération de
Code</a></li>
</ul></li>
<li><a href="#compilation-des-structures-de-contrôle"
id="toc-compilation-des-structures-de-contrôle"><span
class="toc-section-number">9.4</span> Compilation des Structures de
Contrôle</a>
<ul>
<li><a href="#variables-locales" id="toc-variables-locales"><span
class="toc-section-number">9.4.1</span> Variables locales</a></li>
<li><a href="#expressions" id="toc-expressions"><span
class="toc-section-number">9.4.2</span> Expressions</a></li>
<li><a href="#if-else" id="toc-if-else"><span
class="toc-section-number">9.4.3</span> If / Else</a></li>
<li><a href="#boucle-while" id="toc-boucle-while"><span
class="toc-section-number">9.4.4</span> Boucle While</a></li>
<li><a href="#boucle-for" id="toc-boucle-for"><span
class="toc-section-number">9.4.5</span> Boucle For</a></li>
</ul></li>
<li><a href="#compilation-des-fonctions"
id="toc-compilation-des-fonctions"><span
class="toc-section-number">9.5</span> Compilation des Fonctions</a>
<ul>
<li><a href="#convention-dappel" id="toc-convention-dappel"><span
class="toc-section-number">9.5.1</span> Convention d’appel</a></li>
<li><a href="#prologue-et-épilogue" id="toc-prologue-et-épilogue"><span
class="toc-section-number">9.5.2</span> Prologue et Épilogue</a></li>
<li><a href="#appel-de-fonction" id="toc-appel-de-fonction"><span
class="toc-section-number">9.5.3</span> Appel de fonction</a></li>
</ul></li>
<li><a href="#le-compilateur-c32" id="toc-le-compilateur-c32"><span
class="toc-section-number">9.6</span> Le Compilateur C32</a>
<ul>
<li><a href="#utilisation" id="toc-utilisation"><span
class="toc-section-number">9.6.1</span> Utilisation</a></li>
<li><a href="#exemple-complet" id="toc-exemple-complet"><span
class="toc-section-number">9.6.2</span> Exemple complet</a></li>
</ul></li>
<li><a href="#du-code-c32-à-lexécution-trace-complète"
id="toc-du-code-c32-à-lexécution-trace-complète"><span
class="toc-section-number">9.7</span> Du Code C32 à l’Exécution : Trace
Complète</a>
<ul>
<li><a href="#le-programme-c32" id="toc-le-programme-c32"><span
class="toc-section-number">9.7.1</span> Le Programme C32</a></li>
<li><a href="#étape-1-analyse-lexicale-lexer"
id="toc-étape-1-analyse-lexicale-lexer"><span
class="toc-section-number">9.7.2</span> Étape 1 : Analyse Lexicale
(Lexer)</a></li>
<li><a href="#étape-2-analyse-syntaxique-parser"
id="toc-étape-2-analyse-syntaxique-parser"><span
class="toc-section-number">9.7.3</span> Étape 2 : Analyse Syntaxique
(Parser)</a></li>
<li><a href="#étape-3-génération-de-code-assembleur-a32"
id="toc-étape-3-génération-de-code-assembleur-a32"><span
class="toc-section-number">9.7.4</span> Étape 3 : Génération de Code
(Assembleur A32)</a></li>
<li><a href="#étape-4-assemblage-binaire"
id="toc-étape-4-assemblage-binaire"><span
class="toc-section-number">9.7.5</span> Étape 4 : Assemblage
(Binaire)</a></li>
<li><a href="#étape-5-exécution-cycle-par-cycle"
id="toc-étape-5-exécution-cycle-par-cycle"><span
class="toc-section-number">9.7.6</span> Étape 5 : Exécution (Cycle par
Cycle)</a></li>
<li><a href="#visualisation-de-la-pile"
id="toc-visualisation-de-la-pile"><span
class="toc-section-number">9.7.7</span> Visualisation de la
Pile</a></li>
<li><a href="#ce-qui-se-passe-dans-le-hardware"
id="toc-ce-qui-se-passe-dans-le-hardware"><span
class="toc-section-number">9.7.8</span> Ce qui se passe dans le
Hardware</a></li>
<li><a href="#résumé-du-voyage" id="toc-résumé-du-voyage"><span
class="toc-section-number">9.7.9</span> Résumé du Voyage</a></li>
</ul></li>
<li><a href="#construisez-votre-propre-compilateur"
id="toc-construisez-votre-propre-compilateur"><span
class="toc-section-number">9.8</span> Construisez Votre Propre
Compilateur !</a>
<ul>
<li><a href="#phase-1-lexer-analyse-lexicale-1"
id="toc-phase-1-lexer-analyse-lexicale-1"><span
class="toc-section-number">9.8.1</span> Phase 1 : Lexer (Analyse
Lexicale)</a></li>
<li><a href="#phase-2-parser-analyse-syntaxique-1"
id="toc-phase-2-parser-analyse-syntaxique-1"><span
class="toc-section-number">9.8.2</span> Phase 2 : Parser (Analyse
Syntaxique)</a></li>
<li><a href="#phase-3-émission-asm-génération-de-code"
id="toc-phase-3-émission-asm-génération-de-code"><span
class="toc-section-number">9.8.3</span> Phase 3 : Émission ASM
(Génération de Code)</a></li>
<li><a href="#phase-4-codegen-expressions"
id="toc-phase-4-codegen-expressions"><span
class="toc-section-number">9.8.4</span> Phase 4 : CodeGen
Expressions</a></li>
<li><a href="#phase-5-structures-de-contrôle"
id="toc-phase-5-structures-de-contrôle"><span
class="toc-section-number">9.8.5</span> Phase 5 : Structures de
Contrôle</a></li>
<li><a href="#phase-6-fonctions" id="toc-phase-6-fonctions"><span
class="toc-section-number">9.8.6</span> Phase 6 : Fonctions</a></li>
<li><a href="#phase-7-projet-final" id="toc-phase-7-projet-final"><span
class="toc-section-number">9.8.7</span> Phase 7 : Projet Final</a></li>
<li><a href="#techniques-clés" id="toc-techniques-clés"><span
class="toc-section-number">9.8.8</span> Techniques Clés</a></li>
</ul></li>
<li><a href="#exercices-pratiques-6"
id="toc-exercices-pratiques-6"><span
class="toc-section-number">9.9</span> Exercices Pratiques</a>
<ul>
<li><a href="#exercices-sur-le-simulateur-web-6"
id="toc-exercices-sur-le-simulateur-web-6"><span
class="toc-section-number">9.9.1</span> Exercices sur le Simulateur
Web</a></li>
<li><a href="#exercice-traduire-manuellement"
id="toc-exercice-traduire-manuellement"><span
class="toc-section-number">9.9.2</span> Exercice : Traduire
manuellement</a></li>
</ul></li>
<li><a href="#ce-quil-faut-retenir-6"
id="toc-ce-quil-faut-retenir-6"><span
class="toc-section-number">9.10</span> Ce qu’il faut retenir</a></li>
<li><a href="#auto-évaluation-6" id="toc-auto-évaluation-6"><span
class="toc-section-number">9.11</span> Auto-évaluation</a>
<ul>
<li><a href="#questions-de-compréhension-6"
id="toc-questions-de-compréhension-6"><span
class="toc-section-number">9.11.1</span> Questions de
compréhension</a></li>
<li><a href="#mini-défi-pratique-6" id="toc-mini-défi-pratique-6"><span
class="toc-section-number">9.11.2</span> Mini-défi pratique</a></li>
<li><a href="#checklist-de-validation-6"
id="toc-checklist-de-validation-6"><span
class="toc-section-number">9.11.3</span> Checklist de
validation</a></li>
</ul></li>
</ul></li>
<li><a href="#langage-de-haut-niveau-c32"
id="toc-langage-de-haut-niveau-c32"><span
class="toc-section-number">10</span> Langage de Haut Niveau (C32)</a>
<ul>
<li><a href="#où-en-sommes-nous-7" id="toc-où-en-sommes-nous-7"><span
class="toc-section-number">10.1</span> Où en sommes-nous ?</a></li>
<li><a href="#pourquoi-un-langage-de-haut-niveau"
id="toc-pourquoi-un-langage-de-haut-niveau"><span
class="toc-section-number">10.2</span> Pourquoi un Langage de Haut
Niveau ?</a>
<ul>
<li><a href="#le-problème-de-lassembleur"
id="toc-le-problème-de-lassembleur"><span
class="toc-section-number">10.2.1</span> Le problème de
l’assembleur</a></li>
<li><a href="#labstraction" id="toc-labstraction"><span
class="toc-section-number">10.2.2</span> L’abstraction</a></li>
</ul></li>
<li><a href="#spécification-du-langage-c32"
id="toc-spécification-du-langage-c32"><span
class="toc-section-number">10.3</span> Spécification du Langage C32</a>
<ul>
<li><a href="#les-types-de-données" id="toc-les-types-de-données"><span
class="toc-section-number">10.3.1</span> Les Types de Données</a></li>
<li><a href="#variables" id="toc-variables"><span
class="toc-section-number">10.3.2</span> Variables</a></li>
<li><a href="#portée-des-variables" id="toc-portée-des-variables"><span
class="toc-section-number">10.3.3</span> Portée des variables</a></li>
</ul></li>
<li><a href="#opérateurs" id="toc-opérateurs"><span
class="toc-section-number">10.4</span> Opérateurs</a>
<ul>
<li><a href="#arithmétiques" id="toc-arithmétiques"><span
class="toc-section-number">10.4.1</span> Arithmétiques</a></li>
<li><a href="#comparaison" id="toc-comparaison"><span
class="toc-section-number">10.4.2</span> Comparaison</a></li>
<li><a href="#logiques" id="toc-logiques"><span
class="toc-section-number">10.4.3</span> Logiques</a></li>
<li><a href="#binaires" id="toc-binaires"><span
class="toc-section-number">10.4.4</span> Binaires</a></li>
</ul></li>
<li><a href="#structures-de-contrôle"
id="toc-structures-de-contrôle"><span
class="toc-section-number">10.5</span> Structures de Contrôle</a>
<ul>
<li><a href="#if-else-1" id="toc-if-else-1"><span
class="toc-section-number">10.5.1</span> If / Else</a></li>
<li><a href="#while" id="toc-while"><span
class="toc-section-number">10.5.2</span> While</a></li>
<li><a href="#for" id="toc-for"><span
class="toc-section-number">10.5.3</span> For</a></li>
<li><a href="#do-while" id="toc-do-while"><span
class="toc-section-number">10.5.4</span> Do-While</a></li>
</ul></li>
<li><a href="#fonctions" id="toc-fonctions"><span
class="toc-section-number">10.6</span> Fonctions</a>
<ul>
<li><a href="#définition" id="toc-définition"><span
class="toc-section-number">10.6.1</span> Définition</a></li>
<li><a href="#appel" id="toc-appel"><span
class="toc-section-number">10.6.2</span> Appel</a></li>
<li><a href="#récursion" id="toc-récursion"><span
class="toc-section-number">10.6.3</span> Récursion</a></li>
</ul></li>
<li><a href="#pointeurs-et-tableaux"
id="toc-pointeurs-et-tableaux"><span
class="toc-section-number">10.7</span> Pointeurs et Tableaux</a>
<ul>
<li><a href="#pointeurs" id="toc-pointeurs"><span
class="toc-section-number">10.7.1</span> Pointeurs</a></li>
<li><a href="#tableaux" id="toc-tableaux"><span
class="toc-section-number">10.7.2</span> Tableaux</a></li>
<li><a href="#lien-entre-pointeurs-et-tableaux"
id="toc-lien-entre-pointeurs-et-tableaux"><span
class="toc-section-number">10.7.3</span> Lien entre pointeurs et
tableaux</a></li>
<li><a href="#arithmétique-des-pointeurs"
id="toc-arithmétique-des-pointeurs"><span
class="toc-section-number">10.7.4</span> Arithmétique des
Pointeurs</a></li>
</ul></li>
<li><a href="#accès-au-matériel-mmio"
id="toc-accès-au-matériel-mmio"><span
class="toc-section-number">10.8</span> Accès au Matériel (MMIO)</a>
<ul>
<li><a href="#lécran" id="toc-lécran"><span
class="toc-section-number">10.8.1</span> L’écran</a></li>
<li><a href="#le-clavier" id="toc-le-clavier"><span
class="toc-section-number">10.8.2</span> Le clavier</a></li>
</ul></li>
<li><a href="#exemple-complet-1" id="toc-exemple-complet-1"><span
class="toc-section-number">10.9</span> Exemple Complet</a></li>
<li><a href="#exercices-pratiques-7"
id="toc-exercices-pratiques-7"><span
class="toc-section-number">10.10</span> Exercices Pratiques</a>
<ul>
<li><a href="#exercices-sur-le-simulateur-web-7"
id="toc-exercices-sur-le-simulateur-web-7"><span
class="toc-section-number">10.10.1</span> Exercices sur le Simulateur
Web</a></li>
<li><a href="#défis-suggérés" id="toc-défis-suggérés"><span
class="toc-section-number">10.10.2</span> Défis suggérés</a></li>
</ul></li>
<li><a href="#les-structures-structs"
id="toc-les-structures-structs"><span
class="toc-section-number">10.11</span> Les Structures (Structs)</a>
<ul>
<li><a href="#définition-dune-structure"
id="toc-définition-dune-structure"><span
class="toc-section-number">10.11.1</span> Définition d’une
structure</a></li>
<li><a href="#utilisation-1" id="toc-utilisation-1"><span
class="toc-section-number">10.11.2</span> Utilisation</a></li>
<li><a href="#organisation-en-mémoire"
id="toc-organisation-en-mémoire"><span
class="toc-section-number">10.11.3</span> Organisation en
Mémoire</a></li>
<li><a href="#calcul-des-offsets" id="toc-calcul-des-offsets"><span
class="toc-section-number">10.11.4</span> Calcul des Offsets</a></li>
<li><a href="#alignement-padding" id="toc-alignement-padding"><span
class="toc-section-number">10.11.5</span> Alignement (Padding)</a></li>
<li><a href="#tableaux-de-structures"
id="toc-tableaux-de-structures"><span
class="toc-section-number">10.11.6</span> Tableaux de
Structures</a></li>
<li><a href="#pointeur-vers-structure"
id="toc-pointeur-vers-structure"><span
class="toc-section-number">10.11.7</span> Pointeur vers
structure</a></li>
<li><a href="#exemple-complet-2" id="toc-exemple-complet-2"><span
class="toc-section-number">10.11.8</span> Exemple complet</a></li>
<li><a href="#structures-imbriquées"
id="toc-structures-imbriquées"><span
class="toc-section-number">10.11.9</span> Structures imbriquées</a></li>
</ul></li>
<li><a href="#limitations-du-c32" id="toc-limitations-du-c32"><span
class="toc-section-number">10.12</span> Limitations du C32</a></li>
<li><a href="#ce-quil-faut-retenir-7"
id="toc-ce-quil-faut-retenir-7"><span
class="toc-section-number">10.13</span> Ce qu’il faut retenir</a></li>
<li><a href="#auto-évaluation-7" id="toc-auto-évaluation-7"><span
class="toc-section-number">10.14</span> Auto-évaluation</a>
<ul>
<li><a href="#questions-de-compréhension-7"
id="toc-questions-de-compréhension-7"><span
class="toc-section-number">10.14.1</span> Questions de
compréhension</a></li>
<li><a href="#mini-défi-pratique-7" id="toc-mini-défi-pratique-7"><span
class="toc-section-number">10.14.2</span> Mini-défi pratique</a></li>
<li><a href="#checklist-de-validation-7"
id="toc-checklist-de-validation-7"><span
class="toc-section-number">10.14.3</span> Checklist de
validation</a></li>
</ul></li>
</ul></li>
<li><a href="#système-dexploitation"
id="toc-système-dexploitation"><span
class="toc-section-number">11</span> Système d’Exploitation</a>
<ul>
<li><a href="#où-en-sommes-nous-8" id="toc-où-en-sommes-nous-8"><span
class="toc-section-number">11.1</span> Où en sommes-nous ?</a></li>
<li><a href="#quest-ce-quun-système-dexploitation"
id="toc-quest-ce-quun-système-dexploitation"><span
class="toc-section-number">11.2</span> Qu’est-ce qu’un Système
d’Exploitation ?</a>
<ul>
<li><a href="#la-hiérarchie-logicielle"
id="toc-la-hiérarchie-logicielle"><span
class="toc-section-number">11.2.1</span> La hiérarchie
logicielle</a></li>
<li><a href="#ce-que-fait-un-os" id="toc-ce-que-fait-un-os"><span
class="toc-section-number">11.2.2</span> Ce que fait un OS</a></li>
</ul></li>
<li><a href="#gestion-de-la-mémoire-le-tas-heap"
id="toc-gestion-de-la-mémoire-le-tas-heap"><span
class="toc-section-number">11.3</span> Gestion de la Mémoire (Le Tas /
Heap)</a>
<ul>
<li><a href="#le-problème-2" id="toc-le-problème-2"><span
class="toc-section-number">11.3.1</span> Le problème</a></li>
<li><a href="#lallocateur-bump-simple"
id="toc-lallocateur-bump-simple"><span
class="toc-section-number">11.3.2</span> L’allocateur “Bump”
(Simple)</a></li>
<li><a href="#lallocateur-par-liste-chaînée-avancé"
id="toc-lallocateur-par-liste-chaînée-avancé"><span
class="toc-section-number">11.3.3</span> L’allocateur par Liste Chaînée
(Avancé)</a></li>
</ul></li>
<li><a href="#bibliothèque-graphique"
id="toc-bibliothèque-graphique"><span
class="toc-section-number">11.4</span> Bibliothèque Graphique</a>
<ul>
<li><a href="#le-problème-3" id="toc-le-problème-3"><span
class="toc-section-number">11.4.1</span> Le problème</a></li>
<li><a href="#les-fonctions-graphiques"
id="toc-les-fonctions-graphiques"><span
class="toc-section-number">11.4.2</span> Les fonctions
graphiques</a></li>
<li><a href="#lalgorithme-de-bresenham"
id="toc-lalgorithme-de-bresenham"><span
class="toc-section-number">11.4.3</span> L’algorithme de
Bresenham</a></li>
</ul></li>
<li><a href="#entrées-sorties" id="toc-entrées-sorties"><span
class="toc-section-number">11.5</span> Entrées / Sorties</a>
<ul>
<li><a href="#printf-simplifié" id="toc-printf-simplifié"><span
class="toc-section-number">11.5.1</span> Printf simplifié</a></li>
<li><a href="#lecture-du-clavier" id="toc-lecture-du-clavier"><span
class="toc-section-number">11.5.2</span> Lecture du clavier</a></li>
</ul></li>
<li><a href="#interruptions-et-timer-concepts"
id="toc-interruptions-et-timer-concepts"><span
class="toc-section-number">11.6</span> Interruptions et Timer
(Concepts)</a>
<ul>
<li><a href="#le-problème-du-polling"
id="toc-le-problème-du-polling"><span
class="toc-section-number">11.6.1</span> Le problème du polling</a></li>
<li><a href="#les-interruptions" id="toc-les-interruptions"><span
class="toc-section-number">11.6.2</span> Les interruptions</a></li>
</ul></li>
<li><a href="#applications-démo" id="toc-applications-démo"><span
class="toc-section-number">11.7</span> Applications Démo</a>
<ul>
<li><a href="#compiler-et-exécuter-une-démo"
id="toc-compiler-et-exécuter-une-démo"><span
class="toc-section-number">11.7.1</span> Compiler et exécuter une
démo</a></li>
</ul></li>
<li><a href="#exercices-pratiques-8"
id="toc-exercices-pratiques-8"><span
class="toc-section-number">11.8</span> Exercices Pratiques</a>
<ul>
<li><a href="#exercices-sur-le-simulateur-web-8"
id="toc-exercices-sur-le-simulateur-web-8"><span
class="toc-section-number">11.8.1</span> Exercices sur le Simulateur
Web</a></li>
<li><a href="#défis-suggérés-1" id="toc-défis-suggérés-1"><span
class="toc-section-number">11.8.2</span> Défis suggérés</a></li>
</ul></li>
<li><a href="#le-parcours-complet-1"
id="toc-le-parcours-complet-1"><span
class="toc-section-number">11.9</span> Le Parcours Complet</a></li>
<li><a href="#ce-quil-faut-retenir-8"
id="toc-ce-quil-faut-retenir-8"><span
class="toc-section-number">11.10</span> Ce qu’il faut retenir</a></li>
<li><a href="#félicitations" id="toc-félicitations"><span
class="toc-section-number">11.11</span> Félicitations !</a></li>
<li><a href="#auto-évaluation-8" id="toc-auto-évaluation-8"><span
class="toc-section-number">11.12</span> Auto-évaluation</a>
<ul>
<li><a href="#questions-de-compréhension-8"
id="toc-questions-de-compréhension-8"><span
class="toc-section-number">11.12.1</span> Questions de
compréhension</a></li>
<li><a href="#réflexion-finale" id="toc-réflexion-finale"><span
class="toc-section-number">11.12.2</span> Réflexion finale</a></li>
<li><a href="#checklist-de-validation-finale"
id="toc-checklist-de-validation-finale"><span
class="toc-section-number">11.12.3</span> Checklist de validation
finale</a></li>
</ul></li>
</ul></li>
<li><a href="#annexe-tous-les-exercices"
id="toc-annexe-tous-les-exercices"><span
class="toc-section-number">12</span> Annexe : Tous les Exercices</a>
<ul>
<li><a href="#a.-exercices-hdl-portes-logiques"
id="toc-a.-exercices-hdl-portes-logiques"><span
class="toc-section-number">12.1</span> A. Exercices HDL (Portes
Logiques)</a>
<ul>
<li><a href="#projet-1-portes-de-base"
id="toc-projet-1-portes-de-base"><span
class="toc-section-number">12.1.1</span> Projet 1 : Portes de
Base</a></li>
<li><a href="#projet-2-arithmetique"
id="toc-projet-2-arithmetique"><span
class="toc-section-number">12.1.2</span> Projet 2 :
Arithmetique</a></li>
<li><a href="#projet-3-memoire" id="toc-projet-3-memoire"><span
class="toc-section-number">12.1.3</span> Projet 3 : Memoire</a></li>
<li><a href="#projet-5-cpu" id="toc-projet-5-cpu"><span
class="toc-section-number">12.1.4</span> Projet 5 : CPU</a></li>
<li><a href="#projet-6-cpu-pipeline-avance"
id="toc-projet-6-cpu-pipeline-avance"><span
class="toc-section-number">12.1.5</span> Projet 6 : CPU Pipeline
(Avance)</a></li>
<li><a href="#projet-7-cache-l1" id="toc-projet-7-cache-l1"><span
class="toc-section-number">12.1.6</span> Projet 7 : Cache L1</a></li>
</ul></li>
<li><a href="#b.-exercices-assembleur-a32"
id="toc-b.-exercices-assembleur-a32"><span
class="toc-section-number">12.2</span> B. Exercices Assembleur A32</a>
<ul>
<li><a href="#bases" id="toc-bases"><span
class="toc-section-number">12.2.1</span> Bases</a></li>
<li><a href="#controle-de-flux" id="toc-controle-de-flux"><span
class="toc-section-number">12.2.2</span> Controle de Flux</a></li>
<li><a href="#memoire" id="toc-memoire"><span
class="toc-section-number">12.2.3</span> Memoire</a></li>
<li><a href="#structures" id="toc-structures"><span
class="toc-section-number">12.2.4</span> Structures</a></li>
<li><a href="#fonctions-1" id="toc-fonctions-1"><span
class="toc-section-number">12.2.5</span> Fonctions</a></li>
<li><a href="#entreessorties" id="toc-entreessorties"><span
class="toc-section-number">12.2.6</span> Entrees/Sorties</a></li>
<li><a href="#ecran-320x240-1-bitpixel"
id="toc-ecran-320x240-1-bitpixel"><span
class="toc-section-number">12.2.7</span> Ecran (320x240, 1
bit/pixel)</a></li>
<li><a href="#jeux-interactifs" id="toc-jeux-interactifs"><span
class="toc-section-number">12.2.8</span> Jeux Interactifs</a></li>
<li><a href="#cache-patterns-dacces-memoire"
id="toc-cache-patterns-dacces-memoire"><span
class="toc-section-number">12.2.9</span> Cache (Patterns d’Acces
Memoire)</a></li>
</ul></li>
<li><a href="#c.-exercices-c32" id="toc-c.-exercices-c32"><span
class="toc-section-number">12.3</span> C. Exercices C32</a>
<ul>
<li><a href="#bases-1" id="toc-bases-1"><span
class="toc-section-number">12.3.1</span> Bases</a></li>
<li><a href="#conditions" id="toc-conditions"><span
class="toc-section-number">12.3.2</span> Conditions</a></li>
<li><a href="#boucles" id="toc-boucles"><span
class="toc-section-number">12.3.3</span> Boucles</a></li>
<li><a href="#fonctions-2" id="toc-fonctions-2"><span
class="toc-section-number">12.3.4</span> Fonctions</a></li>
<li><a href="#tableaux-1" id="toc-tableaux-1"><span
class="toc-section-number">12.3.5</span> Tableaux</a></li>
<li><a href="#pointeurs-1" id="toc-pointeurs-1"><span
class="toc-section-number">12.3.6</span> Pointeurs</a></li>
<li><a href="#operations-binaires" id="toc-operations-binaires"><span
class="toc-section-number">12.3.7</span> Operations Binaires</a></li>
<li><a href="#recursion" id="toc-recursion"><span
class="toc-section-number">12.3.8</span> Recursion</a></li>
<li><a href="#algorithmes-avances" id="toc-algorithmes-avances"><span
class="toc-section-number">12.3.9</span> Algorithmes Avances</a></li>
<li><a href="#structures-1" id="toc-structures-1"><span
class="toc-section-number">12.3.10</span> Structures</a></li>
<li><a href="#cache-patterns-dacces-memoire-1"
id="toc-cache-patterns-dacces-memoire-1"><span
class="toc-section-number">12.3.11</span> Cache (Patterns d’Acces
Memoire)</a></li>
<li><a href="#entreessorties-1" id="toc-entreessorties-1"><span
class="toc-section-number">12.3.12</span> Entrees/Sorties</a></li>
<li><a href="#projets-avances" id="toc-projets-avances"><span
class="toc-section-number">12.3.13</span> Projets Avances</a></li>
</ul></li>
<li><a href="#d.-construction-du-compilateur"
id="toc-d.-construction-du-compilateur"><span
class="toc-section-number">12.4</span> D. Construction du
Compilateur</a>
<ul>
<li><a href="#phase-1-lexer" id="toc-phase-1-lexer"><span
class="toc-section-number">12.4.1</span> Phase 1 : Lexer</a></li>
<li><a href="#phase-2-parser" id="toc-phase-2-parser"><span
class="toc-section-number">12.4.2</span> Phase 2 : Parser</a></li>
<li><a href="#phase-3-emission-asm" id="toc-phase-3-emission-asm"><span
class="toc-section-number">12.4.3</span> Phase 3 : Emission ASM</a></li>
<li><a href="#phase-4-codegen-expressions-1"
id="toc-phase-4-codegen-expressions-1"><span
class="toc-section-number">12.4.4</span> Phase 4 : CodeGen
Expressions</a></li>
<li><a href="#phase-5-structures-de-controle"
id="toc-phase-5-structures-de-controle"><span
class="toc-section-number">12.4.5</span> Phase 5 : Structures de
Controle</a></li>
<li><a href="#phase-6-fonctions-1" id="toc-phase-6-fonctions-1"><span
class="toc-section-number">12.4.6</span> Phase 6 : Fonctions</a></li>
<li><a href="#phase-7-projet-final-1"
id="toc-phase-7-projet-final-1"><span
class="toc-section-number">12.4.7</span> Phase 7 : Projet Final</a></li>
</ul></li>
<li><a href="#e.-systeme-dexploitation"
id="toc-e.-systeme-dexploitation"><span
class="toc-section-number">12.5</span> E. Systeme d’Exploitation</a>
<ul>
<li><a href="#initialisation" id="toc-initialisation"><span
class="toc-section-number">12.5.1</span> Initialisation</a></li>
<li><a href="#gestion-memoire" id="toc-gestion-memoire"><span
class="toc-section-number">12.5.2</span> Gestion Memoire</a></li>
<li><a href="#drivers" id="toc-drivers"><span
class="toc-section-number">12.5.3</span> Drivers</a></li>
<li><a href="#console-et-clavier" id="toc-console-et-clavier"><span
class="toc-section-number">12.5.4</span> Console et Clavier</a></li>
<li><a href="#shell-et-applications"
id="toc-shell-et-applications"><span
class="toc-section-number">12.5.5</span> Shell et Applications</a></li>
<li><a href="#multitache" id="toc-multitache"><span
class="toc-section-number">12.5.6</span> Multitache</a></li>
<li><a href="#projets-os" id="toc-projets-os"><span
class="toc-section-number">12.5.7</span> Projets OS</a></li>
</ul></li>
<li><a href="#conseils-pour-les-exercices"
id="toc-conseils-pour-les-exercices"><span
class="toc-section-number">12.6</span> Conseils pour les
Exercices</a></li>
</ul></li>
<li><a href="#lart-du-débogage" id="toc-lart-du-débogage"><span
class="toc-section-number">13</span> L’Art du Débogage</a>
<ul>
<li><a href="#pourquoi-ce-chapitre" id="toc-pourquoi-ce-chapitre"><span
class="toc-section-number">13.1</span> Pourquoi ce Chapitre ?</a></li>
<li><a href="#comprendre-les-messages-derreur"
id="toc-comprendre-les-messages-derreur"><span
class="toc-section-number">13.2</span> 1. Comprendre les Messages
d’Erreur</a>
<ul>
<li><a href="#codes-derreur-du-projet-codex"
id="toc-codes-derreur-du-projet-codex"><span
class="toc-section-number">13.2.1</span> Codes d’Erreur du Projet
Codex</a></li>
<li><a href="#erreurs-dassemblage-e1xxx"
id="toc-erreurs-dassemblage-e1xxx"><span
class="toc-section-number">13.2.2</span> Erreurs d’Assemblage
(E1xxx)</a></li>
<li><a href="#erreurs-de-compilation-e2xxx"
id="toc-erreurs-de-compilation-e2xxx"><span
class="toc-section-number">13.2.3</span> Erreurs de Compilation
(E2xxx)</a></li>
<li><a href="#erreurs-de-liaison-e3xxx"
id="toc-erreurs-de-liaison-e3xxx"><span
class="toc-section-number">13.2.4</span> Erreurs de Liaison
(E3xxx)</a></li>
</ul></li>
<li><a href="#utiliser-le-simulateur-pas-à-pas"
id="toc-utiliser-le-simulateur-pas-à-pas"><span
class="toc-section-number">13.3</span> 2. Utiliser le Simulateur
Pas-à-Pas</a>
<ul>
<li><a href="#le-visualiseur-cpu" id="toc-le-visualiseur-cpu"><span
class="toc-section-number">13.3.1</span> Le Visualiseur CPU</a></li>
<li><a href="#méthodologie-de-débogage-pas-à-pas"
id="toc-méthodologie-de-débogage-pas-à-pas"><span
class="toc-section-number">13.3.2</span> Méthodologie de Débogage
Pas-à-Pas</a></li>
<li><a href="#exemple-pratique" id="toc-exemple-pratique"><span
class="toc-section-number">13.3.3</span> Exemple Pratique</a></li>
</ul></li>
<li><a href="#erreurs-courantes-et-solutions"
id="toc-erreurs-courantes-et-solutions"><span
class="toc-section-number">13.4</span> 3. Erreurs Courantes et
Solutions</a>
<ul>
<li><a href="#assembleur" id="toc-assembleur"><span
class="toc-section-number">13.4.1</span> 3.1 Assembleur</a></li>
<li><a href="#compilateur-c32" id="toc-compilateur-c32"><span
class="toc-section-number">13.4.2</span> 3.2 Compilateur C32</a></li>
<li><a href="#hdl" id="toc-hdl"><span
class="toc-section-number">13.4.3</span> 3.3 HDL</a></li>
</ul></li>
<li><a href="#méthodologie-systématique"
id="toc-méthodologie-systématique"><span
class="toc-section-number">13.5</span> 4. Méthodologie Systématique</a>
<ul>
<li><a href="#la-méthode-scientifique-du-débogage"
id="toc-la-méthode-scientifique-du-débogage"><span
class="toc-section-number">13.5.1</span> La Méthode Scientifique du
Débogage</a></li>
<li><a href="#la-technique-de-la-bissection"
id="toc-la-technique-de-la-bissection"><span
class="toc-section-number">13.5.2</span> La Technique de la
Bissection</a></li>
<li><a href="#ajouter-des-traces" id="toc-ajouter-des-traces"><span
class="toc-section-number">13.5.3</span> Ajouter des Traces</a></li>
</ul></li>
<li><a href="#erreurs-de-traps-et-leur-diagnostic"
id="toc-erreurs-de-traps-et-leur-diagnostic"><span
class="toc-section-number">13.6</span> 5. Erreurs de Traps et leur
Diagnostic</a>
<ul>
<li><a href="#types-de-traps" id="toc-types-de-traps"><span
class="toc-section-number">13.6.1</span> Types de Traps</a></li>
<li><a href="#déboguer-un-mem_fault"
id="toc-déboguer-un-mem_fault"><span
class="toc-section-number">13.6.2</span> Déboguer un MEM_FAULT</a></li>
</ul></li>
<li><a href="#checklist-de-débogage"
id="toc-checklist-de-débogage"><span
class="toc-section-number">13.7</span> 6. Checklist de Débogage</a>
<ul>
<li><a href="#assembleur-1" id="toc-assembleur-1"><span
class="toc-section-number">13.7.1</span> Assembleur</a></li>
<li><a href="#c32" id="toc-c32"><span
class="toc-section-number">13.7.2</span> C32</a></li>
<li><a href="#hdl-1" id="toc-hdl-1"><span
class="toc-section-number">13.7.3</span> HDL</a></li>
</ul></li>
<li><a href="#exercices-de-débogage"
id="toc-exercices-de-débogage"><span
class="toc-section-number">13.8</span> 7. Exercices de Débogage</a>
<ul>
<li><a href="#exercice-1-trouvez-le-bug"
id="toc-exercice-1-trouvez-le-bug"><span
class="toc-section-number">13.8.1</span> Exercice 1 : Trouvez le
bug</a></li>
<li><a href="#exercice-2-trouvez-le-bug"
id="toc-exercice-2-trouvez-le-bug"><span
class="toc-section-number">13.8.2</span> Exercice 2 : Trouvez le
bug</a></li>
<li><a href="#exercice-3-trouvez-le-bug"
id="toc-exercice-3-trouvez-le-bug"><span
class="toc-section-number">13.8.3</span> Exercice 3 : Trouvez le
bug</a></li>
</ul></li>
<li><a href="#ce-quil-faut-retenir-9"
id="toc-ce-quil-faut-retenir-9"><span
class="toc-section-number">13.9</span> Ce qu’il faut retenir</a></li>
</ul></li>
<li><a href="#le-cache-pourquoi-votre-ordinateur-semble-rapide"
id="toc-le-cache-pourquoi-votre-ordinateur-semble-rapide"><span
class="toc-section-number">14</span> Le Cache : Pourquoi Votre
Ordinateur Semble Rapide</a>
<ul>
<li><a href="#le-problème-la-ram-est-lente"
id="toc-le-problème-la-ram-est-lente"><span
class="toc-section-number">14.1</span> Le Problème : La RAM est Lente
!</a>
<ul>
<li><a href="#la-hiérarchie-mémoire"
id="toc-la-hiérarchie-mémoire"><span
class="toc-section-number">14.1.1</span> La Hiérarchie Mémoire</a></li>
<li><a href="#lécart-de-vitesse-visualisé"
id="toc-lécart-de-vitesse-visualisé"><span
class="toc-section-number">14.1.2</span> L’écart de vitesse
visualisé</a></li>
</ul></li>
<li><a href="#la-solution-le-principe-de-localité"
id="toc-la-solution-le-principe-de-localité"><span
class="toc-section-number">14.2</span> La Solution : Le Principe de
Localité</a>
<ul>
<li><a href="#localité-temporelle" id="toc-localité-temporelle"><span
class="toc-section-number">14.2.1</span> Localité Temporelle</a></li>
<li><a href="#localité-spatiale" id="toc-localité-spatiale"><span
class="toc-section-number">14.2.2</span> Localité Spatiale</a></li>
</ul></li>
<li><a href="#comment-fonctionne-le-cache"
id="toc-comment-fonctionne-le-cache"><span
class="toc-section-number">14.3</span> Comment Fonctionne le Cache ?</a>
<ul>
<li><a href="#les-lignes-de-cache" id="toc-les-lignes-de-cache"><span
class="toc-section-number">14.3.1</span> Les Lignes de Cache</a></li>
<li><a href="#structure-dune-ligne-de-cache"
id="toc-structure-dune-ligne-de-cache"><span
class="toc-section-number">14.3.2</span> Structure d’une Ligne de
Cache</a></li>
<li><a href="#découpage-dune-adresse"
id="toc-découpage-dune-adresse"><span
class="toc-section-number">14.3.3</span> Découpage d’une
Adresse</a></li>
<li><a href="#structure-complète-du-cache"
id="toc-structure-complète-du-cache"><span
class="toc-section-number">14.3.4</span> Structure Complète du
Cache</a></li>
</ul></li>
<li><a href="#hit-ou-miss-que-se-passe-t-il"
id="toc-hit-ou-miss-que-se-passe-t-il"><span
class="toc-section-number">14.4</span> Hit ou Miss : Que se passe-t-il
?</a>
<ul>
<li><a href="#scénario-1-cache-hit-succès"
id="toc-scénario-1-cache-hit-succès"><span
class="toc-section-number">14.4.1</span> Scénario 1 : Cache HIT
(Succès)</a></li>
<li><a href="#scénario-2-cache-miss-échec"
id="toc-scénario-2-cache-miss-échec"><span
class="toc-section-number">14.4.2</span> Scénario 2 : Cache MISS
(Échec)</a></li>
<li><a href="#diagramme-de-flux-complet"
id="toc-diagramme-de-flux-complet"><span
class="toc-section-number">14.4.3</span> Diagramme de Flux
Complet</a></li>
</ul></li>
<li><a href="#politiques-décriture" id="toc-politiques-décriture"><span
class="toc-section-number">14.5</span> Politiques d’Écriture</a>
<ul>
<li><a href="#write-through-écriture-directe"
id="toc-write-through-écriture-directe"><span
class="toc-section-number">14.5.1</span> Write-Through (Écriture
Directe)</a></li>
<li><a href="#write-back-écriture-différée"
id="toc-write-back-écriture-différée"><span
class="toc-section-number">14.5.2</span> Write-Back (Écriture
Différée)</a></li>
</ul></li>
<li><a href="#types-de-cache-direct-mapped-vs-associatif"
id="toc-types-de-cache-direct-mapped-vs-associatif"><span
class="toc-section-number">14.6</span> Types de Cache : Direct-Mapped vs
Associatif</a>
<ul>
<li><a href="#cache-direct-mapped-correspondance-directe"
id="toc-cache-direct-mapped-correspondance-directe"><span
class="toc-section-number">14.6.1</span> Cache Direct-Mapped
(Correspondance Directe)</a></li>
<li><a href="#cache-fully-associatif"
id="toc-cache-fully-associatif"><span
class="toc-section-number">14.6.2</span> Cache Fully-Associatif</a></li>
<li><a href="#cache-set-associatif-n-way"
id="toc-cache-set-associatif-n-way"><span
class="toc-section-number">14.6.3</span> Cache Set-Associatif
(N-Way)</a></li>
</ul></li>
<li><a href="#politiques-de-remplacement"
id="toc-politiques-de-remplacement"><span
class="toc-section-number">14.7</span> Politiques de Remplacement</a>
<ul>
<li><a href="#lru-least-recently-used"
id="toc-lru-least-recently-used"><span
class="toc-section-number">14.7.1</span> LRU (Least Recently
Used)</a></li>
<li><a href="#pseudo-lru-tree-plru" id="toc-pseudo-lru-tree-plru"><span
class="toc-section-number">14.7.2</span> Pseudo-LRU (Tree-PLRU)</a></li>
<li><a href="#fifo-first-in-first-out"
id="toc-fifo-first-in-first-out"><span
class="toc-section-number">14.7.3</span> FIFO (First-In
First-Out)</a></li>
<li><a href="#random-aléatoire" id="toc-random-aléatoire"><span
class="toc-section-number">14.7.4</span> Random (Aléatoire)</a></li>
<li><a href="#comparaison-des-politiques"
id="toc-comparaison-des-politiques"><span
class="toc-section-number">14.7.5</span> Comparaison des
Politiques</a></li>
</ul></li>
<li><a href="#caches-multi-niveaux-l1l2l3"
id="toc-caches-multi-niveaux-l1l2l3"><span
class="toc-section-number">14.8</span> Caches Multi-Niveaux
(L1/L2/L3)</a>
<ul>
<li><a href="#caractéristiques-typiques-2024"
id="toc-caractéristiques-typiques-2024"><span
class="toc-section-number">14.8.1</span> Caractéristiques Typiques
(2024)</a></li>
<li><a href="#politiques-dinclusion"
id="toc-politiques-dinclusion"><span
class="toc-section-number">14.8.2</span> Politiques d’Inclusion</a></li>
</ul></li>
<li><a href="#patterns-de-code-et-localité"
id="toc-patterns-de-code-et-localité"><span
class="toc-section-number">14.9</span> Patterns de Code et Localité</a>
<ul>
<li><a href="#pattern-1-parcours-séquentiel-localité-spatiale"
id="toc-pattern-1-parcours-séquentiel-localité-spatiale"><span
class="toc-section-number">14.9.1</span> Pattern 1 : Parcours Séquentiel
(Localité Spatiale)</a></li>
<li><a href="#pattern-2-accès-avec-stride-mauvaise-localité"
id="toc-pattern-2-accès-avec-stride-mauvaise-localité"><span
class="toc-section-number">14.9.2</span> Pattern 2 : Accès avec Stride
(Mauvaise Localité)</a></li>
<li><a href="#pattern-3-réutilisation-de-variables-localité-temporelle"
id="toc-pattern-3-réutilisation-de-variables-localité-temporelle"><span
class="toc-section-number">14.9.3</span> Pattern 3 : Réutilisation de
Variables (Localité Temporelle)</a></li>
<li><a href="#pattern-4-structure-de-données-cache-friendly"
id="toc-pattern-4-structure-de-données-cache-friendly"><span
class="toc-section-number">14.9.4</span> Pattern 4 : Structure de
Données Cache-Friendly</a></li>
<li><a href="#pattern-5-loop-tiling-blocking"
id="toc-pattern-5-loop-tiling-blocking"><span
class="toc-section-number">14.9.5</span> Pattern 5 : Loop Tiling /
Blocking</a></li>
</ul></li>
<li><a href="#modélisation-des-performances"
id="toc-modélisation-des-performances"><span
class="toc-section-number">14.10</span> Modélisation des
Performances</a>
<ul>
<li><a href="#temps-daccès-moyen-amat"
id="toc-temps-daccès-moyen-amat"><span
class="toc-section-number">14.10.1</span> Temps d’Accès Moyen
(AMAT)</a></li>
<li><a href="#amat-multi-niveaux" id="toc-amat-multi-niveaux"><span
class="toc-section-number">14.10.2</span> AMAT Multi-Niveaux</a></li>
<li><a href="#exercice-de-calcul" id="toc-exercice-de-calcul"><span
class="toc-section-number">14.10.3</span> Exercice de Calcul</a></li>
</ul></li>
<li><a href="#impact-sur-vos-programmes"
id="toc-impact-sur-vos-programmes"><span
class="toc-section-number">14.11</span> Impact sur vos Programmes</a>
<ul>
<li><a href="#parcours-de-tableaux-2d-lordre-compte"
id="toc-parcours-de-tableaux-2d-lordre-compte"><span
class="toc-section-number">14.11.1</span> Parcours de Tableaux 2D :
L’Ordre Compte !</a></li>
<li><a href="#parcours-row-major-en-ligne---efficace"
id="toc-parcours-row-major-en-ligne---efficace"><span
class="toc-section-number">14.11.2</span> Parcours Row-Major (En Ligne)
- EFFICACE</a></li>
<li><a href="#parcours-column-major-en-colonne---inefficace"
id="toc-parcours-column-major-en-colonne---inefficace"><span
class="toc-section-number">14.11.3</span> Parcours Column-Major (En
Colonne) - INEFFICACE</a></li>
<li><a href="#comparaison-visuelle" id="toc-comparaison-visuelle"><span
class="toc-section-number">14.11.4</span> Comparaison Visuelle</a></li>
<li><a href="#technique-du-blocking"
id="toc-technique-du-blocking"><span
class="toc-section-number">14.11.5</span> Technique du Blocking</a></li>
</ul></li>
<li><a href="#implémentation-hdl-du-cache"
id="toc-implémentation-hdl-du-cache"><span
class="toc-section-number">14.12</span> Implémentation HDL du Cache</a>
<ul>
<li><a href="#architecture-globale" id="toc-architecture-globale"><span
class="toc-section-number">14.12.1</span> Architecture Globale</a></li>
<li><a href="#machine-à-états-du-contrôleur"
id="toc-machine-à-états-du-contrôleur"><span
class="toc-section-number">14.12.2</span> Machine à États du
Contrôleur</a></li>
<li><a href="#wordselect-sélection-du-mot"
id="toc-wordselect-sélection-du-mot"><span
class="toc-section-number">14.12.3</span> WordSelect : Sélection du
Mot</a></li>
</ul></li>
<li><a href="#statistiques-et-performance"
id="toc-statistiques-et-performance"><span
class="toc-section-number">14.13</span> Statistiques et Performance</a>
<ul>
<li><a href="#calcul-du-hit-rate" id="toc-calcul-du-hit-rate"><span
class="toc-section-number">14.13.1</span> Calcul du Hit Rate</a></li>
</ul></li>
<li><a href="#visualiser-le-cache-avec-le-cpu-visualizer"
id="toc-visualiser-le-cache-avec-le-cpu-visualizer"><span
class="toc-section-number">14.14</span> Visualiser le Cache avec le CPU
Visualizer</a>
<ul>
<li><a href="#accéder-au-visualizer-1"
id="toc-accéder-au-visualizer-1"><span
class="toc-section-number">14.14.1</span> Accéder au Visualizer</a></li>
<li><a href="#la-démo-cache" id="toc-la-démo-cache"><span
class="toc-section-number">14.14.2</span> La Démo “Cache”</a></li>
<li><a href="#ce-que-vous-verrez" id="toc-ce-que-vous-verrez"><span
class="toc-section-number">14.14.3</span> Ce que vous verrez</a></li>
<li><a href="#exercice-pratique-1" id="toc-exercice-pratique-1"><span
class="toc-section-number">14.14.4</span> Exercice Pratique</a></li>
</ul></li>
<li><a href="#exercices" id="toc-exercices"><span
class="toc-section-number">14.15</span> Exercices</a>
<ul>
<li><a href="#exercices-hdl" id="toc-exercices-hdl"><span
class="toc-section-number">14.15.1</span> Exercices HDL</a></li>
<li><a href="#exercices-assembleur-a32"
id="toc-exercices-assembleur-a32"><span
class="toc-section-number">14.15.2</span> Exercices Assembleur
A32</a></li>
<li><a href="#exercices-c32" id="toc-exercices-c32"><span
class="toc-section-number">14.15.3</span> Exercices C32</a></li>
</ul></li>
<li><a href="#résumé-visuel" id="toc-résumé-visuel"><span
class="toc-section-number">14.16</span> Résumé Visuel</a></li>
<li><a href="#points-clés-à-retenir"
id="toc-points-clés-à-retenir"><span
class="toc-section-number">14.17</span> Points Clés à Retenir</a></li>
<li><a href="#auto-évaluation-9" id="toc-auto-évaluation-9"><span
class="toc-section-number">14.18</span> Auto-évaluation</a>
<ul>
<li><a href="#questions-de-compréhension-9"
id="toc-questions-de-compréhension-9"><span
class="toc-section-number">14.18.1</span> Questions de
compréhension</a></li>
<li><a href="#mini-défi-pratique-8" id="toc-mini-défi-pratique-8"><span
class="toc-section-number">14.18.2</span> Mini-défi pratique</a></li>
<li><a href="#checklist-de-validation-8"
id="toc-checklist-de-validation-8"><span
class="toc-section-number">14.18.3</span> Checklist de
validation</a></li>
</ul></li>
</ul></li>
<li><a
href="#les-interruptions-quand-le-monde-extérieur-frappe-à-la-porte"
id="toc-les-interruptions-quand-le-monde-extérieur-frappe-à-la-porte"><span
class="toc-section-number">15</span> Les Interruptions : Quand le Monde
Extérieur Frappe à la Porte</a>
<ul>
<li><a href="#pourquoi-les-interruptions"
id="toc-pourquoi-les-interruptions"><span
class="toc-section-number">15.1</span> Pourquoi les Interruptions ?</a>
<ul>
<li><a href="#le-problème-le-polling"
id="toc-le-problème-le-polling"><span
class="toc-section-number">15.1.1</span> Le Problème : Le
Polling</a></li>
<li><a href="#la-solution-les-interruptions"
id="toc-la-solution-les-interruptions"><span
class="toc-section-number">15.1.2</span> La Solution : Les
Interruptions</a></li>
</ul></li>
<li><a href="#types-dinterruptions" id="toc-types-dinterruptions"><span
class="toc-section-number">15.2</span> Types d’Interruptions</a>
<ul>
<li><a href="#interruptions-matérielles-irq"
id="toc-interruptions-matérielles-irq"><span
class="toc-section-number">15.2.1</span> Interruptions Matérielles
(IRQ)</a></li>
<li><a href="#interruptions-logicielles-trapsswi"
id="toc-interruptions-logicielles-trapsswi"><span
class="toc-section-number">15.2.2</span> Interruptions Logicielles
(Traps/SWI)</a></li>
<li><a href="#exceptions" id="toc-exceptions"><span
class="toc-section-number">15.2.3</span> Exceptions</a></li>
</ul></li>
<li><a href="#architecture-dun-système-dinterruptions"
id="toc-architecture-dun-système-dinterruptions"><span
class="toc-section-number">15.3</span> Architecture d’un Système
d’Interruptions</a>
<ul>
<li><a href="#le-contrôleur-dinterruptions-picapic"
id="toc-le-contrôleur-dinterruptions-picapic"><span
class="toc-section-number">15.3.1</span> Le Contrôleur d’Interruptions
(PIC/APIC)</a></li>
<li><a href="#la-table-des-vecteurs-dinterruption-ivt"
id="toc-la-table-des-vecteurs-dinterruption-ivt"><span
class="toc-section-number">15.3.2</span> La Table des Vecteurs
d’Interruption (IVT)</a></li>
</ul></li>
<li><a href="#le-cycle-de-vie-dune-interruption"
id="toc-le-cycle-de-vie-dune-interruption"><span
class="toc-section-number">15.4</span> Le Cycle de Vie d’une
Interruption</a>
<ul>
<li><a href="#détection" id="toc-détection"><span
class="toc-section-number">15.4.1</span> 1. Détection</a></li>
<li><a href="#reconnaissance" id="toc-reconnaissance"><span
class="toc-section-number">15.4.2</span> 2. Reconnaissance</a></li>
<li><a href="#sauvegarde-du-contexte"
id="toc-sauvegarde-du-contexte"><span
class="toc-section-number">15.4.3</span> 3. Sauvegarde du
Contexte</a></li>
<li><a href="#exécution-du-handler-isr"
id="toc-exécution-du-handler-isr"><span
class="toc-section-number">15.4.4</span> 4. Exécution du Handler
(ISR)</a></li>
<li><a href="#retour-reti" id="toc-retour-reti"><span
class="toc-section-number">15.4.5</span> 5. Retour (RETI)</a></li>
</ul></li>
<li><a href="#gestion-des-priorités"
id="toc-gestion-des-priorités"><span
class="toc-section-number">15.5</span> Gestion des Priorités</a>
<ul>
<li><a href="#priorité-fixe-vs-programmable"
id="toc-priorité-fixe-vs-programmable"><span
class="toc-section-number">15.5.1</span> Priorité Fixe vs
Programmable</a></li>
<li><a href="#interruptions-imbriquées-nested"
id="toc-interruptions-imbriquées-nested"><span
class="toc-section-number">15.5.2</span> Interruptions Imbriquées
(Nested)</a></li>
</ul></li>
<li><a href="#latence-dinterruption"
id="toc-latence-dinterruption"><span
class="toc-section-number">15.6</span> Latence d’Interruption</a>
<ul>
<li><a href="#composants-de-la-latence"
id="toc-composants-de-la-latence"><span
class="toc-section-number">15.6.1</span> Composants de la
Latence</a></li>
<li><a href="#optimiser-la-latence" id="toc-optimiser-la-latence"><span
class="toc-section-number">15.6.2</span> Optimiser la Latence</a></li>
</ul></li>
<li><a href="#interruptions-et-systèmes-dexploitation"
id="toc-interruptions-et-systèmes-dexploitation"><span
class="toc-section-number">15.7</span> Interruptions et Systèmes
d’Exploitation</a>
<ul>
<li><a href="#le-timer-le-coeur-battant-de-los"
id="toc-le-timer-le-coeur-battant-de-los"><span
class="toc-section-number">15.7.1</span> Le Timer : Le Coeur Battant de
l’OS</a></li>
<li><a href="#changement-de-contexte-context-switch"
id="toc-changement-de-contexte-context-switch"><span
class="toc-section-number">15.7.2</span> Changement de Contexte (Context
Switch)</a></li>
</ul></li>
<li><a href="#problèmes-de-concurrence"
id="toc-problèmes-de-concurrence"><span
class="toc-section-number">15.8</span> Problèmes de Concurrence</a>
<ul>
<li><a href="#race-conditions" id="toc-race-conditions"><span
class="toc-section-number">15.8.1</span> Race Conditions</a></li>
<li><a href="#sections-critiques" id="toc-sections-critiques"><span
class="toc-section-number">15.8.2</span> Sections Critiques</a></li>
<li><a href="#attention-ne-pas-rester-trop-longtemps"
id="toc-attention-ne-pas-rester-trop-longtemps"><span
class="toc-section-number">15.8.3</span> Attention : Ne Pas Rester Trop
Longtemps !</a></li>
</ul></li>
<li><a href="#exercices-pratiques-9"
id="toc-exercices-pratiques-9"><span
class="toc-section-number">15.9</span> Exercices Pratiques</a>
<ul>
<li><a href="#exercices-sur-le-simulateur-web-9"
id="toc-exercices-sur-le-simulateur-web-9"><span
class="toc-section-number">15.9.1</span> Exercices sur le Simulateur
Web</a></li>
<li><a href="#exercice-1-gestionnaire-de-timer-simple"
id="toc-exercice-1-gestionnaire-de-timer-simple"><span
class="toc-section-number">15.9.2</span> Exercice 1 : Gestionnaire de
Timer Simple</a></li>
<li><a href="#exercice-2-buffer-circulaire-pour-clavier"
id="toc-exercice-2-buffer-circulaire-pour-clavier"><span
class="toc-section-number">15.9.3</span> Exercice 2 : Buffer Circulaire
pour Clavier</a></li>
<li><a href="#exercice-3-ordonnanceur-simple"
id="toc-exercice-3-ordonnanceur-simple"><span
class="toc-section-number">15.9.4</span> Exercice 3 : Ordonnanceur
Simple</a></li>
<li><a href="#exercice-4-analyse-de-latence"
id="toc-exercice-4-analyse-de-latence"><span
class="toc-section-number">15.9.5</span> Exercice 4 : Analyse de
Latence</a></li>
</ul></li>
<li><a href="#auto-évaluation-10" id="toc-auto-évaluation-10"><span
class="toc-section-number">15.10</span> Auto-évaluation</a>
<ul>
<li><a href="#quiz" id="toc-quiz"><span
class="toc-section-number">15.10.1</span> Quiz</a></li>
<li><a href="#exercice-de-réflexion"
id="toc-exercice-de-réflexion"><span
class="toc-section-number">15.10.2</span> Exercice de Réflexion</a></li>
</ul></li>
<li><a href="#résumé" id="toc-résumé"><span
class="toc-section-number">15.11</span> Résumé</a></li>
</ul></li>
<li><a href="#concepts-avancés-du-code-source-à-lexécution"
id="toc-concepts-avancés-du-code-source-à-lexécution"><span
class="toc-section-number">16</span> Concepts Avancés : Du Code Source à
l’Exécution</a>
<ul>
<li><a href="#partie-1-compilation-et-linking"
id="toc-partie-1-compilation-et-linking"><span
class="toc-section-number">16.1</span> Partie 1 : Compilation et
Linking</a>
<ul>
<li><a href="#le-voyage-du-code-source"
id="toc-le-voyage-du-code-source"><span
class="toc-section-number">16.1.1</span> Le Voyage du Code
Source</a></li>
<li><a href="#le-préprocesseur" id="toc-le-préprocesseur"><span
class="toc-section-number">16.1.2</span> Le Préprocesseur</a></li>
<li><a href="#les-fichiers-objets-.o"
id="toc-les-fichiers-objets-.o"><span
class="toc-section-number">16.1.3</span> Les Fichiers Objets
(.o)</a></li>
<li><a href="#le-linker-éditeur-de-liens"
id="toc-le-linker-éditeur-de-liens"><span
class="toc-section-number">16.1.4</span> Le Linker (Éditeur de
Liens)</a></li>
<li><a href="#linking-statique-vs-dynamique"
id="toc-linking-statique-vs-dynamique"><span
class="toc-section-number">16.1.5</span> Linking Statique vs
Dynamique</a></li>
<li><a href="#plt-et-got-comment-ça-marche"
id="toc-plt-et-got-comment-ça-marche"><span
class="toc-section-number">16.1.6</span> PLT et GOT : Comment ça
Marche</a></li>
</ul></li>
<li><a href="#partie-2-gestion-des-exceptions"
id="toc-partie-2-gestion-des-exceptions"><span
class="toc-section-number">16.2</span> Partie 2 : Gestion des
Exceptions</a>
<ul>
<li><a href="#quest-ce-quune-exception"
id="toc-quest-ce-quune-exception"><span
class="toc-section-number">16.2.1</span> Qu’est-ce qu’une Exception
?</a></li>
<li><a href="#anatomie-dune-exception"
id="toc-anatomie-dune-exception"><span
class="toc-section-number">16.2.2</span> Anatomie d’une
Exception</a></li>
<li><a href="#implémentation-bas-niveau-sjlj"
id="toc-implémentation-bas-niveau-sjlj"><span
class="toc-section-number">16.2.3</span> Implémentation Bas Niveau
(SJLJ)</a></li>
<li><a href="#table-driven-exception-handling-moderne"
id="toc-table-driven-exception-handling-moderne"><span
class="toc-section-number">16.2.4</span> Table-Driven Exception Handling
(Moderne)</a></li>
</ul></li>
<li><a href="#partie-3-threads-et-concurrence"
id="toc-partie-3-threads-et-concurrence"><span
class="toc-section-number">16.3</span> Partie 3 : Threads et
Concurrence</a>
<ul>
<li><a href="#processus-vs-threads" id="toc-processus-vs-threads"><span
class="toc-section-number">16.3.1</span> Processus vs Threads</a></li>
<li><a href="#création-de-threads" id="toc-création-de-threads"><span
class="toc-section-number">16.3.2</span> Création de Threads</a></li>
<li><a href="#le-problème-race-conditions"
id="toc-le-problème-race-conditions"><span
class="toc-section-number">16.3.3</span> Le Problème : Race
Conditions</a></li>
<li><a href="#synchronisation-mutex"
id="toc-synchronisation-mutex"><span
class="toc-section-number">16.3.4</span> Synchronisation :
Mutex</a></li>
<li><a href="#autres-primitives-de-synchronisation"
id="toc-autres-primitives-de-synchronisation"><span
class="toc-section-number">16.3.5</span> Autres Primitives de
Synchronisation</a></li>
<li><a href="#deadlocks" id="toc-deadlocks"><span
class="toc-section-number">16.3.6</span> Deadlocks</a></li>
<li><a href="#modèles-de-concurrence"
id="toc-modèles-de-concurrence"><span
class="toc-section-number">16.3.7</span> Modèles de Concurrence</a></li>
</ul></li>
<li><a href="#exercices-pratiques-10"
id="toc-exercices-pratiques-10"><span
class="toc-section-number">16.4</span> Exercices Pratiques</a>
<ul>
<li><a href="#exercices-sur-le-simulateur-web-10"
id="toc-exercices-sur-le-simulateur-web-10"><span
class="toc-section-number">16.4.1</span> Exercices sur le Simulateur
Web</a></li>
<li><a href="#exercice-1-analyse-dun-fichier-objet"
id="toc-exercice-1-analyse-dun-fichier-objet"><span
class="toc-section-number">16.4.2</span> Exercice 1 : Analyse d’un
Fichier Objet</a></li>
<li><a href="#exercice-2-linking-manuel"
id="toc-exercice-2-linking-manuel"><span
class="toc-section-number">16.4.3</span> Exercice 2 : Linking
Manuel</a></li>
<li><a href="#exercice-3-exception-handling-en-c"
id="toc-exercice-3-exception-handling-en-c"><span
class="toc-section-number">16.4.4</span> Exercice 3 : Exception Handling
en C</a></li>
<li><a href="#exercice-4-producteur-consommateur"
id="toc-exercice-4-producteur-consommateur"><span
class="toc-section-number">16.4.5</span> Exercice 4 :
Producteur-Consommateur</a></li>
<li><a href="#exercice-5-détection-de-deadlock"
id="toc-exercice-5-détection-de-deadlock"><span
class="toc-section-number">16.4.6</span> Exercice 5 : Détection de
Deadlock</a></li>
</ul></li>
<li><a href="#auto-évaluation-11" id="toc-auto-évaluation-11"><span
class="toc-section-number">16.5</span> Auto-évaluation</a>
<ul>
<li><a href="#quiz-1" id="toc-quiz-1"><span
class="toc-section-number">16.5.1</span> Quiz</a></li>
<li><a href="#défi" id="toc-défi"><span
class="toc-section-number">16.5.2</span> Défi</a></li>
</ul></li>
<li><a href="#résumé-1" id="toc-résumé-1"><span
class="toc-section-number">16.6</span> Résumé</a></li>
</ul></li>
</ul>
</nav>
<h1 data-number="1" id="larchitecture-codex-guide-de-létudiant"><span
class="header-section-number">1</span> L’Architecture Codex : Guide de
l’Étudiant</h1>
<p>Ce livre vous guide pas à pas dans la construction d’un ordinateur
complet, moderne et 32-bits, à partir de rien : des portes logiques
jusqu’au système d’exploitation.</p>
<h2 data-number="1.1" id="table-des-matières"><span
class="header-section-number">1.1</span> Table des Matières</h2>
<ol type="1">
<li><strong><a href="00_introduction.md">Introduction</a></strong>
<ul>
<li>La philosophie du projet.</li>
<li>L’architecture Codex A32.</li>
<li>Présentation des outils.</li>
</ul></li>
<li><strong><a href="01_logique_booleenne.md">Chapitre 1 : Logique
Booléenne</a></strong>
<ul>
<li>L’abstraction binaire.</li>
<li>Les portes logiques fondamentales (Nand, And, Or, Xor).</li>
<li><em>Exercices :</em> Implémentation dans
<code>hdl_lib/01_gates</code>.</li>
</ul></li>
<li><strong><a href="02_arithmetique.md">Chapitre 2 : Arithmétique
Binaire</a></strong> <em>(À venir)</em>
<ul>
<li>Représentation des nombres (Complément à 2).</li>
<li>Additionneurs et ALU (Arithmetic Logic Unit).</li>
<li><em>Exercices :</em> <code>hdl_lib/03_arith</code>.</li>
</ul></li>
<li><strong><a href="03_memoire.md">Chapitre 3 : Logique Séquentielle et
Mémoire</a></strong> <em>(À venir)</em>
<ul>
<li>Le temps et l’horloge.</li>
<li>Flip-Flops, Registres et RAM.</li>
<li><em>Exercices :</em> <code>hdl_lib/04_seq</code> &amp;
<code>02_multibit</code>.</li>
</ul></li>
<li><strong><a href="04_architecture.md">Chapitre 4 : Architecture
Machine (ISA A32)</a></strong> <em>(À venir)</em>
<ul>
<li>Le jeu d’instructions A32-Lite.</li>
<li>Registres, adressage et structure.</li>
<li><em>Référence :</em> <code>SPECS.md</code>.</li>
</ul></li>
<li><strong><a href="05_cpu.md">Chapitre 5 : Le Processeur
(CPU)</a></strong> <em>(À venir)</em>
<ul>
<li>Implémentation du chemin de données (Data Path).</li>
<li>Logique de contrôle.</li>
<li><em>Exercices :</em> <code>hdl_lib/05_cpu</code>.</li>
</ul></li>
<li><strong><a href="06_assembleur.md">Chapitre 6 :
L’Assembleur</a></strong> <em>(À venir)</em>
<ul>
<li>Traduction symbolique vers binaire.</li>
<li>Gestion des symboles et des labels.</li>
<li><em>Outils :</em> <code>a32_asm</code>.</li>
</ul></li>
<li><strong><a href="07_compilateur.md">Chapitre 7 : Construction du
Compilateur</a></strong> <em>(À venir)</em>
<ul>
<li>Analyse lexicale et syntaxique (Parsing).</li>
<li>Génération de code pour pile.</li>
<li><em>Outils :</em> <code>c32_cli</code>.</li>
</ul></li>
<li><strong><a href="08_langage.md">Chapitre 8 : Langage de Haut Niveau
(C32)</a></strong> <em>(À venir)</em>
<ul>
<li>Syntaxe du langage C32.</li>
<li>Structures de contrôle et types.</li>
</ul></li>
<li><strong><a href="09_os.md">Chapitre 9 : Système
d’Exploitation</a></strong> <em>(À venir)</em>
<ul>
<li>Gestion de la mémoire (Heap).</li>
<li>Entrées/Sorties (Clavier, Écran).</li>
<li><em>Exercices :</em> <code>os_lib</code>.</li>
</ul></li>
</ol>
<h2 data-number="1.2" id="comment-utiliser-ce-guide"><span
class="header-section-number">1.2</span> Comment utiliser ce guide</h2>
<p>Chaque chapitre commence par une <strong>Théorie</strong>, expliquant
les concepts fondamentaux. Ensuite, la section
<strong>Implémentation</strong> détaille ce que vous devez construire,
en faisant référence aux dossiers du projet.</p>
<blockquote>
<p><strong>Note :</strong> Ce projet utilise Rust pour l’outillage, mais
votre travail consistera principalement à écrire du HDL (Hardware
Description Language), de l’assembleur A32 et du C32.</p>
</blockquote>
<h1 data-number="2" id="introduction"><span
class="header-section-number">2</span> Introduction</h1>
<p>Bienvenue dans le projet <strong>Codex</strong>. Si vous lisez ceci,
c’est que vous avez l’ambition de comprendre comment fonctionnent les
ordinateurs — non pas en lisant des théories abstraites, mais en en
construisant un vous-même, de zéro.</p>
<h2 data-number="2.1" id="le-mystère-de-lordinateur"><span
class="header-section-number">2.1</span> Le Mystère de l’Ordinateur</h2>
<p>Prenez un instant pour réfléchir à ce qui se passe quand vous tapez
une lettre sur votre clavier :</p>
<ol type="1">
<li>Vos doigts appuient sur une touche physique</li>
<li>Un signal électrique est envoyé</li>
<li>Ce signal est transformé en code numérique</li>
<li>Le processeur le détecte et l’interprète</li>
<li>Un programme décide quoi faire de cette information</li>
<li>Des pixels s’allument sur votre écran pour afficher la lettre</li>
</ol>
<p>Entre votre doigt et le pixel, il y a des <strong>dizaines de couches
d’abstraction</strong>. Chaque couche fait confiance à celle en dessous
et simplifie la vie de celle au-dessus.</p>
<p>Ce livre va vous faire traverser <strong>toutes ces couches</strong>,
de la plus basse (les portes logiques) à la plus haute (les
applications).</p>
<h2 data-number="2.2" id="pourquoi-construire-un-ordinateur"><span
class="header-section-number">2.2</span> Pourquoi Construire un
Ordinateur ?</h2>
<h3 data-number="2.2.1" id="le-problème-de-la-boîte-noire"><span
class="header-section-number">2.2.1</span> Le problème de la “boîte
noire”</h3>
<p>Dans notre vie quotidienne, l’ordinateur est une “boîte noire”. Nous
tapons sur un clavier, touchons un écran, et la magie opère. En tant
qu’ingénieurs logiciels, nous travaillons souvent sur des couches
d’abstraction très élevées (Python, Java, React).</p>
<p>Cette abstraction est une bénédiction pour la productivité, mais elle
crée un <strong>fossé de compréhension</strong>. Combien de développeurs
savent vraiment : - Comment le processeur exécute leur code ? - Pourquoi
certaines opérations sont rapides et d’autres lentes ? - Ce qui se passe
quand on écrit <code>x = 5</code> ? - Comment une image apparaît à
l’écran ?</p>
<h3 data-number="2.2.2" id="lapproche-du-nand-au-tetris"><span
class="header-section-number">2.2.2</span> L’approche “Du NAND au
Tetris”</h3>
<p>Ce projet a pour but de <strong>briser l’abstraction</strong>. Nous
allons descendre au niveau le plus bas — la porte logique — et remonter
couche par couche jusqu’à pouvoir jouer à un jeu vidéo écrit dans un
langage de haut niveau sur notre propre machine.</p>
<p>À la fin de ce parcours, quand vous verrez du code s’exécuter, vous
saurez <strong>exactement</strong> ce qui se passe dans la machine. Ce
n’est plus de la magie — c’est de l’ingénierie que vous maîtrisez.</p>
<h2 data-number="2.3" id="ce-que-vous-allez-construire"><span
class="header-section-number">2.3</span> Ce que Vous Allez
Construire</h2>
<p>Voici les couches que nous allons traverser, de bas en haut :</p>
<figure>
<img src="images/architecture-stack.svg"
alt="Les 8 couches d’abstraction" />
<figcaption aria-hidden="true">Les 8 couches d’abstraction</figcaption>
</figure>
<h3 data-number="2.3.1" id="la-beauté-de-labstraction"><span
class="header-section-number">2.3.1</span> La beauté de
l’abstraction</h3>
<p>Chaque couche a une propriété remarquable : <strong>elle n’a besoin
de connaître que la couche juste en dessous</strong>.</p>
<ul>
<li>Le programmeur C32 n’a pas besoin de savoir comment fonctionne
l’ALU</li>
<li>L’ALU n’a pas besoin de savoir qu’elle va être utilisée pour un jeu
vidéo</li>
<li>La porte NAND ne “sait” pas qu’elle fait partie d’un ordinateur</li>
</ul>
<p>Cette séparation des préoccupations est ce qui rend possible la
construction de systèmes complexes.</p>
<h2 data-number="2.4" id="larchitecture-codex-a32"><span
class="header-section-number">2.4</span> L’Architecture Codex A32</h2>
<p>L’ordinateur <strong>Codex</strong> est conçu pour être à la fois
pédagogique et réaliste. Il s’inspire des architectures ARM modernes
tout en restant accessible.</p>
<p>Comparé aux architectures pédagogiques classiques plus simples (comme
Hack), Codex offre :</p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Caractéristique</th>
<th style="text-align: left;">Hack (Original)</th>
<th style="text-align: left;">Codex (Ce projet)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Architecture</strong></td>
<td style="text-align: left;">16-bits</td>
<td style="text-align: left;"><strong>32-bits</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Registres</strong></td>
<td style="text-align: left;">2 (A et D)</td>
<td style="text-align: left;"><strong>16 (R0-R15)</strong> style
ARM</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Mémoire</strong></td>
<td style="text-align: left;">Séparée (Harvard)</td>
<td style="text-align: left;"><strong>Unifiée</strong> (Von
Neumann)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Instructions</strong></td>
<td style="text-align: left;">Simple, propriétaire</td>
<td style="text-align: left;"><strong>RISC moderne</strong>
(Load/Store)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Écran</strong></td>
<td style="text-align: left;">Monochrome fixe</td>
<td style="text-align: left;"><strong>320×240 monochrome</strong></td>
</tr>
</tbody>
</table>
<h3 data-number="2.4.1" id="pourquoi-ces-changements"><span
class="header-section-number">2.4.1</span> Pourquoi ces changements
?</h3>
<ol type="1">
<li><p><strong>32 bits</strong> : C’est la taille standard des machines
modernes (avant 64 bits). Cela permet d’adresser 4 Go de mémoire et de
manipuler des nombres plus grands.</p></li>
<li><p><strong>16 registres</strong> : Les processeurs ARM (smartphones,
Raspberry Pi) utilisent aussi des registres R0-R15. Comprendre Codex,
c’est comprendre ARM.</p></li>
<li><p><strong>Architecture RISC</strong> : Les instructions sont
simples et régulières. Le CPU fait une chose à la fois, mais le fait
vite.</p></li>
<li><p><strong>Load/Store</strong> : Le CPU ne calcule jamais
directement en mémoire. Il charge d’abord les données dans des
registres, calcule, puis stocke le résultat. C’est plus simple à
implémenter et à comprendre.</p></li>
</ol>
<h2 data-number="2.5" id="ce-que-vous-allez-apprendre"><span
class="header-section-number">2.5</span> Ce que Vous Allez
Apprendre</h2>
<p>À la fin de ce livre, vous saurez :</p>
<p><strong>Au niveau matériel :</strong> - Comment construire des portes
logiques à partir de NAND - Comment un additionneur transforme des bits
en nombres - Comment la mémoire “se souvient” des données - Comment le
CPU orchestre tout cela</p>
<p><strong>Au niveau logiciel :</strong> - Comment l’assembleur traduit
les mnémoniques en binaire - Comment un compilateur transforme du code
lisible en instructions - Comment un OS simplifie l’accès au matériel -
Comment une application utilise toutes ces couches</p>
<p><strong>Au niveau conceptuel :</strong> - Pourquoi les ordinateurs
utilisent le binaire - Comment l’abstraction permet de gérer la
complexité - Pourquoi certaines opérations sont “coûteuses” - Comment le
même matériel peut faire des choses très différentes</p>
<h2 data-number="2.6" id="vos-outils"><span
class="header-section-number">2.6</span> Vos Outils</h2>
<p>Le projet est fourni avec une suite d’outils performants :</p>
<h3 data-number="2.6.1" id="les-outils-en-ligne-de-commande"><span
class="header-section-number">2.6.1</span> Les Outils en Ligne de
Commande</h3>
<table>
<colgroup>
<col style="width: 31%" />
<col style="width: 27%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Outil</th>
<th style="text-align: left;">Rôle</th>
<th style="text-align: left;">Exemple</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>hdl_cli</code></td>
<td style="text-align: left;">Simule vos circuits HDL</td>
<td style="text-align: left;"><code>hdl_cli test Not.hdl</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>a32_cli</code></td>
<td style="text-align: left;">Assemble le code A32 → binaire</td>
<td
style="text-align: left;"><code>a32_cli prog.s -o prog.bin</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>c32_cli</code></td>
<td style="text-align: left;">Compile le code C32 → assembleur</td>
<td style="text-align: left;"><code>c32_cli prog.c -o prog.s</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>a32_runner</code></td>
<td style="text-align: left;">Exécute le code binaire</td>
<td style="text-align: left;"><code>a32_runner prog.bin</code></td>
</tr>
</tbody>
</table>
<h3 data-number="2.6.2" id="le-simulateur-web-recommandé"><span
class="header-section-number">2.6.2</span> Le Simulateur Web
(Recommandé)</h3>
<p>Pour une expérience plus visuelle et interactive, utilisez le
<strong>Simulateur Web</strong>. Il vous permet de : - Écrire et tester
votre HDL directement dans le navigateur - Voir l’état des signaux en
temps réel avec des chronogrammes - Compiler et exécuter du code C et
Assembleur - Visualiser l’écran, les registres et la mémoire</p>
<p>Pour le lancer :</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> web</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run dev</span></code></pre></div>
<p>Ouvrez ensuite votre navigateur à l’adresse indiquée (généralement
<code>http://localhost:5173</code>).</p>
<h3 data-number="2.6.3" id="le-cpu-visualizer"><span
class="header-section-number">2.6.3</span> Le CPU Visualizer</h3>
<p>Le <strong>CPU Visualizer</strong> est un outil pédagogique
spécialement conçu pour comprendre le fonctionnement du processeur. Il
affiche en temps réel :</p>
<ul>
<li><strong>Le pipeline</strong> : Les 5 étapes d’exécution (Fetch,
Decode, Execute, Memory, Writeback) s’illuminent au fur et à mesure</li>
<li><strong>Les registres</strong> : R0-R15 avec mise en évidence des
modifications</li>
<li><strong>Les flags</strong> : N, Z, C, V avec animations lors des
changements</li>
<li><strong>Le code source</strong> : Coloration syntaxique et
surlignage de la ligne en cours d’exécution</li>
<li><strong>Le cache</strong> : Statistiques (hits/misses) et contenu
des lignes cache</li>
</ul>
<p>Accédez-y depuis le menu principal du Simulateur Web ou directement
via <code>/visualizer.html</code>.</p>
<p><strong>7 démos intégrées</strong> vous permettent d’explorer
différents concepts : 1. Addition simple 2. Boucles et branchements 3.
Accès mémoire (LDR/STR) 4. Conditions et prédication 5. Tableaux 6.
Flags CPU 7. Comportement du cache</p>
<h2 data-number="2.7" id="comment-utiliser-ce-livre"><span
class="header-section-number">2.7</span> Comment Utiliser ce Livre</h2>
<h3 data-number="2.7.1" id="lapproche-recommandée"><span
class="header-section-number">2.7.1</span> L’approche recommandée</h3>
<ol type="1">
<li><strong>Lisez chaque chapitre en entier</strong> avant de commencer
les exercices</li>
<li><strong>Faites les exercices dans l’ordre</strong> — chaque exercice
prépare le suivant</li>
<li><strong>Ne regardez pas les solutions</strong> avant d’avoir
vraiment essayé</li>
<li><strong>Utilisez le simulateur web</strong> pour visualiser ce qui
se passe</li>
<li><strong>Reliez toujours à l’ensemble</strong> — demandez-vous “où
cela s’insère-t-il ?”</li>
</ol>
<h3 data-number="2.7.2" id="si-vous-êtes-bloqué"><span
class="header-section-number">2.7.2</span> Si vous êtes bloqué</h3>
<ul>
<li>Relisez la section correspondante du chapitre</li>
<li>Vérifiez que vous avez bien compris les exercices précédents</li>
<li>Utilisez le débogueur visuel du simulateur web</li>
<li>Les erreurs les plus fréquentes sont des problèmes de câblage
(mauvaises connexions)</li>
</ul>
<h2 data-number="2.8" id="la-grande-aventure-commence"><span
class="header-section-number">2.8</span> La Grande Aventure
Commence</h2>
<p>Vous êtes sur le point d’entreprendre un voyage fascinant. Chaque
chapitre vous rapprochera un peu plus de la compréhension totale de la
machine.</p>
<p>Quand vous aurez terminé, vous regarderez votre ordinateur
différemment. Ce ne sera plus une boîte noire mystérieuse, mais une
symphonie d’abstractions que vous pouvez comprendre, modifier, et même
reconstruire.</p>
<p>Prêt ? Passons à la première brique élémentaire : la logique
booléenne.</p>
<hr />
<p><strong>Rappel important</strong> : Chaque chapitre de ce livre
construit sur les précédents. Résistez à la tentation de sauter des
étapes — la compréhension profonde vient de la construction
progressive.</p>
<h1 data-number="3" id="logique-booléenne"><span
class="header-section-number">3</span> Logique Booléenne</h1>
<blockquote>
<p>“Au commencement était le NAND.”</p>
</blockquote>
<p>Tout ordinateur numérique, aussi complexe soit-il, est construit à
partir de concepts incroyablement simples : le Vrai (<code>1</code>) et
le Faux (<code>0</code>). Ce chapitre traite de la construction de
portes logiques élémentaires à partir d’une brique fondamentale : la
porte NAND.</p>
<hr />
<h2 data-number="3.1" id="où-en-sommes-nous"><span
class="header-section-number">3.1</span> Où en sommes-nous ?</h2>
<figure>
<img src="images/architecture-stack.svg"
alt="Position dans l’architecture" />
<figcaption aria-hidden="true">Position dans l’architecture</figcaption>
</figure>
<p><em>Nous sommes à la Couche 0 : La Porte NAND - Notre axiome de
départ</em></p>
<p>Nous commençons tout en bas de la pyramide. C’est ici que nous posons
les fondations de tout l’édifice. Chaque porte que vous construirez dans
ce chapitre sera utilisée dans les chapitres suivants pour construire
des circuits de plus en plus complexes, jusqu’au CPU complet.</p>
<hr />
<h2 data-number="3.2" id="pourquoi-le-binaire"><span
class="header-section-number">3.2</span> Pourquoi le Binaire ?</h2>
<h3 data-number="3.2.1" id="la-question-fondamentale"><span
class="header-section-number">3.2.1</span> La question fondamentale</h3>
<p>Avant de construire des portes logiques, posons-nous une question
essentielle : <strong>pourquoi les ordinateurs utilisent-ils le binaire
(0 et 1) plutôt que le système décimal (0-9) que nous utilisons au
quotidien ?</strong></p>
<p>La réponse est d’ordre <strong>physique et pratique</strong> :</p>
<ol type="1">
<li><p><strong>Fiabilité</strong> : Distinguer entre deux états (tension
haute/basse, courant/pas courant) est beaucoup plus fiable que de
distinguer entre dix niveaux différents. Le bruit électrique peut
facilement transformer un “7” en “8”, mais rarement un “1” en
“0”.</p></li>
<li><p><strong>Simplicité</strong> : Les circuits qui ne gèrent que deux
états sont beaucoup plus simples à concevoir et à fabriquer. Un
transistor peut facilement agir comme un interrupteur (on/off).</p></li>
<li><p><strong>Universalité</strong> : George Boole a prouvé au 19ème
siècle que toute la logique peut être exprimée avec seulement deux
valeurs : Vrai et Faux.</p></li>
</ol>
<h3 data-number="3.2.2" id="du-voltage-au-bit"><span
class="header-section-number">3.2.2</span> Du voltage au bit</h3>
<p>Dans le monde physique, nos ordinateurs utilisent des tensions
électriques :</p>
<table>
<thead>
<tr class="header">
<th>Tension</th>
<th>Signification logique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0V - 0.8V</td>
<td><code>0</code> (Faux)</td>
</tr>
<tr class="even">
<td>2.4V - 3.3V</td>
<td><code>1</code> (Vrai)</td>
</tr>
</tbody>
</table>
<p>La zone entre 0.8V et 2.4V est une “zone interdite” — les circuits
sont conçus pour ne jamais s’y trouver de manière stable. C’est cette
séparation nette qui rend le binaire si robuste.</p>
<h3 data-number="3.2.3" id="labstraction-qui-libère"><span
class="header-section-number">3.2.3</span> L’abstraction qui libère</h3>
<p>En tant qu’architectes système, nous n’avons pas besoin de penser aux
voltages, aux électrons, ou aux transistors. Nous travaillons avec des
<strong>abstractions</strong> : - Un <strong>bit</strong> peut valoir 0
ou 1 - Une <strong>fonction booléenne</strong> transforme des bits en
d’autres bits</p>
<p>C’est la première de nombreuses couches d’abstraction que nous allons
traverser. Chaque couche nous permet de penser à un niveau supérieur
sans nous soucier des détails de la couche inférieure.</p>
<hr />
<h2 data-number="3.3" id="la-porte-nand-notre-axiome"><span
class="header-section-number">3.3</span> La Porte NAND : Notre
Axiome</h2>
<h3 data-number="3.3.1" id="pourquoi-partir-du-nand"><span
class="header-section-number">3.3.1</span> Pourquoi partir du NAND
?</h3>
<p>Il existe de nombreuses portes logiques (AND, OR, NOT, XOR…), mais
nous choisissons de tout construire à partir d’une seule : la porte
<strong>NAND</strong> (Not-AND).</p>
<p>Pourquoi ce choix ?</p>
<ol type="1">
<li><p><strong>Complétude fonctionnelle</strong> : Le NAND est dit
“fonctionnellement complet” — on peut construire TOUTES les autres
portes logiques à partir de NAND uniquement. C’est mathématiquement
prouvé !</p></li>
<li><p><strong>Réalité industrielle</strong> : La technologie CMOS
(Complementary Metal-Oxide-Semiconductor), utilisée dans tous les
processeurs modernes, implémente naturellement les portes NAND de
manière très efficace — seulement 4 transistors.</p></li>
<li><p><strong>Pédagogie</strong> : Partir d’une seule brique force à
comprendre comment les abstractions se construisent les unes sur les
autres.</p></li>
</ol>
<h3 data-number="3.3.2" id="table-de-vérité-nand"><span
class="header-section-number">3.3.2</span> Table de Vérité NAND</h3>
<p>La porte NAND prend deux entrées (A et B) et produit une sortie. Son
comportement :</p>
<table>
<thead>
<tr class="header">
<th>A</th>
<th>B</th>
<th style="text-align: center;">NAND(A, B)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0</td>
<td style="text-align: center;"><strong>1</strong></td>
</tr>
<tr class="even">
<td>0</td>
<td>1</td>
<td style="text-align: center;"><strong>1</strong></td>
</tr>
<tr class="odd">
<td>1</td>
<td>0</td>
<td style="text-align: center;"><strong>1</strong></td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td style="text-align: center;"><strong>0</strong></td>
</tr>
</tbody>
</table>
<p><strong>Règle simple</strong> : Le résultat est <code>0</code>
<em>seulement si</em> A <strong>et</strong> B sont tous les deux à
<code>1</code>. Dans tous les autres cas, c’est <code>1</code>.</p>
<p>Le nom “NAND” vient de “Not-AND” : c’est l’inverse exact d’une porte
AND.</p>
<h3 data-number="3.3.3" id="symbole-graphique"><span
class="header-section-number">3.3.3</span> Symbole graphique</h3>
<figure>
<img src="images/nand.svg" alt="Porte NAND" />
<figcaption aria-hidden="true">Porte NAND</figcaption>
</figure>
<p><em>Le petit cercle (○) indique l’inversion</em></p>
<hr />
<h2 data-number="3.4" id="construction-des-portes-élémentaires"><span
class="header-section-number">3.4</span> Construction des Portes
Élémentaires</h2>
<p>Votre mission dans ce chapitre est de construire les portes
suivantes, en utilisant <strong>uniquement</strong> des NAND (et les
portes que vous aurez déjà créées).</p>
<h3 data-number="3.4.1"
id="a.-not-inverseur-linversion-de-la-réalité"><span
class="header-section-number">3.4.1</span> A. NOT (Inverseur) —
L’inversion de la réalité</h3>
<p><strong>Rôle dans l’ordinateur</strong> : L’inverseur est
fondamental. Il permet de créer des conditions négatives (“si PAS
égal…”), de complémenter des nombres (pour la soustraction), et
d’implémenter des bascules (pour la mémoire).</p>
<p><strong>Spécification</strong> :</p>
<table>
<thead>
<tr class="header">
<th>in</th>
<th>out</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
<p><strong>Le défi</strong> : Comment utiliser une porte NAND (qui prend
2 entrées) pour n’en traiter qu’une seule ?</p>
<p><strong>L’astuce</strong> : Connectez le même signal aux deux entrées
!</p>
<figure>
<img src="images/not-from-nand.svg"
alt="NOT construit à partir de NAND" />
<figcaption aria-hidden="true">NOT construit à partir de
NAND</figcaption>
</figure>
<p>Vérifions avec la table de vérité :</p>
<ul>
<li>Si <code>in = 0</code> : NAND(0, 0) = 1 OK</li>
<li>Si <code>in = 1</code> : NAND(1, 1) = 0 OK</li>
</ul>
<p>C’est exactement le comportement NOT !</p>
<hr />
<h3 data-number="3.4.2" id="b.-and-et-la-conjonction"><span
class="header-section-number">3.4.2</span> B. AND (Et) — La
conjonction</h3>
<p><strong>Rôle dans l’ordinateur</strong> : La porte AND est
essentielle pour : - Extraire des bits spécifiques d’un nombre
(masquage) - Vérifier que TOUTES les conditions sont vraies - Contrôler
le passage de données (avec un signal d’activation)</p>
<p><strong>Spécification</strong> :</p>
<table>
<thead>
<tr class="header">
<th>A</th>
<th>B</th>
<th style="text-align: center;">AND(A, B)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td>0</td>
<td>1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td>1</td>
<td>0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
<p><strong>La sortie vaut 1 seulement si A ET B valent 1.</strong></p>
<p><strong>L’insight</strong> : Le NAND est un “Not-AND”. Si on inverse
le résultat d’un NAND… on obtient un AND !</p>
<figure>
<img src="images/and-from-nand.svg"
alt="AND construit à partir de NAND et NOT" />
<figcaption aria-hidden="true">AND construit à partir de NAND et
NOT</figcaption>
</figure>
<p>Formule : <code>AND(A, B) = NOT(NAND(A, B))</code></p>
<hr />
<h3 data-number="3.4.3" id="c.-or-ou-lalternative"><span
class="header-section-number">3.4.3</span> C. OR (Ou) —
L’alternative</h3>
<p><strong>Rôle dans l’ordinateur</strong> : La porte OR permet de : -
Combiner plusieurs signaux de contrôle - Vérifier qu’AU MOINS UNE
condition est vraie - Créer des priorités (interruptions, erreurs)</p>
<p><strong>Spécification</strong> :</p>
<table>
<thead>
<tr class="header">
<th>A</th>
<th>B</th>
<th style="text-align: center;">OR(A, B)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td>0</td>
<td>1</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td>1</td>
<td>0</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
<p><strong>La sortie vaut 1 si au moins une entrée vaut 1.</strong></p>
<p><strong>Le Théorème de De Morgan</strong> : Ce théorème fondamental
nous donne la clé :</p>
<pre><code>A OR B = NOT( (NOT A) AND (NOT B) )</code></pre>
<p>En utilisant uniquement des NAND :</p>
<pre><code>A OR B = (NOT A) NAND (NOT B)</code></pre>
<figure>
<img src="images/or-from-nand.svg"
alt="OR construit à partir de NOT et NAND" />
<figcaption aria-hidden="true">OR construit à partir de NOT et
NAND</figcaption>
</figure>
<hr />
<h3 data-number="3.4.4" id="d.-xor-ou-exclusif-la-différence"><span
class="header-section-number">3.4.4</span> D. XOR (Ou Exclusif) — La
différence</h3>
<p><strong>Rôle dans l’ordinateur</strong> : XOR est crucial pour : -
<strong>L’addition binaire</strong> : XOR calcule la somme de deux bits
(sans la retenue) - <strong>La comparaison</strong> : XOR détecte si
deux bits sont différents - <strong>Le cryptage</strong> : XOR est au
cœur de nombreux algorithmes de chiffrement - <strong>La détection
d’erreurs</strong> : Calcul de parité</p>
<p><strong>Spécification</strong> :</p>
<table>
<thead>
<tr class="header">
<th>A</th>
<th>B</th>
<th style="text-align: center;">XOR(A, B)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td>0</td>
<td>1</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td>1</td>
<td>0</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<p><strong>La sortie vaut 1 si les entrées sont
<em>différentes</em>.</strong></p>
<p><strong>Formule algébrique</strong> :</p>
<pre><code>XOR(A, B) = (A AND NOT B) OR (NOT A AND B)</code></pre>
<p>En mots : “A est vrai et B est faux” OU “A est faux et B est
vrai”.</p>
<hr />
<h3 data-number="3.4.5" id="e.-multiplexeur-mux-laiguilleur"><span
class="header-section-number">3.4.5</span> E. Multiplexeur (Mux) —
L’aiguilleur</h3>
<p><strong>Rôle dans l’ordinateur</strong> : Le multiplexeur est l’un
des composants les plus importants ! Il permet de :</p>
<ul>
<li><strong>Choisir entre plusieurs sources de données</strong> : Comme
un aiguillage de train</li>
<li><strong>Implémenter les conditions</strong> :
<code>if (sel) then b else a</code></li>
<li><strong>Construire la mémoire</strong> : Sélectionner quelle cellule
lire</li>
</ul>
<p><strong>Spécification</strong> :</p>
<ul>
<li>Si <code>sel == 0</code> alors <code>out = a</code></li>
<li>Si <code>sel == 1</code> alors <code>out = b</code></li>
</ul>
<figure>
<img src="images/mux.svg" alt="Multiplexeur" />
<figcaption aria-hidden="true">Multiplexeur</figcaption>
</figure>
<p><strong>L’insight</strong> : On peut voir le Mux comme : “soit (a ET
non-sel) soit (b ET sel)”.</p>
<pre><code>out = (a AND NOT sel) OR (b AND sel)</code></pre>
<p><strong>Pourquoi le Mux est-il si important ?</strong></p>
<p>Imaginez que vous construisez un CPU. À chaque cycle, le CPU doit
choisir :</p>
<ul>
<li>D’où vient l’opérande ? De la mémoire ou d’un registre ?</li>
<li>Où va le résultat ? Vers la mémoire ou un registre ?</li>
<li>Quelle instruction exécuter ?</li>
</ul>
<p>Chacun de ces choix est implémenté par un multiplexeur !</p>
<hr />
<h3 data-number="3.4.6"
id="f.-démultiplexeur-dmux-linverse-de-laiguilleur"><span
class="header-section-number">3.4.6</span> F. Démultiplexeur (DMux) —
L’inverse de l’aiguilleur</h3>
<p><strong>Rôle dans l’ordinateur</strong> : Le DMux fait l’inverse du
Mux — il prend UNE entrée et la dirige vers UNE des sorties possibles.
Utile pour :</p>
<ul>
<li><strong>L’adressage mémoire</strong> : Activer la bonne cellule</li>
<li><strong>La distribution de signaux</strong> : Envoyer une commande
au bon périphérique</li>
</ul>
<p><strong>Spécification</strong> :</p>
<ul>
<li>Si <code>sel == 0</code> alors <code>a = in, b = 0</code></li>
<li>Si <code>sel == 1</code> alors <code>a = 0, b = in</code></li>
</ul>
<figure>
<img src="images/dmux.svg" alt="Démultiplexeur" />
<figcaption aria-hidden="true">Démultiplexeur</figcaption>
</figure>
<hr />
<h2 data-number="3.5" id="le-lien-avec-lordinateur-complet"><span
class="header-section-number">3.5</span> Le Lien avec l’Ordinateur
Complet</h2>
<p>Prenons du recul. Pourquoi construisons-nous ces portes ?</p>
<h3 data-number="3.5.1" id="du-nand-au-cpu-la-feuille-de-route"><span
class="header-section-number">3.5.1</span> Du NAND au CPU : La feuille
de route</h3>
<pre><code>CHAPITRE 1 (Ici)     CHAPITRE 2          CHAPITRE 3         CHAPITRE 5
     ↓                    ↓                   ↓                  ↓
   NAND             Half Adder            DFF (Flip-Flop)       CPU
     ↓                    ↓                   ↓                  ↓
NOT, AND, OR  →    Full Adder      →    Registres      →    Ordinateur
XOR, Mux, DMux          ↓                   ↓                complet !
                      ALU              RAM (Mémoire)</code></pre>
<p><strong>Chaque porte a un rôle précis</strong> :</p>
<ul>
<li><strong>NOT</strong> : Permet la soustraction (via le complément à
2)</li>
<li><strong>AND</strong> : Masquage de bits, conditions ET</li>
<li><strong>OR</strong> : Combinaison de signaux, conditions OU</li>
<li><strong>XOR</strong> : Addition bit à bit, comparaisons</li>
<li><strong>Mux</strong> : Tous les choix du CPU (quelle donnée ? quelle
opération ?)</li>
<li><strong>DMux</strong> : Adressage mémoire, routage des
résultats</li>
</ul>
<p>Quand vous jouerez à un jeu sur votre ordinateur Codex au Chapitre 9,
chaque pixel affiché à l’écran aura été calculé par des millions
d’opérations utilisant ces portes élémentaires !</p>
<hr />
<h2 data-number="3.6" id="description-matérielle-codex-hdl"><span
class="header-section-number">3.6</span> Description Matérielle (Codex
HDL)</h2>
<p>Pour décrire nos circuits, nous utilisons un langage appelé
<strong>HDL</strong> (Hardware Description Language). C’est un langage
<strong>déclaratif</strong> : on décrit QUELS composants existent et
COMMENT ils sont connectés, pas DANS QUEL ORDRE les exécuter.</p>
<h3 data-number="3.6.1" id="pourquoi-un-langage-de-description"><span
class="header-section-number">3.6.1</span> Pourquoi un langage de
description ?</h3>
<p>En électronique réelle, on dessine des schémas. Mais les schémas
deviennent illisibles pour des circuits complexes (un CPU contient des
millions de portes !). Le HDL permet de :</p>
<ol type="1">
<li><strong>Décrire</strong> des circuits de manière textuelle</li>
<li><strong>Simuler</strong> leur comportement avant fabrication</li>
<li><strong>Synthétiser</strong> le circuit vers du matériel réel</li>
</ol>
<p>Notre HDL est inspiré du <strong>VHDL</strong> (Very High-Speed
Integrated Circuit HDL), utilisé dans l’industrie.</p>
<h3 data-number="3.6.2" id="structure-dun-fichier-.hdl"><span
class="header-section-number">3.6.2</span> Structure d’un fichier
<code>.hdl</code></h3>
<p>Un fichier HDL se compose de deux parties :</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- ============================================================</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- 1. L&#39;ENTITÉ : L&#39;interface externe (les &quot;broches&quot; de la puce)</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">-- ============================================================</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="cf">entity</span> <span class="dv">NomDeLaPuce</span> <span class="kw">is</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">port</span>(</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>;     <span class="co">-- Entrée de 1 bit</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>;     <span class="co">-- Autre entrée</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">:</span> <span class="kw">out</span> <span class="dt">bit</span>     <span class="co">-- Sortie (pas de point-virgule sur la dernière)</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  );</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="cf">end entity;</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">-- ============================================================</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">-- 2. L&#39;ARCHITECTURE : Le contenu interne (le câblage)</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">-- ============================================================</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="cf">architecture</span> <span class="dv">rtl</span> <span class="kw">of</span> <span class="fu">NomDeLaPuce</span> <span class="kw">is</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Déclaration des composants utilisés</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">component</span> <span class="dv">Nand</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">port</span>(a <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>; b <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>; y <span class="ot">:</span> <span class="kw">out</span> <span class="dt">bit</span>);</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end component;</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Déclaration des signaux internes (fils)</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="ot">signal</span> fil_interne <span class="ot">:</span> <span class="dt">bit</span>;</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="cf">begin</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Instanciation et connexion des composants</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u1</span><span class="ot">:</span> <span class="kw">Nand</span> <span class="kw">port</span> <span class="kw">map</span> (a <span class="ot">=&gt;</span> a<span class="ot">,</span> b <span class="ot">=&gt;</span> b<span class="ot">,</span> y <span class="ot">=&gt;</span> fil_interne);</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Assignation directe (optionnel)</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;=</span> fil_interne;</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="cf">end architecture;</span></span></code></pre></div>
<h3 data-number="3.6.3" id="vocabulaire-essentiel"><span
class="header-section-number">3.6.3</span> Vocabulaire essentiel</h3>
<table>
<thead>
<tr class="header">
<th>Terme</th>
<th>Signification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>entity</code></td>
<td>L’interface externe — quelles sont les entrées/sorties</td>
</tr>
<tr class="even">
<td><code>architecture</code></td>
<td>Le contenu — comment c’est câblé à l’intérieur</td>
</tr>
<tr class="odd">
<td><code>component</code></td>
<td>Une puce qu’on veut utiliser (il faut la déclarer)</td>
</tr>
<tr class="even">
<td><code>signal</code></td>
<td>Un fil interne (pour connecter des composants entre eux)</td>
</tr>
<tr class="odd">
<td><code>port map</code></td>
<td>“Brancher” les fils aux broches d’un composant</td>
</tr>
<tr class="even">
<td><code>=&gt;</code></td>
<td>“est connecté à” (broche =&gt; signal)</td>
</tr>
<tr class="odd">
<td><code>&lt;=</code></td>
<td>Assignation (sortie &lt;= signal)</td>
</tr>
</tbody>
</table>
<h3 data-number="3.6.4" id="règles-de-connexion"><span
class="header-section-number">3.6.4</span> Règles de connexion</h3>
<ol type="1">
<li><strong>À gauche du <code>=&gt;</code></strong> : Le nom de la
broche du composant que vous utilisez</li>
<li><strong>À droite du <code>=&gt;</code></strong> : Le signal de VOTRE
architecture que vous y connectez</li>
<li><strong>Les signaux doivent être déclarés</strong> avant le
<code>begin</code></li>
<li><strong>Chaque instance a un nom unique</strong> (<code>u1</code>,
<code>u2</code>, etc.)</li>
</ol>
<h3 data-number="3.6.5" id="bus-vecteurs-de-bits"><span
class="header-section-number">3.6.5</span> Bus (Vecteurs de bits)</h3>
<p>Pour manipuler plusieurs bits simultanément (ex: un nombre de 32
bits), on utilise <code>bits(MSB downto LSB)</code> :</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- Un bus de 32 bits</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>data_bus <span class="ot">:</span> <span class="kw">in</span> bits(<span class="dv">31</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">-- Accéder à un bit spécifique</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>data_bus(<span class="dv">0</span>)   <span class="co">-- Le bit de poids faible (LSB)</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>data_bus(<span class="dv">31</span>)  <span class="co">-- Le bit de poids fort (MSB)</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">-- Extraire une tranche</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>data_bus(<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>)  <span class="co">-- Les 8 bits de poids faible</span></span></code></pre></div>
<h3 data-number="3.6.6" id="exemple-complet-xor-en-hdl"><span
class="header-section-number">3.6.6</span> Exemple complet : XOR en
HDL</h3>
<div class="sourceCode" id="cb9"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- La porte XOR : sortie = 1 si les entrées sont différentes</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- XOR(a,b) = (a AND NOT b) OR (NOT a AND b)</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="cf">entity</span> <span class="dv">Xor2</span> <span class="kw">is</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">port</span>(</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>;</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>;</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">:</span> <span class="kw">out</span> <span class="dt">bit</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  );</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="cf">end entity;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="cf">architecture</span> <span class="dv">rtl</span> <span class="kw">of</span> <span class="fu">Xor2</span> <span class="kw">is</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Composants utilisés</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">component</span> <span class="dv">Inv</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">port</span>(a <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>; y <span class="ot">:</span> <span class="kw">out</span> <span class="dt">bit</span>);</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end component;</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">component</span> <span class="dv">And2</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">port</span>(a <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>; b <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>; y <span class="ot">:</span> <span class="kw">out</span> <span class="dt">bit</span>);</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end component;</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">component</span> <span class="dv">Or2</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">port</span>(a <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>; b <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>; y <span class="ot">:</span> <span class="kw">out</span> <span class="dt">bit</span>);</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end component;</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Signaux internes</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="ot">signal</span> not_a<span class="ot">,</span> not_b <span class="ot">:</span> <span class="dt">bit</span>;  <span class="co">-- Les inversions de a et b</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  <span class="ot">signal</span> w1<span class="ot">,</span> w2 <span class="ot">:</span> <span class="dt">bit</span>;        <span class="co">-- Résultats intermédiaires</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="cf">begin</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- NOT a et NOT b</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u_nota</span><span class="ot">:</span> <span class="fu">Inv</span> <span class="kw">port map </span>(a <span class="ot">=&gt;</span> a<span class="ot">,</span> y <span class="ot">=&gt;</span> not_a);</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u_notb</span><span class="ot">:</span> <span class="fu">Inv</span> <span class="kw">port map </span>(a <span class="ot">=&gt;</span> b<span class="ot">,</span> y <span class="ot">=&gt;</span> not_b);</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- (a AND NOT b)</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u_and1</span><span class="ot">:</span> <span class="fu">And2</span> <span class="kw">port map </span>(a <span class="ot">=&gt;</span> a<span class="ot">,</span> b <span class="ot">=&gt;</span> not_b<span class="ot">,</span> y <span class="ot">=&gt;</span> w1);</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- (NOT a AND b)</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u_and2</span><span class="ot">:</span> <span class="fu">And2</span> <span class="kw">port map </span>(a <span class="ot">=&gt;</span> not_a<span class="ot">,</span> b <span class="ot">=&gt;</span> b<span class="ot">,</span> y <span class="ot">=&gt;</span> w2);</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Résultat final : OR des deux termes</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u_or</span><span class="ot">:</span> <span class="fu">Or2</span> <span class="kw">port map </span>(a <span class="ot">=&gt;</span> w1<span class="ot">,</span> b <span class="ot">=&gt;</span> w2<span class="ot">,</span> y <span class="ot">=&gt;</span> y);</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="cf">end architecture;</span></span></code></pre></div>
<hr />
<h2 data-number="3.7" id="portes-multi-entrées-et-multi-bits"><span
class="header-section-number">3.7</span> Portes Multi-Entrées et
Multi-Bits</h2>
<p>Jusqu’ici, nous avons construit des portes à <strong>2
entrées</strong> (And2, Or2, Xor2). Mais en pratique, nous avons souvent
besoin de : - <strong>Portes à N entrées</strong> : Or8Way, And4Way -
<strong>Portes sur N bits</strong> : And16, Or32</p>
<h3 data-number="3.7.1" id="généralisation-à-n-entrées"><span
class="header-section-number">3.7.1</span> Généralisation à N
Entrées</h3>
<h4 data-number="3.7.1.1" id="or8way-ou-sur-8-bits"><span
class="header-section-number">3.7.1.1</span> Or8Way : OU sur 8 bits</h4>
<p>Imaginons qu’on veuille savoir si <strong>au moins un bit</strong>
parmi 8 est à 1. C’est un OR à 8 entrées :</p>
<pre><code>Or8Way(a[0..7]) = a[0] OR a[1] OR a[2] OR ... OR a[7]</code></pre>
<p><strong>Construction hiérarchique</strong> (en arbre) :</p>
<pre><code>Niveau 1 :  Or2(a[0], a[1]) → t0    Or2(a[2], a[3]) → t1
            Or2(a[4], a[5]) → t2    Or2(a[6], a[7]) → t3

Niveau 2 :  Or2(t0, t1) → t4        Or2(t2, t3) → t5

Niveau 3 :  Or2(t4, t5) → sortie</code></pre>
<p><strong>Avantage</strong> : Seulement 3 niveaux de profondeur
(log₂(8) = 3), au lieu de 7 en série.</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">entity</span> <span class="dv">Or8Way</span> <span class="kw">is</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">port</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">:</span> <span class="kw">in</span> bits(<span class="dv">7</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">:</span> <span class="kw">out</span> <span class="dt">bit</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  );</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="cf">end entity;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="cf">architecture</span> <span class="dv">rtl</span> <span class="kw">of</span> <span class="fu">Or8Way</span> <span class="kw">is</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">component</span> <span class="dv">Or2</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">port</span>(a <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>; b <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>; y <span class="ot">:</span> <span class="kw">out</span> <span class="dt">bit</span>);</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end component;</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  <span class="ot">signal</span> t0<span class="ot">,</span> t1<span class="ot">,</span> t2<span class="ot">,</span> t3<span class="ot">,</span> t4<span class="ot">,</span> t5 <span class="ot">:</span> <span class="dt">bit</span>;</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="cf">begin</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Niveau 1 : paires</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u0</span><span class="ot">:</span> <span class="fu">Or2</span> <span class="kw">port map </span>(a <span class="ot">=&gt;</span> a(<span class="dv">0</span>)<span class="ot">,</span> b <span class="ot">=&gt;</span> a(<span class="dv">1</span>)<span class="ot">,</span> y <span class="ot">=&gt;</span> t0);</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u1</span><span class="ot">:</span> <span class="fu">Or2</span> <span class="kw">port map </span>(a <span class="ot">=&gt;</span> a(<span class="dv">2</span>)<span class="ot">,</span> b <span class="ot">=&gt;</span> a(<span class="dv">3</span>)<span class="ot">,</span> y <span class="ot">=&gt;</span> t1);</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u2</span><span class="ot">:</span> <span class="fu">Or2</span> <span class="kw">port map </span>(a <span class="ot">=&gt;</span> a(<span class="dv">4</span>)<span class="ot">,</span> b <span class="ot">=&gt;</span> a(<span class="dv">5</span>)<span class="ot">,</span> y <span class="ot">=&gt;</span> t2);</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u3</span><span class="ot">:</span> <span class="fu">Or2</span> <span class="kw">port map </span>(a <span class="ot">=&gt;</span> a(<span class="dv">6</span>)<span class="ot">,</span> b <span class="ot">=&gt;</span> a(<span class="dv">7</span>)<span class="ot">,</span> y <span class="ot">=&gt;</span> t3);</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Niveau 2</span></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u4</span><span class="ot">:</span> <span class="fu">Or2</span> <span class="kw">port map </span>(a <span class="ot">=&gt;</span> t0<span class="ot">,</span> b <span class="ot">=&gt;</span> t1<span class="ot">,</span> y <span class="ot">=&gt;</span> t4);</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u5</span><span class="ot">:</span> <span class="fu">Or2</span> <span class="kw">port map </span>(a <span class="ot">=&gt;</span> t2<span class="ot">,</span> b <span class="ot">=&gt;</span> t3<span class="ot">,</span> y <span class="ot">=&gt;</span> t5);</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Niveau 3</span></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u6</span><span class="ot">:</span> <span class="fu">Or2</span> <span class="kw">port map </span>(a <span class="ot">=&gt;</span> t4<span class="ot">,</span> b <span class="ot">=&gt;</span> t5<span class="ot">,</span> y <span class="ot">=&gt;</span> y);</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="cf">end architecture;</span></span></code></pre></div>
<h3 data-number="3.7.2" id="multiplexeurs-multi-entrées"><span
class="header-section-number">3.7.2</span> Multiplexeurs
Multi-Entrées</h3>
<h4 data-number="3.7.2.1" id="mux4way-choisir-parmi-4-entrées"><span
class="header-section-number">3.7.2.1</span> Mux4Way : Choisir parmi 4
entrées</h4>
<p>Avec 2 bits de sélection, on peut choisir parmi 4 entrées :</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">sel[1]</th>
<th style="text-align: center;">sel[0]</th>
<th style="text-align: center;">Sortie</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">a</td>
</tr>
<tr class="even">
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">b</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">c</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">d</td>
</tr>
</tbody>
</table>
<p><strong>Construction avec des Mux 2:1</strong> :</p>
<pre><code>        sel[0]
          │
    ┌─────┼─────┐
    │     │     │
  ┌─▼─┐ ┌─▼─┐   │
a─┤Mux├─┤   │   │
b─┤   │ │Mux├───┼──► sortie
  └───┘ │   │   │
  ┌───┐ └─▲─┘   │
c─┤Mux├───┘     │
d─┤   │         │
  └─▲─┘         │
    │           │
  sel[1]────────┘</code></pre>
<div class="sourceCode" id="cb14"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="cf">entity</span> <span class="dv">Mux4Way</span> <span class="kw">is</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">port</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    a<span class="ot">,</span> b<span class="ot">,</span> c<span class="ot">,</span> d <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>;</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    sel <span class="ot">:</span> <span class="kw">in</span> bits(<span class="dv">1</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">:</span> <span class="kw">out</span> <span class="dt">bit</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  );</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="cf">end entity;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="cf">architecture</span> <span class="dv">rtl</span> <span class="kw">of</span> <span class="fu">Mux4Way</span> <span class="kw">is</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">component</span> <span class="dv">Mux</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">port</span>(a <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>; b <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>; sel <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>; y <span class="ot">:</span> <span class="kw">out</span> <span class="dt">bit</span>);</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end component;</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="ot">signal</span> ab<span class="ot">,</span> cd <span class="ot">:</span> <span class="dt">bit</span>;</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="cf">begin</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Niveau 1 : sélection par sel[0]</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u_ab</span><span class="ot">:</span> <span class="fu">Mux</span> <span class="kw">port map </span>(a <span class="ot">=&gt;</span> a<span class="ot">,</span> b <span class="ot">=&gt;</span> b<span class="ot">,</span> sel <span class="ot">=&gt;</span> sel(<span class="dv">0</span>)<span class="ot">,</span> y <span class="ot">=&gt;</span> ab);</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u_cd</span><span class="ot">:</span> <span class="fu">Mux</span> <span class="kw">port map </span>(a <span class="ot">=&gt;</span> c<span class="ot">,</span> b <span class="ot">=&gt;</span> d<span class="ot">,</span> sel <span class="ot">=&gt;</span> sel(<span class="dv">0</span>)<span class="ot">,</span> y <span class="ot">=&gt;</span> cd);</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Niveau 2 : sélection par sel[1]</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u_out</span><span class="ot">:</span> <span class="fu">Mux</span> <span class="kw">port map </span>(a <span class="ot">=&gt;</span> ab<span class="ot">,</span> b <span class="ot">=&gt;</span> cd<span class="ot">,</span> sel <span class="ot">=&gt;</span> sel(<span class="dv">1</span>)<span class="ot">,</span> y <span class="ot">=&gt;</span> y);</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="cf">end architecture;</span></span></code></pre></div>
<h4 data-number="3.7.2.2"
id="mux8way-8-entrées-3-bits-de-sélection"><span
class="header-section-number">3.7.2.2</span> Mux8Way : 8 entrées, 3 bits
de sélection</h4>
<p>Le même principe s’étend : 2 Mux4Way + 1 Mux donne un Mux8Way.</p>
<h3 data-number="3.7.3" id="démultiplexeurs-multi-sorties"><span
class="header-section-number">3.7.3</span> Démultiplexeurs
Multi-Sorties</h3>
<h4 data-number="3.7.3.1" id="dmux4way-router-vers-4-destinations"><span
class="header-section-number">3.7.3.1</span> DMux4Way : Router vers 4
destinations</h4>
<p>L’inverse du Mux : une entrée, 4 sorties possibles.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">sel[1]</th>
<th style="text-align: center;">sel[0]</th>
<th style="text-align: center;">a</th>
<th style="text-align: center;">b</th>
<th style="text-align: center;">c</th>
<th style="text-align: center;">d</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">in</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">in</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">in</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">in</td>
</tr>
</tbody>
</table>
<p><strong>Construction</strong> :</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="cf">entity</span> <span class="dv">DMux4Way</span> <span class="kw">is</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">port</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    input <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>;</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    sel <span class="ot">:</span> <span class="kw">in</span> bits(<span class="dv">1</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    a<span class="ot">,</span> b<span class="ot">,</span> c<span class="ot">,</span> d <span class="ot">:</span> <span class="kw">out</span> <span class="dt">bit</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  );</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="cf">end entity;</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="cf">architecture</span> <span class="dv">rtl</span> <span class="kw">of</span> <span class="fu">DMux4Way</span> <span class="kw">is</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">component</span> <span class="dv">DMux</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">port</span>(input <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>; sel <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>; a <span class="ot">:</span> <span class="kw">out</span> <span class="dt">bit</span>; b <span class="ot">:</span> <span class="kw">out</span> <span class="dt">bit</span>);</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end component;</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="ot">signal</span> top<span class="ot">,</span> bottom <span class="ot">:</span> <span class="dt">bit</span>;</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="cf">begin</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Niveau 1 : sel[1] divise en haut/bas</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u_split</span><span class="ot">:</span> <span class="fu">DMux</span> <span class="kw">port map </span>(input <span class="ot">=&gt;</span> input<span class="ot">,</span> sel <span class="ot">=&gt;</span> sel(<span class="dv">1</span>)<span class="ot">,</span> a <span class="ot">=&gt;</span> top<span class="ot">,</span> b <span class="ot">=&gt;</span> bottom);</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Niveau 2 : sel[0] divise chaque moitié</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u_top</span><span class="ot">:</span> <span class="fu">DMux</span> <span class="kw">port map </span>(input <span class="ot">=&gt;</span> top<span class="ot">,</span> sel <span class="ot">=&gt;</span> sel(<span class="dv">0</span>)<span class="ot">,</span> a <span class="ot">=&gt;</span> a<span class="ot">,</span> b <span class="ot">=&gt;</span> b);</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u_bot</span><span class="ot">:</span> <span class="fu">DMux</span> <span class="kw">port map </span>(input <span class="ot">=&gt;</span> bottom<span class="ot">,</span> sel <span class="ot">=&gt;</span> sel(<span class="dv">0</span>)<span class="ot">,</span> a <span class="ot">=&gt;</span> c<span class="ot">,</span> b <span class="ot">=&gt;</span> d);</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="cf">end architecture;</span></span></code></pre></div>
<h3 data-number="3.7.4" id="portes-sur-n-bits-bus"><span
class="header-section-number">3.7.4</span> Portes sur N Bits (Bus)</h3>
<p>Pour traiter des mots de 16 ou 32 bits, on réplique la porte bit par
bit :</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- And32 : ET bit-à-bit sur 32 bits</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="cf">entity</span> <span class="dv">And32</span> <span class="kw">is</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">port</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    a <span class="ot">:</span> <span class="kw">in</span> bits(<span class="dv">31</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    b <span class="ot">:</span> <span class="kw">in</span> bits(<span class="dv">31</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">:</span> <span class="kw">out</span> bits(<span class="dv">31</span> <span class="ot">downto</span> <span class="dv">0</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  );</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="cf">end entity;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="cf">architecture</span> <span class="dv">rtl</span> <span class="kw">of</span> <span class="fu">And32</span> <span class="kw">is</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">component</span> <span class="dv">And2</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">port</span>(a <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>; b <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>; y <span class="ot">:</span> <span class="kw">out</span> <span class="dt">bit</span>);</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end component;</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="cf">begin</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Instancier 32 portes AND en parallèle</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="dv">gen</span><span class="ot">:</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="dv">0</span> <span class="ot">to</span> <span class="dv">31</span> <span class="cf">generate</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="dv">u</span><span class="ot">:</span> <span class="fu">And2</span> <span class="kw">port map </span>(a <span class="ot">=&gt;</span> a(i)<span class="ot">,</span> b <span class="ot">=&gt;</span> b(i)<span class="ot">,</span> y <span class="ot">=&gt;</span> y(i));</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end generate;</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="cf">end architecture;</span></span></code></pre></div>
<p><strong>Note</strong> : La construction <code>for ... generate</code>
crée automatiquement 32 instances. C’est équivalent à écrire 32 lignes
<code>port map</code>.</p>
<h3 data-number="3.7.5" id="pourquoi-cest-important"><span
class="header-section-number">3.7.5</span> Pourquoi c’est Important
?</h3>
<p>Ces portes multi-entrées sont essentielles pour :</p>
<table>
<thead>
<tr class="header">
<th>Composant</th>
<th>Utilisation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Or8Way</strong></td>
<td>Tester si un registre est non-nul (flag Z de l’ALU)</td>
</tr>
<tr class="even">
<td><strong>Mux4Way/8Way</strong></td>
<td>Sélectionner un registre parmi 4, 8, ou 16</td>
</tr>
<tr class="odd">
<td><strong>DMux4Way/8Way</strong></td>
<td>Router un signal <code>load</code> vers le bon registre</td>
</tr>
<tr class="even">
<td><strong>And32, Or32</strong></td>
<td>Opérations bit-à-bit de l’ALU</td>
</tr>
<tr class="odd">
<td><strong>Mux32</strong></td>
<td>Choisir entre deux bus 32 bits</td>
</tr>
</tbody>
</table>
<p>Au chapitre 3 (Mémoire), vous utiliserez DMux8Way pour adresser 8
registres. Au chapitre 5 (CPU), Mux16Way sélectionnera parmi 16
registres.</p>
<hr />
<h2 data-number="3.8" id="exercices-pratiques"><span
class="header-section-number">3.8</span> Exercices Pratiques</h2>
<h3 data-number="3.8.1" id="exercices-sur-le-simulateur-web"><span
class="header-section-number">3.8.1</span> Exercices sur le Simulateur
Web</h3>
<p>Le <strong>Simulateur Web</strong> vous permet de construire et
tester vos portes de manière interactive. Lancez-le et allez dans la
section <strong>HDL Progression</strong>.</p>
<table>
<thead>
<tr class="header">
<th>Exercice</th>
<th>Description</th>
<th style="text-align: center;">Difficulté</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Inv</code></td>
<td>Inverseur (NOT) — Votre première porte</td>
<td style="text-align: center;">[*]</td>
</tr>
<tr class="even">
<td><code>And2</code></td>
<td>Porte AND à 2 entrées</td>
<td style="text-align: center;">[*]</td>
</tr>
<tr class="odd">
<td><code>Or2</code></td>
<td>Porte OR à 2 entrées</td>
<td style="text-align: center;">[*]</td>
</tr>
<tr class="even">
<td><code>Xor2</code></td>
<td>Porte XOR (Ou exclusif)</td>
<td style="text-align: center;">[**]</td>
</tr>
<tr class="odd">
<td><code>Mux</code></td>
<td>Multiplexeur 2 vers 1</td>
<td style="text-align: center;">[**]</td>
</tr>
<tr class="even">
<td><code>DMux</code></td>
<td>Démultiplexeur 1 vers 2</td>
<td style="text-align: center;">[**]</td>
</tr>
</tbody>
</table>
<p><strong>Pour chaque exercice</strong> :</p>
<ol type="1">
<li>Lisez la spécification et la table de vérité</li>
<li>Réfléchissez à comment combiner les portes disponibles</li>
<li>Écrivez votre code HDL</li>
<li>Testez — le simulateur vous montrera un chronogramme des
signaux</li>
<li>Si un test échoue, analysez quelle entrée produit le mauvais
résultat</li>
</ol>
<h3 data-number="3.8.2" id="comment-lancer-le-simulateur-web"><span
class="header-section-number">3.8.2</span> Comment lancer le simulateur
web ?</h3>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> web</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install    <span class="co"># (première fois uniquement)</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run dev</span></code></pre></div>
<p>Puis ouvrez votre navigateur à l’adresse indiquée (généralement
<code>http://localhost:5173</code>).</p>
<h3 data-number="3.8.3"
id="alternative-tests-en-ligne-de-commande"><span
class="header-section-number">3.8.3</span> Alternative : Tests en ligne
de commande</h3>
<p>Si vous préférez travailler dans les fichiers du répertoire
<code>hdl_lib/01_gates/</code> :</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester une porte spécifique</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> run <span class="at">-p</span> hdl_cli <span class="at">--</span> test hdl_lib/01_gates/Not.hdl</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester toutes les portes du projet 1</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> run <span class="at">-p</span> hdl_cli <span class="at">--</span> test hdl_lib/01_gates/</span></code></pre></div>
<hr />
<h2 data-number="3.9" id="défis-supplémentaires"><span
class="header-section-number">3.9</span> Défis Supplémentaires</h2>
<h3 data-number="3.9.1" id="défi-1-minimiser-le-nombre-de-nand"><span
class="header-section-number">3.9.1</span> Défi 1 : Minimiser le nombre
de NAND</h3>
<p>Construisez la porte XOR en utilisant <strong>seulement 4 portes
NAND</strong> (c’est le minimum théorique !). La solution classique en
utilise 5.</p>
<h3 data-number="3.9.2" id="défi-2-implémenter-implies"><span
class="header-section-number">3.9.2</span> Défi 2 : Implémenter
IMPLIES</h3>
<p>La fonction “implication” (<code>A → B</code>) vaut FAUX seulement si
A est VRAI et B est FAUX.</p>
<table>
<thead>
<tr class="header">
<th>A</th>
<th>B</th>
<th style="text-align: center;">A → B</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td>0</td>
<td>1</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td>1</td>
<td>0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
<p>Construisez cette porte en utilisant les portes élémentaires.</p>
<h3 data-number="3.9.3" id="défi-3-mux-à-4-entrées"><span
class="header-section-number">3.9.3</span> Défi 3 : Mux à 4 entrées</h3>
<p>Construisez un Mux qui choisit parmi 4 entrées (<code>a</code>,
<code>b</code>, <code>c</code>, <code>d</code>) avec 2 bits de sélection
(<code>sel[1:0]</code>).</p>
<hr />
<h2 data-number="3.10" id="ce-quil-faut-retenir"><span
class="header-section-number">3.10</span> Ce qu’il faut retenir</h2>
<ol type="1">
<li><strong>Le binaire simplifie</strong> : Deux états sont plus fiables
que dix</li>
<li><strong>NAND est universel</strong> : Toutes les portes peuvent être
construites à partir de NAND</li>
<li><strong>L’abstraction est puissante</strong> : On construit des
couches les unes sur les autres</li>
<li><strong>Chaque porte a un rôle</strong> :
<ul>
<li>NOT → Inversion, complément</li>
<li>AND → Masquage, condition “et”</li>
<li>OR → Combinaison, condition “ou”</li>
<li>XOR → Addition, comparaison</li>
<li>Mux → Choix, sélection</li>
<li>DMux → Routage, adressage</li>
</ul></li>
</ol>
<p><strong>Prochaine étape</strong> : Au Chapitre 2, nous utiliserons
ces portes pour construire des circuits qui font de
l’<strong>arithmétique</strong> — addition, soustraction, et une ALU
(Unité Arithmétique et Logique) complète.</p>
<hr />
<p><strong>Conseil</strong> : Ne passez pas au chapitre suivant avant
d’avoir réussi tous les exercices de ce chapitre. Chaque porte que vous
construisez sera réutilisée dans les chapitres suivants !</p>
<hr />
<h2 data-number="3.11" id="auto-évaluation"><span
class="header-section-number">3.11</span> Auto-évaluation</h2>
<p>Testez votre compréhension avant de passer au chapitre suivant.</p>
<h3 data-number="3.11.1" id="questions-de-compréhension"><span
class="header-section-number">3.11.1</span> Questions de
compréhension</h3>
<p><strong>Q1.</strong> Pourquoi les ordinateurs utilisent-ils le
binaire plutôt que le décimal ?</p>
<p><strong>Q2.</strong> Pourquoi dit-on que NAND est une porte
“universelle” ?</p>
<p><strong>Q3.</strong> Quelle est la sortie de <code>XOR(1, 1)</code> ?
Et de <code>XOR(0, 1)</code> ?</p>
<p><strong>Q4.</strong> Un multiplexeur (MUX) a 2 entrées de données
<code>a</code> et <code>b</code>, et un signal de sélection
<code>sel</code>. Si <code>sel = 1</code>, quelle entrée est transmise
en sortie ?</p>
<p><strong>Q5.</strong> Combien de portes NAND faut-il au minimum pour
construire un inverseur (NOT) ?</p>
<h3 data-number="3.11.2" id="mini-défi-pratique"><span
class="header-section-number">3.11.2</span> Mini-défi pratique</h3>
<p>Complétez cette table de vérité pour la fonction
<code>F(a, b) = AND(OR(a, b), NOT(a))</code> :</p>
<table>
<thead>
<tr class="header">
<th>a</th>
<th>b</th>
<th>OR(a,b)</th>
<th>NOT(a)</th>
<th>F</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
<tr class="even">
<td>0</td>
<td>1</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
<tr class="odd">
<td>1</td>
<td>0</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td>?</td>
<td>?</td>
<td>?</td>
</tr>
</tbody>
</table>
<p><em>Les solutions se trouvent dans le document
<strong>Codex_Solutions</strong>.</em></p>
<h3 data-number="3.11.3" id="checklist-de-validation"><span
class="header-section-number">3.11.3</span> Checklist de validation</h3>
<p>Avant de passer au chapitre 2, assurez-vous de pouvoir :</p>
<ul class="task-list">
<li><label><input type="checkbox" />Expliquer pourquoi NAND est
universel</label></li>
<li><label><input type="checkbox" />Construire NOT, AND, OR à partir de
NAND</label></li>
<li><label><input type="checkbox" />Lire et écrire une table de
vérité</label></li>
<li><label><input type="checkbox" />Comprendre le rôle du MUX
(sélection) et du DMUX (routage)</label></li>
<li><label><input type="checkbox" />Écrire du code HDL simple avec
<code>port map</code></label></li>
</ul>
<h1 data-number="4" id="arithmétique-binaire"><span
class="header-section-number">4</span> Arithmétique Binaire</h1>
<blockquote>
<p>“Les mathématiques sont le langage avec lequel Dieu a écrit
l’univers.” — Galilée</p>
</blockquote>
<p>Dans le chapitre précédent, nous avons appris à manipuler des bits
individuels avec des portes logiques. Mais un ordinateur doit savoir
compter ! Comment passer de simples portes logiques à une calculatrice
capable d’additionner des nombres à 32 bits ?</p>
<hr />
<h2 data-number="4.1" id="où-en-sommes-nous-1"><span
class="header-section-number">4.1</span> Où en sommes-nous ?</h2>
<figure>
<img src="images/architecture-stack.svg"
alt="Position dans l’architecture" />
<figcaption aria-hidden="true">Position dans l’architecture</figcaption>
</figure>
<p><em>Nous sommes à la Couche 1 : Logique Matérielle (Portes logiques -
ALU, RAM, CPU)</em></p>
<p>Nous sommes toujours dans la couche matérielle, mais nous montons
d’un niveau. Nous allons combiner les portes logiques du Chapitre 1 pour
construire des circuits arithmétiques, culminant avec
l’<strong>ALU</strong> (Arithmetic Logic Unit) — le composant qui
effectue TOUS les calculs du processeur.</p>
<hr />
<h2 data-number="4.2"
id="pourquoi-larithmétique-est-elle-si-importante"><span
class="header-section-number">4.2</span> Pourquoi l’Arithmétique
est-elle si Importante ?</h2>
<h3 data-number="4.2.1" id="au-cœur-de-tout-calcul"><span
class="header-section-number">4.2.1</span> Au cœur de tout calcul</h3>
<p>Regardez ce que fait un ordinateur :</p>
<ul>
<li><strong>Afficher une image</strong> : Calculer la couleur de chaque
pixel (additions, multiplications)</li>
<li><strong>Jouer un son</strong> : Mélanger des formes d’onde
(additions)</li>
<li><strong>Naviguer sur le web</strong> : Calculer des checksums,
décompresser des données</li>
<li><strong>Exécuter un programme</strong> : Calculer l’adresse de la
prochaine instruction (addition)</li>
</ul>
<p>Même les opérations les plus “abstraites” se réduisent finalement à
des opérations arithmétiques sur des nombres binaires. L’ALU que vous
allez construire est le moteur qui fait tourner TOUT.</p>
<h3 data-number="4.2.2" id="ce-que-nous-allons-construire"><span
class="header-section-number">4.2.2</span> Ce que nous allons
construire</h3>
<figure>
<img src="images/build-roadmap.svg"
alt="Feuille de route : des portes à l’ALU" />
<figcaption aria-hidden="true">Feuille de route : des portes à
l’ALU</figcaption>
</figure>
<p>À la fin de ce chapitre, vous aurez construit une ALU capable
d’effectuer : - Addition et soustraction - ET, OU, XOR logiques -
Comparaisons (via les drapeaux)</p>
<hr />
<h2 data-number="4.3" id="représentation-des-nombres"><span
class="header-section-number">4.3</span> Représentation des Nombres</h2>
<h3 data-number="4.3.1" id="le-système-binaire-base-2"><span
class="header-section-number">4.3.1</span> Le Système Binaire (Base
2)</h3>
<p>Avant de construire des additionneurs, comprenons comment les nombres
sont représentés.</p>
<p>En décimal (base 10), chaque position représente une puissance de 10
:</p>
<pre><code>  4   2   7
  ↓   ↓   ↓
10² 10¹ 10⁰  →  4×100 + 2×10 + 7×1 = 427</code></pre>
<p>En binaire (base 2), chaque position représente une puissance de 2
:</p>
<pre><code>Position :   3    2    1    0
Poids    :  2³   2²   2¹   2⁰
Valeur   :   8    4    2    1

Exemple : 1011₂ = 1×8 + 0×4 + 1×2 + 1×1 = 11₁₀</code></pre>
<h3 data-number="4.3.2" id="taille-des-nombres-dans-codex"><span
class="header-section-number">4.3.2</span> Taille des nombres dans
Codex</h3>
<p>Notre ordinateur Codex travaille sur <strong>32 bits</strong>. Cela
signifie : - <strong>Plage non-signée</strong> : 0 à 2³² - 1 = 4 294 967
295 (≈ 4 milliards) - <strong>Plage signée</strong> : -2 147 483 648 à 2
147 483 647 (≈ ±2 milliards)</p>
<p>C’est suffisant pour : - Adresser 4 Go de mémoire (chaque octet a une
adresse unique) - Représenter des coordonnées d’écran, des scores de
jeux, des compteurs</p>
<h3 data-number="4.3.3"
id="les-nombres-négatifs-le-complément-à-2"><span
class="header-section-number">4.3.3</span> Les Nombres Négatifs : Le
Complément à 2</h3>
<p>Comment représenter des nombres négatifs avec seulement des 0 et des
1 ?</p>
<p><strong>Le problème</strong> : On pourrait utiliser un bit de signe
(0 = positif, 1 = négatif), mais alors on aurait besoin de circuits
différents pour l’addition et la soustraction, et on aurait deux
représentations du zéro (+0 et -0).</p>
<p><strong>La solution brillante</strong> : Le <strong>Complément à
2</strong>.</p>
<p>Le bit le plus à gauche (bit 31, le MSB) est le “bit de signe” : -
<code>0</code> → le nombre est positif ou nul - <code>1</code> → le
nombre est négatif</p>
<p>Mais attention, ce n’est pas un simple bit de signe ! Le système est
conçu pour que <strong>l’addition fonctionne de la même manière</strong>
que le nombre soit positif ou négatif.</p>
<h3 data-number="4.3.4"
id="comment-obtenir-le-complément-à-2-la-valeur-négative"><span
class="header-section-number">4.3.4</span> Comment obtenir le complément
à 2 (la valeur négative) ?</h3>
<p>Pour obtenir -X à partir de X : 1. <strong>Inverser</strong> tous les
bits de X (0→1, 1→0) 2. <strong>Ajouter 1</strong> au résultat</p>
<p><strong>Exemple sur 4 bits</strong> : Calculons -5</p>
<pre><code>  5 en binaire :   0101
  Inversion    :   1010
  Ajouter 1    : + 0001
                 ──────
  -5           :   1011</code></pre>
<p><strong>Vérification</strong> : 5 + (-5) devrait donner 0</p>
<pre><code>    0101   (5)
  + 1011   (-5)
  ──────
   10000   → Les 4 bits de poids faible sont 0000 OK
            (La retenue &quot;1&quot; est ignorée car on travaille sur 4 bits)</code></pre>
<h3 data-number="4.3.5"
id="pourquoi-le-complément-à-2-est-il-génial"><span
class="header-section-number">4.3.5</span> Pourquoi le complément à 2
est-il génial ?</h3>
<ol type="1">
<li><strong>Un seul zéro</strong> : 0000 est le seul zéro (pas de +0 et
-0)</li>
<li><strong>L’addition fonctionne universellement</strong> : Le même
circuit additionne les positifs et les négatifs</li>
<li><strong>La soustraction devient une addition</strong> : A - B = A +
(-B) = A + NOT(B) + 1</li>
</ol>
<p>C’est grâce au complément à 2 que notre ALU peut être relativement
simple !</p>
<hr />
<h2 data-number="4.4" id="laddition-binaire"><span
class="header-section-number">4.4</span> L’Addition Binaire</h2>
<p>L’addition binaire suit les mêmes règles que l’addition décimale
qu’on apprend à l’école : on additionne colonne par colonne, de droite à
gauche, en propageant les retenues.</p>
<h3 data-number="4.4.1" id="les-règles-de-base-sur-1-bit"><span
class="header-section-number">4.4.1</span> Les règles de base (sur 1
bit)</h3>
<pre><code>0 + 0 = 0  (pas de retenue)
0 + 1 = 1  (pas de retenue)
1 + 0 = 1  (pas de retenue)
1 + 1 = 10 (c&#39;est-à-dire 0 avec une retenue de 1)</code></pre>
<h3 data-number="4.4.2" id="exemple-daddition-sur-4-bits"><span
class="header-section-number">4.4.2</span> Exemple d’addition sur 4
bits</h3>
<p>Calculons 5 + 3 = 8 :</p>
<pre><code>  Retenues :   1 1 1
              ─────
     5     :   0 1 0 1
  +  3     : + 0 0 1 1
            ─────────
     8     :   1 0 0 0</code></pre>
<p>Détail colonne par colonne (de droite à gauche) :</p>
<ul>
<li>Colonne 0 : 1 + 1 = 0, retenue 1</li>
<li>Colonne 1 : 0 + 1 + 1(retenue) = 0, retenue 1</li>
<li>Colonne 2 : 1 + 0 + 1(retenue) = 0, retenue 1</li>
<li>Colonne 3 : 0 + 0 + 1(retenue) = 1</li>
</ul>
<p>Résultat : 1000₂ = 8₁₀ OK</p>
<hr />
<h2 data-number="4.5" id="le-demi-additionneur-half-adder"><span
class="header-section-number">4.5</span> Le Demi-Additionneur (Half
Adder)</h2>
<p>Le demi-additionneur est le circuit le plus simple pour additionner
deux bits. Il produit : - <strong>sum</strong> : La somme (bit de poids
faible) - <strong>carry</strong> : La retenue (bit de poids fort)</p>
<h3 data-number="4.5.1" id="table-de-vérité"><span
class="header-section-number">4.5.1</span> Table de vérité</h3>
<table>
<thead>
<tr class="header">
<th>a</th>
<th>b</th>
<th style="text-align: center;">sum</th>
<th style="text-align: center;">carry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td>0</td>
<td>1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td>1</td>
<td>0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
<h3 data-number="4.5.2" id="linsight-clé"><span
class="header-section-number">4.5.2</span> L’insight clé</h3>
<p>Regardez attentivement les colonnes : - <strong>sum</strong>
correspond exactement à <strong>XOR(a, b)</strong> — différent = 1,
identique = 0 - <strong>carry</strong> correspond exactement à
<strong>AND(a, b)</strong> — les deux à 1 = retenue</p>
<p>C’est pour cela que nous avons construit XOR et AND au Chapitre 1
!</p>
<h3 data-number="4.5.3" id="schéma-du-circuit"><span
class="header-section-number">4.5.3</span> Schéma du circuit</h3>
<figure>
<img src="images/half-adder.svg" alt="Demi-additionneur" />
<figcaption aria-hidden="true">Demi-additionneur</figcaption>
</figure>
<h3 data-number="4.5.4" id="limitation"><span
class="header-section-number">4.5.4</span> Limitation</h3>
<p>Le demi-additionneur ne peut pas recevoir de retenue d’une colonne
précédente. Il ne fonctionne donc que pour le bit de poids faible (la
première colonne).</p>
<hr />
<h2 data-number="4.6" id="ladditionneur-complet-full-adder"><span
class="header-section-number">4.6</span> L’Additionneur Complet (Full
Adder)</h2>
<p>Pour additionner des nombres de plusieurs bits, chaque colonne (sauf
la première) doit pouvoir accepter une retenue venant de la colonne
précédente.</p>
<h3 data-number="4.6.1" id="interface"><span
class="header-section-number">4.6.1</span> Interface</h3>
<figure>
<img src="images/full-adder.svg" alt="Additionneur complet" />
<figcaption aria-hidden="true">Additionneur complet</figcaption>
</figure>
<h3 data-number="4.6.2" id="table-de-vérité-1"><span
class="header-section-number">4.6.2</span> Table de vérité</h3>
<table>
<thead>
<tr class="header">
<th>a</th>
<th>b</th>
<th style="text-align: center;">cin</th>
<th style="text-align: center;">sum</th>
<th style="text-align: center;">cout</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td>0</td>
<td>0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td>0</td>
<td>1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td>0</td>
<td>1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td>1</td>
<td>0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td>1</td>
<td>0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="odd">
<td>1</td>
<td>1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td>1</td>
<td>1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
<h3 data-number="4.6.3" id="comment-le-construire"><span
class="header-section-number">4.6.3</span> Comment le construire ?</h3>
<p>Un Full Adder peut être construit avec <strong>deux Half Adders et
une porte OR</strong> :</p>
<ol type="1">
<li>Le premier Half Adder additionne <code>a</code> et
<code>b</code></li>
<li>Le second Half Adder additionne le résultat avec
<code>cin</code></li>
<li>Si l’un des deux Half Adders produit une retenue, on a une retenue
finale</li>
</ol>
<figure>
<img src="images/full-adder-construction.svg"
alt="Construction du Full Adder" />
<figcaption aria-hidden="true">Construction du Full Adder</figcaption>
</figure>
<p>Formules :</p>
<ul>
<li><code>s1 = XOR(a, b)</code></li>
<li><code>sum = XOR(s1, cin)</code></li>
<li><code>c1 = AND(a, b)</code></li>
<li><code>c2 = AND(s1, cin)</code></li>
<li><code>cout = OR(c1, c2)</code></li>
</ul>
<hr />
<h2 data-number="4.7"
id="ladditionneur-32-bits-ripple-carry-adder"><span
class="header-section-number">4.7</span> L’Additionneur 32-bits (Ripple
Carry Adder)</h2>
<p>Pour additionner des nombres de 32 bits, nous connectons 32 Full
Adders en cascade. La retenue de sortie de chaque additionneur devient
la retenue d’entrée du suivant.</p>
<h3 data-number="4.7.1" id="schéma-simplifié"><span
class="header-section-number">4.7.1</span> Schéma simplifié</h3>
<figure>
<img src="images/ripple-carry-adder.svg"
alt="Additionneur 32 bits à propagation de retenue" />
<figcaption aria-hidden="true">Additionneur 32 bits à propagation de
retenue</figcaption>
</figure>
<p><strong>Note</strong> : Le premier Full Adder (position 0) a une
retenue d’entrée de 0 pour une addition normale. Mais on peut y injecter
un 1 pour implémenter la soustraction (A + NOT(B) + 1).</p>
<h3 data-number="4.7.2" id="le-compromis-du-ripple-carry"><span
class="header-section-number">4.7.2</span> Le compromis du Ripple
Carry</h3>
<p><strong>Avantage</strong> : Très simple à comprendre et à
implémenter.</p>
<p><strong>Inconvénient</strong> : Les retenues se propagent d’un bout à
l’autre. Pour 32 bits, la retenue doit traverser 32 étages. C’est lent
!</p>
<p>Dans les vrais processeurs, on utilise des techniques comme le “Carry
Lookahead Adder” pour accélérer la propagation. Mais pour notre projet
pédagogique, le Ripple Carry est parfait.</p>
<hr />
<h2 data-number="4.8" id="lalu-arithmetic-logic-unit"><span
class="header-section-number">4.8</span> L’ALU (Arithmetic Logic
Unit)</h2>
<p>L’ALU est le <strong>cœur calculatoire</strong> du processeur. C’est
elle qui effectue TOUTES les opérations arithmétiques et logiques.</p>
<h3 data-number="4.8.1"
id="pourquoi-combiner-arithmétique-et-logique"><span
class="header-section-number">4.8.1</span> Pourquoi combiner
arithmétique et logique ?</h3>
<p>Plutôt que d’avoir des circuits séparés pour l’addition, la
soustraction, le AND, le OR, etc., l’ALU combine tout en un seul
composant. Un signal de contrôle (<code>op</code>) lui dit quelle
opération effectuer.</p>
<h3 data-number="4.8.2" id="interface-de-lalu-codex"><span
class="header-section-number">4.8.2</span> Interface de l’ALU Codex</h3>
<figure>
<img src="images/alu-interface.svg" alt="Interface de l’ALU" />
<figcaption aria-hidden="true">Interface de l’ALU</figcaption>
</figure>
<h3 data-number="4.8.3" id="les-opérations-de-lalu"><span
class="header-section-number">4.8.3</span> Les Opérations de l’ALU</h3>
<p>Le signal <code>op</code> (4 bits) définit l’opération à effectuer
:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">op (binaire)</th>
<th style="text-align: center;">Nom</th>
<th style="text-align: center;">Opération</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0000</td>
<td style="text-align: center;">AND</td>
<td style="text-align: center;"><code>a &amp; b</code></td>
<td style="text-align: left;">ET logique bit à bit</td>
</tr>
<tr class="even">
<td style="text-align: center;">0001</td>
<td style="text-align: center;">EOR</td>
<td style="text-align: center;"><code>a ^ b</code></td>
<td style="text-align: left;">OU exclusif bit à bit</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0010</td>
<td style="text-align: center;">SUB</td>
<td style="text-align: center;"><code>a - b</code></td>
<td style="text-align: left;">Soustraction</td>
</tr>
<tr class="even">
<td style="text-align: center;">0011</td>
<td style="text-align: center;">ADD</td>
<td style="text-align: center;"><code>a + b</code></td>
<td style="text-align: left;">Addition</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0100</td>
<td style="text-align: center;">ORR</td>
<td style="text-align: center;"><code>a \| b</code></td>
<td style="text-align: left;">OU logique bit à bit</td>
</tr>
<tr class="even">
<td style="text-align: center;">0101</td>
<td style="text-align: center;">MOV</td>
<td style="text-align: center;"><code>b</code></td>
<td style="text-align: left;">Copie de b (ignore a)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0110</td>
<td style="text-align: center;">MVN</td>
<td style="text-align: center;"><code>~b</code></td>
<td style="text-align: left;">Inversion de b (NOT)</td>
</tr>
</tbody>
</table>
<h3 data-number="4.8.4" id="comment-implémenter-la-soustraction"><span
class="header-section-number">4.8.4</span> Comment implémenter la
soustraction ?</h3>
<p>Grâce au complément à 2, la soustraction devient une addition :</p>
<pre><code>A - B = A + (-B) = A + (NOT B) + 1</code></pre>
<p>En pratique :</p>
<ol type="1">
<li>Inverser tous les bits de B (avec des portes NOT)</li>
<li>Additionner A et NOT(B) avec une retenue d’entrée de 1</li>
</ol>
<p>C’est pour cela que notre additionneur a une entrée <code>cin</code>
!</p>
<h3 data-number="4.8.5" id="les-drapeaux-flags"><span
class="header-section-number">4.8.5</span> Les Drapeaux (Flags)</h3>
<p>Les drapeaux sont des informations supplémentaires sur le résultat
:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Drapeau</th>
<th style="text-align: left;">Nom</th>
<th style="text-align: left;">Signification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>N</strong></td>
<td style="text-align: left;">Negative</td>
<td style="text-align: left;">1 si le résultat est négatif (bit 31 =
1)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>Z</strong></td>
<td style="text-align: left;">Zero</td>
<td style="text-align: left;">1 si le résultat est exactement 0</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>C</strong></td>
<td style="text-align: left;">Carry</td>
<td style="text-align: left;">1 s’il y a eu une retenue (dépassement
non-signé)</td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>V</strong></td>
<td style="text-align: left;">Overflow</td>
<td style="text-align: left;">1 s’il y a eu un dépassement signé</td>
</tr>
</tbody>
</table>
<p><strong>À quoi servent ces drapeaux ?</strong></p>
<p>Ils permettent au CPU de prendre des décisions :</p>
<ul>
<li><code>B.EQ</code> (Branch if Equal) teste si Z = 1</li>
<li><code>B.LT</code> (Branch if Less Than) teste une combinaison de N
et V</li>
<li><code>B.CS</code> (Branch if Carry Set) teste si C = 1</li>
</ul>
<p>Sans les drapeaux, il serait impossible d’implémenter les conditions
<code>if</code>, les boucles <code>while</code>, etc. !</p>
<h3 data-number="4.8.6" id="comment-calculer-les-drapeaux"><span
class="header-section-number">4.8.6</span> Comment calculer les drapeaux
?</h3>
<ul>
<li><strong>N (Negative)</strong> : C’est simplement le bit 31 du
résultat</li>
<li><strong>Z (Zero)</strong> : NOR de tous les bits du résultat (tous à
0 ?)</li>
<li><strong>C (Carry)</strong> : La retenue de sortie de
l’additionneur</li>
<li><strong>V (Overflow)</strong> : Se produit quand :
<ul>
<li>Deux positifs donnent un négatif</li>
<li>Deux négatifs donnent un positif</li>
<li>Formule : <code>V = (a[31] == b[31]) AND (a[31] != y[31])</code>
(pour l’addition)</li>
</ul></li>
</ul>
<h3 data-number="4.8.7" id="quand-utiliser-chaque-drapeau"><span
class="header-section-number">4.8.7</span> Quand Utiliser Chaque Drapeau
?</h3>
<p>C’est la question cruciale ! Les drapeaux ont des significations
différentes selon qu’on travaille en <strong>signé</strong> ou
<strong>non-signé</strong>.</p>
<h4 data-number="4.8.7.1" id="arithmétique-non-signée-unsigned"><span
class="header-section-number">4.8.7.1</span> Arithmétique Non-Signée
(unsigned)</h4>
<p>Pour des nombres non-signés (0 à 2³²-1), utilisez <strong>C</strong>
et <strong>Z</strong> :</p>
<table>
<thead>
<tr class="header">
<th>Condition</th>
<th>Test</th>
<th>Explication</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>a == b</td>
<td>Z = 1</td>
<td>Résultat de a - b est zéro</td>
</tr>
<tr class="even">
<td>a != b</td>
<td>Z = 0</td>
<td>Résultat non nul</td>
</tr>
<tr class="odd">
<td>a &lt; b</td>
<td>C = 0</td>
<td>Pas de retenue → emprunt</td>
</tr>
<tr class="even">
<td>a &gt;= b</td>
<td>C = 1</td>
<td>Retenue présente → pas d’emprunt</td>
</tr>
<tr class="odd">
<td>a &gt; b</td>
<td>C = 1 ET Z = 0</td>
<td>Pas d’emprunt et non égal</td>
</tr>
<tr class="even">
<td>a &lt;= b</td>
<td>C = 0 OU Z = 1</td>
<td>Emprunt ou égal</td>
</tr>
</tbody>
</table>
<p><strong>Pourquoi C ?</strong> En soustraction non-signée, si a &lt;
b, le résultat “wrappe” (passe par 0) et il n’y a pas de retenue. Si a
&gt;= b, la soustraction ne wrappe pas et produit une retenue.</p>
<h4 data-number="4.8.7.2" id="arithmétique-signée-signed"><span
class="header-section-number">4.8.7.2</span> Arithmétique Signée
(signed)</h4>
<p>Pour des nombres signés (-2³¹ à 2³¹-1), utilisez <strong>N</strong>,
<strong>V</strong>, et <strong>Z</strong> :</p>
<table>
<thead>
<tr class="header">
<th>Condition</th>
<th>Test</th>
<th>Explication</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>a == b</td>
<td>Z = 1</td>
<td>Résultat de a - b est zéro</td>
</tr>
<tr class="even">
<td>a != b</td>
<td>Z = 0</td>
<td>Résultat non nul</td>
</tr>
<tr class="odd">
<td>a &lt; b</td>
<td>N ≠ V</td>
<td>Voir explication ci-dessous</td>
</tr>
<tr class="even">
<td>a &gt;= b</td>
<td>N = V</td>
<td>L’inverse</td>
</tr>
<tr class="odd">
<td>a &gt; b</td>
<td>Z = 0 ET N = V</td>
<td>Non égal et pas moins que</td>
</tr>
<tr class="even">
<td>a &lt;= b</td>
<td>Z = 1 OU N ≠ V</td>
<td>Égal ou moins que</td>
</tr>
</tbody>
</table>
<p><strong>Pourquoi N ≠ V pour “moins que” ?</strong></p>
<p>C’est subtil mais élégant. Après <code>a - b</code> :</p>
<ol type="1">
<li><strong>Sans overflow (V = 0)</strong> : Le signe du résultat est
fiable
<ul>
<li>Si N = 1 (négatif) → a &lt; b ✓</li>
<li>Si N = 0 (positif) → a &gt;= b ✓</li>
</ul></li>
<li><strong>Avec overflow (V = 1)</strong> : Le signe est
<strong>inversé</strong> !
<ul>
<li>Si N = 1 mais V = 1 → En réalité a &gt;= b (l’overflow a inversé le
signe)</li>
<li>Si N = 0 mais V = 1 → En réalité a &lt; b</li>
</ul></li>
</ol>
<p>Donc : <code>a &lt; b</code> ⟺ (N = 1 et V = 0) OU (N = 0 et V = 1) ⟺
<strong>N ≠ V</strong></p>
<h4 data-number="4.8.7.3" id="table-de-référence-des-branchements"><span
class="header-section-number">4.8.7.3</span> Table de Référence des
Branchements</h4>
<table>
<thead>
<tr class="header">
<th>Instruction</th>
<th>Signification</th>
<th>Flags testés</th>
<th>Signé/Non-signé</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>B.EQ</td>
<td>Equal</td>
<td>Z = 1</td>
<td>Les deux</td>
</tr>
<tr class="even">
<td>B.NE</td>
<td>Not Equal</td>
<td>Z = 0</td>
<td>Les deux</td>
</tr>
<tr class="odd">
<td>B.CS/B.HS</td>
<td>Carry Set / Higher or Same</td>
<td>C = 1</td>
<td>Non-signé</td>
</tr>
<tr class="even">
<td>B.CC/B.LO</td>
<td>Carry Clear / Lower</td>
<td>C = 0</td>
<td>Non-signé</td>
</tr>
<tr class="odd">
<td>B.HI</td>
<td>Higher</td>
<td>C = 1 et Z = 0</td>
<td>Non-signé</td>
</tr>
<tr class="even">
<td>B.LS</td>
<td>Lower or Same</td>
<td>C = 0 ou Z = 1</td>
<td>Non-signé</td>
</tr>
<tr class="odd">
<td>B.GE</td>
<td>Greater or Equal</td>
<td>N = V</td>
<td>Signé</td>
</tr>
<tr class="even">
<td>B.LT</td>
<td>Less Than</td>
<td>N ≠ V</td>
<td>Signé</td>
</tr>
<tr class="odd">
<td>B.GT</td>
<td>Greater Than</td>
<td>Z = 0 et N = V</td>
<td>Signé</td>
</tr>
<tr class="even">
<td>B.LE</td>
<td>Less or Equal</td>
<td>Z = 1 ou N ≠ V</td>
<td>Signé</td>
</tr>
<tr class="odd">
<td>B.MI</td>
<td>Minus (negative)</td>
<td>N = 1</td>
<td>—</td>
</tr>
<tr class="even">
<td>B.PL</td>
<td>Plus (positive/zero)</td>
<td>N = 0</td>
<td>—</td>
</tr>
<tr class="odd">
<td>B.VS</td>
<td>Overflow Set</td>
<td>V = 1</td>
<td>—</td>
</tr>
<tr class="even">
<td>B.VC</td>
<td>Overflow Clear</td>
<td>V = 0</td>
<td>—</td>
</tr>
</tbody>
</table>
<h4 data-number="4.8.7.4" id="exemple-pratique-comparaison"><span
class="header-section-number">4.8.7.4</span> Exemple Pratique :
Comparaison</h4>
<div class="sourceCode" id="cb26"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">; Comparer deux nombres signés</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">CMP</span> R0<span class="op">,</span> R1      <span class="co">; Calcule R0 - R1, met à jour les flags</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    B<span class="op">.</span>LT moins      <span class="co">; Si R0 &lt; R1 (signé), sauter</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">; Comparer deux nombres non-signés</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">CMP</span> R2<span class="op">,</span> R3      <span class="co">; Calcule R2 - R3, met à jour les flags</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    B<span class="op">.</span>LO moins_u    <span class="co">; Si R2 &lt; R3 (non-signé), sauter</span></span></code></pre></div>
<p><strong>Attention</strong> : Utiliser B.LT pour du non-signé ou B.LO
pour du signé donne des résultats incorrects !</p>
<pre><code>Exemple : R0 = 0xFFFFFFFF, R1 = 0x00000001
- En non-signé : 4294967295 &gt; 1 → B.HI pris, B.LO non pris ✓
- En signé : -1 &lt; 1 → B.LT pris, B.GE non pris ✓</code></pre>
<hr />
<h2 data-number="4.9" id="la-multiplication-matérielle"><span
class="header-section-number">4.9</span> La Multiplication
Matérielle</h2>
<p>La multiplication est une opération plus complexe que l’addition,
mais elle peut être implémentée efficacement en matériel grâce à
l’algorithme des <strong>produits partiels</strong>.</p>
<h3 data-number="4.9.1" id="le-principe-multiplication-à-la-main"><span
class="header-section-number">4.9.1</span> Le Principe : Multiplication
à la Main</h3>
<p>Rappelons comment on multiplie en binaire, comme à l’école primaire
:</p>
<pre><code>        1 0 1 1   (11 en décimal)
      ×   1 1 0   (6 en décimal)
      ---------
        0 0 0 0   (1011 × 0, décalé de 0)
      1 0 1 1     (1011 × 1, décalé de 1)
    1 0 1 1       (1011 × 1, décalé de 2)
    -----------
    1 0 0 0 0 1 0  (66 en décimal)</code></pre>
<p>Chaque ligne est un <strong>produit partiel</strong> : c’est
simplement <code>a</code> multiplié par un bit de <code>b</code>, puis
décalé vers la gauche.</p>
<h3 data-number="4.9.2" id="lalgorithme-des-produits-partiels"><span
class="header-section-number">4.9.2</span> L’Algorithme des Produits
Partiels</h3>
<p>Pour multiplier deux nombres de N bits :</p>
<ol type="1">
<li><p><strong>Générer les produits partiels</strong> : Pour chaque bit
<code>b[i]</code>, calculer <code>pp[i] = a AND b[i]</code></p>
<ul>
<li>Si <code>b[i] = 0</code>, le produit partiel est 0</li>
<li>Si <code>b[i] = 1</code>, le produit partiel est <code>a</code></li>
</ul></li>
<li><p><strong>Décaler chaque produit partiel</strong> :
<code>pp[i]</code> est décalé de <code>i</code> positions vers la
gauche</p></li>
<li><p><strong>Additionner tous les produits partiels</strong> : Le
résultat final est la somme de tous les <code>pp[i]</code>
décalés</p></li>
</ol>
<h3 data-number="4.9.3"
id="structure-du-multiplicateur-8-bits-mul8"><span
class="header-section-number">4.9.3</span> Structure du Multiplicateur
8-bits (Mul8)</h3>
<p>Pour un multiplicateur 8×8 → 16 bits :</p>
<pre><code>Entrées:  a[7:0], b[7:0]
Sortie:   y[15:0] = a × b

Produits partiels:
  pp0 = a AND b[0]  →  [7:0]      (pas de décalage)
  pp1 = a AND b[1]  →  [8:1]      (décalage de 1)
  pp2 = a AND b[2]  →  [9:2]      (décalage de 2)
  ...
  pp7 = a AND b[7]  →  [14:7]     (décalage de 7)</code></pre>
<h3 data-number="4.9.4" id="addition-en-arbre-wallace-tree"><span
class="header-section-number">4.9.4</span> Addition en Arbre (Wallace
Tree)</h3>
<p>Pour additionner 8 produits partiels efficacement, on utilise une
structure en arbre :</p>
<pre><code>Niveau 1:  pp0+pp1 → sum01    pp2+pp3 → sum23    pp4+pp5 → sum45    pp6+pp7 → sum67
Niveau 2:  sum01+sum23 → sum0123              sum45+sum67 → sum4567
Niveau 3:  sum0123 + sum4567 → résultat final</code></pre>
<p>Cette structure en arbre réduit la latence de O(n) à O(log n).</p>
<h3 data-number="4.9.5" id="pourquoi-le-résultat-est-sur-16-bits"><span
class="header-section-number">4.9.5</span> Pourquoi le Résultat est sur
16 bits ?</h3>
<p>Le produit de deux nombres de N bits peut avoir jusqu’à 2N bits : -
Pire cas : <code>0xFF × 0xFF = 0xFE01</code> (255 × 255 = 65025) - C’est
pourquoi <code>Mul8</code> a une sortie de 16 bits</p>
<h3 data-number="4.9.6" id="extension-à-32-bits-mul32"><span
class="header-section-number">4.9.6</span> Extension à 32 bits
(Mul32)</h3>
<p>Pour un multiplicateur 32×32 → 64 bits, le principe est identique
mais à plus grande échelle :</p>
<ol type="1">
<li><strong>32 produits partiels</strong> de 32 bits chacun</li>
<li><strong>Étendre chaque pp à 64 bits</strong> avec décalage
approprié</li>
<li><strong>Addition en arbre</strong> à 5 niveaux (log₂(32) = 5)</li>
</ol>
<pre><code>Structure Mul32:
  - 32 instances de And32 (génération des produits partiels)
  - 31 instances de Add64 (addition en arbre)
  - Résultat : 64 bits</code></pre>
<h3 data-number="4.9.7"
id="optimisations-dans-les-vrais-processeurs"><span
class="header-section-number">4.9.7</span> Optimisations dans les Vrais
Processeurs</h3>
<p>Les multiplicateurs modernes utilisent des techniques avancées :</p>
<table>
<thead>
<tr class="header">
<th>Technique</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Booth Encoding</strong></td>
<td>Réduit le nombre de produits partiels</td>
</tr>
<tr class="even">
<td><strong>Carry-Save Adder (CSA)</strong></td>
<td>Retarde la propagation des retenues</td>
</tr>
<tr class="odd">
<td><strong>Wallace Tree</strong></td>
<td>Structure en arbre pour additionner les pp</td>
</tr>
<tr class="even">
<td><strong>Dadda Multiplier</strong></td>
<td>Variante optimisée du Wallace Tree</td>
</tr>
</tbody>
</table>
<p>Notre implémentation pédagogique utilise l’approche simple des
produits partiels avec addition en arbre ripple-carry.</p>
<h3 data-number="4.9.8" id="pourquoi-mul-nest-pas-dans-lalu"><span
class="header-section-number">4.9.8</span> Pourquoi MUL n’est pas dans
l’ALU ?</h3>
<p>Dans notre architecture A32, la multiplication est une
<strong>instruction séparée</strong> (classe 101) et non une opération
de l’ALU. Ce choix reflète la réalité des processeurs modernes :</p>
<table>
<thead>
<tr class="header">
<th>Aspect</th>
<th>ALU (ADD, SUB, AND…)</th>
<th>Multiplicateur (MUL)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Complexité</strong></td>
<td>1 additionneur 32-bits</td>
<td>31 additionneurs 32-bits</td>
</tr>
<tr class="even">
<td><strong>Portes logiques</strong></td>
<td>~1000 portes</td>
<td>~30,000 portes</td>
</tr>
<tr class="odd">
<td><strong>Latence</strong></td>
<td>1 cycle</td>
<td>3-5 cycles</td>
</tr>
<tr class="even">
<td><strong>Pipeline</strong></td>
<td>Exécution simple</td>
<td>Souvent pipeliné en interne</td>
</tr>
</tbody>
</table>
<p><strong>Conséquences architecturales :</strong></p>
<ol type="1">
<li><strong>Unité séparée</strong> : Les vrais CPU (ARM Cortex-M, x86)
ont une unité MAC (Multiply-Accumulate) dédiée</li>
<li><strong>Scheduling</strong> : Le compilateur doit tenir compte de la
latence de MUL</li>
<li><strong>Optimisation</strong> : Parfois <code>a * 8</code> est
remplacé par <code>a &lt;&lt; 3</code> (décalage, 1 cycle)</li>
</ol>
<p><strong>Dans notre simulateur :</strong> - L’instruction
<code>MUL Rd, Rn, Rm</code> utilise la classe d’instruction 101 - Elle
est décodée et exécutée séparément des opérations ALU (classe 000/001) -
Le résultat est tronqué à 32 bits (pas de résultat 64 bits comme
ARM)</p>
<p>Cette séparation illustre un principe fondamental : <strong>toutes
les opérations arithmétiques ne sont pas égales</strong> en termes de
coût matériel.</p>
<hr />
<h2 data-number="4.10" id="architecture-de-lalu"><span
class="header-section-number">4.10</span> Architecture de l’ALU</h2>
<p>Voici comment l’ALU est structurée en interne :</p>
<figure>
<img src="images/alu-architecture.svg" alt="Architecture de l’ALU" />
<figcaption aria-hidden="true">Architecture de l’ALU</figcaption>
</figure>
<p>L’idée clé : calculer TOUS les résultats possibles en parallèle, puis
utiliser un multiplexeur pour sélectionner le bon selon
<code>op</code>.</p>
<hr />
<h2 data-number="4.11" id="exercices-pratiques-1"><span
class="header-section-number">4.11</span> Exercices Pratiques</h2>
<h3 data-number="4.11.1" id="exercices-sur-le-simulateur-web-1"><span
class="header-section-number">4.11.1</span> Exercices sur le Simulateur
Web</h3>
<p>Lancez le <strong>Simulateur Web</strong> et allez dans <strong>HDL
Progression</strong> → <strong>Projet 3 : Arithmétique</strong>.</p>
<table>
<thead>
<tr class="header">
<th>Exercice</th>
<th>Description</th>
<th style="text-align: center;">Difficulté</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>HalfAdder</code></td>
<td>Demi-additionneur (XOR + AND)</td>
<td style="text-align: center;">[*]</td>
</tr>
<tr class="even">
<td><code>FullAdder</code></td>
<td>Additionneur complet (2 Half Adders + OR)</td>
<td style="text-align: center;">[**]</td>
</tr>
<tr class="odd">
<td><code>Add16</code></td>
<td>Additionneur 16 bits en cascade</td>
<td style="text-align: center;">[**]</td>
</tr>
<tr class="even">
<td><code>Inc16</code></td>
<td>Incrémenteur (+1) — cas spécial utile</td>
<td style="text-align: center;">[*]</td>
</tr>
<tr class="odd">
<td><code>Sub16</code></td>
<td>Soustracteur (via complément à 2)</td>
<td style="text-align: center;">[**]</td>
</tr>
<tr class="even">
<td><code>ALU</code></td>
<td>L’ALU complète avec drapeaux</td>
<td style="text-align: center;">[***]</td>
</tr>
<tr class="odd">
<td><code>And8</code></td>
<td>AND 8-bit avec masque (pour produits partiels)</td>
<td style="text-align: center;">[*]</td>
</tr>
<tr class="even">
<td><code>Mul8</code></td>
<td>Multiplicateur 8×8 → 16 bits</td>
<td style="text-align: center;">[***]</td>
</tr>
</tbody>
</table>
<h3 data-number="4.11.2" id="conseils-pour-lalu"><span
class="header-section-number">4.11.2</span> Conseils pour l’ALU</h3>
<ol type="1">
<li><p><strong>Commencez par les opérations simples</strong> : AND, OR,
XOR sont juste des portes appliquées bit à bit</p></li>
<li><p><strong>Pour la soustraction</strong> :</p>
<pre><code>sub = a + (NOT b) + 1</code></pre>
<p>Utilisez un inverseur sur b et une retenue d’entrée de 1</p></li>
<li><p><strong>Utilisez les Mux</strong> : Un Mux4Way ou Mux8Way
sélectionne parmi plusieurs résultats</p></li>
<li><p><strong>Les drapeaux</strong> :</p>
<ul>
<li>N : bit 31 du résultat</li>
<li>Z : tous les bits sont à 0 ? (utilisez un grand OR puis NOT)</li>
<li>C : retenue de sortie de l’additionneur</li>
<li>V : comparez les signes des entrées et du résultat</li>
</ul></li>
</ol>
<h3 data-number="4.11.3" id="conseils-pour-le-multiplicateur-mul8"><span
class="header-section-number">4.11.3</span> Conseils pour le
Multiplicateur (Mul8)</h3>
<ol type="1">
<li><p><strong>And8 d’abord</strong> : Commencez par implémenter
<code>And8</code> qui génère un produit partiel</p>
<ul>
<li>C’est simplement 8 portes AND en parallèle</li>
<li>Chaque bit de <code>a</code> est ANDé avec le même bit
<code>b</code></li>
</ul></li>
<li><p><strong>Étendre les produits partiels</strong> :</p>
<ul>
<li><code>pp0</code> → bits [7:0], reste à 0</li>
<li><code>pp1</code> → bits [8:1], bit 0 et bits [15:9] à 0</li>
<li><code>pp2</code> → bits [9:2], bits [1:0] et bits [15:10] à 0</li>
<li>… et ainsi de suite</li>
</ul></li>
<li><p><strong>Addition en arbre</strong> :</p>
<pre><code>Niveau 1: 4 additions (pp0+pp1, pp2+pp3, pp4+pp5, pp6+pp7)
Niveau 2: 2 additions
Niveau 3: 1 addition finale</code></pre></li>
<li><p><strong>Ne pas oublier</strong> : Le résultat est sur 16 bits,
pas 8 !</p></li>
</ol>
<h3 data-number="4.11.4" id="tests-en-ligne-de-commande"><span
class="header-section-number">4.11.4</span> Tests en ligne de
commande</h3>
<div class="sourceCode" id="cb34"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester le Half Adder</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> run <span class="at">-p</span> hdl_cli <span class="at">--</span> test hdl_lib/03_arith/HalfAdder.hdl</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester l&#39;ALU complète</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> run <span class="at">-p</span> hdl_cli <span class="at">--</span> test hdl_lib/03_arith/ALU.hdl</span></code></pre></div>
<hr />
<h2 data-number="4.12" id="défis-supplémentaires-1"><span
class="header-section-number">4.12</span> Défis Supplémentaires</h2>
<h3 data-number="4.12.1" id="défi-1-carry-lookahead"><span
class="header-section-number">4.12.1</span> Défi 1 : Carry
Lookahead</h3>
<p>Le Ripple Carry est lent car les retenues se propagent
séquentiellement. Implémentez un “Carry Lookahead Adder” sur 4 bits qui
calcule les retenues en parallèle.</p>
<h3 data-number="4.12.2" id="défi-2-multiplicateur"><span
class="header-section-number">4.12.2</span> Défi 2 : Multiplicateur</h3>
<p>Construisez un circuit qui multiplie deux nombres de 4 bits. Indice :
la multiplication est une série d’additions décalées.</p>
<h3 data-number="4.12.3" id="défi-3-comparateur"><span
class="header-section-number">4.12.3</span> Défi 3 : Comparateur</h3>
<p>Construisez un circuit qui compare deux nombres 32 bits et produit
trois sorties :</p>
<p>/bin/bash: ligne 1: q : commande introuvable - <code>eq</code> : a ==
b - <code>gt</code> : a &gt; b</p>
<p>Indice : Vous pouvez utiliser la soustraction et regarder les
drapeaux !</p>
<hr />
<h2 data-number="4.13" id="le-lien-avec-le-cpu"><span
class="header-section-number">4.13</span> Le Lien avec le CPU</h2>
<p>L’ALU que vous venez de construire sera utilisée à CHAQUE cycle
d’horloge du CPU :</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Instruction</th>
<th style="text-align: left;">Utilisation de l’ALU</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>ADD R1, R2, R3</code></td>
<td style="text-align: left;">Additionne R2 et R3, stocke dans R1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>SUB R1, R2, R3</code></td>
<td style="text-align: left;">Soustrait R3 de R2</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>CMP R1, R2</code></td>
<td style="text-align: left;">Soustrait et met à jour les drapeaux (sans
stocker)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>AND R1, R2, R3</code></td>
<td style="text-align: left;">ET logique</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>LDR R1, [R2]</code></td>
<td style="text-align: left;">Calcule l’adresse mémoire (R2 +
offset)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>B label</code></td>
<td style="text-align: left;">Calcule la nouvelle adresse (PC +
offset)</td>
</tr>
</tbody>
</table>
<p>Même les sauts conditionnels (<code>B.EQ</code>, <code>B.NE</code>,
etc.) dépendent des drapeaux produits par l’ALU !</p>
<hr />
<h2 data-number="4.14" id="ce-quil-faut-retenir-1"><span
class="header-section-number">4.14</span> Ce qu’il faut retenir</h2>
<ol type="1">
<li><p><strong>Le binaire est naturel pour les circuits</strong> :
Addition = XOR pour le bit, AND pour la retenue</p></li>
<li><p><strong>Le complément à 2 est magique</strong> : Un seul
additionneur pour addition ET soustraction</p></li>
<li><p><strong>L’ALU est le cœur du calcul</strong> : Toutes les
opérations passent par elle</p></li>
<li><p><strong>Les drapeaux permettent les décisions</strong> : Sans
eux, pas de <code>if</code>, pas de boucles</p></li>
<li><p><strong>La hiérarchie continue</strong> :</p>
<ul>
<li>Portes → Half Adder → Full Adder → Additionneur 32-bits → ALU</li>
</ul></li>
</ol>
<p><strong>Prochaine étape</strong> : Au Chapitre 3, nous aborderons la
<strong>mémoire</strong>. Comment l’ordinateur peut-il “se souvenir” de
données ? Nous construirons des flip-flops, des registres, et de la
RAM.</p>
<hr />
<p><strong>Conseil</strong> : L’ALU est l’un des composants les plus
complexes du projet. Prenez le temps de bien comprendre chaque étape. Si
vous avez réussi l’ALU, le reste du projet sera beaucoup plus accessible
!</p>
<hr />
<h2 data-number="4.15" id="auto-évaluation-1"><span
class="header-section-number">4.15</span> Auto-évaluation</h2>
<p>Testez votre compréhension avant de passer au chapitre suivant.</p>
<h3 data-number="4.15.1" id="questions-de-compréhension-1"><span
class="header-section-number">4.15.1</span> Questions de
compréhension</h3>
<p><strong>Q1.</strong> Dans un Half Adder, quelle porte logique calcule
le bit de somme ? Et la retenue ?</p>
<p><strong>Q2.</strong> Quelle est la représentation en complément à 2
de -1 sur 8 bits ?</p>
<p><strong>Q3.</strong> Comment l’ALU effectue-t-elle une soustraction A
- B ?</p>
<p><strong>Q4.</strong> Que signifient les drapeaux N, Z, C, V ?</p>
<p><strong>Q5.</strong> Pourquoi <code>CMP R1, R2</code> n’a pas besoin
de registre destination ?</p>
<h3 data-number="4.15.2" id="mini-défi-pratique-1"><span
class="header-section-number">4.15.2</span> Mini-défi pratique</h3>
<p>Calculez mentalement le résultat de ces opérations sur 8 bits :</p>
<table>
<thead>
<tr class="header">
<th>Opération</th>
<th>A (hex)</th>
<th>B (hex)</th>
<th>Résultat</th>
<th>Drapeaux</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ADD</td>
<td>0x7F</td>
<td>0x01</td>
<td>?</td>
<td>N=? Z=? V=?</td>
</tr>
<tr class="even">
<td>ADD</td>
<td>0xFF</td>
<td>0x01</td>
<td>?</td>
<td>N=? Z=? C=?</td>
</tr>
<tr class="odd">
<td>SUB</td>
<td>0x05</td>
<td>0x05</td>
<td>?</td>
<td>Z=?</td>
</tr>
</tbody>
</table>
<p><em>Les solutions se trouvent dans le document
<strong>Codex_Solutions</strong>.</em></p>
<h3 data-number="4.15.3" id="checklist-de-validation-1"><span
class="header-section-number">4.15.3</span> Checklist de validation</h3>
<p>Avant de passer au chapitre 3, assurez-vous de pouvoir :</p>
<ul class="task-list">
<li><label><input type="checkbox" />Expliquer la différence entre Half
Adder et Full Adder</label></li>
<li><label><input type="checkbox" />Convertir un nombre négatif en
complément à 2</label></li>
<li><label><input type="checkbox" />Expliquer comment la soustraction
utilise l’addition</label></li>
<li><label><input type="checkbox" />Décrire le rôle de chaque drapeau
(N, Z, C, V)</label></li>
<li><label><input type="checkbox" />Implémenter un additionneur 32 bits
en chaînant des Full Adders</label></li>
</ul>
<h1 data-number="5" id="logique-séquentielle-et-mémoire"><span
class="header-section-number">5</span> Logique Séquentielle et
Mémoire</h1>
<blockquote>
<p>“Le temps est ce qui empêche tout d’arriver en même temps.” — John
Wheeler</p>
</blockquote>
<p>Jusqu’à présent, nos circuits étaient <strong>combinatoires</strong>
: la sortie dépendait uniquement des entrées instantanées, comme une
fonction mathématique pure <code>y = f(x)</code>. Si vous coupez le
courant, ils “oublient” tout.</p>
<p>Pour construire un véritable ordinateur, nous devons pouvoir
<strong>stocker de l’information</strong> et la récupérer plus tard.
C’est le rôle de la <strong>logique séquentielle</strong>.</p>
<hr />
<h2 data-number="5.1" id="où-en-sommes-nous-2"><span
class="header-section-number">5.1</span> Où en sommes-nous ?</h2>
<figure>
<img src="images/architecture-stack.svg"
alt="Position dans l’architecture" />
<figcaption aria-hidden="true">Position dans l’architecture</figcaption>
</figure>
<p><em>Nous sommes à la Couche 1 : Logique Matérielle (Portes - ALU -
MEMOIRE - CPU)</em></p>
<p>Nous continuons à construire la couche matérielle. Après les portes
logiques (Chapitre 1) et l’ALU (Chapitre 2), nous abordons maintenant la
<strong>mémoire</strong> — le composant qui permet à l’ordinateur de “se
souvenir”.</p>
<hr />
<h2 data-number="5.2"
id="pourquoi-la-mémoire-est-elle-fondamentale"><span
class="header-section-number">5.2</span> Pourquoi la Mémoire est-elle
Fondamentale ?</h2>
<h3 data-number="5.2.1" id="le-problème-de-létat"><span
class="header-section-number">5.2.1</span> Le problème de l’état</h3>
<p>Imaginez un programme simple :</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> x <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span></code></pre></div>
<p>Pour exécuter cette instruction, l’ordinateur doit : 1.
<strong>Lire</strong> la valeur actuelle de <code>x</code> 2.
<strong>Calculer</strong> <code>x + 1</code> (avec l’ALU) 3.
<strong>Écrire</strong> le résultat dans <code>x</code></p>
<p>Sans mémoire, il n’y a pas de “valeur actuelle de x” à lire. Sans
mémoire, le résultat du calcul disparaît immédiatement après avoir été
produit.</p>
<h3 data-number="5.2.2" id="ce-que-stocke-la-mémoire"><span
class="header-section-number">5.2.2</span> Ce que stocke la mémoire</h3>
<p>Un ordinateur en fonctionnement stocke : - <strong>Le
programme</strong> : Les instructions à exécuter (le code machine) -
<strong>Les données</strong> : Les variables, les tableaux, les objets -
<strong>L’état du CPU</strong> : Les registres, le compteur de programme
- <strong>La pile d’appels</strong> : Pour les fonctions et les
retours</p>
<p>Toutes ces informations vivent dans différentes formes de
mémoire.</p>
<h3 data-number="5.2.3" id="combinatoire-vs-séquentiel"><span
class="header-section-number">5.2.3</span> Combinatoire vs
Séquentiel</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Circuits Combinatoires</th>
<th style="text-align: left;">Circuits Séquentiels</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Sortie = f(entrées)</td>
<td style="text-align: left;">Sortie = f(entrées, <strong>état
précédent</strong>)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pas de mémoire</td>
<td style="text-align: left;">A de la mémoire</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pas d’horloge</td>
<td style="text-align: left;">Synchronisé par une horloge</td>
</tr>
<tr class="even">
<td style="text-align: left;">Exemples : AND, OR, ALU</td>
<td style="text-align: left;">Exemples : Registres, RAM, CPU</td>
</tr>
</tbody>
</table>
<hr />
<h2 data-number="5.3" id="le-temps-et-lhorloge-clock"><span
class="header-section-number">5.3</span> Le Temps et l’Horloge
(Clock)</h2>
<h3 data-number="5.3.1" id="le-problème-de-la-synchronisation"><span
class="header-section-number">5.3.1</span> Le problème de la
synchronisation</h3>
<p>Dans un circuit combinatoire, les signaux se propagent à travers les
portes avec un léger délai. Si on essaie de lire un résultat avant qu’il
soit stable, on obtient des valeurs incorrectes.</p>
<p><strong>La solution</strong> : L’<strong>horloge</strong>
(<code>clk</code>).</p>
<p>L’horloge est un signal qui oscille perpétuellement entre 0 et 1 à
une fréquence fixe :</p>
<figure>
<img src="images/clock-signal.svg" alt="Signal d’horloge" />
<figcaption aria-hidden="true">Signal d’horloge</figcaption>
</figure>
<h3 data-number="5.3.2" id="front-montant-rising-edge"><span
class="header-section-number">5.3.2</span> Front montant (Rising
Edge)</h3>
<p>Le moment crucial est le <strong>front montant</strong> : le passage
de 0 à 1.</p>
<p>Dans le système Codex, les changements d’état se produisent sur le
front montant. Cela signifie :</p>
<ul>
<li>Pendant que l’horloge est à 0, les circuits combinatoires
calculent</li>
<li>Quand l’horloge passe à 1, les résultats sont capturés dans les
registres</li>
</ul>
<p>C’est comme dire : “Tout le monde calcule… et maintenant, on fige les
résultats !”</p>
<h3 data-number="5.3.3" id="fréquence-dhorloge"><span
class="header-section-number">5.3.3</span> Fréquence d’horloge</h3>
<p>La fréquence de l’horloge détermine la vitesse du processeur :</p>
<ul>
<li>Un processeur à 1 GHz = 1 milliard de cycles par seconde</li>
<li>À chaque cycle, le CPU peut exécuter (une partie d’)une
instruction</li>
</ul>
<p>Plus vite bat l’horloge, plus l’ordinateur est rapide — mais aussi
plus il chauffe !</p>
<hr />
<h2 data-number="5.4" id="la-bascule-d-d-flip-flop-dff"><span
class="header-section-number">5.4</span> La Bascule D (D Flip-Flop /
DFF)</h2>
<p>La <strong>DFF</strong> (Data Flip-Flop) est l’atome de la mémoire.
C’est le plus petit circuit capable de mémoriser un bit.</p>
<h3 data-number="5.4.1" id="interface-1"><span
class="header-section-number">5.4.1</span> Interface</h3>
<figure>
<img src="images/dff.svg" alt="Bascule D (DFF)" />
<figcaption aria-hidden="true">Bascule D (DFF)</figcaption>
</figure>
<ul>
<li><code>d</code> : La donnée à mémoriser (entrée)</li>
<li><code>q</code> : La donnée mémorisée (sortie)</li>
<li><code>clk</code> : L’horloge (parfois implicite)</li>
</ul>
<h3 data-number="5.4.2" id="comportement"><span
class="header-section-number">5.4.2</span> Comportement</h3>
<p><strong>Règle fondamentale</strong> : <code>q(t) = d(t-1)</code></p>
<p>La sortie à l’instant <em>t</em> est égale à ce qu’était l’entrée au
cycle précédent.</p>
<figure>
<img src="images/clock-timing.svg" alt="Signal d’horloge et DFF" />
<figcaption aria-hidden="true">Signal d’horloge et DFF</figcaption>
</figure>
<h3 data-number="5.4.3" id="pourquoi-est-ce-utile"><span
class="header-section-number">5.4.3</span> Pourquoi est-ce utile ?</h3>
<p>La DFF introduit un <strong>délai d’un cycle</strong>. Ce délai
permet : 1. De stocker une valeur pour le prochain cycle 2. De casser
les boucles (éviter les oscillations infinies) 3. De synchroniser tous
les composants sur l’horloge</p>
<h3 data-number="5.4.4" id="comment-fonctionne-une-dff-en-interne"><span
class="header-section-number">5.4.4</span> Comment fonctionne une DFF en
interne ?</h3>
<p>Une DFF peut être construite à partir de deux verrous (latches) en
série, eux-mêmes construits à partir de portes NAND. C’est un sujet
fascinant mais hors de notre scope — nous considérons la DFF comme une
primitive fournie par le simulateur.</p>
<hr />
<h2 data-number="5.5" id="le-registre-1-bit-bit"><span
class="header-section-number">5.5</span> Le Registre 1-bit (Bit)</h2>
<p>La DFF mémorise pendant UN cycle, puis elle prend la nouvelle valeur
d’entrée. Comment garder une valeur <strong>indéfiniment</strong> ?</p>
<h3 data-number="5.5.1" id="le-problème"><span
class="header-section-number">5.5.1</span> Le problème</h3>
<p>On veut un circuit qui :</p>
<ul>
<li>Si <code>load = 1</code> : stocke la nouvelle valeur
<code>in</code></li>
<li>Si <code>load = 0</code> : conserve l’ancienne valeur</li>
</ul>
<h3 data-number="5.5.2" id="la-solution-la-rétroaction"><span
class="header-section-number">5.5.2</span> La solution : la
rétroaction</h3>
<p>On utilise un <strong>Mux</strong> pour choisir entre :</p>
<ul>
<li>L’ancienne valeur (sortie de la DFF)</li>
<li>La nouvelle valeur (<code>in</code>)</li>
</ul>
<figure>
<img src="images/bit-register.svg"
alt="Registre 1-bit avec rétroaction" />
<figcaption aria-hidden="true">Registre 1-bit avec
rétroaction</figcaption>
</figure>
<p><strong>Fonctionnement</strong> :</p>
<ul>
<li>Si <code>load = 0</code> : Le Mux sélectionne la sortie de la DFF.
La DFF ré-enregistre sa propre valeur. La valeur est
<strong>maintenue</strong>.</li>
<li>Si <code>load = 1</code> : Le Mux sélectionne <code>in</code>. La
DFF enregistre la nouvelle valeur.</li>
</ul>
<h3 data-number="5.5.3" id="cest-magique"><span
class="header-section-number">5.5.3</span> C’est magique !</h3>
<p>Cette petite boucle de rétroaction transforme un délai d’un cycle en
une mémoire permanente. C’est le principe fondamental de toute mémoire
électronique.</p>
<hr />
<h2 data-number="5.6" id="le-registre-32-bits"><span
class="header-section-number">5.6</span> Le Registre 32-bits</h2>
<h3 data-number="5.6.1" id="du-bit-au-mot"><span
class="header-section-number">5.6.1</span> Du bit au mot</h3>
<p>Un registre 32-bits est simplement <strong>32 registres 1-bit en
parallèle</strong>, partageant le même signal <code>load</code>.</p>
<figure>
<img src="images/register32.svg" alt="Registre 32 bits" />
<figcaption aria-hidden="true">Registre 32 bits</figcaption>
</figure>
<p>Quand <code>load = 1</code>, les 32 bits sont capturés simultanément.
C’est atomique.</p>
<h3 data-number="5.6.2" id="le-rôle-des-registres-dans-le-cpu"><span
class="header-section-number">5.6.2</span> Le rôle des registres dans le
CPU</h3>
<p>Le CPU Codex dispose de <strong>16 registres</strong> nommés R0 à R15
:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Registre</th>
<th style="text-align: left;">Rôle typique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">R0-R12</td>
<td style="text-align: left;">Registres généraux (calculs,
variables)</td>
</tr>
<tr class="even">
<td style="text-align: center;">R13 (SP)</td>
<td style="text-align: left;">Stack Pointer (pointeur de pile)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">R14 (LR)</td>
<td style="text-align: left;">Link Register (adresse de retour)</td>
</tr>
<tr class="even">
<td style="text-align: center;">R15 (PC)</td>
<td style="text-align: left;">Program Counter (adresse de l’instruction
courante)</td>
</tr>
</tbody>
</table>
<p>Les registres sont la mémoire la plus rapide du CPU — ils sont
directement connectés à l’ALU et peuvent être lus/écrits en un seul
cycle.</p>
<hr />
<h2 data-number="5.7" id="la-ram-random-access-memory"><span
class="header-section-number">5.7</span> La RAM (Random Access
Memory)</h2>
<h3 data-number="5.7.1" id="du-registre-à-la-mémoire"><span
class="header-section-number">5.7.1</span> Du registre à la mémoire</h3>
<p>Un registre stocke UN mot de 32 bits. Pour stocker des millions de
mots, nous construisons une <strong>RAM</strong> (Random Access
Memory).</p>
<p>“Random Access” signifie qu’on peut accéder à n’importe quelle
cellule directement, sans parcourir les autres. Contrairement à une
bande magnétique où il faut rembobiner !</p>
<h3 data-number="5.7.2" id="interface-de-la-ram"><span
class="header-section-number">5.7.2</span> Interface de la RAM</h3>
<figure>
<img src="images/ram-interface.svg" alt="Interface de la RAM" />
<figcaption aria-hidden="true">Interface de la RAM</figcaption>
</figure>
<ul>
<li><code>in</code> : La donnée à écrire</li>
<li><code>address</code> : L’adresse de la cellule à lire/écrire</li>
<li><code>load</code> : Si 1, écrire <code>in</code> à
<code>address</code>. Si 0, ne rien écrire.</li>
<li><code>out</code> : La valeur stockée à <code>address</code>
(toujours disponible en lecture)</li>
</ul>
<h3 data-number="5.7.3" id="comment-ça-marche"><span
class="header-section-number">5.7.3</span> Comment ça marche ?</h3>
<p>La RAM utilise les composants que nous avons construits :</p>
<ol type="1">
<li><strong>DMux</strong> (Démultiplexeur) : Route le signal
<code>load</code> vers UN SEUL registre — celui correspondant à
l’adresse</li>
<li><strong>Registres</strong> : Stockent les données</li>
<li><strong>Mux</strong> (Multiplexeur) : Sélectionne la sortie du
registre correspondant à l’adresse</li>
</ol>
<h3 data-number="5.7.4" id="exemple-ram8-8-mots-de-32-bits"><span
class="header-section-number">5.7.4</span> Exemple : RAM8 (8 mots de 32
bits)</h3>
<figure>
<img src="images/ram8-architecture.svg" alt="Architecture RAM8" />
<figcaption aria-hidden="true">Architecture RAM8</figcaption>
</figure>
<h3 data-number="5.7.5"
id="construction-hiérarchique-de-grandes-rams"><span
class="header-section-number">5.7.5</span> Construction hiérarchique de
grandes RAMs</h3>
<p>Comment construire une RAM64 (64 mots) à partir de RAM8 ?</p>
<pre><code>address[5:0] = address[5:3] (3 bits supérieurs) + address[2:0] (3 bits inférieurs)
               ↓                                  ↓
        Sélectionne laquelle des 8 RAM8    Sélectionne le mot dans cette RAM8</code></pre>
<p>On utilise 8 RAM8 :</p>
<ul>
<li>Les 3 bits de poids fort (<code>address[5:3]</code>) choisissent
<strong>quelle RAM8</strong></li>
<li>Les 3 bits de poids faible (<code>address[2:0]</code>) choisissent
<strong>quel mot dans la RAM8</strong></li>
</ul>
<p>C’est un pattern récursif qui permet de construire des mémoires de
n’importe quelle taille !</p>
<hr />
<h2 data-number="5.8" id="le-compteur-de-programme-pc"><span
class="header-section-number">5.8</span> Le Compteur de Programme
(PC)</h2>
<p>Le <strong>Program Counter</strong> (PC) est peut-être le registre le
plus important du CPU. Il contient l’adresse de la prochaine instruction
à exécuter.</p>
<h3 data-number="5.8.1" id="pourquoi-est-il-spécial"><span
class="header-section-number">5.8.1</span> Pourquoi est-il spécial
?</h3>
<p>Après chaque instruction, le PC doit passer à l’instruction suivante.
Mais parfois :</p>
<ul>
<li>On veut <strong>sauter</strong> à une autre adresse (boucles,
conditions)</li>
<li>On veut <strong>revenir à 0</strong> (redémarrage)</li>
</ul>
<h3 data-number="5.8.2" id="les-trois-modes-du-pc"><span
class="header-section-number">5.8.2</span> Les trois modes du PC</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Priorité</th>
<th style="text-align: left;">Mode</th>
<th style="text-align: left;">Condition</th>
<th style="text-align: left;">Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">1</td>
<td style="text-align: left;"><strong>Reset</strong></td>
<td style="text-align: left;"><code>reset = 1</code></td>
<td style="text-align: left;"><code>PC ← 0</code></td>
</tr>
<tr class="even">
<td style="text-align: center;">2</td>
<td style="text-align: left;"><strong>Jump</strong></td>
<td style="text-align: left;"><code>load = 1</code></td>
<td style="text-align: left;"><code>PC ← in</code></td>
</tr>
<tr class="odd">
<td style="text-align: center;">3</td>
<td style="text-align: left;"><strong>Increment</strong></td>
<td style="text-align: left;"><code>inc = 1</code></td>
<td style="text-align: left;"><code>PC ← PC + 1</code></td>
</tr>
<tr class="even">
<td style="text-align: center;">4</td>
<td style="text-align: left;"><strong>Hold</strong></td>
<td style="text-align: left;">sinon</td>
<td style="text-align: left;"><code>PC ← PC</code></td>
</tr>
</tbody>
</table>
<h3 data-number="5.8.3" id="schéma-simplifié-1"><span
class="header-section-number">5.8.3</span> Schéma simplifié</h3>
<figure>
<img src="images/pc-register.svg" alt="Compteur de programme (PC)" />
<figcaption aria-hidden="true">Compteur de programme (PC)</figcaption>
</figure>
<h3 data-number="5.8.4" id="le-lien-avec-lexécution-du-programme"><span
class="header-section-number">5.8.4</span> Le lien avec l’exécution du
programme</h3>
<p>À chaque cycle d’horloge :</p>
<ol type="1">
<li>Le CPU lit l’instruction à l’adresse <code>PC</code></li>
<li>Il décode et exécute l’instruction</li>
<li>Il met à jour le PC (incrément ou saut)</li>
<li>Le cycle recommence</li>
</ol>
<p>C’est le cœur battant de l’ordinateur !</p>
<hr />
<h2 data-number="5.9" id="les-différents-types-de-mémoire"><span
class="header-section-number">5.9</span> Les Différents Types de
Mémoire</h2>
<p>Dans un vrai ordinateur, il y a plusieurs niveaux de mémoire :</p>
<figure>
<img src="images/memory-hierarchy.svg"
alt="Pyramide de la hiérarchie mémoire" />
<figcaption aria-hidden="true">Pyramide de la hiérarchie
mémoire</figcaption>
</figure>
<p>Plus on monte dans la pyramide :</p>
<ul>
<li>Plus c’est rapide</li>
<li>Plus c’est cher par octet</li>
<li>Plus la capacité est faible</li>
</ul>
<p>Dans le Codex, nous implémentons les registres et la RAM. Les caches
et les disques sont des concepts plus avancés.</p>
<hr />
<h2 data-number="5.10" id="exercices-pratiques-2"><span
class="header-section-number">5.10</span> Exercices Pratiques</h2>
<h3 data-number="5.10.1" id="exercices-sur-le-simulateur-web-2"><span
class="header-section-number">5.10.1</span> Exercices sur le Simulateur
Web</h3>
<p>Lancez le <strong>Simulateur Web</strong> et allez dans <strong>HDL
Progression</strong> → <strong>Projet 4 : Séquentiel</strong>.</p>
<table>
<colgroup>
<col style="width: 28%" />
<col style="width: 37%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="header">
<th>Exercice</th>
<th>Description</th>
<th style="text-align: center;">Difficulté</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>DFF1</code></td>
<td>Bascule D (fournie comme primitive)</td>
<td style="text-align: center;">—</td>
</tr>
<tr class="even">
<td><code>BitReg</code></td>
<td>Registre 1-bit (Mux + DFF)</td>
<td style="text-align: center;">[*]</td>
</tr>
<tr class="odd">
<td><code>Register16</code></td>
<td>Registre 16-bits (16 BitReg en parallèle)</td>
<td style="text-align: center;">[*]</td>
</tr>
<tr class="even">
<td><code>PC</code></td>
<td>Compteur de programme avec reset/load/inc</td>
<td style="text-align: center;">[**]</td>
</tr>
<tr class="odd">
<td><code>RAM8</code></td>
<td>RAM de 8 mots (DMux + 8 Registres + Mux)</td>
<td style="text-align: center;">[**]</td>
</tr>
<tr class="even">
<td><code>RAM64</code></td>
<td>RAM de 64 mots (8 RAM8)</td>
<td style="text-align: center;">[**]</td>
</tr>
<tr class="odd">
<td><code>RegFile</code></td>
<td>Banc de registres (lecture double, écriture simple)</td>
<td style="text-align: center;">[***]</td>
</tr>
</tbody>
</table>
<h3 data-number="5.10.2" id="ordre-de-progression-recommandé"><span
class="header-section-number">5.10.2</span> Ordre de progression
recommandé</h3>
<ol type="1">
<li><strong>BitReg</strong> : La brique de base. Un Mux et une DFF.</li>
<li><strong>Register16</strong> : 16 BitReg en parallèle. Vérifiez que
tous les bits sont synchronisés.</li>
<li><strong>PC</strong> : Attention à la priorité ! reset &gt; load &gt;
inc &gt; hold</li>
<li><strong>RAM8</strong> : Utilisez DMux8Way et Mux8Way16</li>
<li><strong>RAM64</strong> : Composition de 8 RAM8</li>
</ol>
<h3 data-number="5.10.3" id="prérequis"><span
class="header-section-number">5.10.3</span> Prérequis</h3>
<p>Avant de construire les RAMs, assurez-vous d’avoir terminé les
composants multi-bits du Projet 2 : - <code>Mux8Way16</code> :
Sélectionne parmi 8 entrées de 16 bits - <code>DMux8Way</code> :
Distribue 1 entrée vers 8 sorties</p>
<h3 data-number="5.10.4" id="tests-en-ligne-de-commande-1"><span
class="header-section-number">5.10.4</span> Tests en ligne de
commande</h3>
<div class="sourceCode" id="cb37"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester le registre 1-bit</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> run <span class="at">-p</span> hdl_cli <span class="at">--</span> test hdl_lib/04_seq/BitReg.hdl</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester la RAM8</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> run <span class="at">-p</span> hdl_cli <span class="at">--</span> test hdl_lib/04_seq/RAM8.hdl</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester le PC</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> run <span class="at">-p</span> hdl_cli <span class="at">--</span> test hdl_lib/04_seq/PC.hdl</span></code></pre></div>
<hr />
<h2 data-number="5.11" id="défis-supplémentaires-2"><span
class="header-section-number">5.11</span> Défis Supplémentaires</h2>
<h3 data-number="5.11.1"
id="défi-1-ram-avec-deux-ports-de-lecture"><span
class="header-section-number">5.11.1</span> Défi 1 : RAM avec deux ports
de lecture</h3>
<p>Construisez une RAM qui permet de lire DEUX adresses différentes
simultanément (utile pour le CPU qui doit lire deux opérandes).</p>
<h3 data-number="5.11.2" id="défi-2-compteur-avec-valeur-maximale"><span
class="header-section-number">5.11.2</span> Défi 2 : Compteur avec
valeur maximale</h3>
<p>Modifiez le PC pour qu’il s’arrête à une valeur maximale au lieu de
continuer à compter (overflow protection).</p>
<h3 data-number="5.11.3"
id="défi-3-registre-à-décalage-shift-register"><span
class="header-section-number">5.11.3</span> Défi 3 : Registre à décalage
(Shift Register)</h3>
<p>Construisez un registre où les bits se décalent d’une position à
chaque cycle. Utilisé pour : - Les communications série - La
multiplication/division par 2 - Les générateurs de nombres
aléatoires</p>
<hr />
<h2 data-number="5.12" id="le-lien-avec-la-suite"><span
class="header-section-number">5.12</span> Le Lien avec la Suite</h2>
<p>La mémoire que vous venez de construire sera utilisée partout dans
l’ordinateur :</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Composant</th>
<th style="text-align: left;">Utilisation de la mémoire</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Registres R0-R15</strong></td>
<td style="text-align: left;">16 registres 32-bits pour les calculs</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>RAM</strong></td>
<td style="text-align: left;">Stockage du programme et des données</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>PC</strong></td>
<td style="text-align: left;">Adresse de l’instruction courante</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Pile (Stack)</strong></td>
<td style="text-align: left;">Zone de RAM pour les appels de
fonction</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Écran</strong></td>
<td style="text-align: left;">Zone de RAM mappée aux pixels (MMIO)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Clavier</strong></td>
<td style="text-align: left;">Registre mappé en mémoire (MMIO)</td>
</tr>
</tbody>
</table>
<p>Au Chapitre 4, nous verrons comment le CPU accède à la mémoire et aux
périphériques via le <strong>Memory-Mapped I/O</strong> (MMIO).</p>
<hr />
<h2 data-number="5.13" id="ce-quil-faut-retenir-2"><span
class="header-section-number">5.13</span> Ce qu’il faut retenir</h2>
<ol type="1">
<li><p><strong>L’horloge synchronise tout</strong> : Les changements se
font sur le front montant</p></li>
<li><p><strong>La DFF est l’atome de mémoire</strong> :
<code>q(t) = d(t-1)</code></p></li>
<li><p><strong>La rétroaction crée la persistance</strong> : Mux + DFF =
mémoire permanente</p></li>
<li><p><strong>La RAM est un tableau de registres</strong> : Accès par
adresse</p></li>
<li><p><strong>Le PC guide l’exécution</strong> : Il pointe vers
l’instruction courante</p></li>
<li><p><strong>Hiérarchie de mémoire</strong> :</p>
<ul>
<li>Registres → Cache → RAM → Disque</li>
<li>Rapidité vs Capacité</li>
</ul></li>
</ol>
<p><strong>Prochaine étape</strong> : Au Chapitre 4, nous définissons
l’<strong>Architecture Machine</strong> (ISA). C’est le “contrat” entre
le matériel et le logiciel : quelles instructions le CPU comprend-il ?
Comment accède-t-il à la mémoire ?</p>
<hr />
<p><strong>Conseil</strong> : Prenez le temps de bien comprendre la
boucle de rétroaction du registre 1-bit. C’est un concept fondamental
qui revient constamment en informatique !</p>
<hr />
<h2 data-number="5.14" id="auto-évaluation-2"><span
class="header-section-number">5.14</span> Auto-évaluation</h2>
<p>Testez votre compréhension avant de passer au chapitre suivant.</p>
<h3 data-number="5.14.1" id="questions-de-compréhension-2"><span
class="header-section-number">5.14.1</span> Questions de
compréhension</h3>
<p><strong>Q1.</strong> Quelle est la différence fondamentale entre un
circuit combinatoire et un circuit séquentiel ?</p>
<p><strong>Q2.</strong> Pourquoi le signal <code>load</code> est-il
nécessaire dans un registre ?</p>
<p><strong>Q3.</strong> Comment fonctionne l’adressage dans une RAM de 8
mots ?</p>
<p><strong>Q4.</strong> Le PC (Program Counter) a plusieurs modes :
reset, load, inc, hold. Dans quel ordre de priorité fonctionnent-ils
?</p>
<p><strong>Q5.</strong> Pourquoi la RAM est-elle plus lente que les
registres ?</p>
<h3 data-number="5.14.2" id="mini-défi-pratique-2"><span
class="header-section-number">5.14.2</span> Mini-défi pratique</h3>
<p>Dessinez le schéma bloc d’un registre 1-bit avec les composants
suivants : - 1 MUX 2-vers-1 - 1 DFF</p>
<p>Indice : La sortie du DFF retourne vers une entrée du MUX.</p>
<p><em>Les solutions se trouvent dans le document
<strong>Codex_Solutions</strong>.</em></p>
<h3 data-number="5.14.3" id="checklist-de-validation-2"><span
class="header-section-number">5.14.3</span> Checklist de validation</h3>
<p>Avant de passer au chapitre 4, assurez-vous de pouvoir :</p>
<ul class="task-list">
<li><label><input type="checkbox" />Expliquer pourquoi l’horloge est
nécessaire (synchronisation)</label></li>
<li><label><input type="checkbox" />Décrire le comportement d’une DFF :
<code>q(t) = d(t-1)</code></label></li>
<li><label><input type="checkbox" />Construire un registre 1-bit avec
MUX + DFF</label></li>
<li><label><input type="checkbox" />Expliquer comment RAM8 utilise DMux
et Mux pour l’adressage</label></li>
<li><label><input type="checkbox" />Décrire les priorités du PC (reset
&gt; load &gt; inc &gt; hold)</label></li>
</ul>
<h1 data-number="6" id="architecture-machine-isa-a32"><span
class="header-section-number">6</span> Architecture Machine (ISA
A32)</h1>
<blockquote>
<p>“Le langage est la limite de mon monde.” — Wittgenstein</p>
</blockquote>
<p>Nous avons maintenant des portes logiques, des additionneurs, et de
la mémoire. Mais comment <strong>commander</strong> tout cela ? C’est le
rôle de l’<strong>Architecture de Jeu d’Instructions</strong> (ISA -
Instruction Set Architecture).</p>
<p>L’ISA est le <strong>contrat</strong> entre le matériel et le
logiciel. C’est la liste de toutes les instructions que le CPU sait
exécuter.</p>
<hr />
<h2 data-number="6.1" id="où-en-sommes-nous-3"><span
class="header-section-number">6.1</span> Où en sommes-nous ?</h2>
<figure>
<img src="images/architecture-stack.svg"
alt="Position dans l’architecture" />
<figcaption aria-hidden="true">Position dans l’architecture</figcaption>
</figure>
<p><em>Nous sommes à la Couche 2 : Architecture Machine (ISA) - Le
contrat entre matériel et logiciel</em></p>
<p>Ce chapitre marque une transition importante. Nous quittons
temporairement le monde du matériel pour définir
<strong>l’interface</strong> entre matériel et logiciel. L’ISA que nous
définissons ici sera :</p>
<ul>
<li><strong>Implémentée</strong> par le CPU au Chapitre 5</li>
<li><strong>Utilisée</strong> par l’assembleur au Chapitre 6</li>
<li><strong>Ciblée</strong> par le compilateur au Chapitre 7</li>
</ul>
<hr />
<h2 data-number="6.2" id="quest-ce-quune-architecture"><span
class="header-section-number">6.2</span> Qu’est-ce qu’une Architecture
?</h2>
<h3 data-number="6.2.1" id="le-contrat-fondamental"><span
class="header-section-number">6.2.1</span> Le contrat fondamental</h3>
<p>L’architecture d’un processeur définit :</p>
<ol type="1">
<li><strong>Les registres</strong> : Combien ? Quelle taille ? Quel rôle
?</li>
<li><strong>Les instructions</strong> : Quelles opérations le CPU
peut-il faire ?</li>
<li><strong>L’encodage</strong> : Comment les instructions sont-elles
représentées en binaire ?</li>
<li><strong>Le modèle mémoire</strong> : Comment le CPU voit-il la
mémoire ?</li>
</ol>
<p>C’est un <strong>contrat</strong> :</p>
<ul>
<li>Le matériel <strong>promet</strong> d’exécuter les instructions
comme spécifié</li>
<li>Le logiciel <strong>s’engage</strong> à n’utiliser que les
instructions définies</li>
</ul>
<h3 data-number="6.2.2"
id="codex-a32-une-architecture-risc-moderne"><span
class="header-section-number">6.2.2</span> Codex A32 : Une architecture
RISC moderne</h3>
<p>L’architecture <strong>Codex A32</strong> est inspirée de ARM,
l’architecture qui équipe la plupart des smartphones et le Raspberry Pi.
Elle est :</p>
<ul>
<li><strong>RISC</strong> (Reduced Instruction Set Computer) :
Instructions simples et rapides</li>
<li><strong>32 bits</strong> : Registres et adresses sur 32 bits</li>
<li><strong>Load/Store</strong> : Le CPU ne calcule jamais directement
en mémoire</li>
</ul>
<hr />
<h2 data-number="6.3" id="pourquoi-risc-larchitecture-loadstore"><span
class="header-section-number">6.3</span> Pourquoi RISC ? L’architecture
Load/Store</h2>
<h3 data-number="6.3.1" id="cisc-vs-risc"><span
class="header-section-number">6.3.1</span> CISC vs RISC</h3>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">CISC (x86, Intel)</th>
<th style="text-align: left;">RISC (ARM, Codex)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Instructions complexes</td>
<td style="text-align: left;">Instructions simples</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>ADD [mem], reg</code> possible</td>
<td style="text-align: left;">Calcul uniquement entre registres</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Vitesse variable par instruction</td>
<td style="text-align: left;">1 instruction ≈ 1 cycle</td>
</tr>
<tr class="even">
<td style="text-align: left;">Plus facile à programmer directement</td>
<td style="text-align: left;">Plus facile à implémenter en matériel</td>
</tr>
</tbody>
</table>
<h3 data-number="6.3.2" id="la-règle-dor-loadstore"><span
class="header-section-number">6.3.2</span> La règle d’or Load/Store</h3>
<p>En architecture RISC, le CPU ne peut <strong>jamais</strong> calculer
directement sur la mémoire. Toute opération suit le schéma :</p>
<pre><code>1. LOAD  : Charger les données de la mémoire vers les registres
2. COMPUTE : Effectuer le calcul dans les registres
3. STORE : Stocker le résultat de retour en mémoire</code></pre>
<p><strong>Exemple</strong> : Incrémenter une variable en mémoire</p>
<div class="sourceCode" id="cb39"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>LDR R0<span class="op">,</span> <span class="op">[</span>R1<span class="op">]</span>      <span class="co">; 1. Charger la valeur depuis l&#39;adresse R1</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="bu">ADD</span> R0<span class="op">,</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">1</span>    <span class="co">; 2. Ajouter 1</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="bu">STR</span> R0<span class="op">,</span> <span class="op">[</span>R1<span class="op">]</span>      <span class="co">; 3. Stocker le résultat</span></span></code></pre></div>
<p>En x86 (CISC), on pourrait écrire <code>ADD [mem], 1</code> en une
seule instruction. Mais le CPU RISC est plus simple à construire et peut
aller plus vite.</p>
<hr />
<h2 data-number="6.4" id="le-cycle-de-vie-dune-instruction"><span
class="header-section-number">6.4</span> Le Cycle de Vie d’une
Instruction</h2>
<p>Chaque instruction traverse trois phases :</p>
<figure>
<img src="images/fetch-decode-execute.svg"
alt="Cycle Fetch-Decode-Execute" />
<figcaption aria-hidden="true">Cycle Fetch-Decode-Execute</figcaption>
</figure>
<ol type="1">
<li><strong>Fetch</strong> (Récupération)
<ul>
<li>Le CPU lit l’instruction à l’adresse contenue dans PC</li>
<li>PC est incrémenté pour pointer vers l’instruction suivante</li>
</ul></li>
<li><strong>Decode</strong> (Décodage)
<ul>
<li>Les 32 bits de l’instruction sont analysés</li>
<li>Le CPU identifie : quel opération ? quels registres ? quelle valeur
immédiate ?</li>
</ul></li>
<li><strong>Execute</strong> (Exécution)
<ul>
<li>L’ALU effectue le calcul</li>
<li>Le résultat est stocké dans le registre de destination</li>
<li>Si c’est un branchement, PC peut être modifié</li>
</ul></li>
</ol>
<hr />
<h2 data-number="6.5" id="les-registres-le-plan-de-travail"><span
class="header-section-number">6.5</span> Les Registres : Le Plan de
Travail</h2>
<p>Le CPU dispose de <strong>16 registres</strong> de 32 bits, nommés R0
à R15.</p>
<h3 data-number="6.5.1" id="vue-densemble"><span
class="header-section-number">6.5.1</span> Vue d’ensemble</h3>
<figure>
<img src="images/register-bank.svg" alt="Banc de registres" />
<figcaption aria-hidden="true">Banc de registres</figcaption>
</figure>
<h3 data-number="6.5.2" id="rôles-des-registres"><span
class="header-section-number">6.5.2</span> Rôles des registres</h3>
<table>
<colgroup>
<col style="width: 27%" />
<col style="width: 18%" />
<col style="width: 54%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Registre</th>
<th style="text-align: left;">Alias</th>
<th style="text-align: left;">Rôle conventionnel</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>R0-R3</strong></td>
<td style="text-align: left;">—</td>
<td style="text-align: left;">Arguments des fonctions et valeurs de
retour</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>R4-R11</strong></td>
<td style="text-align: left;">—</td>
<td style="text-align: left;">Variables locales (préservées par les
fonctions)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>R12</strong></td>
<td style="text-align: left;">IP</td>
<td style="text-align: left;">Registre temporaire (Intra-Procedure
call)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>R13</strong></td>
<td style="text-align: left;"><strong>SP</strong></td>
<td style="text-align: left;">Stack Pointer — Pointe vers le sommet de
la pile</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>R14</strong></td>
<td style="text-align: left;"><strong>LR</strong></td>
<td style="text-align: left;">Link Register — Adresse de retour après
<code>BL</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>R15</strong></td>
<td style="text-align: left;"><strong>PC</strong></td>
<td style="text-align: left;">Program Counter — Adresse de l’instruction
courante</td>
</tr>
</tbody>
</table>
<h3 data-number="6.5.3" id="le-cas-spécial-de-r15-pc"><span
class="header-section-number">6.5.3</span> Le cas spécial de R15
(PC)</h3>
<p>Le PC est accessible comme n’importe quel registre. Si vous écrivez
dedans, vous forcez un saut !</p>
<div class="sourceCode" id="cb40"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span> PC<span class="op">,</span> <span class="kw">R14</span>    <span class="co">; Équivalent à &quot;return&quot; : saute à l&#39;adresse dans LR</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="bu">ADD</span> PC<span class="op">,</span> PC<span class="op">,</span> <span class="op">#</span><span class="dv">8</span> <span class="co">; Saute de 8 octets plus loin</span></span></code></pre></div>
<p>C’est puissant mais dangereux — une erreur de calcul et le CPU saute
n’importe où !</p>
<hr />
<h2 data-number="6.6" id="la-carte-mémoire-memory-map"><span
class="header-section-number">6.6</span> La Carte Mémoire (Memory
Map)</h2>
<p>La mémoire est un espace linéaire de 4 Go (2³² octets), mais toutes
les adresses ne sont pas utilisables.</p>
<h3 data-number="6.6.1" id="organisation-de-la-mémoire-codex"><span
class="header-section-number">6.6.1</span> Organisation de la mémoire
Codex</h3>
<figure>
<img src="images/memory-map.svg" alt="Carte mémoire Codex" />
<figcaption aria-hidden="true">Carte mémoire Codex</figcaption>
</figure>
<h3 data-number="6.6.2" id="le-memory-mapped-io-mmio"><span
class="header-section-number">6.6.2</span> Le Memory-Mapped I/O
(MMIO)</h3>
<p>En Codex (comme en ARM), les périphériques sont accessibles
<strong>comme de la mémoire</strong>. Il n’y a pas d’instructions
spéciales <code>IN</code>/<code>OUT</code>.</p>
<p><strong>L’écran</strong> :</p>
<ul>
<li>Adresse : <code>0x00400000</code> à <code>0x00402580</code></li>
<li>Format : 1 bit par pixel, 40 octets par ligne</li>
<li>Écrire un <code>1</code> à un bit = pixel blanc</li>
</ul>
<p><strong>Le clavier</strong> :</p>
<ul>
<li>Adresse : <code>0x00402600</code></li>
<li>Lire cette adresse donne le code ASCII de la touche pressée (ou
0)</li>
</ul>
<p><strong>Exemple</strong> : Allumer le premier pixel</p>
<div class="sourceCode" id="cb41"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>LDR R0<span class="op">,</span> <span class="op">=</span><span class="bn">0x00400000</span>   <span class="co">; Adresse de l&#39;écran</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span> R1<span class="op">,</span> <span class="op">#</span><span class="bn">0x80</span>         <span class="co">; Bit 7 = premier pixel de la ligne</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>STRB R1<span class="op">,</span> <span class="op">[</span>R0<span class="op">]</span>         <span class="co">; Écrire un octet</span></span></code></pre></div>
<hr />
<h2 data-number="6.7" id="le-format-des-instructions"><span
class="header-section-number">6.7</span> Le Format des Instructions</h2>
<p>Chaque instruction est encodée sur <strong>32 bits</strong>. La
structure générale :</p>
<pre><code>31   28 27   25 24                                             0
┌──────┬───────┬───────────────────────────────────────────────┐
│ Cond │ Class │              Données de l&#39;instruction         │
└──────┴───────┴───────────────────────────────────────────────┘</code></pre>
<h3 data-number="6.7.1" id="les-bits-de-condition-31-28"><span
class="header-section-number">6.7.1</span> Les bits de condition
(31-28)</h3>
<p><strong>Fonctionnalité unique de ARM/Codex</strong> : Toute
instruction peut être conditionnelle !</p>
<p>Au lieu de :</p>
<div class="sourceCode" id="cb43"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="bu">CMP</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">0</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>B<span class="op">.</span>NE skip</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span> R1<span class="op">,</span> <span class="op">#</span><span class="dv">1</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">skip:</span></span></code></pre></div>
<p>On peut écrire :</p>
<div class="sourceCode" id="cb44"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="bu">CMP</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">0</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span><span class="op">.</span>EQ R1<span class="op">,</span> <span class="op">#</span><span class="dv">1</span>   <span class="co">; Exécuté SEULEMENT si Z=1 (égal)</span></span></code></pre></div>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Code</th>
<th style="text-align: left;">Suffixe</th>
<th style="text-align: left;">Condition</th>
<th style="text-align: left;">Signification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">0000</td>
<td style="text-align: left;">EQ</td>
<td style="text-align: left;">Z = 1</td>
<td style="text-align: left;">Égal (Equal)</td>
</tr>
<tr class="even">
<td style="text-align: center;">0001</td>
<td style="text-align: left;">NE</td>
<td style="text-align: left;">Z = 0</td>
<td style="text-align: left;">Différent (Not Equal)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">0010</td>
<td style="text-align: left;">CS/HS</td>
<td style="text-align: left;">C = 1</td>
<td style="text-align: left;">Retenue (Carry Set)</td>
</tr>
<tr class="even">
<td style="text-align: center;">0011</td>
<td style="text-align: left;">CC/LO</td>
<td style="text-align: left;">C = 0</td>
<td style="text-align: left;">Pas de retenue (Carry Clear)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1010</td>
<td style="text-align: left;">GE</td>
<td style="text-align: left;">N = V</td>
<td style="text-align: left;">Plus grand ou égal (signé)</td>
</tr>
<tr class="even">
<td style="text-align: center;">1011</td>
<td style="text-align: left;">LT</td>
<td style="text-align: left;">N ≠ V</td>
<td style="text-align: left;">Plus petit (signé)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1100</td>
<td style="text-align: left;">GT</td>
<td style="text-align: left;">Z=0 et N=V</td>
<td style="text-align: left;">Plus grand (signé)</td>
</tr>
<tr class="even">
<td style="text-align: center;">1101</td>
<td style="text-align: left;">LE</td>
<td style="text-align: left;">Z=1 ou N≠V</td>
<td style="text-align: left;">Plus petit ou égal (signé)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">1110</td>
<td style="text-align: left;">AL</td>
<td style="text-align: left;">(toujours)</td>
<td style="text-align: left;">Toujours exécuter (défaut)</td>
</tr>
</tbody>
</table>
<h3 data-number="6.7.2" id="les-classes-dinstructions-27-25"><span
class="header-section-number">6.7.2</span> Les classes d’instructions
(27-25)</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Bits 27-25</th>
<th style="text-align: left;">Classe</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">000</td>
<td style="text-align: left;">Data Processing (reg)</td>
<td style="text-align: left;">Opérations ALU avec registre</td>
</tr>
<tr class="even">
<td style="text-align: left;">001</td>
<td style="text-align: left;">Data Processing (imm)</td>
<td style="text-align: left;">Opérations ALU avec immédiat</td>
</tr>
<tr class="odd">
<td style="text-align: left;">010</td>
<td style="text-align: left;">Load/Store</td>
<td style="text-align: left;">Accès mémoire (LDR, STR)</td>
</tr>
<tr class="even">
<td style="text-align: left;">011</td>
<td style="text-align: left;">Branch</td>
<td style="text-align: left;">Branchements (B, BL)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">100</td>
<td style="text-align: left;">Block Transfer</td>
<td style="text-align: left;">Push/Pop multiple (LDM, STM)</td>
</tr>
<tr class="even">
<td style="text-align: left;">111</td>
<td style="text-align: left;">System</td>
<td style="text-align: left;">Instructions système (SVC, HALT)</td>
</tr>
</tbody>
</table>
<hr />
<h2 data-number="6.8" id="les-instructions-en-détail"><span
class="header-section-number">6.8</span> Les Instructions en Détail</h2>
<h3 data-number="6.8.1"
id="a.-opérations-arithmétiques-et-logiques"><span
class="header-section-number">6.8.1</span> A. Opérations Arithmétiques
et Logiques</h3>
<p><strong>Format général</strong> :
<code>OP{cond}{S} Rd, Rn, Operand2</code></p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Instruction</th>
<th style="text-align: left;">Opération</th>
<th style="text-align: left;">Exemple</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>ADD</code></td>
<td style="text-align: left;">Addition</td>
<td style="text-align: left;"><code>ADD R1, R2, R3</code> → R1 = R2 +
R3</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>SUB</code></td>
<td style="text-align: left;">Soustraction</td>
<td style="text-align: left;"><code>SUB R1, R2, #5</code> → R1 = R2 -
5</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>AND</code></td>
<td style="text-align: left;">ET logique</td>
<td style="text-align: left;"><code>AND R1, R2, R3</code> → R1 = R2
&amp; R3</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>ORR</code></td>
<td style="text-align: left;">OU logique</td>
<td style="text-align: left;"><code>ORR R1, R2, R3</code> → R1 = R2 |
R3</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>EOR</code></td>
<td style="text-align: left;">XOR</td>
<td style="text-align: left;"><code>EOR R1, R2, R3</code> → R1 = R2 ^
R3</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>MOV</code></td>
<td style="text-align: left;">Copie</td>
<td style="text-align: left;"><code>MOV R1, R2</code> → R1 = R2</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>MVN</code></td>
<td style="text-align: left;">Copie inversée</td>
<td style="text-align: left;"><code>MVN R1, R2</code> → R1 = ~R2</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>CMP</code></td>
<td style="text-align: left;">Comparaison</td>
<td style="text-align: left;"><code>CMP R1, R2</code> → met à jour les
flags</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>TST</code></td>
<td style="text-align: left;">Test bits</td>
<td style="text-align: left;"><code>TST R1, R2</code> → AND sans
stocker</td>
</tr>
</tbody>
</table>
<p><strong>Le suffixe <code>S</code></strong> : Ajouter <code>S</code>
met à jour les drapeaux NZCV.</p>
<div class="sourceCode" id="cb45"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>ADDS R1<span class="op">,</span> R2<span class="op">,</span> R3   <span class="co">; Met à jour les flags</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="bu">ADD</span> R1<span class="op">,</span> R2<span class="op">,</span> R3    <span class="co">; Ne touche pas aux flags</span></span></code></pre></div>
<h3 data-number="6.8.2" id="b.-accès-mémoire-loadstore"><span
class="header-section-number">6.8.2</span> B. Accès Mémoire
(Load/Store)</h3>
<p><strong>Format général</strong> :
<code>LDR/STR{B} Rd, [Rn, #offset]</code></p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Instruction</th>
<th style="text-align: left;">Action</th>
<th style="text-align: left;">Exemple</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>LDR</code></td>
<td style="text-align: left;">Charger 32 bits</td>
<td style="text-align: left;"><code>LDR R0, [R1]</code> → R0 =
MEM[R1]</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>STR</code></td>
<td style="text-align: left;">Stocker 32 bits</td>
<td style="text-align: left;"><code>STR R0, [R1]</code> → MEM[R1] =
R0</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>LDRB</code></td>
<td style="text-align: left;">Charger 8 bits</td>
<td style="text-align: left;"><code>LDRB R0, [R1]</code> → R0 = MEM[R1]
(1 octet)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>STRB</code></td>
<td style="text-align: left;">Stocker 8 bits</td>
<td style="text-align: left;"><code>STRB R0, [R1]</code> → MEM[R1] = R0
(1 octet)</td>
</tr>
</tbody>
</table>
<p><strong>Modes d’adressage</strong> :</p>
<div class="sourceCode" id="cb46"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>LDR R0<span class="op">,</span> <span class="op">[</span>R1<span class="op">]</span>        <span class="co">; Simple : adresse = R1</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>LDR R0<span class="op">,</span> <span class="op">[</span>R1<span class="op">,</span> <span class="op">#</span><span class="dv">4</span><span class="op">]</span>    <span class="co">; Offset : adresse = R1 + 4</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>LDR R0<span class="op">,</span> <span class="op">[</span>R1<span class="op">,</span> R2<span class="op">]</span>    <span class="co">; Registre : adresse = R1 + R2</span></span></code></pre></div>
<h3 data-number="6.8.3" id="c.-branchements"><span
class="header-section-number">6.8.3</span> C. Branchements</h3>
<p><strong>Format</strong> : <code>B{cond} label</code> ou
<code>BL{cond} label</code></p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Instruction</th>
<th style="text-align: left;">Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>B label</code></td>
<td style="text-align: left;">Saut inconditionnel</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>BL label</code></td>
<td style="text-align: left;">Branch with Link (appel de fonction)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>B.EQ label</code></td>
<td style="text-align: left;">Saut si égal (Z=1)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>B.NE label</code></td>
<td style="text-align: left;">Saut si différent (Z=0)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>B.LT label</code></td>
<td style="text-align: left;">Saut si plus petit (signé)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>B.GT label</code></td>
<td style="text-align: left;">Saut si plus grand (signé)</td>
</tr>
</tbody>
</table>
<p><strong>Le mystère de <code>BL</code></strong> :</p>
<div class="sourceCode" id="cb47"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">main:</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    BL ma_fonction    <span class="co">; 1. Sauvegarde PC+4 dans LR</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                      <span class="co">; 2. Saute à ma_fonction</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">; ... (on revient ici après le retour)</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ma_fonction:</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">; ... faire quelque chose ...</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> PC<span class="op">,</span> LR        <span class="co">; Retour : saute à l&#39;adresse dans LR</span></span></code></pre></div>
<hr />
<h2 data-number="6.9" id="la-pile-stack"><span
class="header-section-number">6.9</span> La Pile (Stack)</h2>
<p>La pile est une zone de mémoire utilisée pour : - Sauvegarder les
registres - Stocker les variables locales - Passer des arguments aux
fonctions</p>
<h3 data-number="6.9.1" id="fonctionnement"><span
class="header-section-number">6.9.1</span> Fonctionnement</h3>
<p>La pile <strong>grandit vers le bas</strong> (des adresses hautes
vers les basses) :</p>
<pre><code>       Adresses hautes
           │
           ▼
┌──────────────────┐
│  (données)       │
├──────────────────┤
│  (données)       │
├──────────────────┤ ← SP (Stack Pointer)
│                  │
│   (espace libre) │
│                  │
└──────────────────┘
       Adresses basses</code></pre>
<h3 data-number="6.9.2" id="push-et-pop-manuel"><span
class="header-section-number">6.9.2</span> Push et Pop (manuel)</h3>
<p>Codex n’a pas d’instructions <code>PUSH</code>/<code>POP</code>
natives. On les simule :</p>
<div class="sourceCode" id="cb49"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">; PUSH R0 (empiler R0)</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="bu">SUB</span> <span class="kw">SP</span><span class="op">,</span> <span class="kw">SP</span><span class="op">,</span> <span class="op">#</span><span class="dv">4</span>     <span class="co">; Faire de la place (pile descend)</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="bu">STR</span> R0<span class="op">,</span> <span class="op">[</span><span class="kw">SP</span><span class="op">]</span>       <span class="co">; Stocker R0 au sommet</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co">; POP R0 (dépiler dans R0)</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>LDR R0<span class="op">,</span> <span class="op">[</span><span class="kw">SP</span><span class="op">]</span>       <span class="co">; Lire depuis le sommet</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="bu">ADD</span> <span class="kw">SP</span><span class="op">,</span> <span class="kw">SP</span><span class="op">,</span> <span class="op">#</span><span class="dv">4</span>     <span class="co">; Libérer l&#39;espace</span></span></code></pre></div>
<hr />
<h2 data-number="6.10" id="exemples-de-programmes"><span
class="header-section-number">6.10</span> Exemples de Programmes</h2>
<h3 data-number="6.10.1" id="exemple-1-somme-de-1-à-n"><span
class="header-section-number">6.10.1</span> Exemple 1 : Somme de 1 à
N</h3>
<div class="sourceCode" id="cb50"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">; Calcule 1 + 2 + ... + 10</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>.text</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>.global _start</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">_start:</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">0</span>       <span class="co">; sum = 0</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> R1<span class="op">,</span> <span class="op">#</span><span class="dv">1</span>       <span class="co">; i = 1</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="fu">loop:</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">CMP</span> R1<span class="op">,</span> <span class="op">#</span><span class="dv">10</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    B<span class="op">.</span>GT done         <span class="co">; si i &gt; 10, sortir</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">ADD</span> R0<span class="op">,</span> R0<span class="op">,</span> R1   <span class="co">; sum += i</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">ADD</span> R1<span class="op">,</span> R1<span class="op">,</span> <span class="op">#</span><span class="dv">1</span>   <span class="co">; i++</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    B loop</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a><span class="fu">done:</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">; R0 contient 55</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>    HALT</span></code></pre></div>
<h3 data-number="6.10.2"
id="exemple-2-maximum-de-deux-nombres-avec-prédication"><span
class="header-section-number">6.10.2</span> Exemple 2 : Maximum de deux
nombres (avec prédication)</h3>
<div class="sourceCode" id="cb51"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">; R2 = max(R0, R1) sans branchement</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="bu">CMP</span> R0<span class="op">,</span> R1</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span><span class="op">.</span>GE R2<span class="op">,</span> R0     <span class="co">; Si R0 &gt;= R1, R2 = R0</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span><span class="op">.</span>LT R2<span class="op">,</span> R1     <span class="co">; Si R0 &lt; R1, R2 = R1</span></span></code></pre></div>
<h3 data-number="6.10.3" id="exemple-3-dessiner-un-pixel"><span
class="header-section-number">6.10.3</span> Exemple 3 : Dessiner un
pixel</h3>
<div class="sourceCode" id="cb52"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">; Allumer le pixel (10, 20)</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co">; Adresse = 0x00400000 + (y * 40) + (x / 8)</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co">; Bit = 7 - (x % 8)</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>LDR R0<span class="op">,</span> <span class="op">=</span><span class="bn">0x00400000</span>  <span class="co">; Base de l&#39;écran</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span> R1<span class="op">,</span> <span class="op">#</span><span class="dv">20</span>          <span class="co">; y = 20</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span> R2<span class="op">,</span> <span class="op">#</span><span class="dv">40</span>          <span class="co">; octets par ligne</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="bu">MUL</span> R1<span class="op">,</span> R1<span class="op">,</span> R2       <span class="co">; offset_y = y * 40</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="bu">ADD</span> R0<span class="op">,</span> R0<span class="op">,</span> R1       <span class="co">; adresse_ligne</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span> R1<span class="op">,</span> <span class="op">#</span><span class="dv">10</span>          <span class="co">; x = 10</span></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span> R2<span class="op">,</span> R1<span class="op">,</span> LSR <span class="op">#</span><span class="dv">3</span>   <span class="co">; x / 8</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="bu">ADD</span> R0<span class="op">,</span> R0<span class="op">,</span> R2       <span class="co">; adresse finale</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a><span class="bu">AND</span> R1<span class="op">,</span> R1<span class="op">,</span> <span class="op">#</span><span class="dv">7</span>       <span class="co">; x % 8</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>RSB R1<span class="op">,</span> R1<span class="op">,</span> <span class="op">#</span><span class="dv">7</span>       <span class="co">; 7 - (x % 8)</span></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span> R2<span class="op">,</span> <span class="op">#</span><span class="dv">1</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="bu">LSL</span> R2<span class="op">,</span> R2<span class="op">,</span> R1       <span class="co">; masque = 1 &lt;&lt; bit_pos</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>LDRB R3<span class="op">,</span> <span class="op">[</span>R0<span class="op">]</span>        <span class="co">; Lire l&#39;octet actuel</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>ORR R3<span class="op">,</span> R3<span class="op">,</span> R2       <span class="co">; Allumer le bit</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>STRB R3<span class="op">,</span> <span class="op">[</span>R0<span class="op">]</span>        <span class="co">; Écrire l&#39;octet</span></span></code></pre></div>
<hr />
<h2 data-number="6.11" id="gestion-des-erreurs-traps"><span
class="header-section-number">6.11</span> Gestion des Erreurs
(Traps)</h2>
<p>Si le CPU rencontre une situation invalide, il déclenche une
<strong>trap</strong> :</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Trap</th>
<th style="text-align: left;">Cause</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>ILLEGAL</code></td>
<td style="text-align: left;">Instruction invalide (opcode inconnu)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>MEM_FAULT</code></td>
<td style="text-align: left;">Accès à une adresse non mappée</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>MISALIGNED</code></td>
<td style="text-align: left;">Accès 32-bits à une adresse non alignée
(ex: 0x3)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>DIV_ZERO</code></td>
<td style="text-align: left;">Division par zéro</td>
</tr>
</tbody>
</table>
<hr />
<h2 data-number="6.12" id="exercices-pratiques-3"><span
class="header-section-number">6.12</span> Exercices Pratiques</h2>
<h3 data-number="6.12.1" id="exercices-sur-le-simulateur-web-3"><span
class="header-section-number">6.12.1</span> Exercices sur le Simulateur
Web</h3>
<p>Lancez le <strong>Simulateur Web</strong> et allez dans <strong>A32
Assembly</strong>.</p>
<table>
<thead>
<tr class="header">
<th>Exercice</th>
<th>Description</th>
<th style="text-align: center;">Difficulté</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Hello World</code></td>
<td>Afficher du texte</td>
<td style="text-align: center;">[*]</td>
</tr>
<tr class="even">
<td><code>Addition</code></td>
<td>Additionner deux registres</td>
<td style="text-align: center;">[*]</td>
</tr>
<tr class="odd">
<td><code>Soustraction</code></td>
<td>Soustraire avec le drapeau</td>
<td style="text-align: center;">[*]</td>
</tr>
<tr class="even">
<td><code>Logique</code></td>
<td>Opérations AND, OR, XOR</td>
<td style="text-align: center;">[*]</td>
</tr>
<tr class="odd">
<td><code>Conditions</code></td>
<td>Utiliser les branches conditionnelles</td>
<td style="text-align: center;">[**]</td>
</tr>
<tr class="even">
<td><code>Boucles</code></td>
<td>Implémenter une boucle while</td>
<td style="text-align: center;">[**]</td>
</tr>
<tr class="odd">
<td><code>Multiplication</code></td>
<td>Multiplier par additions successives</td>
<td style="text-align: center;">[**]</td>
</tr>
<tr class="even">
<td><code>Fibonacci</code></td>
<td>Calculer la suite de Fibonacci</td>
<td style="text-align: center;">[**]</td>
</tr>
<tr class="odd">
<td><code>Tableaux</code></td>
<td>Parcourir un tableau en mémoire</td>
<td style="text-align: center;">[**]</td>
</tr>
<tr class="even">
<td><code>Maximum Tableau</code></td>
<td>Trouver le max dans un tableau</td>
<td style="text-align: center;">[***]</td>
</tr>
<tr class="odd">
<td><code>Fonctions</code></td>
<td>Appeler des fonctions avec BL</td>
<td style="text-align: center;">[***]</td>
</tr>
<tr class="even">
<td><code>Pixel</code></td>
<td>Allumer un pixel à l’écran</td>
<td style="text-align: center;">[**]</td>
</tr>
<tr class="odd">
<td><code>Ligne</code></td>
<td>Dessiner une ligne</td>
<td style="text-align: center;">[***]</td>
</tr>
<tr class="even">
<td><code>Rectangle</code></td>
<td>Dessiner un rectangle</td>
<td style="text-align: center;">[***]</td>
</tr>
<tr class="odd">
<td><code>Lire un Caractère</code></td>
<td>Lire le clavier</td>
<td style="text-align: center;">[**]</td>
</tr>
</tbody>
</table>
<h3 data-number="6.12.2" id="tests-en-ligne-de-commande-2"><span
class="header-section-number">6.12.2</span> Tests en ligne de
commande</h3>
<div class="sourceCode" id="cb53"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assembler un fichier</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> run <span class="at">-p</span> a32_cli <span class="at">--</span> assemble mon_prog.s <span class="at">-o</span> mon_prog.bin</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Exécuter un binaire</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> run <span class="at">-p</span> a32_runner <span class="at">--</span> mon_prog.bin</span></code></pre></div>
<hr />
<h2 data-number="6.13" id="ce-quil-faut-retenir-3"><span
class="header-section-number">6.13</span> Ce qu’il faut retenir</h2>
<ol type="1">
<li><p><strong>L’ISA est un contrat</strong> : Entre le matériel et le
logiciel</p></li>
<li><p><strong>RISC = Simple</strong> : Load, Compute, Store — jamais de
calcul direct en mémoire</p></li>
<li><p><strong>16 registres</strong> : R0-R12 généraux, R13=SP, R14=LR,
R15=PC</p></li>
<li><p><strong>Tout est conditionnel</strong> : <code>ADD.EQ</code>,
<code>MOV.GT</code> évitent les branchements</p></li>
<li><p><strong>Memory-Mapped I/O</strong> : L’écran et le clavier sont
des adresses mémoire</p></li>
<li><p><strong>Le cycle Fetch-Decode-Execute</strong> : Le cœur battant
du CPU</p></li>
</ol>
<p><strong>Prochaine étape</strong> : Au Chapitre 5, nous construirons
le CPU qui <strong>implémente</strong> cette architecture. Vous verrez
comment les circuits du Chapitre 1-3 sont combinés pour exécuter ces
instructions.</p>
<hr />
<p><strong>Conseil</strong> : Passez du temps sur le simulateur web à
écrire des programmes en assembleur. Comprendre l’assembleur vous aidera
énormément à comprendre le compilateur plus tard !</p>
<hr />
<h2 data-number="6.14" id="auto-évaluation-3"><span
class="header-section-number">6.14</span> Auto-évaluation</h2>
<p>Testez votre compréhension avant de passer au chapitre suivant.</p>
<h3 data-number="6.14.1" id="questions-de-compréhension-3"><span
class="header-section-number">6.14.1</span> Questions de
compréhension</h3>
<p><strong>Q1.</strong> Qu’est-ce qu’une architecture RISC et pourquoi
A32 en est une ?</p>
<p><strong>Q2.</strong> Pourquoi y a-t-il 16 registres (R0-R15) et pas 8
ou 32 ?</p>
<p><strong>Q3.</strong> Que font les registres spéciaux R13, R14, R15
?</p>
<p><strong>Q4.</strong> Comment fonctionne l’exécution conditionnelle
(ex: <code>ADD.EQ</code>) ?</p>
<p><strong>Q5.</strong> Qu’est-ce que le Memory-Mapped I/O (MMIO) ?</p>
<h3 data-number="6.14.2" id="mini-défi-pratique-3"><span
class="header-section-number">6.14.2</span> Mini-défi pratique</h3>
<p>Écrivez un programme assembleur qui : 1. Met 10 dans R0 2. Met 3 dans
R1 3. Calcule R0 - R1 et stocke dans R2 4. Si le résultat est positif,
met 1 dans R3, sinon 0</p>
<p><em>Les solutions se trouvent dans le document
<strong>Codex_Solutions</strong>.</em></p>
<h3 data-number="6.14.3" id="checklist-de-validation-3"><span
class="header-section-number">6.14.3</span> Checklist de validation</h3>
<p>Avant de passer au chapitre 5, assurez-vous de pouvoir :</p>
<ul class="task-list">
<li><label><input type="checkbox" />Expliquer la différence entre RISC
et CISC</label></li>
<li><label><input type="checkbox" />Décrire le rôle de chaque registre
spécial (SP, LR, PC)</label></li>
<li><label><input type="checkbox" />Écrire un programme simple en
assembleur A32</label></li>
<li><label><input type="checkbox" />Utiliser les conditions (EQ, NE, GT,
LT, etc.)</label></li>
<li><label><input type="checkbox" />Expliquer le cycle
Fetch-Decode-Execute</label></li>
</ul>
<h1 data-number="7" id="le-processeur-cpu"><span
class="header-section-number">7</span> Le Processeur (CPU)</h1>
<blockquote>
<p>“Si vous ne pouvez pas le construire, vous ne le comprenez pas.” —
Richard Feynman</p>
</blockquote>
<p>C’est le grand moment. Nous allons assembler toutes les pièces du
puzzle — portes logiques, ALU, registres, mémoire — pour construire le
<strong>cœur de l’ordinateur</strong> : le CPU A32.</p>
<hr />
<h2 data-number="7.1" id="où-en-sommes-nous-4"><span
class="header-section-number">7.1</span> Où en sommes-nous ?</h2>
<figure>
<img src="images/architecture-stack.svg"
alt="Position dans l’architecture" />
<figcaption aria-hidden="true">Position dans l’architecture</figcaption>
</figure>
<p><em>Nous sommes à la Couche 1 : CPU - L’Aboutissement (ALU + RAM +
Registres)</em></p>
<p>Ce chapitre est le <strong>point culminant</strong> de tout le
travail matériel. Après ce chapitre, vous aurez construit un ordinateur
complet capable d’exécuter du vrai code !</p>
<hr />
<h2 data-number="7.2" id="deux-implémentations-du-cpu"><span
class="header-section-number">7.2</span> Deux Implémentations du
CPU</h2>
<p>Le projet Codex propose <strong>deux implémentations</strong> du CPU
A32, chacune avec un objectif pédagogique différent :</p>
<h3 data-number="7.2.1" id="cpu-mono-cycle-simulateur-rust"><span
class="header-section-number">7.2.1</span> CPU Mono-cycle (Simulateur
Rust)</h3>
<p>Le <strong>simulateur Rust</strong> (<code>a32_core</code>)
implémente un CPU <strong>mono-cycle</strong> :</p>
<figure>
<img src="images/cpu-monocycle.svg" alt="CPU Mono-cycle" />
<figcaption aria-hidden="true">CPU Mono-cycle</figcaption>
</figure>
<p><em>Chaque instruction traverse TOUTES les étapes en UN
cycle</em></p>
<p><strong>Utilisé par :</strong></p>
<ul>
<li>Le <strong>CPU Visualizer</strong> (interface web)</li>
<li>Le <strong>runner</strong> (<code>a32_runner</code>)</li>
<li>L’<strong>IDE web</strong> (exécution des programmes)</li>
<li>Les <strong>tests</strong> C32 et A32</li>
</ul>
<p><strong>Avantages :</strong> Simple à comprendre, facile à déboguer,
comportement prévisible.</p>
<h3 data-number="7.2.2" id="cpu-pipeline-hdl"><span
class="header-section-number">7.2.2</span> CPU Pipeline (HDL)</h3>
<p>Le <strong>CPU en HDL</strong>
(<code>hdl_lib/05_cpu/CPU_Pipeline.hdl</code>) implémente un vrai
<strong>pipeline 5 étages</strong> :</p>
<figure>
<img src="images/cpu-pipeline.svg" alt="CPU Pipeline 5 étages" />
<figcaption aria-hidden="true">CPU Pipeline 5 étages</figcaption>
</figure>
<p><strong>Composants HDL :</strong></p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Fichier</th>
<th style="text-align: left;">Rôle</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>IF_ID_Reg.hdl</code></td>
<td style="text-align: left;">Registre pipeline IF→ID</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>ID_EX_Reg.hdl</code></td>
<td style="text-align: left;">Registre pipeline ID→EX</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>EX_MEM_Reg.hdl</code></td>
<td style="text-align: left;">Registre pipeline EX→MEM</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>MEM_WB_Reg.hdl</code></td>
<td style="text-align: left;">Registre pipeline MEM→WB</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>HazardDetect.hdl</code></td>
<td style="text-align: left;">Détection des hazards (stall)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>ForwardUnit.hdl</code></td>
<td style="text-align: left;">Bypass/forwarding des données</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>CPU_Pipeline.hdl</code></td>
<td style="text-align: left;">CPU complet assemblé</td>
</tr>
</tbody>
</table>
<p><strong>Utilisé par :</strong></p>
<ul>
<li>Les <strong>exercices HDL</strong> (apprentissage hardware)</li>
<li>Le <strong>simulateur HDL</strong> (<code>hdl_cli</code>)</li>
</ul>
<p><strong>Avantages :</strong> Réaliste, montre les vrais défis du
design CPU (hazards, forwarding, stalls).</p>
<h3 data-number="7.2.3" id="pourquoi-deux-implémentations"><span
class="header-section-number">7.2.3</span> Pourquoi deux implémentations
?</h3>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 44%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">Mono-cycle (Rust)</th>
<th style="text-align: left;">Pipeline (HDL)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Objectif</strong></td>
<td style="text-align: left;">Exécuter des programmes</td>
<td style="text-align: left;">Apprendre le hardware</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Complexité</strong></td>
<td style="text-align: left;">Simple</td>
<td style="text-align: left;">Réaliste</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Performance</strong></td>
<td style="text-align: left;">1 instr/cycle</td>
<td style="text-align: left;">Jusqu’à 1 instr/cycle (avec hazards)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Hazards</strong></td>
<td style="text-align: left;">Aucun</td>
<td style="text-align: left;">Gérés (stall + forward)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Utilisation</strong></td>
<td style="text-align: left;">IDE, tests, visualizer</td>
<td style="text-align: left;">Exercices HDL</td>
</tr>
</tbody>
</table>
<blockquote>
<p><strong>Note :</strong> Le CPU Visualizer affiche les étapes (Fetch,
Decode, Execute, Memory, Writeback) de manière
<strong>pédagogique</strong>, mais l’exécution sous-jacente est
mono-cycle. Pour voir un vrai pipeline avec hazards et forwarding,
utilisez le simulateur HDL avec <code>CPU_Pipeline.hdl</code>.</p>
</blockquote>
<hr />
<h2 data-number="7.3" id="quest-ce-quun-cpu"><span
class="header-section-number">7.3</span> Qu’est-ce qu’un CPU ?</h2>
<h3 data-number="7.3.1" id="le-chef-dorchestre"><span
class="header-section-number">7.3.1</span> Le chef d’orchestre</h3>
<p>Le CPU (Central Processing Unit) est le composant qui :</p>
<ol type="1">
<li><strong>Lit</strong> les instructions depuis la mémoire</li>
<li><strong>Décode</strong> ces instructions pour comprendre quoi
faire</li>
<li><strong>Exécute</strong> les opérations (calculs, accès mémoire,
branchements)</li>
<li><strong>Répète</strong> à l’infini (jusqu’à HALT)</li>
</ol>
<p>C’est une machine à états qui exécute une instruction après l’autre,
inlassablement.</p>
<h3 data-number="7.3.2" id="ce-que-nous-avons-construit-jusquici"><span
class="header-section-number">7.3.2</span> Ce que nous avons construit
jusqu’ici</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Chapitre</th>
<th style="text-align: left;">Composant</th>
<th style="text-align: left;">Rôle dans le CPU</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Portes logiques</td>
<td style="text-align: left;">Briques de base de tout circuit</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">ALU</td>
<td style="text-align: left;">Effectue les calculs (ADD, SUB, AND…)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">Registres</td>
<td style="text-align: left;">Stockent les données du CPU (R0-R15)</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">PC</td>
<td style="text-align: left;">Pointe vers l’instruction courante</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">RAM</td>
<td style="text-align: left;">Stocke le programme et les données</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">ISA</td>
<td style="text-align: left;">Définit les instructions à supporter</td>
</tr>
</tbody>
</table>
<h3 data-number="7.3.3" id="ce-quil-reste-à-construire"><span
class="header-section-number">7.3.3</span> Ce qu’il reste à
construire</h3>
<ul>
<li><strong>Décodeur</strong> : Analyse les bits de l’instruction</li>
<li><strong>Unité de contrôle</strong> : Décide quoi activer</li>
<li><strong>Multiplexeurs de données</strong> : Routent les données
entre composants</li>
<li><strong>Le CPU lui-même</strong> : L’assemblage final</li>
</ul>
<hr />
<h2 data-number="7.4" id="architecture-du-cpu-data-path"><span
class="header-section-number">7.4</span> Architecture du CPU (Data
Path)</h2>
<p>Voici le schéma complet du CPU. Chaque flèche est un fil (ou un bus
de 32 fils). Chaque boîte est un composant que vous avez construit ou
que vous allez construire.</p>
<figure>
<img src="images/cpu-datapath.svg"
alt="Architecture du CPU (Data Path)" />
<figcaption aria-hidden="true">Architecture du CPU (Data
Path)</figcaption>
</figure>
<h3 data-number="7.4.1" id="les-flux-de-données"><span
class="header-section-number">7.4.1</span> Les flux de données</h3>
<ol type="1">
<li><strong>Fetch</strong> : PC → Mémoire Instructions → Instruction (32
bits)</li>
<li><strong>Decode</strong> : Instruction → Décodeur → (Rd, Rn, Rm, Imm,
opcode)</li>
<li><strong>Register Read</strong> : Rn, Rm → Banc de Registres →
Valeurs</li>
<li><strong>Execute</strong> : Valeurs → ALU → Résultat</li>
<li><strong>Memory</strong> : Résultat → Mémoire Données (si
LDR/STR)</li>
<li><strong>Writeback</strong> : Résultat → Registre Rd</li>
</ol>
<hr />
<h2 data-number="7.5" id="les-composants-du-cpu"><span
class="header-section-number">7.5</span> Les Composants du CPU</h2>
<h3 data-number="7.5.1" id="le-compteur-de-programme-pc-1"><span
class="header-section-number">7.5.1</span> 1. Le Compteur de Programme
(PC)</h3>
<p>Vous l’avez déjà construit au Chapitre 3 ! Le PC contient l’adresse
de l’instruction courante.</p>
<p><strong>Modes de fonctionnement</strong> :</p>
<ul>
<li><code>inc = 1</code> : PC ← PC + 4 (instruction suivante)</li>
<li><code>load = 1</code> : PC ← adresse de branchement</li>
<li><code>reset = 1</code> : PC ← 0 (redémarrage)</li>
</ul>
<h3 data-number="7.5.2" id="le-décodeur-decoder"><span
class="header-section-number">7.5.2</span> 2. Le Décodeur (Decoder)</h3>
<p>Le décodeur est un circuit <strong>purement combinatoire</strong> qui
“découpe” les 32 bits de l’instruction.</p>
<figure>
<img src="images/decoder.svg" alt="Le décodeur d’instructions" />
<figcaption aria-hidden="true">Le décodeur d’instructions</figcaption>
</figure>
<p><strong>Sorties du décodeur</strong> :</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Signal</th>
<th style="text-align: left;">Bits</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>cond</code></td>
<td style="text-align: left;">31-28</td>
<td style="text-align: left;">Code de condition (EQ, NE, LT…)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>class</code></td>
<td style="text-align: left;">27-25</td>
<td style="text-align: left;">Classe d’instruction (ALU, MEM,
BRANCH)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>op</code></td>
<td style="text-align: left;">24-21</td>
<td style="text-align: left;">Opération ALU (ADD, SUB, AND…)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>S</code></td>
<td style="text-align: left;">20</td>
<td style="text-align: left;">Mettre à jour les drapeaux ?</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Rn</code></td>
<td style="text-align: left;">19-16</td>
<td style="text-align: left;">Registre source 1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Rd</code></td>
<td style="text-align: left;">15-12</td>
<td style="text-align: left;">Registre destination</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Rm</code></td>
<td style="text-align: left;">3-0</td>
<td style="text-align: left;">Registre source 2</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>imm12</code></td>
<td style="text-align: left;">11-0</td>
<td style="text-align: left;">Valeur immédiate (12 bits)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>imm24</code></td>
<td style="text-align: left;">23-0</td>
<td style="text-align: left;">Offset de branchement (24 bits)</td>
</tr>
</tbody>
</table>
<p>Le décodeur ne fait que du <strong>câblage</strong> — il ne calcule
rien, il ne fait que router les bits vers les bonnes sorties.</p>
<h3 data-number="7.5.3" id="lunité-de-contrôle-control"><span
class="header-section-number">7.5.3</span> 3. L’Unité de Contrôle
(Control)</h3>
<p>L’unité de contrôle est le <strong>chef d’orchestre</strong>. Elle
regarde la classe et l’opcode, et décide quels signaux activer.</p>
<figure>
<img src="images/control-unit.svg" alt="Unité de contrôle" />
<figcaption aria-hidden="true">Unité de contrôle</figcaption>
</figure>
<p><strong>Exemples de signaux de contrôle</strong> :</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Instruction</th>
<th style="text-align: center;">reg_write</th>
<th style="text-align: center;">mem_read</th>
<th style="text-align: center;">mem_write</th>
<th style="text-align: center;">alu_src</th>
<th style="text-align: center;">branch</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ADD</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0 (reg)</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">ADD #imm</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1 (imm)</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LDR</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1 (imm)</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">STR</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1 (imm)</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">B</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">X</td>
<td style="text-align: center;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">CMP</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
</tr>
</tbody>
</table>
<h3 data-number="7.5.4"
id="le-vérificateur-de-condition-condcheck"><span
class="header-section-number">7.5.4</span> 4. Le Vérificateur de
Condition (CondCheck)</h3>
<p>Ce petit circuit vérifie si la condition est satisfaite.</p>
<p><strong>Entrées</strong> :</p>
<ul>
<li><code>cond</code> : Le code de condition (4 bits, ex: 0000 =
EQ)</li>
<li><code>flags</code> : Les drapeaux NZCV</li>
</ul>
<p><strong>Sortie</strong> :</p>
<ul>
<li><code>ok</code> : 1 si la condition est vraie, 0 sinon</li>
</ul>
<pre><code>  cond = 0000 (EQ) et Z = 1  →  ok = 1
  cond = 0000 (EQ) et Z = 0  →  ok = 0
  cond = 1110 (AL)           →  ok = 1 (toujours)</code></pre>
<p><strong>Pourquoi est-ce important ?</strong></p>
<p>Si <code>ok = 0</code>, l’instruction est “annulée” — on n’écrit pas
dans le registre, on ne fait pas le branchement. C’est la
<strong>prédication</strong> en action !</p>
<h3 data-number="7.5.5" id="le-banc-de-registres-regfile"><span
class="header-section-number">7.5.5</span> 5. Le Banc de Registres
(RegFile)</h3>
<p>Vous l’avez construit au Chapitre 3 (RAM8, RAM16…). Le banc de
registres est une RAM spéciale avec :</p>
<ul>
<li><strong>2 ports de lecture</strong> : Lire Rn ET Rm
simultanément</li>
<li><strong>1 port d’écriture</strong> : Écrire dans Rd</li>
</ul>
<figure>
<img src="images/register-bank-interface.svg"
alt="Interface du banc de registres" />
<figcaption aria-hidden="true">Interface du banc de
registres</figcaption>
</figure>
<h3 data-number="7.5.6" id="les-multiplexeurs"><span
class="header-section-number">7.5.6</span> 6. Les Multiplexeurs</h3>
<p>Les multiplexeurs routent les données entre les composants :</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Mux</th>
<th style="text-align: left;">Choix</th>
<th style="text-align: left;">Signification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>ALU_src</strong></td>
<td style="text-align: left;">0: Rm, 1: Imm</td>
<td style="text-align: left;">Deuxième opérande de l’ALU</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Writeback</strong></td>
<td style="text-align: left;">0: ALU, 1: MEM</td>
<td style="text-align: left;">Source de la valeur à écrire</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>PC_src</strong></td>
<td style="text-align: left;">0: PC+4, 1: Branch</td>
<td style="text-align: left;">Prochaine valeur du PC</td>
</tr>
</tbody>
</table>
<hr />
<h2 data-number="7.6" id="du-format-dinstruction-au-hardware"><span
class="header-section-number">7.6</span> Du Format d’Instruction au
Hardware</h2>
<p>C’est une question fondamentale : <strong>comment chaque bit de
l’instruction devient-il une action dans le hardware ?</strong></p>
<h3 data-number="7.6.1" id="rappel-format-dune-instruction-a32"><span
class="header-section-number">7.6.1</span> Rappel : Format d’une
Instruction A32</h3>
<pre><code> 31  28 27 25 24  21 20 19 16 15 12 11          0
┌──────┬─────┬──────┬──┬─────┬─────┬─────────────┐
│ cond │class│  op  │ S│  Rn │  Rd │   operand2  │
└──────┴─────┴──────┴──┴─────┴─────┴─────────────┘</code></pre>
<h3 data-number="7.6.2" id="mapping-isa-hardware"><span
class="header-section-number">7.6.2</span> Mapping ISA → Hardware</h3>
<p>Voici comment chaque champ de l’instruction contrôle le hardware
:</p>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 21%" />
<col style="width: 30%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="header">
<th>Bits</th>
<th>Champ</th>
<th>Hardware</th>
<th>Fonction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>[31:28]</td>
<td><code>cond</code></td>
<td><strong>Cond Check</strong></td>
<td>Compare avec NZCV, génère <code>cond_ok</code></td>
</tr>
<tr class="even">
<td>[27:25]</td>
<td><code>class</code></td>
<td><strong>Decoder</strong></td>
<td>Distingue ALU/Mémoire/Branch/etc.</td>
</tr>
<tr class="odd">
<td>[24:21]</td>
<td><code>op</code></td>
<td><strong>Control Unit</strong></td>
<td>Génère <code>ALU_op</code>, <code>reg_write</code>,
<code>mem_write</code></td>
</tr>
<tr class="even">
<td>[20]</td>
<td><code>S</code></td>
<td><strong>Flag Register</strong></td>
<td>Active la mise à jour des flags</td>
</tr>
<tr class="odd">
<td>[19:16]</td>
<td><code>Rn</code></td>
<td><strong>RegFile port A</strong></td>
<td>Adresse du registre source 1</td>
</tr>
<tr class="even">
<td>[15:12]</td>
<td><code>Rd</code></td>
<td><strong>RegFile port W</strong></td>
<td>Adresse du registre destination</td>
</tr>
<tr class="odd">
<td>[11:0]</td>
<td><code>operand2</code></td>
<td><strong>Imm Extender</strong> ou <strong>RegFile port
B</strong></td>
<td>Deuxième opérande</td>
</tr>
</tbody>
</table>
<h3 data-number="7.6.3" id="exemple-détaillé-add-r1-r2-r3"><span
class="header-section-number">7.6.3</span> Exemple Détaillé : ADD R1,
R2, R3</h3>
<p>L’instruction <code>ADD R1, R2, R3</code> en binaire :</p>
<pre><code>1110 000 0100 0 0010 0001 00000000 0011
│    │   │    │ │    │    │         │
│    │   │    │ │    │    │         └── Rm = R3 (0011)
│    │   │    │ │    │    └── padding (ignoré)
│    │   │    │ │    └── Rd = R1 (0001)
│    │   │    │ └── Rn = R2 (0010)
│    │   │    └── S = 0 (ne met pas à jour les flags)
│    │   └── opcode = 0100 (ADD)
│    └── class = 000 (ALU avec registre)
└── cond = 1110 (AL = Always)</code></pre>
<p><strong>Parcours dans le hardware</strong> :</p>
<ol type="1">
<li><p><strong>Cond Check</strong> : <code>cond = 1110</code> (AL) →
<code>cond_ok = 1</code> (toujours vrai)</p></li>
<li><p><strong>Decoder</strong> : <code>class = 000</code> → Instruction
ALU avec registre</p>
<ul>
<li><code>reg_write = 1</code> (on écrit dans un registre)</li>
<li><code>mem_read = 0</code>, <code>mem_write = 0</code> (pas d’accès
mémoire)</li>
<li><code>ALU_src = 0</code> (opérande 2 = registre, pas immédiat)</li>
</ul></li>
<li><p><strong>Control Unit</strong> : <code>op = 0100</code> →
<code>ALU_op = ADD</code></p></li>
<li><p><strong>RegFile</strong> :</p>
<ul>
<li>Port A lit <code>Rn = R2</code> →
<code>Data_A = valeur de R2</code></li>
<li>Port B lit <code>Rm = R3</code> →
<code>Data_B = valeur de R3</code></li>
</ul></li>
<li><p><strong>ALU</strong> : Calcule
<code>Data_A + Data_B</code></p></li>
<li><p><strong>Writeback</strong> : Écrit le résultat dans
<code>Rd = R1</code></p></li>
</ol>
<h3 data-number="7.6.4" id="exemple-détaillé-ldr-r0-r1-8"><span
class="header-section-number">7.6.4</span> Exemple Détaillé : LDR R0,
[R1, #8]</h3>
<p>L’instruction <code>LDR R0, [R1, #8]</code> :</p>
<pre><code>1110 010 1 1001 0001 0000 000000001000
│    │   │ │    │    │    │
│    │   │ │    │    │    └── offset = #8
│    │   │ │    │    └── Rd = R0
│    │   │ │    └── Rn = R1
│    │   │ └── opcode (bits) = 1001 (LDR avec offset positif)
│    │   └── L = 1 (Load, pas Store)
│    └── class = 010 (Mémoire)
└── cond = 1110 (AL)</code></pre>
<p><strong>Parcours</strong> :</p>
<ol type="1">
<li><p><strong>Decoder</strong> : <code>class = 010</code> → Instruction
mémoire</p>
<ul>
<li><code>mem_read = 1</code> (on lit la mémoire)</li>
<li><code>ALU_src = 1</code> (opérande 2 = immédiat)</li>
<li><code>ALU_op = ADD</code> (pour calculer l’adresse)</li>
</ul></li>
<li><p><strong>RegFile</strong> : Lit <code>Rn = R1</code> → adresse de
base</p></li>
<li><p><strong>Imm Extender</strong> : Extrait offset = 8</p></li>
<li><p><strong>ALU</strong> : Calcule <code>R1 + 8</code> → adresse
effective</p></li>
<li><p><strong>Mémoire</strong> : Lit MEM[adresse] → valeur</p></li>
<li><p><strong>Writeback</strong> : <code>Rd = R0</code> reçoit la
valeur lue</p></li>
</ol>
<h3 data-number="7.6.5" id="exemple-détaillé-b.eq-label"><span
class="header-section-number">7.6.5</span> Exemple Détaillé : B.EQ
label</h3>
<p>L’instruction <code>B.EQ label</code> (avec offset de 10
instructions) :</p>
<pre><code>0000 101 0 000000000000000000001010
│    │   │ │
│    │   │ └── offset = 10 (en nombre d&#39;instructions)
│    │   └── L = 0 (Branch, pas Branch-Link)
│    └── class = 101 (Branch)
└── cond = 0000 (EQ = Equal, Z=1)</code></pre>
<p><strong>Parcours</strong> :</p>
<ol type="1">
<li><p><strong>Cond Check</strong> : <code>cond = 0000</code> (EQ) →
<code>cond_ok = Z</code> (prend le flag Z actuel)</p></li>
<li><p><strong>Decoder</strong> : <code>class = 101</code> → Instruction
de branchement</p>
<ul>
<li><code>PC_src = branch_taken</code> (si cond_ok = 1)</li>
<li><code>reg_write = 0</code> (pas d’écriture registre)</li>
</ul></li>
<li><p><strong>Calcul de l’adresse cible</strong> :
<code>PC + 4 + (offset × 4)</code> = <code>PC + 4 + 40</code></p></li>
<li><p><strong>MUX PC</strong> : Si <code>cond_ok = 1</code> (Z était à
1), PC ← adresse cible</p></li>
</ol>
<h3 data-number="7.6.6" id="schéma-récapitulatif"><span
class="header-section-number">7.6.6</span> Schéma Récapitulatif</h3>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│                     INSTRUCTION (32 bits)                    │
└─────────────────────────────────────────────────────────────┘
          │           │           │           │
          ▼           ▼           ▼           ▼
    ┌──────────┐ ┌─────────┐ ┌─────────┐ ┌──────────┐
    │cond[31:28]│ │Decoder  │ │ RegFile │ │Imm Extend│
    │          │ │class,op │ │ Rn,Rd,Rm│ │ operand2 │
    └────┬─────┘ └────┬────┘ └────┬────┘ └────┬─────┘
         │            │           │           │
         ▼            ▼           ▼           ▼
    ┌─────────┐  ┌─────────┐  ┌──────┐   ┌───────┐
    │Cond     │  │Control  │  │Data_A│   │Data_B │
    │Check    │  │Unit     │  │Data_B│   │ou Imm │
    │         │  │         │  │      │   │       │
    │cond_ok  │  │signaux  │  └──┬───┘   └───┬───┘
    └────┬────┘  └────┬────┘     │           │
         │            │          └─────┬─────┘
         │            │                │
         │            ▼                ▼
         │       ┌─────────────────────────┐
         │       │          ALU            │
         │       │    (selon ALU_op)       │
         │       └───────────┬─────────────┘
         │                   │
         │                   ▼
         │            ┌─────────────┐
         │            │   Résultat  │
         │            │   + Flags   │
         │            └──────┬──────┘
         │                   │
         ▼                   ▼
    ┌────────────────────────────────┐
    │   Activation conditionnelle    │
    │   (si cond_ok = 1, exécute)    │
    └────────────────────────────────┘</code></pre>
<hr />
<h2 data-number="7.7" id="le-cycle-dexécution-en-détail"><span
class="header-section-number">7.7</span> Le Cycle d’Exécution en
Détail</h2>
<p>Notre CPU est <strong>single-cycle</strong> : chaque instruction
s’exécute en un seul cycle d’horloge.</p>
<h3 data-number="7.7.1" id="phase-1-fetch-récupération"><span
class="header-section-number">7.7.1</span> Phase 1 : Fetch
(Récupération)</h3>
<pre><code>PC ──► Mémoire Instructions ──► instruction (32 bits)</code></pre>
<p>Le PC envoie son adresse à la mémoire d’instructions. La mémoire
renvoie les 32 bits de l’instruction.</p>
<h3 data-number="7.7.2" id="phase-2-decode-décodage"><span
class="header-section-number">7.7.2</span> Phase 2 : Decode
(Décodage)</h3>
<pre><code>instruction ──► Décodeur ──► cond, class, op, Rn, Rd, Rm, imm
                   │
                   └──► Unité de Contrôle ──► signaux</code></pre>
<p>Le décodeur découpe l’instruction. L’unité de contrôle décide quoi
activer.</p>
<h3 data-number="7.7.3"
id="phase-3-register-read-lecture-des-registres"><span
class="header-section-number">7.7.3</span> Phase 3 : Register Read
(Lecture des registres)</h3>
<pre><code>Rn, Rm ──► Banc de Registres ──► Data_A, Data_B</code></pre>
<p>Les valeurs des registres sources sont lues.</p>
<h3 data-number="7.7.4" id="phase-4-execute-exécution"><span
class="header-section-number">7.7.4</span> Phase 4 : Execute
(Exécution)</h3>
<pre><code>Data_A ──────────────────┐
                         ├──► ALU ──► Résultat, Flags
Data_B ou Imm ──► MUX ───┘</code></pre>
<p>L’ALU effectue l’opération. Les drapeaux sont mis à jour (si
S=1).</p>
<h3 data-number="7.7.5" id="phase-5-memory-accès-mémoire"><span
class="header-section-number">7.7.5</span> Phase 5 : Memory (Accès
mémoire)</h3>
<pre><code>                    ┌─── Si LDR : MEM[addr] → valeur
Résultat (adresse) ─┤
                    └─── Si STR : valeur → MEM[addr]</code></pre>
<p>Pour les instructions LDR/STR, on accède à la mémoire de données.</p>
<h3 data-number="7.7.6" id="phase-6-writeback-écriture"><span
class="header-section-number">7.7.6</span> Phase 6 : Writeback
(Écriture)</h3>
<pre><code>Résultat (ALU ou MEM) ──► MUX ──► Banc de Registres ──► Rd</code></pre>
<p>Si <code>reg_write = 1</code> ET <code>cond_ok = 1</code>, on écrit
dans le registre destination.</p>
<h3 data-number="7.7.7" id="phase-7-pc-update"><span
class="header-section-number">7.7.7</span> Phase 7 : PC Update</h3>
<pre><code>        ┌─── Si branch : PC + (offset × 4)
PC+4 ───┤
        └─── Sinon : PC + 4</code></pre>
<p>Le PC est mis à jour pour le prochain cycle.</p>
<hr />
<h2 data-number="7.8" id="implémentation-du-cpu-en-hdl"><span
class="header-section-number">7.8</span> Implémentation du CPU en
HDL</h2>
<p>Voici un squelette de l’architecture du CPU :</p>
<div class="sourceCode" id="cb67"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="cf">entity</span> <span class="dv">CPU</span> <span class="kw">is</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">port</span>(</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    clk      <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>;</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    reset    <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>;</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">-- Interface mémoire</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    instr    <span class="ot">:</span> <span class="kw">in</span> bits(<span class="dv">31</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    mem_in   <span class="ot">:</span> <span class="kw">in</span> bits(<span class="dv">31</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>    pc_out   <span class="ot">:</span> <span class="kw">out</span> bits(<span class="dv">31</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>    mem_addr <span class="ot">:</span> <span class="kw">out</span> bits(<span class="dv">31</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>    mem_out  <span class="ot">:</span> <span class="kw">out</span> bits(<span class="dv">31</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>    mem_we   <span class="ot">:</span> <span class="kw">out</span> <span class="dt">bit</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  );</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="cf">end entity;</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a><span class="cf">architecture</span> <span class="dv">rtl</span> <span class="kw">of</span> <span class="fu">CPU</span> <span class="kw">is</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Signaux internes</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>  <span class="ot">signal</span> pc<span class="ot">,</span> pc_next <span class="ot">:</span> bits(<span class="dv">31</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>  <span class="ot">signal</span> cond<span class="ot">,</span> op <span class="ot">:</span> bits(<span class="dv">3</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>  <span class="ot">signal</span> rd<span class="ot">,</span> rn<span class="ot">,</span> rm <span class="ot">:</span> bits(<span class="dv">3</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>  <span class="ot">signal</span> imm12 <span class="ot">:</span> bits(<span class="dv">11</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>  <span class="ot">signal</span> data_a<span class="ot">,</span> data_b<span class="ot">,</span> alu_result <span class="ot">:</span> bits(<span class="dv">31</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>  <span class="ot">signal</span> reg_write<span class="ot">,</span> mem_read<span class="ot">,</span> mem_write<span class="ot">,</span> alu_src<span class="ot">,</span> branch <span class="ot">:</span> <span class="dt">bit</span>;</span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>  <span class="ot">signal</span> n_flag<span class="ot">,</span> z_flag<span class="ot">,</span> c_flag<span class="ot">,</span> v_flag<span class="ot">,</span> cond_ok <span class="ot">:</span> <span class="dt">bit</span>;</span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a><span class="cf">begin</span></span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Instanciation des composants</span></span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u_decoder</span><span class="ot">:</span> <span class="fu">Decoder</span> <span class="kw">port map </span>(<span class="ot">...</span>);</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u_control</span><span class="ot">:</span> <span class="fu">Control</span> <span class="kw">port map </span>(<span class="ot">...</span>);</span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u_condcheck</span><span class="ot">:</span> <span class="fu">CondCheck</span> <span class="kw">port map </span>(<span class="ot">...</span>);</span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u_regfile</span><span class="ot">:</span> <span class="fu">RegFile</span> <span class="kw">port map </span>(<span class="ot">...</span>);</span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u_alu</span><span class="ot">:</span> <span class="fu">ALU</span> <span class="kw">port map </span>(<span class="ot">...</span>);</span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a>  <span class="dv">u_pc</span><span class="ot">:</span> <span class="fu">PC</span> <span class="kw">port map </span>(<span class="ot">...</span>);</span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Multiplexeurs</span></span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a>  alu_b <span class="ot">&lt;=</span> imm12 <span class="kw">when</span> alu_src <span class="ot">=</span> <span class="bn">&#39;1&#39;</span> <span class="kw">else</span> data_b;</span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true" tabindex="-1"></a>  writeback <span class="ot">&lt;=</span> mem_in <span class="kw">when</span> mem_read <span class="ot">=</span> <span class="bn">&#39;1&#39;</span> <span class="kw">else</span> alu_result;</span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true" tabindex="-1"></a>  pc_next <span class="ot">&lt;=</span> branch_addr <span class="kw">when</span> (branch <span class="kw">and</span> cond_ok) <span class="ot">=</span> <span class="bn">&#39;1&#39;</span> <span class="kw">else</span> pc_plus_4;</span>
<span id="cb67-38"><a href="#cb67-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-39"><a href="#cb67-39" aria-hidden="true" tabindex="-1"></a><span class="cf">end architecture;</span></span></code></pre></div>
<hr />
<h2 data-number="7.9" id="exercices-pratiques-4"><span
class="header-section-number">7.9</span> Exercices Pratiques</h2>
<h3 data-number="7.9.1" id="exercices-sur-le-simulateur-web-4"><span
class="header-section-number">7.9.1</span> Exercices sur le Simulateur
Web</h3>
<p>Lancez le <strong>Simulateur Web</strong> et allez dans <strong>HDL
Progression</strong> → <strong>Projet 5 : CPU</strong>.</p>
<table>
<thead>
<tr class="header">
<th>Exercice</th>
<th>Description</th>
<th style="text-align: center;">Difficulté</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>Decoder</code></td>
<td>Découper l’instruction en champs</td>
<td style="text-align: center;">[**]</td>
</tr>
<tr class="even">
<td><code>CondCheck</code></td>
<td>Vérifier les conditions (EQ, NE, LT…)</td>
<td style="text-align: center;">[**]</td>
</tr>
<tr class="odd">
<td><code>Control</code></td>
<td>Générer les signaux de contrôle</td>
<td style="text-align: center;">[***]</td>
</tr>
<tr class="even">
<td><code>CPU</code></td>
<td>L’assemblage final !</td>
<td style="text-align: center;">[****]</td>
</tr>
</tbody>
</table>
<h3 data-number="7.9.2" id="ordre-de-progression"><span
class="header-section-number">7.9.2</span> Ordre de progression</h3>
<ol type="1">
<li><strong>Decoder</strong> : Commencez par là. C’est du pur câblage.
<ul>
<li>Utilisez la syntaxe <code>instr(31 downto 28)</code> pour extraire
les bits</li>
</ul></li>
<li><strong>CondCheck</strong> : Table de vérité des conditions
<ul>
<li>EQ : Z = 1</li>
<li>NE : Z = 0</li>
<li>LT : N ≠ V</li>
<li>etc.</li>
</ul></li>
<li><strong>Control</strong> : La logique de commande
<ul>
<li>Pour chaque classe d’instruction, décidez les signaux</li>
<li>Attention aux cas spéciaux (CMP ne fait pas reg_write)</li>
</ul></li>
<li><strong>CPU</strong> : L’assemblage final
<ul>
<li>Suivez le schéma du data path</li>
<li>N’oubliez pas les multiplexeurs !</li>
</ul></li>
</ol>
<h3 data-number="7.9.3" id="tests-en-ligne-de-commande-3"><span
class="header-section-number">7.9.3</span> Tests en ligne de
commande</h3>
<div class="sourceCode" id="cb68"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester le décodeur</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> run <span class="at">-p</span> hdl_cli <span class="at">--</span> test hdl_lib/05_cpu/Decoder.hdl</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tester le CPU complet</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> run <span class="at">-p</span> hdl_cli <span class="at">--</span> test hdl_lib/05_cpu/CPU.hdl</span></code></pre></div>
<hr />
<h2 data-number="7.10" id="cpu-visualizer-loutil-interactif"><span
class="header-section-number">7.10</span> CPU Visualizer : L’Outil
Interactif</h2>
<p>Pour mieux comprendre comment le CPU exécute les instructions, le
projet inclut un <strong>CPU Visualizer</strong> interactif. C’est un
outil web qui vous permet de voir en temps réel le fonctionnement du
processeur.</p>
<h3 data-number="7.10.1" id="accéder-au-visualizer"><span
class="header-section-number">7.10.1</span> Accéder au Visualizer</h3>
<ol type="1">
<li>Lancez le serveur web :</li>
</ol>
<div class="sourceCode" id="cb69"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> web</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run dev</span></code></pre></div>
<ol start="2" type="1">
<li><p>Ouvrez votre navigateur à l’adresse indiquée (généralement
<code>http://localhost:5173</code>)</p></li>
<li><p>Cliquez sur <strong>CPU Visualizer</strong> dans la barre de
navigation</p></li>
</ol>
<h3 data-number="7.10.2" id="fonctionnalités-du-visualizer"><span
class="header-section-number">7.10.2</span> Fonctionnalités du
Visualizer</h3>
<h4 data-number="7.10.2.1" id="vue-pipeline"><span
class="header-section-number">7.10.2.1</span> Vue Pipeline</h4>
<p>Le Visualizer affiche les <strong>5 étapes du cycle
d’exécution</strong> :</p>
<figure>
<img src="images/pipeline-view.svg"
alt="Vue Pipeline - Étapes d’exécution" />
<figcaption aria-hidden="true">Vue Pipeline - Étapes
d’exécution</figcaption>
</figure>
<p>Chaque étape s’illumine en jaune quand elle est active, vous
permettant de suivre la progression de l’instruction.</p>
<h4 data-number="7.10.2.2" id="panneau-registres"><span
class="header-section-number">7.10.2.2</span> Panneau Registres</h4>
<p>Affiche les <strong>16 registres</strong> (R0-R15) avec les alias
:</p>
<ul>
<li><strong>SP</strong> (R13) : Stack Pointer</li>
<li><strong>LR</strong> (R14) : Link Register</li>
<li><strong>PC</strong> (R15) : Program Counter</li>
</ul>
<p>Les registres modifiés s’illuminent en vert pendant un instant.</p>
<h4 data-number="7.10.2.3" id="panneau-flags-cpsr"><span
class="header-section-number">7.10.2.3</span> Panneau Flags (CPSR)</h4>
<p>Les 4 drapeaux du processeur sont affichés :</p>
<ul>
<li><strong>N</strong> (Negative) : Le résultat est négatif</li>
<li><strong>Z</strong> (Zero) : Le résultat est zéro</li>
<li><strong>C</strong> (Carry) : Retenue/emprunt</li>
<li><strong>V</strong> (Overflow) : Débordement signé</li>
</ul>
<p>Les flags changent de couleur quand ils sont actifs.</p>
<h4 data-number="7.10.2.4" id="panneau-code-source"><span
class="header-section-number">7.10.2.4</span> Panneau Code Source</h4>
<p>Affiche le code assembleur avec :</p>
<ul>
<li><strong>Coloration syntaxique</strong> : Instructions, registres,
nombres, commentaires</li>
<li><strong>Surlignage de la ligne courante</strong> : La ligne en cours
d’exécution est mise en évidence en jaune</li>
<li><strong>Défilement automatique</strong> : Le code défile pour suivre
l’exécution</li>
</ul>
<h4 data-number="7.10.2.5" id="panneau-mémoire-et-cache"><span
class="header-section-number">7.10.2.5</span> Panneau Mémoire et
Cache</h4>
<p>Affiche :</p>
<ul>
<li><strong>Vue mémoire</strong> : Les octets en mémoire autour du
PC</li>
<li><strong>Statistiques cache</strong> : Hits, Misses, Taux de
réussite</li>
<li><strong>Contenu du cache L1</strong> : Lignes valides avec tag et
données</li>
<li><strong>Indicateur HIT/MISS</strong> : Flash vert pour hit, rouge
pour miss</li>
</ul>
<h3 data-number="7.10.3" id="les-démos-intégrées"><span
class="header-section-number">7.10.3</span> Les Démos Intégrées</h3>
<p>Le Visualizer inclut 7 démos prêtes à l’emploi :</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Demo</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Concept illustré</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>1. Addition</strong></td>
<td style="text-align: left;">5 + 3 = 8</td>
<td style="text-align: left;">Instructions ALU basiques</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>2. Boucle</strong></td>
<td style="text-align: left;">Somme 1-5</td>
<td style="text-align: left;">Branchements conditionnels</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>3. Mémoire</strong></td>
<td style="text-align: left;">LDR/STR</td>
<td style="text-align: left;">Accès mémoire</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>4. Condition</strong></td>
<td style="text-align: left;">Valeur absolue</td>
<td style="text-align: left;">Prédication</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>5. Tableau</strong></td>
<td style="text-align: left;">Somme tableau</td>
<td style="text-align: left;">Boucle + mémoire</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>6. Flags</strong></td>
<td style="text-align: left;">N, Z, C, V</td>
<td style="text-align: left;">Drapeaux CPU</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>7. Cache</strong></td>
<td style="text-align: left;">Parcours mémoire</td>
<td style="text-align: left;">Cache hits/misses</td>
</tr>
</tbody>
</table>
<h3 data-number="7.10.4" id="contrôles"><span
class="header-section-number">7.10.4</span> Contrôles</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Bouton</th>
<th style="text-align: left;">Raccourci</th>
<th style="text-align: left;">Action</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Reset</strong></td>
<td style="text-align: left;">Ctrl+R</td>
<td style="text-align: left;">Remet le CPU à zéro</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Step</strong></td>
<td style="text-align: left;">N, F10</td>
<td style="text-align: left;">Exécute une instruction</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Play/Pause</strong></td>
<td style="text-align: left;">Espace</td>
<td style="text-align: left;">Lance/arrête l’exécution continue</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Vitesse</strong></td>
<td style="text-align: left;">Slider</td>
<td style="text-align: left;">Ajuste la vitesse d’exécution</td>
</tr>
</tbody>
</table>
<h3 data-number="7.10.5" id="charger-votre-propre-code"><span
class="header-section-number">7.10.5</span> Charger Votre Propre
Code</h3>
<ol type="1">
<li>Cliquez sur <strong>Charger fichier</strong></li>
<li>Sélectionnez un fichier <code>.asm</code>, <code>.a32</code> ou
<code>.a32b</code></li>
<li>Le code est assemblé et chargé automatiquement</li>
</ol>
<h3 data-number="7.10.6" id="exercice-pratique"><span
class="header-section-number">7.10.6</span> Exercice Pratique</h3>
<p>Utilisez le Visualizer pour observer ces comportements :</p>
<ol type="1">
<li><p><strong>Suivez une addition</strong> : Chargez la démo “Addition”
et observez comment ADD lit deux registres et écrit le résultat</p></li>
<li><p><strong>Observez un branchement</strong> : Chargez la démo
“Boucle” et regardez comment B.LE revient au début de la boucle</p></li>
<li><p><strong>Analysez le cache</strong> : Chargez la démo “Cache” et
observez les miss au premier parcours, puis les hits au second</p></li>
</ol>
<hr />
<h2 data-number="7.11" id="conseils-de-débogage"><span
class="header-section-number">7.11</span> Conseils de Débogage</h2>
<h3 data-number="7.11.1" id="le-pc-reste-à-0"><span
class="header-section-number">7.11.1</span> Le PC reste à 0 ?</h3>
<ul>
<li>Vérifiez que <code>inc = 1</code> par défaut</li>
<li>Vérifiez que le reset n’est pas bloqué</li>
</ul>
<h3 data-number="7.11.2" id="les-branchements-ne-marchent-pas"><span
class="header-section-number">7.11.2</span> Les branchements ne marchent
pas ?</h3>
<ul>
<li>L’offset dans l’instruction est en mots (× 4 pour avoir des
octets)</li>
<li>Vérifiez que <code>cond_ok</code> est correct</li>
<li>Vérifiez le calcul de l’adresse de branchement</li>
</ul>
<h3 data-number="7.11.3" id="rien-ne-sécrit-dans-les-registres"><span
class="header-section-number">7.11.3</span> Rien ne s’écrit dans les
registres ?</h3>
<ul>
<li><code>reg_write</code> doit être à 1</li>
<li><code>cond_ok</code> doit être à 1</li>
<li>Le registre destination ne doit pas être R15 (géré à part)</li>
</ul>
<h3 data-number="7.11.4" id="ldrstr-ne-fonctionne-pas"><span
class="header-section-number">7.11.4</span> LDR/STR ne fonctionne pas
?</h3>
<ul>
<li>Vérifiez le calcul de l’adresse (base + offset)</li>
<li>Vérifiez les signaux <code>mem_read</code> et
<code>mem_write</code></li>
<li>Attention à l’alignement (adresses multiples de 4)</li>
</ul>
<hr />
<h2 data-number="7.12" id="aller-plus-loin-le-cpu-pipeline"><span
class="header-section-number">7.12</span> Aller Plus Loin : Le CPU
Pipeline</h2>
<p>Le CPU single-cycle que nous avons construit est simple et
pédagogique. Mais dans le monde réel, il serait <strong>très
lent</strong>. Les vrais processeurs utilisent une technique appelée
<strong>pipeline</strong> pour être beaucoup plus rapides.</p>
<p>Cette section explique en détail ce qu’est un pipeline, pourquoi il
est nécessaire, et comment le construire.</p>
<hr />
<h3 data-number="7.12.1"
id="pourquoi-le-cpu-single-cycle-est-lent"><span
class="header-section-number">7.12.1</span> Pourquoi le CPU Single-Cycle
est Lent</h3>
<h4 data-number="7.12.1.1" id="le-problème-de-la-chaîne-critique"><span
class="header-section-number">7.12.1.1</span> Le problème de la chaîne
critique</h4>
<p>Dans notre CPU single-cycle, une instruction doit traverser
<strong>tous</strong> les composants en un seul cycle :</p>
<figure>
<img src="images/critical-path.svg"
alt="Le problème de la chaîne critique" />
<figcaption aria-hidden="true">Le problème de la chaîne
critique</figcaption>
</figure>
<p>Le cycle d’horloge doit être assez <strong>long</strong> pour que le
signal traverse tout ce chemin. Si chaque étape prend 1 nanoseconde, le
cycle doit faire au minimum 6 ns.</p>
<p><strong>Résultat</strong> : Même si certaines instructions n’ont pas
besoin de la mémoire de données (comme ADD), elles prennent quand même 6
ns.</p>
<h4 data-number="7.12.1.2" id="une-analogie-la-laverie"><span
class="header-section-number">7.12.1.2</span> Une analogie : La
laverie</h4>
<p>Imaginez que vous avez 4 lessives à faire. Chaque lessive a 4 étapes
: laver (30 min), sécher (30 min), plier (30 min), ranger (30 min).</p>
<figure>
<img src="images/laundry-analogy.svg" alt="Analogie de la laverie" />
<figcaption aria-hidden="true">Analogie de la laverie</figcaption>
</figure>
<p>Le pipeline ne rend pas une lessive individuelle plus rapide, mais il
permet de traiter <strong>plus de lessives par heure</strong> !</p>
<hr />
<h3 data-number="7.12.2" id="le-pipeline-à-5-étages"><span
class="header-section-number">7.12.2</span> Le Pipeline à 5 Étages</h3>
<p>Notre CPU pipeliné divise l’exécution en <strong>5 étapes</strong>,
chacune prenant exactement 1 cycle d’horloge :</p>
<figure>
<img src="images/pipeline-5-stages.svg" alt="Pipeline à 5 étages" />
<figcaption aria-hidden="true">Pipeline à 5 étages</figcaption>
</figure>
<h4 data-number="7.12.2.1" id="étape-1-if-instruction-fetch"><span
class="header-section-number">7.12.2.1</span> Étape 1 : IF (Instruction
Fetch)</h4>
<p><strong>But</strong> : Aller chercher l’instruction en mémoire.</p>
<pre><code>┌─────────────────────────────────────────────┐
│  IF - Instruction Fetch                     │
│                                             │
│    PC ────► Mémoire ────► Instruction       │
│    │        Instructions    (32 bits)       │
│    │                                        │
│    └───► PC + 4 (préparé pour la suite)     │
│                                             │
└─────────────────────────────────────────────┘</code></pre>
<p><strong>Ce qui se passe</strong> :</p>
<ol type="1">
<li>Le PC (Program Counter) envoie son adresse à la mémoire</li>
<li>La mémoire renvoie l’instruction (32 bits)</li>
<li>On calcule PC + 4 pour l’instruction suivante</li>
</ol>
<p><strong>Sortie</strong> : L’instruction et PC+4 sont stockés dans le
registre IF/ID.</p>
<h4 data-number="7.12.2.2" id="étape-2-id-instruction-decode"><span
class="header-section-number">7.12.2.2</span> Étape 2 : ID (Instruction
Decode)</h4>
<p><strong>But</strong> : Comprendre l’instruction et lire les registres
sources.</p>
<pre><code>┌─────────────────────────────────────────────┐
│  ID - Instruction Decode                    │
│                                             │
│    Instruction ─┬─► Décodeur ──► Signaux    │
│                 │                de contrôle│
│                 │                           │
│                 └─► Registres ──► Valeurs   │
│                      (Rn, Rm)     (A, B)    │
│                                             │
└─────────────────────────────────────────────┘</code></pre>
<p><strong>Ce qui se passe</strong> :</p>
<ol type="1">
<li>Le décodeur extrait les champs (Rd, Rn, Rm, opcode, etc.)</li>
<li>L’unité de contrôle génère les signaux (reg_write, mem_read,
etc.)</li>
<li>On lit les valeurs des registres Rn et Rm</li>
<li>On détecte les éventuels aléas (hazards)</li>
</ol>
<p><strong>Sortie</strong> : Tout est stocké dans le registre ID/EX.</p>
<h4 data-number="7.12.2.3" id="étape-3-ex-execute"><span
class="header-section-number">7.12.2.3</span> Étape 3 : EX
(Execute)</h4>
<p><strong>But</strong> : Effectuer le calcul.</p>
<pre><code>┌─────────────────────────────────────────────┐
│  EX - Execute                               │
│                                             │
│    Valeur A ──────┐                         │
│                   ├──► ALU ──► Résultat     │
│    Valeur B ──┬───┘            + Flags      │
│    ou Imm    MUX                            │
│                                             │
│    (Pour Branch: calcul de l&#39;adresse cible) │
│                                             │
└─────────────────────────────────────────────┘</code></pre>
<p><strong>Ce qui se passe</strong> :</p>
<ol type="1">
<li>L’ALU effectue l’opération (ADD, SUB, AND, etc.)</li>
<li>Les flags (N, Z, C, V) sont calculés</li>
<li>Pour les branchements, on calcule l’adresse cible</li>
<li>Le forwarding peut injecter des valeurs ici (on verra plus
tard)</li>
</ol>
<p><strong>Sortie</strong> : Le résultat ALU est stocké dans le registre
EX/MEM.</p>
<h4 data-number="7.12.2.4" id="étape-4-mem-memory-access"><span
class="header-section-number">7.12.2.4</span> Étape 4 : MEM (Memory
Access)</h4>
<p><strong>But</strong> : Lire ou écrire en mémoire (pour LDR/STR
seulement).</p>
<pre><code>┌─────────────────────────────────────────────┐
│  MEM - Memory Access                        │
│                                             │
│    Si LDR:  Adresse ──► Mémoire ──► Donnée  │
│                         Données             │
│                                             │
│    Si STR:  Adresse, Donnée ──► Mémoire     │
│                                             │
│    Sinon:   (le résultat ALU passe juste)   │
│                                             │
└─────────────────────────────────────────────┘</code></pre>
<p><strong>Ce qui se passe</strong> :</p>
<ol type="1">
<li>Pour LDR : on lit la mémoire à l’adresse calculée</li>
<li>Pour STR : on écrit la valeur en mémoire</li>
<li>Pour les autres instructions : rien (le résultat ALU est juste
transmis)</li>
</ol>
<p><strong>Sortie</strong> : Le résultat (ALU ou mémoire) est stocké
dans le registre MEM/WB.</p>
<h4 data-number="7.12.2.5" id="étape-5-wb-write-back"><span
class="header-section-number">7.12.2.5</span> Étape 5 : WB (Write
Back)</h4>
<p><strong>But</strong> : Écrire le résultat dans le registre
destination.</p>
<pre><code>┌─────────────────────────────────────────────┐
│  WB - Write Back                            │
│                                             │
│    Résultat ──► MUX ──► Banc de Registres   │
│    (ALU ou MEM)          ↓                  │
│                         Rd                  │
│                                             │
└─────────────────────────────────────────────┘</code></pre>
<p><strong>Ce qui se passe</strong> :</p>
<ol type="1">
<li>On choisit le résultat à écrire (ALU ou mémoire)</li>
<li>Si <code>reg_write = 1</code>, on écrit dans le registre Rd</li>
</ol>
<hr />
<h3 data-number="7.12.3" id="visualisation-du-pipeline-en-action"><span
class="header-section-number">7.12.3</span> Visualisation du Pipeline en
Action</h3>
<p>Voici comment 5 instructions traversent le pipeline :</p>
<figure>
<img src="images/pipeline-timing.svg"
alt="Visualisation du timing du pipeline" />
<figcaption aria-hidden="true">Visualisation du timing du
pipeline</figcaption>
</figure>
<p><strong>Observation clé</strong> : À partir du cycle 5, le pipeline
est “rempli” et on termine <strong>une instruction par cycle</strong>
!</p>
<p><strong>Comparaison des performances</strong> :</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">CPU</th>
<th style="text-align: left;">100 instructions</th>
<th style="text-align: left;">Temps (si cycle = 1ns)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Single-cycle</td>
<td style="text-align: left;">100 cycles</td>
<td style="text-align: left;">100 ns</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pipeline 5 étages</td>
<td style="text-align: left;">104 cycles*</td>
<td style="text-align: left;">104 ns</td>
</tr>
</tbody>
</table>
<p>*Attendez… le pipeline n’est pas plus rapide ?</p>
<p>C’est parce que le cycle du pipeline est <strong>5× plus
court</strong> ! Chaque étage ne fait qu’une partie du travail.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">CPU</th>
<th style="text-align: left;">Durée cycle</th>
<th style="text-align: left;">100 instructions</th>
<th style="text-align: left;">Temps réel</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Single-cycle</td>
<td style="text-align: left;">5 ns</td>
<td style="text-align: left;">100 cycles</td>
<td style="text-align: left;"><strong>500 ns</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;">Pipeline</td>
<td style="text-align: left;">1 ns</td>
<td style="text-align: left;">104 cycles</td>
<td style="text-align: left;"><strong>104 ns</strong></td>
</tr>
</tbody>
</table>
<p>Le pipeline est <strong>~5× plus rapide</strong> !</p>
<hr />
<h3 data-number="7.12.4" id="les-registres-de-pipeline"><span
class="header-section-number">7.12.4</span> Les Registres de
Pipeline</h3>
<p>Pour que le pipeline fonctionne, il faut <strong>stocker</strong> les
résultats intermédiaires entre chaque étage. C’est le rôle des
<strong>registres de pipeline</strong>.</p>
<h4 data-number="7.12.4.1" id="le-registre-ifid"><span
class="header-section-number">7.12.4.1</span> Le registre IF/ID</h4>
<p><strong>Stocke</strong> :</p>
<ul>
<li>L’instruction (32 bits)</li>
<li>PC+4 (32 bits)</li>
</ul>
<p><strong>Signaux spéciaux</strong> :</p>
<ul>
<li><code>stall</code> : Si 1, garder les mêmes valeurs (ne pas
avancer)</li>
<li><code>flush</code> : Si 1, mettre l’instruction à NOP (annuler)</li>
</ul>
<figure>
<img src="images/if-id-register.svg" alt="Registre de pipeline IF/ID" />
<figcaption aria-hidden="true">Registre de pipeline IF/ID</figcaption>
</figure>
<hr />
<h3 data-number="7.12.5" id="les-aléas-hazards"><span
class="header-section-number">7.12.5</span> Les Aléas (Hazards)</h3>
<p>Le pipeline crée de nouveaux problèmes. Quand une instruction dépend
du résultat d’une instruction précédente qui n’est pas encore terminée,
on a un <strong>aléa</strong>.</p>
<h4 data-number="7.12.5.1" id="aléa-de-données-data-hazard"><span
class="header-section-number">7.12.5.1</span> Aléa de Données (Data
Hazard)</h4>
<p><strong>Exemple problématique</strong> :</p>
<pre class="assembly"><code>ADD R1, R2, R3    ; Instruction 1: R1 = R2 + R3
SUB R4, R1, R5    ; Instruction 2: R4 = R1 - R5 (utilise R1!)</code></pre>
<figure>
<img src="images/data-hazard.svg" alt="Aléa de données (Data Hazard)" />
<figcaption aria-hidden="true">Aléa de données (Data
Hazard)</figcaption>
</figure>
<p><strong>Le problème</strong> : SUB lit R1 au cycle 3 (étage ID), mais
ADD n’écrit R1 qu’au cycle 5 (étage WB). SUB va lire
l’<strong>ancienne</strong> valeur de R1 !</p>
<h4 data-number="7.12.5.2" id="solution-1-le-forwarding-bypass"><span
class="header-section-number">7.12.5.2</span> Solution 1 : Le Forwarding
(Bypass)</h4>
<p>Au lieu d’attendre que R1 soit écrit dans le banc de registres, on
peut <strong>transférer</strong> le résultat directement depuis l’étage
EX ou MEM vers l’étage où on en a besoin.</p>
<pre><code>         │ Cycle 1 │ Cycle 2 │ Cycle 3 │ Cycle 4 │ Cycle 5 │
─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
ADD R1   │   IF    │   ID    │   EX ───┼── Résultat disponible!
SUB R4,R1│         │   IF    │   ID    │   EX ←── Forward!
                                            │
                                      (on prend le résultat
                                       directement de ADD)</code></pre>
<p><strong>Le ForwardUnit</strong> détecte ces situations et redirige
les données :</p>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│  ForwardUnit                                                │
│                                                             │
│  Entrées:                                                   │
│    ex_rn, ex_rm  : registres sources de l&#39;instruction en EX │
│    mem_rd        : registre destination en MEM              │
│    mem_reg_write : MEM va écrire un registre?               │
│    wb_rd         : registre destination en WB               │
│    wb_reg_write  : WB va écrire un registre?                │
│                                                             │
│  Logique:                                                   │
│    Si MEM.rd = EX.rn et MEM écrit → forward depuis MEM      │
│    Sinon si WB.rd = EX.rn et WB écrit → forward depuis WB   │
│    Sinon → pas de forwarding                                │
│                                                             │
│  Sorties (2 bits chacune):                                  │
│    forward_a : 00=rien, 01=depuis MEM, 10=depuis WB         │
│    forward_b : 00=rien, 01=depuis MEM, 10=depuis WB         │
│                                                             │
└─────────────────────────────────────────────────────────────┘</code></pre>
<h4 data-number="7.12.5.3" id="solution-2-le-stall-pour-load-use"><span
class="header-section-number">7.12.5.3</span> Solution 2 : Le Stall
(pour Load-Use)</h4>
<p>Le forwarding ne résout pas tous les cas. Considérons :</p>
<pre class="assembly"><code>LDR R1, [R2]      ; Charge R1 depuis la mémoire
ADD R4, R1, R5    ; Utilise R1 immédiatement!</code></pre>
<pre><code>         │ Cycle 1 │ Cycle 2 │ Cycle 3 │ Cycle 4 │ Cycle 5 │
─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
LDR R1   │   IF    │   ID    │   EX    │   MEM ←── R1 disponible ici
ADD R4,R1│         │   IF    │   ID    │   EX ←── Besoin de R1 ici!</code></pre>
<p><strong>Problème</strong> : ADD a besoin de R1 dans son étage EX
(cycle 4), mais LDR ne lit la mémoire qu’à l’étage MEM (aussi cycle 4).
On ne peut pas faire de forwarding vers le passé !</p>
<p><strong>Solution</strong> : Insérer une <strong>bulle</strong>
(stall) pour retarder ADD d’un cycle.</p>
<pre><code>         │ Cycle 1 │ Cycle 2 │ Cycle 3 │ Cycle 4 │ Cycle 5 │ Cycle 6 │
─────────┼─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
LDR R1   │   IF    │   ID    │   EX    │   MEM───┼──►Forward possible!
ADD R4,R1│         │   IF    │   ID    │  STALL  │   EX ←── Forward OK!
Instr 3  │         │         │   IF    │  STALL  │   ID    │   EX    │</code></pre>
<p><strong>Le HazardDetect</strong> détecte ces situations :</p>
<pre><code>┌───────────────────────────────────────────────────────────────┐
│  HazardDetect                                                 │
│                                                               │
│  Entrées:                                                     │
│    id_rn, id_rm    : registres sources en ID                  │
│    id_rn_used      : Rn est utilisé par l&#39;instruction?        │
│    id_rm_used      : Rm est utilisé par l&#39;instruction?        │
│    ex_rd           : registre destination en EX               │
│    ex_mem_read     : instruction en EX est un LDR?            │
│                                                               │
│  Logique:                                                     │
│    Si EX est un load (ex_mem_read = 1)                        │
│    ET ID utilise ce registre (id_rn = ex_rd ou id_rm = ex_rd) │
│    → Déclencher un STALL                                      │
│                                                               │
│  Sortie:                                                      │
│    stall : 1 = bloquer IF et ID, insérer NOP en EX            │
│                                                               │
└───────────────────────────────────────────────────────────────┘</code></pre>
<h4 data-number="7.12.5.4" id="aléa-de-contrôle-control-hazard"><span
class="header-section-number">7.12.5.4</span> Aléa de Contrôle (Control
Hazard)</h4>
<p>Les branchements posent un autre problème :</p>
<pre class="assembly"><code>B.EQ label         ; Si égal, sauter à label
ADD R1, R2, R3    ; Cette instruction est-elle exécutée?
SUB R4, R5, R6    ; Et celle-ci?
label:
MOV R7, #42</code></pre>
<pre><code>         │ Cycle 1 │ Cycle 2 │ Cycle 3 │ Cycle 4 │
─────────┼─────────┼─────────┼─────────┼─────────┤
B.EQ      │   IF    │   ID    │   EX ←── On sait si on branche
ADD      │         │   IF    │   ID    │  ???    │
SUB      │         │         │   IF    │  ???    │</code></pre>
<p><strong>Problème</strong> : Quand on exécute B.EQ, on a déjà commencé
à chercher les instructions suivantes ! Si le branchement est pris, ADD
et SUB n’auraient jamais dû être exécutées.</p>
<p><strong>Solution</strong> : Le <strong>Flush</strong></p>
<p>Si le branchement est pris, on <strong>annule</strong> les
instructions qui n’auraient pas dû être chargées :</p>
<pre><code>         │ Cycle 1 │ Cycle 2 │ Cycle 3 │ Cycle 4 │ Cycle 5 │
─────────┼─────────┼─────────┼─────────┼─────────┼─────────┤
B.EQ      │   IF    │   ID    │   EX    │   MEM   │   WB    │
ADD      │         │   IF    │   ID    │  FLUSH  │         │
SUB      │         │         │   IF    │  FLUSH  │         │
MOV R7   │         │         │         │   IF    │   ID    │...</code></pre>
<p>Le signal <code>flush</code> met les registres de pipeline à NOP
(instruction qui ne fait rien).</p>
<hr />
<h3 data-number="7.12.6"
id="architecture-complète-du-cpu-pipeline"><span
class="header-section-number">7.12.6</span> Architecture Complète du CPU
Pipeline</h3>
<figure>
<img src="images/cpu-pipeline-architecture.svg"
alt="Architecture du CPU Pipeline" />
<figcaption aria-hidden="true">Architecture du CPU Pipeline</figcaption>
</figure>
<hr />
<h3 data-number="7.12.7" id="exercices-pratiques-projet-6"><span
class="header-section-number">7.12.7</span> Exercices Pratiques : Projet
6</h3>
<p>Le <strong>Projet 6 : CPU Pipeline</strong> vous permet de construire
ces composants.</p>
<h4 data-number="7.12.7.1" id="exercice-1-if_id_reg"><span
class="header-section-number">7.12.7.1</span> Exercice 1 :
IF_ID_Reg</h4>
<p><strong>Objectif</strong> : Implémenter le registre de pipeline
IF/ID.</p>
<p><strong>Comportement</strong> :</p>
<ol type="1">
<li>Sur <code>reset='1'</code> OU <code>flush='1'</code> : mettre
l’instruction à NOP (0xE0000000)</li>
<li>Sur <code>stall='1'</code> : garder les valeurs actuelles</li>
<li>Sinon : capturer les nouvelles valeurs</li>
</ol>
<p><strong>Squelette</strong> :</p>
<div class="sourceCode" id="cb85"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="cf">architecture</span> <span class="dv">rtl</span> <span class="kw">of</span> <span class="fu">IF_ID_Reg</span> <span class="kw">is</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="ot">signal</span> instr_reg <span class="ot">:</span> bits(<span class="dv">31</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="ot">signal</span> pc_plus4_reg <span class="ot">:</span> bits(<span class="dv">31</span> <span class="ot">downto</span> <span class="dv">0</span>);</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="cf">begin</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">process</span>(clk)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="sc">begin</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">rising_edge</span>(clk) <span class="cf">then</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (reset <span class="ot">=</span> <span class="bn">&#39;1&#39;</span>) <span class="kw">or</span> (flush <span class="ot">=</span> <span class="bn">&#39;1&#39;</span>) <span class="cf">then</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>        instr_reg <span class="ot">&lt;=</span> x<span class="st">&quot;E0000000&quot;</span>;  <span class="co">-- NOP</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>        pc_plus4_reg <span class="ot">&lt;=</span> x<span class="st">&quot;00000000&quot;</span>;</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">elsif</span> stall <span class="ot">=</span> <span class="bn">&#39;0&#39;</span> <span class="cf">then</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>        instr_reg <span class="ot">&lt;=</span> if_instr;</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>        pc_plus4_reg <span class="ot">&lt;=</span> if_pc_plus4;</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>      <span class="cf">end if;</span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>      <span class="co">-- Si stall=&#39;1&#39;, on ne fait rien (garde les valeurs)</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end if;</span></span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>  <span class="sc">end process;</span></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>  id_instr <span class="ot">&lt;=</span> instr_reg;</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>  id_pc_plus4 <span class="ot">&lt;=</span> pc_plus4_reg;</span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a><span class="cf">end architecture;</span></span></code></pre></div>
<h4 data-number="7.12.7.2" id="exercice-2-hazarddetect"><span
class="header-section-number">7.12.7.2</span> Exercice 2 :
HazardDetect</h4>
<p><strong>Objectif</strong> : Détecter les aléas load-use.</p>
<p><strong>Logique</strong> :</p>
<pre><code>rn_hazard = ex_mem_read AND id_rn_used AND (id_rn = ex_rd)
rm_hazard = ex_mem_read AND id_rm_used AND (id_rm = ex_rd)
stall = rn_hazard OR rm_hazard</code></pre>
<p><strong>En HDL</strong> (attention : pas de <code>when...else</code>,
utiliser la logique booléenne) :</p>
<div class="sourceCode" id="cb87"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="cf">architecture</span> <span class="dv">rtl</span> <span class="kw">of</span> <span class="fu">HazardDetect</span> <span class="kw">is</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="ot">signal</span> rn_hazard <span class="ot">:</span> <span class="dt">bit</span>;</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="ot">signal</span> rm_hazard <span class="ot">:</span> <span class="dt">bit</span>;</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="cf">begin</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  rn_hazard <span class="ot">&lt;=</span> ex_mem_read <span class="kw">and</span> id_rn_used <span class="kw">and</span> (id_rn <span class="ot">=</span> ex_rd);</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  rm_hazard <span class="ot">&lt;=</span> ex_mem_read <span class="kw">and</span> id_rm_used <span class="kw">and</span> (id_rm <span class="ot">=</span> ex_rd);</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  stall <span class="ot">&lt;=</span> rn_hazard <span class="kw">or</span> rm_hazard;</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="cf">end architecture;</span></span></code></pre></div>
<h4 data-number="7.12.7.3" id="exercice-3-forwardunit"><span
class="header-section-number">7.12.7.3</span> Exercice 3 :
ForwardUnit</h4>
<p><strong>Objectif</strong> : Générer les signaux de forwarding.</p>
<p><strong>Encodage</strong> :</p>
<ul>
<li><code>00</code> : Pas de forwarding</li>
<li><code>01</code> : Forward depuis MEM</li>
<li><code>10</code> : Forward depuis WB</li>
</ul>
<p><strong>Logique</strong> :</p>
<pre><code>mem_fwd_a = mem_reg_write AND (mem_rd = ex_rn)
wb_fwd_a = wb_reg_write AND (wb_rd = ex_rn) AND (NOT mem_fwd_a)
forward_a = wb_fwd_a &amp; mem_fwd_a   (concaténation de bits)</code></pre>
<p><strong>En HDL</strong> :</p>
<div class="sourceCode" id="cb89"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="cf">architecture</span> <span class="dv">rtl</span> <span class="kw">of</span> <span class="fu">ForwardUnit</span> <span class="kw">is</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="ot">signal</span> mem_fwd_a<span class="ot">,</span> wb_fwd_a <span class="ot">:</span> <span class="dt">bit</span>;</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="ot">signal</span> mem_fwd_b<span class="ot">,</span> wb_fwd_b <span class="ot">:</span> <span class="dt">bit</span>;</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="cf">begin</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>  mem_fwd_a <span class="ot">&lt;=</span> mem_reg_write <span class="kw">and</span> (mem_rd <span class="ot">=</span> ex_rn);</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>  wb_fwd_a <span class="ot">&lt;=</span> wb_reg_write <span class="kw">and</span> (wb_rd <span class="ot">=</span> ex_rn) <span class="kw">and</span> (<span class="kw">not</span> mem_fwd_a);</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>  mem_fwd_b <span class="ot">&lt;=</span> mem_reg_write <span class="kw">and</span> (mem_rd <span class="ot">=</span> ex_rm);</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>  wb_fwd_b <span class="ot">&lt;=</span> wb_reg_write <span class="kw">and</span> (wb_rd <span class="ot">=</span> ex_rm) <span class="kw">and</span> (<span class="kw">not</span> mem_fwd_b);</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>  forward_a <span class="ot">&lt;=</span> wb_fwd_a <span class="ot">&amp;</span> mem_fwd_a;</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>  forward_b <span class="ot">&lt;=</span> wb_fwd_b <span class="ot">&amp;</span> mem_fwd_b;</span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a><span class="cf">end architecture;</span></span></code></pre></div>
<h4 data-number="7.12.7.4"
id="exercice-4-cpu_pipeline-projet-final"><span
class="header-section-number">7.12.7.4</span> Exercice 4 : CPU_Pipeline
(Projet Final)</h4>
<p>C’est le grand défi ! Assembler tous les composants en un CPU
pipeliné complet.</p>
<p><strong>Conseil</strong> : L’implémentation de référence est dans
<code>hdl_lib/05_cpu/CPU_Pipeline.hdl</code> (~450 lignes).</p>
<hr />
<h3 data-number="7.12.8" id="comment-tester-le-cpu-pipeline-hdl"><span
class="header-section-number">7.12.8</span> Comment Tester le CPU
Pipeline HDL</h3>
<p>Pour tester le CPU Pipeline en HDL, créez un script de test
<code>.tst</code> :</p>
<p><strong>Fichier <code>CPU_Pipeline_test.tst</code> :</strong></p>
<pre><code>-- Test du CPU Pipeline
load CPU_Pipeline.hdl;

-- Charger les composants requis
load IF_ID_Reg.hdl;
load ID_EX_Reg.hdl;
load EX_MEM_Reg.hdl;
load MEM_WB_Reg.hdl;
load HazardDetect.hdl;
load ForwardUnit.hdl;
load Decoder.hdl;
load Control.hdl;
load CondCheck.hdl;
load RegFile16.hdl;
load ALU32.hdl;
load Shifter32.hdl;
load Add32.hdl;
load PC.hdl;
load Mux32.hdl;

-- Initialiser
set reset 1;
tick; tock;
set reset 0;

-- Charger une instruction ADD R1, R0, #5 en mémoire
set instr_data 0x22100005;  -- ADD R1, R0, #5

-- Exécuter plusieurs cycles (5 cycles pour traverser le pipeline)
tick; tock;  -- IF
tick; tock;  -- ID
tick; tock;  -- EX
tick; tock;  -- MEM
tick; tock;  -- WB

-- Vérifier l&#39;état
expect halted 0;</code></pre>
<p><strong>Exécuter le test :</strong></p>
<div class="sourceCode" id="cb91"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> run <span class="at">-p</span> hdl_cli <span class="at">--</span> CPU_Pipeline_test.tst</span></code></pre></div>
<p><strong>Structure des fichiers HDL pour le pipeline :</strong></p>
<pre><code>hdl_lib/05_cpu/
├── CPU_Pipeline.hdl      # CPU complet assemblé
├── IF_ID_Reg.hdl         # Registre pipeline IF→ID
├── ID_EX_Reg.hdl         # Registre pipeline ID→EX
├── EX_MEM_Reg.hdl        # Registre pipeline EX→MEM
├── MEM_WB_Reg.hdl        # Registre pipeline MEM→WB
├── HazardDetect.hdl      # Détection load-use hazards
├── ForwardUnit.hdl       # Bypass/forwarding
├── Decoder.hdl           # Décodage instruction
├── Control.hdl           # Signaux de contrôle
└── CondCheck.hdl         # Vérification conditions</code></pre>
<p><strong>Observer le pipeline en action :</strong></p>
<p>Pour voir les hazards et le forwarding, testez avec des instructions
dépendantes :</p>
<pre><code>-- Test de forwarding (EX→EX)
-- ADD R1, R0, #5     ; R1 = 5
-- ADD R2, R1, #3     ; R2 = R1 + 3 = 8 (forward depuis EX)
set instr_data 0x22100005;  tick; tock;
set instr_data 0x22210003;  tick; tock;
-- Le ForwardUnit détecte que R1 est produit par l&#39;instruction précédente
-- et bypass la valeur directement sans attendre le writeback</code></pre>
<pre><code>-- Test de stall (load-use hazard)
-- LDR R1, [R0]       ; R1 = mem[R0]
-- ADD R2, R1, #3     ; R2 = R1 + 3 (doit attendre le load)
set instr_data 0x51100000;  tick; tock;
set instr_data 0x22210003;  tick; tock;
-- Le HazardDetect insère un stall car le LDR n&#39;a pas encore
-- la valeur disponible au moment où ADD en a besoin</code></pre>
<hr />
<h3 data-number="7.12.9" id="résumé-pipeline-vs-single-cycle"><span
class="header-section-number">7.12.9</span> Résumé : Pipeline vs
Single-Cycle</h3>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 43%" />
<col style="width: 31%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Aspect</th>
<th style="text-align: left;">Single-Cycle</th>
<th style="text-align: left;">Pipeline</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Instructions en
parallèle</strong></td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">Jusqu’à 5</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Throughput</strong></td>
<td style="text-align: left;">1 instr / 5 unités de temps</td>
<td style="text-align: left;">1 instr / 1 unité de temps</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Complexité</strong></td>
<td style="text-align: left;">Simple</td>
<td style="text-align: left;">Plus complexe</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Aléas</strong></td>
<td style="text-align: left;">Aucun</td>
<td style="text-align: left;">Data hazards, Control hazards</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Composants
supplémentaires</strong></td>
<td style="text-align: left;">Aucun</td>
<td style="text-align: left;">Registres pipeline, Hazard Detect, Forward
Unit</td>
</tr>
</tbody>
</table>
<hr />
<h3 data-number="7.12.10" id="pour-aller-encore-plus-loin"><span
class="header-section-number">7.12.10</span> Pour Aller Encore Plus
Loin</h3>
<p>Les vrais processeurs modernes vont bien au-delà :</p>
<ul>
<li><strong>Superscalaire</strong> : Plusieurs pipelines en
parallèle</li>
<li><strong>Exécution dans le désordre</strong> : Réorganiser les
instructions</li>
<li><strong>Prédiction de branchement</strong> : Deviner si un
branchement sera pris</li>
<li><strong>Cache</strong> : Mémoire ultra-rapide proche du CPU</li>
</ul>
<p>Mais ces concepts dépassent le cadre de ce livre. Le pipeline à 5
étages reste la base sur laquelle tout le reste est construit !</p>
<hr />
<h2 data-number="7.13" id="le-lien-avec-la-suite-1"><span
class="header-section-number">7.13</span> Le Lien avec la Suite</h2>
<p><strong>Félicitations !</strong> Vous venez de construire un
ordinateur complet.</p>
<p>Ce CPU que vous avez construit peut maintenant :</p>
<ul>
<li>Exécuter des programmes écrits en assembleur (Chapitre 6)</li>
<li>Exécuter des programmes compilés depuis C32 (Chapitre 7-8)</li>
<li>Faire tourner un système d’exploitation minimal (Chapitre 9)</li>
</ul>
<h3 data-number="7.13.1" id="le-parcours-complet"><span
class="header-section-number">7.13.1</span> Le parcours complet</h3>
<pre><code>Chapitre 1-5 : MATÉRIEL
    NAND → Portes → ALU → Mémoire → CPU
                              ↓
Chapitre 6-9 : LOGICIEL
    Assembleur → Compilateur → Langage C32 → OS</code></pre>
<p>À partir de maintenant, nous passons du côté
<strong>logiciel</strong>. Le matériel est terminé !</p>
<hr />
<h2 data-number="7.14" id="ce-quil-faut-retenir-4"><span
class="header-section-number">7.14</span> Ce qu’il faut retenir</h2>
<ol type="1">
<li><p><strong>Le CPU orchestre tout</strong> : Fetch → Decode → Execute
→ Memory → Writeback</p></li>
<li><p><strong>Le décodeur analyse</strong> : 32 bits → signaux
individuels</p></li>
<li><p><strong>L’unité de contrôle décide</strong> : Quels composants
activer</p></li>
<li><p><strong>Les multiplexeurs routent</strong> : Les données entre
composants</p></li>
<li><p><strong>Les drapeaux permettent les conditions</strong> : NZCV →
CondCheck → ok/pas ok</p></li>
<li><p><strong>Single-cycle = simple</strong> : Tout en un cycle (mais
lent en vrai)</p></li>
</ol>
<p><strong>Prochaine étape</strong> : Au Chapitre 6, nous construirons
l’<strong>Assembleur</strong> — le programme qui traduit le code
assembleur en binaire exécutable par votre CPU.</p>
<hr />
<p><strong>Conseil</strong> : Si vous avez réussi le CPU, vous avez
accompli quelque chose de remarquable. Prenez le temps de savourer :
vous avez construit un ordinateur complet, de la porte NAND au
processeur fonctionnel !</p>
<hr />
<h2 data-number="7.15" id="auto-évaluation-4"><span
class="header-section-number">7.15</span> Auto-évaluation</h2>
<p>Testez votre compréhension avant de passer au chapitre suivant.</p>
<h3 data-number="7.15.1" id="questions-de-compréhension-4"><span
class="header-section-number">7.15.1</span> Questions de
compréhension</h3>
<p><strong>Q1.</strong> Quelles sont les 5 étapes du cycle d’exécution
d’une instruction ?</p>
<p><strong>Q2.</strong> Quel est le rôle du décodeur d’instructions
?</p>
<p><strong>Q3.</strong> Pourquoi les branchements conditionnels
dépendent-ils des drapeaux NZCV ?</p>
<p><strong>Q4.</strong> Dans un CPU pipeline 5 étages, qu’est-ce qu’un
hazard de données ?</p>
<p><strong>Q5.</strong> Quelle est la différence entre un CPU
single-cycle et un CPU pipeliné ?</p>
<h3 data-number="7.15.2" id="mini-défi-pratique-4"><span
class="header-section-number">7.15.2</span> Mini-défi pratique</h3>
<p>Tracez l’exécution de cette instruction dans le CPU :</p>
<div class="sourceCode" id="cb96"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="bu">ADD</span> R1<span class="op">,</span> R2<span class="op">,</span> R3</span></code></pre></div>
<p>Décrivez ce qui se passe à chaque étape (Fetch, Decode, Execute,
Memory, Writeback).</p>
<p><em>Les solutions se trouvent dans le document
<strong>Codex_Solutions</strong>.</em></p>
<h3 data-number="7.15.3" id="checklist-de-validation-4"><span
class="header-section-number">7.15.3</span> Checklist de validation</h3>
<p>Avant de passer au chapitre 6, assurez-vous de pouvoir :</p>
<ul class="task-list">
<li><label><input type="checkbox" />Décrire les 5 étapes d’exécution
d’une instruction</label></li>
<li><label><input type="checkbox" />Expliquer le rôle du décodeur et de
l’unité de contrôle</label></li>
<li><label><input type="checkbox" />Tracer le chemin des données pour
ADD, LDR, et B</label></li>
<li><label><input type="checkbox" />Comprendre pourquoi les MUX sont
essentiels (choix des sources)</label></li>
<li><label><input type="checkbox" />Expliquer le concept de pipeline et
ses avantages</label></li>
</ul>
<h1 data-number="8" id="lassembleur"><span
class="header-section-number">8</span> L’Assembleur</h1>
<blockquote>
<p>“Traduire, c’est trahir ?” — Pas ici.</p>
</blockquote>
<p>Dans les chapitres précédents, nous avons conçu le matériel capable
d’exécuter des instructions 32 bits. Mais écrire un programme en
hexadécimal (comme <code>0xE2801001</code>) est extrêmement pénible et
source d’erreurs.</p>
<p>L’<strong>Assembleur</strong> est l’outil logiciel qui fait le pont
entre le programmeur et la machine. Il traduit un fichier texte
contenant des mnémoniques lisibles (ex: <code>ADD R1, R1, #1</code>) en
un fichier binaire exécutable par le CPU.</p>
<hr />
<h2 data-number="8.1" id="où-en-sommes-nous-5"><span
class="header-section-number">8.1</span> Où en sommes-nous ?</h2>
<figure>
<img src="images/architecture-stack.svg"
alt="Position dans l’architecture" />
<figcaption aria-hidden="true">Position dans l’architecture</figcaption>
</figure>
<p><em>Nous sommes à la Couche 3 : Assembleur - Du texte au
binaire</em></p>
<p>Nous entrons maintenant dans le monde du <strong>logiciel</strong> !
L’assembleur est le premier programme que nous construisons pour notre
machine.</p>
<hr />
<h2 data-number="8.2" id="le-rôle-de-lassembleur"><span
class="header-section-number">8.2</span> Le Rôle de l’Assembleur</h2>
<h3 data-number="8.2.1" id="du-texte-au-binaire"><span
class="header-section-number">8.2.1</span> Du texte au binaire</h3>
<pre><code>                    Assembleur
   Code source  ──────────────►  Code machine
   (texte)                       (binaire)

   ADD R1, R2, #10     →     0xE2821010
   B loop              →     0xEAFFFFFE</code></pre>
<h3 data-number="8.2.2" id="les-trois-tâches-de-lassembleur"><span
class="header-section-number">8.2.2</span> Les trois tâches de
l’assembleur</h3>
<ol type="1">
<li><p><strong>Analyse (Parsing)</strong> : Lire le code source et
comprendre les instructions, les opérandes, les labels.</p></li>
<li><p><strong>Résolution des Symboles</strong> : Transformer les
étiquettes (labels) comme <code>loop:</code> en adresses
numériques.</p></li>
<li><p><strong>Encodage</strong> : Transformer chaque instruction en son
équivalent binaire de 32 bits selon la spécification de l’ISA.</p></li>
</ol>
<hr />
<h2 data-number="8.3" id="la-stratégie-des-deux-passes"><span
class="header-section-number">8.3</span> La Stratégie des Deux
Passes</h2>
<h3 data-number="8.3.1" id="pourquoi-deux-passes"><span
class="header-section-number">8.3.1</span> Pourquoi deux passes ?</h3>
<p>Regardez ce code :</p>
<div class="sourceCode" id="cb98"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>    B suite    <span class="co">; Où est &#39;suite&#39; ? On ne le sait pas encore !</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">1</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="fu">suite:</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">ADD</span> R0<span class="op">,</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">1</span></span></code></pre></div>
<p>À la ligne 1, l’assembleur ne sait pas encore où est
<code>suite</code>. C’est le problème des <strong>références vers
l’avant</strong>.</p>
<h3 data-number="8.3.2"
id="passe-1-construction-de-la-table-des-symboles"><span
class="header-section-number">8.3.2</span> Passe 1 : Construction de la
Table des Symboles</h3>
<p>L’assembleur parcourt le fichier et note l’adresse de chaque label
:</p>
<pre><code>Adresse 0x0000 : B suite           (4 octets)
Adresse 0x0004 : MOV R0, #1        (4 octets)
Adresse 0x0008 : suite:            ← On note : suite = 0x0008
Adresse 0x0008 : ADD R0, R0, #1</code></pre>
<p><strong>Table des symboles</strong> :
<code>{ "suite": 0x00000008 }</code></p>
<h3 data-number="8.3.3" id="passe-2-génération-du-code"><span
class="header-section-number">8.3.3</span> Passe 2 : Génération du
Code</h3>
<p>L’assembleur reparcourt le fichier. Quand il voit
<code>B suite</code>, il regarde dans sa table et génère l’offset
correct.</p>
<pre><code>B suite → offset = (0x0008 - 0x0000 - 8) / 4 = -2 → 0xEAFFFFFE</code></pre>
<hr />
<h2 data-number="8.4" id="sections-et-directives"><span
class="header-section-number">8.4</span> Sections et Directives</h2>
<h3 data-number="8.4.1" id="les-sections"><span
class="header-section-number">8.4.1</span> Les Sections</h3>
<p>Un programme n’est pas fait que d’instructions. Il contient aussi des
données.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Section</th>
<th style="text-align: left;">Contenu</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>.text</code></td>
<td style="text-align: left;">Le code (les instructions) — généralement
en lecture seule</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>.data</code></td>
<td style="text-align: left;">Les variables globales initialisées</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>.bss</code></td>
<td style="text-align: left;">Les variables globales non initialisées
(mises à zéro)</td>
</tr>
</tbody>
</table>
<h3 data-number="8.4.2" id="les-directives"><span
class="header-section-number">8.4.2</span> Les Directives</h3>
<p>Les directives (commençant par <code>.</code>) guident l’assembleur
:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Directive</th>
<th style="text-align: left;">Signification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>.text</code></td>
<td style="text-align: left;">Début de la section code</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>.data</code></td>
<td style="text-align: left;">Début de la section données</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>.global _start</code></td>
<td style="text-align: left;">Exporte le symbole
<code>_start</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>.word 123</code></td>
<td style="text-align: left;">Réserve 4 octets avec la valeur 123</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>.asciz "Hello"</code></td>
<td style="text-align: left;">Chaîne terminée par un zéro</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>.align 2</code></td>
<td style="text-align: left;">Aligne sur un multiple de 4 octets</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>.ltorg</code></td>
<td style="text-align: left;">Force l’émission du literal pool</td>
</tr>
</tbody>
</table>
<hr />
<h2 data-number="8.5" id="exemple-dencodage"><span
class="header-section-number">8.5</span> Exemple d’Encodage</h2>
<p>Comment l’assembleur encode-t-il <code>ADD R1, R2, #10</code> ?</p>
<h3 data-number="8.5.1" id="étape-1-identifier-linstruction"><span
class="header-section-number">8.5.1</span> Étape 1 : Identifier
l’instruction</h3>
<ul>
<li><strong>Mnémonique</strong> : <code>ADD</code> → opcode = 0011</li>
<li><strong>Registres</strong> : Rd = R1, Rn = R2</li>
<li><strong>Immédiat</strong> : #10</li>
</ul>
<h3 data-number="8.5.2" id="étape-2-déterminer-la-classe"><span
class="header-section-number">8.5.2</span> Étape 2 : Déterminer la
classe</h3>
<ul>
<li>Classe <code>001</code> car on utilise un immédiat</li>
</ul>
<h3 data-number="8.5.3" id="étape-3-assembler-les-bits"><span
class="header-section-number">8.5.3</span> Étape 3 : Assembler les
bits</h3>
<pre><code> 31-28  27-25  24-21  20   19-16  15-12  11-0
 Cond   Class   Op    S     Rn     Rd    Imm12
 1110   001    0011   0    0010   0001   000000001010

 = 0xE2821010</code></pre>
<hr />
<h2 data-number="8.6" id="la-gestion-des-grandes-constantes"><span
class="header-section-number">8.6</span> La Gestion des Grandes
Constantes</h2>
<h3 data-number="8.6.1" id="le-problème-1"><span
class="header-section-number">8.6.1</span> Le problème</h3>
<p>Une instruction fait 32 bits. Un immédiat fait 12 bits maximum.
Comment charger <code>0xDEADBEEF</code> (32 bits) dans un registre ?</p>
<h3 data-number="8.6.2" id="la-solution-le-literal-pool"><span
class="header-section-number">8.6.2</span> La solution : Le Literal
Pool</h3>
<p>L’assembleur offre une syntaxe magique :
<code>LDR R0, =0xDEADBEEF</code></p>
<p>Ce n’est <strong>pas</strong> une vraie instruction LDR — c’est une
<strong>pseudo-instruction</strong> que l’assembleur transforme :</p>
<ol type="1">
<li>La valeur <code>0xDEADBEEF</code> est stockée dans le
<strong>literal pool</strong> (une zone de données après le code)</li>
<li>L’instruction est remplacée par <code>LDR R0, [PC, #offset]</code>
qui va chercher la valeur</li>
</ol>
<div class="sourceCode" id="cb102"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co">; Code source</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>    LDR R0<span class="op">,</span> <span class="op">=</span><span class="bn">0xDEADBEEF</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="co">; Ce que l&#39;assembleur génère</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>    LDR R0<span class="op">,</span> <span class="op">[</span>PC<span class="op">,</span> <span class="op">#</span><span class="dv">8</span><span class="op">]</span>    <span class="co">; Va chercher la valeur 8 octets plus loin</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="fu">literal_pool:</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>    .<span class="dt">word</span> <span class="bn">0xDEADBEEF</span>    <span class="co">; La valeur est stockée ici</span></span></code></pre></div>
<hr />
<h2 data-number="8.7" id="exercices-pratiques-5"><span
class="header-section-number">8.7</span> Exercices Pratiques</h2>
<h3 data-number="8.7.1" id="exercices-sur-le-simulateur-web-5"><span
class="header-section-number">8.7.1</span> Exercices sur le Simulateur
Web</h3>
<p>Tous les exercices de la section <strong>A32 Assembly</strong> du
simulateur web vous font pratiquer l’écriture d’assembleur. L’assembleur
intégré traduit votre code en binaire automatiquement.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Catégorie</th>
<th style="text-align: left;">Exercices</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Basique</td>
<td style="text-align: left;">Hello World, Addition, Soustraction,
Logique</td>
</tr>
<tr class="even">
<td style="text-align: left;">Contrôle</td>
<td style="text-align: left;">Conditions, Boucles, Multiplication,
Fibonacci</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mémoire</td>
<td style="text-align: left;">Tableaux, Maximum Tableau, Fonctions</td>
</tr>
<tr class="even">
<td style="text-align: left;">Graphique</td>
<td style="text-align: left;">Pixel, Ligne, Rectangle, Damier</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Avancé</td>
<td style="text-align: left;">Recherche Dichotomique, Dégradé</td>
</tr>
</tbody>
</table>
<h3 data-number="8.7.2" id="exercice-manuel-encodage"><span
class="header-section-number">8.7.2</span> Exercice manuel :
Encodage</h3>
<p>Traduisez ces instructions en binaire (32 bits) :</p>
<ol type="1">
<li><code>MOV R0, #5</code></li>
<li><code>SUB R1, R1, #1</code></li>
<li><code>B -2</code> (saut de 2 instructions en arrière)</li>
</ol>
<h3 data-number="8.7.3" id="exercice-table-des-symboles"><span
class="header-section-number">8.7.3</span> Exercice : Table des
symboles</h3>
<p>Calculez l’adresse de chaque label :</p>
<div class="sourceCode" id="cb103"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>.text</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">start:</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">0</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="fu">loop:</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">CMP</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">10</span></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>    B<span class="op">.</span>EQ end</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">ADD</span> R0<span class="op">,</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">1</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>    B loop</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="fu">end:</span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>    HALT</span></code></pre></div>
<h3 data-number="8.7.4" id="utilisation-de-loutil-cli"><span
class="header-section-number">8.7.4</span> Utilisation de l’outil
CLI</h3>
<div class="sourceCode" id="cb104"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assembler un fichier</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> run <span class="at">-p</span> a32_cli <span class="at">--</span> assemble mon_prog.s <span class="at">-o</span> mon_prog.bin</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Examiner le binaire généré</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hexdump</span> <span class="at">-C</span> mon_prog.bin</span></code></pre></div>
<hr />
<h2 data-number="8.8" id="ce-quil-faut-retenir-5"><span
class="header-section-number">8.8</span> Ce qu’il faut retenir</h2>
<ol type="1">
<li><p><strong>L’assembleur traduit</strong> : Texte lisible → Binaire
exécutable</p></li>
<li><p><strong>Deux passes</strong> : D’abord collecter les symboles,
puis générer le code</p></li>
<li><p><strong>Les directives organisent</strong> : <code>.text</code>,
<code>.data</code>, <code>.word</code>, <code>.asciz</code></p></li>
<li><p><strong>Le literal pool résout</strong> : Les constantes 32 bits
via <code>LDR R0, =value</code></p></li>
<li><p><strong>Un symbole = une adresse</strong> : Les labels deviennent
des nombres</p></li>
</ol>
<p><strong>Prochaine étape</strong> : Au Chapitre 7, nous construirons
un <strong>Compilateur</strong> qui traduit du code C32 en assembleur.
C’est l’étape suivante vers l’abstraction !</p>
<hr />
<p><strong>Conseil</strong> : Faites beaucoup d’exercices en assembleur.
Plus vous serez à l’aise avec l’assembleur, mieux vous comprendrez ce
que fait le compilateur.</p>
<hr />
<h2 data-number="8.9" id="auto-évaluation-5"><span
class="header-section-number">8.9</span> Auto-évaluation</h2>
<p>Testez votre compréhension avant de passer au chapitre suivant.</p>
<h3 data-number="8.9.1" id="questions-de-compréhension-5"><span
class="header-section-number">8.9.1</span> Questions de
compréhension</h3>
<p><strong>Q1.</strong> Pourquoi l’assembleur fait-il deux passes sur le
code source ?</p>
<p><strong>Q2.</strong> Quelle est la différence entre
<code>.text</code> et <code>.data</code> ?</p>
<p><strong>Q3.</strong> Comment l’assembleur gère-t-il
<code>LDR R0, =0xDEADBEEF</code> ?</p>
<p><strong>Q4.</strong> Que se passe-t-il si un branchement est trop
loin (offset &gt; 24 bits) ?</p>
<p><strong>Q5.</strong> Qu’est-ce qu’un fichier binaire A32B contient
exactement ?</p>
<h3 data-number="8.9.2" id="mini-défi-pratique-5"><span
class="header-section-number">8.9.2</span> Mini-défi pratique</h3>
<p>Encodez manuellement cette instruction en binaire 32 bits :</p>
<div class="sourceCode" id="cb105"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="bu">ADD</span> R1<span class="op">,</span> R2<span class="op">,</span> R3</span></code></pre></div>
<p>Indice : Format ALU registre =
<code>[cond:4][000][opcode:4][S][Rn:4][Rd:4][00000000][Rm:4]</code></p>
<p><em>Les solutions se trouvent dans le document
<strong>Codex_Solutions</strong>.</em></p>
<h3 data-number="8.9.3" id="checklist-de-validation-5"><span
class="header-section-number">8.9.3</span> Checklist de validation</h3>
<p>Avant de passer au chapitre 7, assurez-vous de pouvoir :</p>
<ul class="task-list">
<li><label><input type="checkbox" />Expliquer le rôle des deux passes de
l’assembleur</label></li>
<li><label><input type="checkbox" />Utiliser les directives
<code>.text</code>, <code>.data</code>, <code>.word</code>,
<code>.asciz</code></label></li>
<li><label><input type="checkbox" />Comprendre le fonctionnement du
literal pool</label></li>
<li><label><input type="checkbox" />Encoder une instruction simple à la
main (format binaire)</label></li>
<li><label><input type="checkbox" />Lire et interpréter un hexdump de
fichier binaire</label></li>
</ul>
<h1 data-number="9" id="construction-du-compilateur"><span
class="header-section-number">9</span> Construction du Compilateur</h1>
<blockquote>
<p>“Pour comprendre la récursivité, il faut d’abord comprendre la
récursivité.”</p>
</blockquote>
<p>Dans ce chapitre, nous allons construire le <strong>pont</strong>
entre le langage de haut niveau (C32) et l’assembleur (A32). Le
compilateur est l’outil qui permet aux humains d’écrire du code lisible
tout en profitant de la vitesse du code machine.</p>
<hr />
<h2 data-number="9.1" id="où-en-sommes-nous-6"><span
class="header-section-number">9.1</span> Où en sommes-nous ?</h2>
<figure>
<img src="images/architecture-stack.svg"
alt="Position dans l’architecture" />
<figcaption aria-hidden="true">Position dans l’architecture</figcaption>
</figure>
<p><em>Nous sommes à la Couche 4 : Compilateur - Transforme C32 en
Assembleur A32</em></p>
<p>Le compilateur est le <strong>traducteur automatique</strong> qui
transforme du code lisible par les humains en code exécutable par la
machine.</p>
<hr />
<h2 data-number="9.2" id="le-rôle-du-compilateur"><span
class="header-section-number">9.2</span> Le Rôle du Compilateur</h2>
<h3 data-number="9.2.1" id="pourquoi-un-compilateur"><span
class="header-section-number">9.2.1</span> Pourquoi un compilateur
?</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Assembleur</th>
<th style="text-align: left;">C32 (haut niveau)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>ADD R0, R0, #1</code></td>
<td style="text-align: left;"><code>x = x + 1;</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">Gestion manuelle des registres</td>
<td style="text-align: left;">Variables nommées</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sauts et labels</td>
<td style="text-align: left;"><code>if</code>, <code>while</code>,
<code>for</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">Appels manuels avec conventions</td>
<td style="text-align: left;"><code>return fonction();</code></td>
</tr>
</tbody>
</table>
<p>Le compilateur traduit le second en premier, automatiquement.</p>
<h3 data-number="9.2.2" id="les-étapes-de-compilation"><span
class="header-section-number">9.2.2</span> Les étapes de
compilation</h3>
<pre><code>Code C32          Analyse           Génération
  (texte)    →    (AST)      →     Assembleur
                                       │
                                       ▼
                                    Binaire</code></pre>
<ol type="1">
<li><strong>Analyse lexicale</strong> : Découpe le texte en tokens
(<code>int</code>, <code>x</code>, <code>=</code>, <code>5</code>,
<code>;</code>)</li>
<li><strong>Analyse syntaxique</strong> : Construit un arbre (AST)
représentant la structure</li>
<li><strong>Analyse sémantique</strong> : Vérifie les types, les
portées, etc.</li>
<li><strong>Génération de code</strong> : Produit l’assembleur
équivalent</li>
</ol>
<hr />
<h2 data-number="9.3" id="les-phases-du-compilateur"><span
class="header-section-number">9.3</span> Les Phases du Compilateur</h2>
<h3 data-number="9.3.1" id="phase-1-lexer-analyse-lexicale"><span
class="header-section-number">9.3.1</span> Phase 1 : Lexer (Analyse
Lexicale)</h3>
<p>Le lexer transforme le flux de caractères en tokens :</p>
<div class="sourceCode" id="cb107"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span></code></pre></div>
<p>Devient :</p>
<pre><code>[INT] [ID:&quot;x&quot;] [EQUAL] [NUMBER:5] [SEMICOLON]</code></pre>
<h3 data-number="9.3.2" id="phase-2-parser-analyse-syntaxique"><span
class="header-section-number">9.3.2</span> Phase 2 : Parser (Analyse
Syntaxique)</h3>
<p>Le parser construit un <strong>AST</strong> (Abstract Syntax Tree)
:</p>
<pre><code>           Declaration
              /    \
           Type    Assignment
            |        /    \
          &quot;int&quot;  &quot;x&quot;    Number
                         |
                         5</code></pre>
<h3 data-number="9.3.3" id="phase-3-génération-de-code"><span
class="header-section-number">9.3.3</span> Phase 3 : Génération de
Code</h3>
<p>Le générateur parcourt l’AST et produit l’assembleur :</p>
<div class="sourceCode" id="cb110"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co">; int x = 5;</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">5</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="bu">STR</span> R0<span class="op">,</span> <span class="op">[</span><span class="kw">SP</span><span class="op">,</span> <span class="op">#-</span><span class="dv">4</span><span class="op">]!</span>   <span class="co">; Push x sur la pile</span></span></code></pre></div>
<hr />
<h2 data-number="9.4" id="compilation-des-structures-de-contrôle"><span
class="header-section-number">9.4</span> Compilation des Structures de
Contrôle</h2>
<h3 data-number="9.4.1" id="variables-locales"><span
class="header-section-number">9.4.1</span> Variables locales</h3>
<p>Les variables locales vivent sur la <strong>pile</strong> :</p>
<div class="sourceCode" id="cb111"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> b <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span></code></pre></div>
<div class="sourceCode" id="cb112"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co">; Prologue</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="bu">SUB</span> <span class="kw">SP</span><span class="op">,</span> <span class="kw">SP</span><span class="op">,</span> <span class="op">#</span><span class="dv">8</span>       <span class="co">; Réserve 8 octets pour a et b</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="co">; a = 10</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">10</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="bu">STR</span> R0<span class="op">,</span> <span class="op">[</span><span class="kw">SP</span><span class="op">,</span> <span class="op">#</span><span class="dv">4</span><span class="op">]</span>     <span class="co">; a est à SP+4</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="co">; b = 20</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">20</span></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a><span class="bu">STR</span> R0<span class="op">,</span> <span class="op">[</span><span class="kw">SP</span><span class="op">,</span> <span class="op">#</span><span class="dv">0</span><span class="op">]</span>     <span class="co">; b est à SP+0</span></span></code></pre></div>
<h3 data-number="9.4.2" id="expressions"><span
class="header-section-number">9.4.2</span> Expressions</h3>
<p>Pour <code>a + b * 2</code> :</p>
<div class="sourceCode" id="cb113"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co">; Évaluation de b * 2</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>LDR R0<span class="op">,</span> <span class="op">[</span><span class="kw">SP</span><span class="op">,</span> <span class="op">#</span><span class="dv">0</span><span class="op">]</span>     <span class="co">; R0 = b</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span> R1<span class="op">,</span> <span class="op">#</span><span class="dv">2</span></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="bu">MUL</span> R0<span class="op">,</span> R0<span class="op">,</span> R1       <span class="co">; R0 = b * 2</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="co">; Évaluation de a + (b * 2)</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>LDR R1<span class="op">,</span> <span class="op">[</span><span class="kw">SP</span><span class="op">,</span> <span class="op">#</span><span class="dv">4</span><span class="op">]</span>     <span class="co">; R1 = a</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="bu">ADD</span> R0<span class="op">,</span> R1<span class="op">,</span> R0       <span class="co">; R0 = a + b*2</span></span></code></pre></div>
<h3 data-number="9.4.3" id="if-else"><span
class="header-section-number">9.4.3</span> If / Else</h3>
<div class="sourceCode" id="cb114"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>x <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb115"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>    LDR R0<span class="op">,</span> <span class="op">[</span><span class="kw">SP</span><span class="op">,</span> <span class="op">#</span>x_offset<span class="op">]</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">CMP</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">0</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>    B<span class="op">.</span>LE else_label</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Then branch</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">1</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">STR</span> R0<span class="op">,</span> <span class="op">[</span><span class="kw">SP</span><span class="op">,</span> <span class="op">#</span>y_offset<span class="op">]</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>    B endif_label</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a><span class="fu">else_label:</span></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Else branch</span></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">0</span></span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">STR</span> R0<span class="op">,</span> <span class="op">[</span><span class="kw">SP</span><span class="op">,</span> <span class="op">#</span>y_offset<span class="op">]</span></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a><span class="fu">endif_label:</span></span></code></pre></div>
<h3 data-number="9.4.4" id="boucle-while"><span
class="header-section-number">9.4.4</span> Boucle While</h3>
<div class="sourceCode" id="cb116"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb117"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">while_start:</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>    LDR R0<span class="op">,</span> <span class="op">[</span><span class="kw">SP</span><span class="op">,</span> <span class="op">#</span>i_offset<span class="op">]</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">CMP</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">10</span></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>    B<span class="op">.</span>GE while_end</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Corps de la boucle</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">ADD</span> R0<span class="op">,</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">1</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">STR</span> R0<span class="op">,</span> <span class="op">[</span><span class="kw">SP</span><span class="op">,</span> <span class="op">#</span>i_offset<span class="op">]</span></span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>    B while_start</span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a><span class="fu">while_end:</span></span></code></pre></div>
<h3 data-number="9.4.5" id="boucle-for"><span
class="header-section-number">9.4.5</span> Boucle For</h3>
<p><code>for (init; cond; incr) { body }</code> est équivalent à :</p>
<div class="sourceCode" id="cb118"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>init<span class="op">;</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>cond<span class="op">)</span> <span class="op">{</span></span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>    body<span class="op">;</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>    incr<span class="op">;</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h2 data-number="9.5" id="compilation-des-fonctions"><span
class="header-section-number">9.5</span> Compilation des Fonctions</h2>
<h3 data-number="9.5.1" id="convention-dappel"><span
class="header-section-number">9.5.1</span> Convention d’appel</h3>
<p>Comment passe-t-on les arguments ? Comment retourne-t-on une valeur
?</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Registre</th>
<th style="text-align: left;">Rôle</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">R0-R3</td>
<td style="text-align: left;">Arguments 1-4, valeur de retour en R0</td>
</tr>
<tr class="even">
<td style="text-align: left;">R4-R11</td>
<td style="text-align: left;">Sauvegardés par l’appelé
(callee-saved)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">R13 (SP)</td>
<td style="text-align: left;">Pointeur de pile</td>
</tr>
<tr class="even">
<td style="text-align: left;">R14 (LR)</td>
<td style="text-align: left;">Adresse de retour</td>
</tr>
</tbody>
</table>
<h3 data-number="9.5.2" id="prologue-et-épilogue"><span
class="header-section-number">9.5.2</span> Prologue et Épilogue</h3>
<div class="sourceCode" id="cb119"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb120"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">add:</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Prologue</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">SUB</span> <span class="kw">SP</span><span class="op">,</span> <span class="kw">SP</span><span class="op">,</span> <span class="op">#</span><span class="dv">4</span>       <span class="co">; Place pour LR</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">STR</span> LR<span class="op">,</span> <span class="op">[</span><span class="kw">SP</span><span class="op">]</span>         <span class="co">; Sauvegarde LR</span></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Corps : a est dans R0, b dans R1</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">ADD</span> R0<span class="op">,</span> R0<span class="op">,</span> R1       <span class="co">; Résultat dans R0</span></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Épilogue</span></span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>    LDR LR<span class="op">,</span> <span class="op">[</span><span class="kw">SP</span><span class="op">]</span>         <span class="co">; Restaure LR</span></span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">ADD</span> <span class="kw">SP</span><span class="op">,</span> <span class="kw">SP</span><span class="op">,</span> <span class="op">#</span><span class="dv">4</span></span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> PC<span class="op">,</span> LR           <span class="co">; Retour</span></span></code></pre></div>
<h3 data-number="9.5.3" id="appel-de-fonction"><span
class="header-section-number">9.5.3</span> Appel de fonction</h3>
<div class="sourceCode" id="cb121"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> add<span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span></code></pre></div>
<div class="sourceCode" id="cb122"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">5</span>           <span class="co">; Premier argument</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> R1<span class="op">,</span> <span class="op">#</span><span class="dv">3</span>           <span class="co">; Deuxième argument</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>    BL add               <span class="co">; Appel (sauve PC+4 dans LR)</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">STR</span> R0<span class="op">,</span> <span class="op">[</span><span class="kw">SP</span><span class="op">,</span> <span class="op">#</span>result_offset<span class="op">]</span>  <span class="co">; Sauve le résultat</span></span></code></pre></div>
<hr />
<h2 data-number="9.6" id="le-compilateur-c32"><span
class="header-section-number">9.6</span> Le Compilateur C32</h2>
<p>Le compilateur C32 du projet Codex (<code>c32_cli</code>) implémente
toutes ces transformations.</p>
<h3 data-number="9.6.1" id="utilisation"><span
class="header-section-number">9.6.1</span> Utilisation</h3>
<div class="sourceCode" id="cb123"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compiler un fichier C32 en assembleur</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> run <span class="at">-p</span> c32_cli <span class="at">--</span> mon_fichier.c <span class="at">-o</span> mon_fichier.s</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Compiler directement en binaire</span></span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> run <span class="at">-p</span> c32_cli <span class="at">--</span> mon_fichier.c <span class="at">-o</span> mon_fichier.bin</span></code></pre></div>
<h3 data-number="9.6.2" id="exemple-complet"><span
class="header-section-number">9.6.2</span> Exemple complet</h3>
<div class="sourceCode" id="cb124"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="co">// fibonacci.c</span></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> fib<span class="op">(</span><span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&lt;=</span> <span class="dv">1</span><span class="op">)</span> <span class="cf">return</span> n<span class="op">;</span></span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fib<span class="op">(</span>n<span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">+</span> fib<span class="op">(</span>n<span class="op">-</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fib<span class="op">(</span><span class="dv">10</span><span class="op">);</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Produit de l’assembleur avec : - Gestion automatique de la pile -
Appels récursifs - Sauvegarde/restauration des registres</p>
<hr />
<h2 data-number="9.7" id="du-code-c32-à-lexécution-trace-complète"><span
class="header-section-number">9.7</span> Du Code C32 à l’Exécution :
Trace Complète</h2>
<p>Suivons pas à pas le voyage d’un programme simple à travers toutes
les couches.</p>
<h3 data-number="9.7.1" id="le-programme-c32"><span
class="header-section-number">9.7.1</span> Le Programme C32</h3>
<div class="sourceCode" id="cb125"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co">// simple.c</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> square<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">*</span> x<span class="op">;</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> square<span class="op">(</span>n<span class="op">);</span></span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="9.7.2" id="étape-1-analyse-lexicale-lexer"><span
class="header-section-number">9.7.2</span> Étape 1 : Analyse Lexicale
(Lexer)</h3>
<p>Le lexer découpe le texte en tokens :</p>
<pre><code>int      → [KEYWORD: int]
square   → [IDENTIFIER: &quot;square&quot;]
(        → [LPAREN]
int      → [KEYWORD: int]
x        → [IDENTIFIER: &quot;x&quot;]
)        → [RPAREN]
{        → [LBRACE]
return   → [KEYWORD: return]
x        → [IDENTIFIER: &quot;x&quot;]
*        → [STAR]
x        → [IDENTIFIER: &quot;x&quot;]
;        → [SEMICOLON]
}        → [RBRACE]
...</code></pre>
<h3 data-number="9.7.3" id="étape-2-analyse-syntaxique-parser"><span
class="header-section-number">9.7.3</span> Étape 2 : Analyse Syntaxique
(Parser)</h3>
<p>Le parser construit un AST (Abstract Syntax Tree) :</p>
<pre><code>Program
├── Function: square(x: int) -&gt; int
│   └── Return
│       └── BinaryOp: *
│           ├── Var: x
│           └── Var: x
│
└── Function: main() -&gt; int
    └── Block
        ├── VarDecl: n = 5
        └── Return
            └── Call: square
                └── Var: n</code></pre>
<h3 data-number="9.7.4"
id="étape-3-génération-de-code-assembleur-a32"><span
class="header-section-number">9.7.4</span> Étape 3 : Génération de Code
(Assembleur A32)</h3>
<p>Le générateur parcourt l’AST et produit :</p>
<div class="sourceCode" id="cb128"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co">; ==========================================</span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="co">; Fonction: square(x)</span></span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="co">; Paramètre x dans R0</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="co">; ==========================================</span></span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="fu">square:</span></span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Prologue (sauvegarde du contexte)</span></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">PUSH</span> <span class="op">{</span>LR<span class="op">}</span>               <span class="co">; Sauver adresse de retour</span></span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Corps: return x * x</span></span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">; x est déjà dans R0</span></span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MUL</span> R0<span class="op">,</span> R0<span class="op">,</span> R0          <span class="co">; R0 = x * x</span></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Épilogue (restauration et retour)</span></span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">POP</span> <span class="op">{</span>LR<span class="op">}</span>                <span class="co">; Restaurer LR</span></span>
<span id="cb128-15"><a href="#cb128-15" aria-hidden="true" tabindex="-1"></a>    BX LR                   <span class="co">; Retour (résultat dans R0)</span></span>
<span id="cb128-16"><a href="#cb128-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-17"><a href="#cb128-17" aria-hidden="true" tabindex="-1"></a><span class="co">; ==========================================</span></span>
<span id="cb128-18"><a href="#cb128-18" aria-hidden="true" tabindex="-1"></a><span class="co">; Fonction: main()</span></span>
<span id="cb128-19"><a href="#cb128-19" aria-hidden="true" tabindex="-1"></a><span class="co">; ==========================================</span></span>
<span id="cb128-20"><a href="#cb128-20" aria-hidden="true" tabindex="-1"></a><span class="fu">main:</span></span>
<span id="cb128-21"><a href="#cb128-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Prologue</span></span>
<span id="cb128-22"><a href="#cb128-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">PUSH</span> <span class="op">{</span>R4<span class="op">,</span> LR<span class="op">}</span>           <span class="co">; Sauver R4 et LR</span></span>
<span id="cb128-23"><a href="#cb128-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">SUB</span> <span class="kw">SP</span><span class="op">,</span> <span class="kw">SP</span><span class="op">,</span> <span class="op">#</span><span class="dv">4</span>          <span class="co">; Réserver 4 octets pour n</span></span>
<span id="cb128-24"><a href="#cb128-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-25"><a href="#cb128-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">; int n = 5</span></span>
<span id="cb128-26"><a href="#cb128-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> R4<span class="op">,</span> <span class="op">#</span><span class="dv">5</span>              <span class="co">; R4 = 5 (utilise R4 car callee-saved)</span></span>
<span id="cb128-27"><a href="#cb128-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">STR</span> R4<span class="op">,</span> <span class="op">[</span><span class="kw">SP</span><span class="op">,</span> <span class="op">#</span><span class="dv">0</span><span class="op">]</span>        <span class="co">; n = 5 (sur la pile)</span></span>
<span id="cb128-28"><a href="#cb128-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-29"><a href="#cb128-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">; return square(n)</span></span>
<span id="cb128-30"><a href="#cb128-30" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> R0<span class="op">,</span> R4              <span class="co">; Argument: R0 = n</span></span>
<span id="cb128-31"><a href="#cb128-31" aria-hidden="true" tabindex="-1"></a>    BL square               <span class="co">; Appel de square</span></span>
<span id="cb128-32"><a href="#cb128-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-33"><a href="#cb128-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Épilogue</span></span>
<span id="cb128-34"><a href="#cb128-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">ADD</span> <span class="kw">SP</span><span class="op">,</span> <span class="kw">SP</span><span class="op">,</span> <span class="op">#</span><span class="dv">4</span>          <span class="co">; Libérer la pile</span></span>
<span id="cb128-35"><a href="#cb128-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">POP</span> <span class="op">{</span>R4<span class="op">,</span> LR<span class="op">}</span>            <span class="co">; Restaurer R4 et LR</span></span>
<span id="cb128-36"><a href="#cb128-36" aria-hidden="true" tabindex="-1"></a>    BX LR                   <span class="co">; Retour (R0 contient 25)</span></span></code></pre></div>
<h3 data-number="9.7.5" id="étape-4-assemblage-binaire"><span
class="header-section-number">9.7.5</span> Étape 4 : Assemblage
(Binaire)</h3>
<p>L’assembleur traduit chaque instruction en code machine 32 bits :</p>
<pre><code>Adresse   Binaire (hex)  Instruction           Encodage
--------  -------------  --------------------  --------------------------
0x0000    E92D4000       PUSH {LR}             Cond=E, opcode=92D, Rn=D(SP)
0x0004    E0000090       MUL R0, R0, R0        Cond=E, Rm=R0, Rs=R0, Rd=R0
0x0008    E8BD4000       POP {LR}              Cond=E, opcode=8BD, Rn=D
0x000C    E12FFF1E       BX LR                 Cond=E, opcode=12FFF1, Rm=E

0x0010    E92D4010       PUSH {R4, LR}         Reglist = R4 + LR
0x0014    E24DD004       SUB SP, SP, #4        Imm = 4
0x0018    E3A04005       MOV R4, #5            Imm = 5
0x001C    E58D4000       STR R4, [SP, #0]      Offset = 0
0x0020    E1A00004       MOV R0, R4            Rm = R4
0x0024    EBFFFFF5       BL square             Offset = -11 (vers 0x0000)
0x0028    E28DD004       ADD SP, SP, #4        Imm = 4
0x002C    E8BD4010       POP {R4, LR}          Reglist = R4 + LR
0x0030    E12FFF1E       BX LR                 Retour</code></pre>
<h3 data-number="9.7.6" id="étape-5-exécution-cycle-par-cycle"><span
class="header-section-number">9.7.6</span> Étape 5 : Exécution (Cycle
par Cycle)</h3>
<p>Trace d’exécution sur le CPU (simplifié) :</p>
<pre><code>┌─────────────────────────────────────────────────────────────────┐
│                    EXÉCUTION PAS À PAS                          │
├─────────┬──────────────────────┬────────────────────────────────┤
│ Cycle   │ PC / Instruction     │ État après exécution           │
├─────────┼──────────────────────┼────────────────────────────────┤
│    1    │ 0x0010 PUSH {R4,LR}  │ SP=0xFFF8, Mem[SP]=LR, R4     │
│    2    │ 0x0014 SUB SP,SP,#4  │ SP=0xFFF4                      │
│    3    │ 0x0018 MOV R4,#5     │ R4=5                           │
│    4    │ 0x001C STR R4,[SP]   │ Mem[0xFFF4]=5 (n=5)           │
│    5    │ 0x0020 MOV R0,R4     │ R0=5 (argument pour square)    │
│    6    │ 0x0024 BL square     │ LR=0x0028, PC=0x0000           │
│         │                      │ ─── Entrée dans square ───     │
│    7    │ 0x0000 PUSH {LR}     │ SP=0xFFF0, Mem[SP]=0x0028     │
│    8    │ 0x0004 MUL R0,R0,R0  │ R0=5*5=25                      │
│    9    │ 0x0008 POP {LR}      │ LR=0x0028, SP=0xFFF4          │
│   10    │ 0x000C BX LR         │ PC=0x0028                      │
│         │                      │ ─── Retour dans main ───       │
│   11    │ 0x0028 ADD SP,SP,#4  │ SP=0xFFF8                      │
│   12    │ 0x002C POP {R4,LR}   │ R4 et LR restaurés, SP=0x10000│
│   13    │ 0x0030 BX LR         │ Retour au système avec R0=25  │
└─────────┴──────────────────────┴────────────────────────────────┘

Résultat final : R0 = 25 (square(5) = 5 * 5 = 25)</code></pre>
<h3 data-number="9.7.7" id="visualisation-de-la-pile"><span
class="header-section-number">9.7.7</span> Visualisation de la Pile</h3>
<pre><code>Adresse    Avant main    Après PUSH    Après SUB     Pendant square
           (SP=0x10000)  (SP=0xFFF8)   (SP=0xFFF4)   (SP=0xFFF0)
────────── ────────────  ────────────  ────────────  ────────────
0x10000    [libre]       [libre]       [libre]       [libre]
0x0FFFC                  LR (retour)   LR (retour)   LR (retour)
0x0FFF8                  R4 (sauvé)    R4 (sauvé)    R4 (sauvé)
0x0FFF4                                n = 5         n = 5
0x0FFF0                                              LR = 0x0028
           ↑ SP          ↑ SP          ↑ SP          ↑ SP</code></pre>
<h3 data-number="9.7.8" id="ce-qui-se-passe-dans-le-hardware"><span
class="header-section-number">9.7.8</span> Ce qui se passe dans le
Hardware</h3>
<p>À chaque cycle, le CPU effectue le cycle Fetch-Decode-Execute :</p>
<pre><code>Cycle 8 : MUL R0, R0, R0
──────────────────────────────────────────────────────────────

1. FETCH : PC=0x0004 → Instruction Register = 0xE0000090
           PC = PC + 4 (préparation instruction suivante)

2. DECODE : Opcode = MUL
            Rd = R0 (destination)
            Rm = R0 (premier opérande)
            Rs = R0 (second opérande)
            → Activer le multiplicateur de l&#39;ALU

3. EXECUTE :
   ┌────────────────────────────────────────────┐
   │                   ALU                       │
   │                                             │
   │   R0 (5) ───────┐                          │
   │                 │   ┌──────────┐           │
   │                 ├──→│    ×     │──→ 25     │
   │                 │   └──────────┘           │
   │   R0 (5) ───────┘                          │
   │                                             │
   └────────────────────────────────────────────┘

4. WRITE BACK : R0 = 25</code></pre>
<h3 data-number="9.7.9" id="résumé-du-voyage"><span
class="header-section-number">9.7.9</span> Résumé du Voyage</h3>
<pre><code>┌─────────────────────────────────────────────────────────────────┐
│                 DU SOURCE À L&#39;EXÉCUTION                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  C32           &quot;return x * x;&quot;                                  │
│    │                                                             │
│    │ Lexer                                                       │
│    ▼                                                             │
│  Tokens       [RETURN] [ID:x] [STAR] [ID:x] [SEMICOLON]         │
│    │                                                             │
│    │ Parser                                                      │
│    ▼                                                             │
│  AST          Return(BinaryOp(*, Var(x), Var(x)))               │
│    │                                                             │
│    │ CodeGen                                                     │
│    ▼                                                             │
│  Assembleur   MUL R0, R0, R0                                    │
│    │                                                             │
│    │ Assembleur                                                  │
│    ▼                                                             │
│  Binaire      0xE0000090                                        │
│    │                                                             │
│    │ CPU (fetch-decode-execute)                                  │
│    ▼                                                             │
│  Exécution    R0 = 25                                           │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘</code></pre>
<p>Cette trace montre comment chaque couche d’abstraction transforme le
code : - Le <strong>lexer</strong> voit des caractères → produit des
tokens - Le <strong>parser</strong> voit des tokens → produit une
structure (AST) - Le <strong>codegen</strong> voit un AST → produit de
l’assembleur - L’<strong>assembleur</strong> voit des mnémoniques →
produit du binaire - Le <strong>CPU</strong> voit du binaire → exécute
des opérations</p>
<hr />
<h2 data-number="9.8" id="construisez-votre-propre-compilateur"><span
class="header-section-number">9.8</span> Construisez Votre Propre
Compilateur !</h2>
<p>Le simulateur web contient une section <strong>Compilateur:
Construction</strong> avec <strong>18 exercices progressifs</strong>
organisés en 7 phases. Vous construirez un mini-compilateur qui génère
du vrai code assembleur A32.</p>
<h3 data-number="9.8.1" id="phase-1-lexer-analyse-lexicale-1"><span
class="header-section-number">9.8.1</span> Phase 1 : Lexer (Analyse
Lexicale)</h3>
<p>Le lexer transforme le texte en tokens.</p>
<table>
<colgroup>
<col style="width: 43%" />
<col style="width: 56%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1.1 Reconnaître un Chiffre</td>
<td style="text-align: left;">Implémenter <code>is_digit(c)</code> pour
détecter ‘0’-‘9’</td>
</tr>
<tr class="even">
<td style="text-align: left;">1.2 Lire un Nombre</td>
<td style="text-align: left;">Parser un entier depuis une chaîne</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1.3 Compter les Tokens</td>
<td style="text-align: left;">Compter les tokens dans
<code>"12 + 34 * 5"</code></td>
</tr>
</tbody>
</table>
<h3 data-number="9.8.2" id="phase-2-parser-analyse-syntaxique-1"><span
class="header-section-number">9.8.2</span> Phase 2 : Parser (Analyse
Syntaxique)</h3>
<p>Le parser construit une représentation structurée et évalue les
expressions.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2.1 Précédence des Opérateurs</td>
<td style="text-align: left;">Déterminer la priorité (<code>*</code>
&gt; <code>+</code>)</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.2 Évaluer une Opération</td>
<td style="text-align: left;">Évaluer <code>3 + 4</code> ou
<code>6 * 7</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">2.3 Parser avec Précédence</td>
<td style="text-align: left;">Descente récursive pour
<code>2 + 3 * 4</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">2.4 Parenthèses</td>
<td style="text-align: left;">Supporter <code>(2 + 3) * 4</code></td>
</tr>
</tbody>
</table>
<h3 data-number="9.8.3"
id="phase-3-émission-asm-génération-de-code"><span
class="header-section-number">9.8.3</span> Phase 3 : Émission ASM
(Génération de Code)</h3>
<p>Générer des instructions A32 sous forme de chaînes.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">3.1 Générer MOV</td>
<td style="text-align: left;">Produire <code>"MOV R0, #42"</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">3.2 Opération Binaire</td>
<td style="text-align: left;">Mapper <code>+</code> → <code>ADD</code>,
<code>*</code> → <code>MUL</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">3.3 Comparaison</td>
<td style="text-align: left;">Générer <code>CMP</code> et codes de
condition</td>
</tr>
</tbody>
</table>
<h3 data-number="9.8.4" id="phase-4-codegen-expressions"><span
class="header-section-number">9.8.4</span> Phase 4 : CodeGen
Expressions</h3>
<p>Générer du code A32 complet pour des expressions.</p>
<table>
<colgroup>
<col style="width: 43%" />
<col style="width: 56%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">4.1 Constante → A32</td>
<td style="text-align: left;">Générer code pour charger une
constante</td>
</tr>
<tr class="even">
<td style="text-align: left;">4.2 Addition → A32</td>
<td style="text-align: left;"><code>a + b</code> →
<code>MOV R0, #a / MOV R1, #b / ADD R0, R0, R1</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">4.3 Expression → A32</td>
<td style="text-align: left;">Expression complète avec précédence</td>
</tr>
</tbody>
</table>
<h3 data-number="9.8.5" id="phase-5-structures-de-contrôle"><span
class="header-section-number">9.8.5</span> Phase 5 : Structures de
Contrôle</h3>
<p>Générer du code pour <code>if/else</code> et <code>while</code>.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">5.1 If/Else → A32</td>
<td style="text-align: left;">Générer les sauts conditionnels et
labels</td>
</tr>
<tr class="even">
<td style="text-align: left;">5.2 While → A32</td>
<td style="text-align: left;">Générer les boucles avec labels</td>
</tr>
</tbody>
</table>
<h3 data-number="9.8.6" id="phase-6-fonctions"><span
class="header-section-number">9.8.6</span> Phase 6 : Fonctions</h3>
<p>Gérer les appels de fonction et la pile.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">6.1 Prologue/Épilogue</td>
<td style="text-align: left;">Sauvegarder LR, réserver la pile</td>
</tr>
<tr class="even">
<td style="text-align: left;">6.2 Appel de Fonction</td>
<td style="text-align: left;">Passer les arguments, appeler avec BL</td>
</tr>
</tbody>
</table>
<h3 data-number="9.8.7" id="phase-7-projet-final"><span
class="header-section-number">9.8.7</span> Phase 7 : Projet Final</h3>
<table>
<colgroup>
<col style="width: 43%" />
<col style="width: 56%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">7.1 Mini-Compilateur Complet</td>
<td style="text-align: left;">Compiler une expression en A32
exécutable</td>
</tr>
</tbody>
</table>
<p>Le projet final combine toutes les phases : lexer → parser → codegen
pour produire du code assembleur A32 fonctionnel.</p>
<h3 data-number="9.8.8" id="techniques-clés"><span
class="header-section-number">9.8.8</span> Techniques Clés</h3>
<p>Ces exercices utilisent la technique de <strong>descente
récursive</strong> :</p>
<ul>
<li><code>parse_expr()</code> gère <code>+</code> et <code>-</code>
(basse priorité)</li>
<li><code>parse_term()</code> gère <code>*</code> et <code>/</code>
(haute priorité)</li>
<li><code>parse_factor()</code> gère les nombres et les parenthèses</li>
</ul>
<hr />
<h2 data-number="9.9" id="exercices-pratiques-6"><span
class="header-section-number">9.9</span> Exercices Pratiques</h2>
<h3 data-number="9.9.1" id="exercices-sur-le-simulateur-web-6"><span
class="header-section-number">9.9.1</span> Exercices sur le Simulateur
Web</h3>
<p>La section <strong>C32</strong> du simulateur web vous permet de
compiler et exécuter du C32.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Catégorie</th>
<th style="text-align: left;">Exercices</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Bases</td>
<td style="text-align: left;">Variables, Expressions, Modulo,
Incrémentation</td>
</tr>
<tr class="even">
<td style="text-align: left;">Contrôle</td>
<td style="text-align: left;">Conditions, Else-If, Maximum de 3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Boucles</td>
<td style="text-align: left;">For, While, Imbriquées,
Multiplication</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fonctions</td>
<td style="text-align: left;">Appels, Paramètres, Valeur Absolue,
Min/Max</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tableaux</td>
<td style="text-align: left;">Accès, Maximum, Comptage</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pointeurs</td>
<td style="text-align: left;">Adresses, Swap, Tableaux via
pointeurs</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Récursion</td>
<td style="text-align: left;">Factorielle, Fibonacci, PGCD</td>
</tr>
<tr class="even">
<td style="text-align: left;">Algorithmes</td>
<td style="text-align: left;">Tri à Bulles, Recherche Binaire</td>
</tr>
</tbody>
</table>
<h3 data-number="9.9.2" id="exercice-traduire-manuellement"><span
class="header-section-number">9.9.2</span> Exercice : Traduire
manuellement</h3>
<p>Traduisez ce code C32 en assembleur à la main :</p>
<div class="sourceCode" id="cb134"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> <span class="dv">10</span><span class="op">;</span> i <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>    sum <span class="op">=</span> sum <span class="op">+</span> i<span class="op">;</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Comparez avec la sortie du compilateur !</p>
<hr />
<h2 data-number="9.10" id="ce-quil-faut-retenir-6"><span
class="header-section-number">9.10</span> Ce qu’il faut retenir</h2>
<ol type="1">
<li><p><strong>Le compilateur traduit</strong> : C32 (lisible) →
Assembleur (exécutable)</p></li>
<li><p><strong>Trois phases</strong> : Lexer → Parser → Générateur de
code</p></li>
<li><p><strong>Les variables locales vivent sur la pile</strong> : Accès
via <code>[SP, #offset]</code></p></li>
<li><p><strong>Les structures de contrôle deviennent des sauts</strong>
: <code>if</code> → <code>CMP</code> + <code>B</code></p></li>
<li><p><strong>Les fonctions suivent une convention</strong> : Arguments
en R0-R3, retour en R0</p></li>
</ol>
<p><strong>Prochaine étape</strong> : Au Chapitre 8, nous explorerons le
langage C32 en détail — sa syntaxe, ses types, et ses possibilités.</p>
<hr />
<p><strong>Conseil</strong> : Pour vraiment comprendre le compilateur,
écrivez du C32 et regardez l’assembleur généré. Cherchez à prédire ce
que le compilateur va produire !</p>
<hr />
<h2 data-number="9.11" id="auto-évaluation-6"><span
class="header-section-number">9.11</span> Auto-évaluation</h2>
<p>Testez votre compréhension avant de passer au chapitre suivant.</p>
<h3 data-number="9.11.1" id="questions-de-compréhension-6"><span
class="header-section-number">9.11.1</span> Questions de
compréhension</h3>
<p><strong>Q1.</strong> Quelles sont les trois phases principales d’un
compilateur ?</p>
<p><strong>Q2.</strong> Comment le compilateur gère-t-il les variables
locales ?</p>
<p><strong>Q3.</strong> Comment un <code>if-else</code> est-il traduit
en assembleur ?</p>
<p><strong>Q4.</strong> Quelle est la convention d’appel pour les
arguments de fonction ?</p>
<p><strong>Q5.</strong> Pourquoi le compilateur génère-t-il un prologue
et un épilogue pour chaque fonction ?</p>
<h3 data-number="9.11.2" id="mini-défi-pratique-6"><span
class="header-section-number">9.11.2</span> Mini-défi pratique</h3>
<p>Prédisez l’assembleur généré pour ce code C32 :</p>
<div class="sourceCode" id="cb135"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> double_it<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">+</span> x<span class="op">;</span></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><em>Les solutions se trouvent dans le document
<strong>Codex_Solutions</strong>.</em></p>
<h3 data-number="9.11.3" id="checklist-de-validation-6"><span
class="header-section-number">9.11.3</span> Checklist de validation</h3>
<p>Avant de passer au chapitre 8, assurez-vous de pouvoir :</p>
<ul class="task-list">
<li><label><input type="checkbox" />Décrire le rôle du lexer, parser, et
codegen</label></li>
<li><label><input type="checkbox" />Expliquer comment les variables
locales sont stockées</label></li>
<li><label><input type="checkbox" />Traduire un <code>if-else</code>
simple en assembleur</label></li>
<li><label><input type="checkbox" />Connaître la convention d’appel
(R0-R3, pile, LR)</label></li>
<li><label><input type="checkbox" />Comprendre le prologue/épilogue
d’une fonction</label></li>
</ul>
<h1 data-number="10" id="langage-de-haut-niveau-c32"><span
class="header-section-number">10</span> Langage de Haut Niveau
(C32)</h1>
<blockquote>
<p>“Le logiciel est l’esprit qui anime la machine.”</p>
</blockquote>
<p>Jusqu’à présent, nous avons construit le matériel et appris à lui
parler en assembleur. Mais écrire des applications complexes en
assembleur est laborieux. C’est ici qu’intervient le
<strong>C32</strong> — un langage de haut niveau qui vous permet de vous
concentrer sur la <strong>logique</strong> de votre programme.</p>
<hr />
<h2 data-number="10.1" id="où-en-sommes-nous-7"><span
class="header-section-number">10.1</span> Où en sommes-nous ?</h2>
<figure>
<img src="images/architecture-stack.svg"
alt="Position dans l’architecture" />
<figcaption aria-hidden="true">Position dans l’architecture</figcaption>
</figure>
<p><em>Nous sommes à la Couche 5 : Langage de Haut Niveau (C32) -
Variables, fonctions, boucles</em></p>
<p>Le C32 est un sous-ensemble du langage C. Si vous connaissez le C, le
Java ou le C++, vous vous sentirez chez vous.</p>
<hr />
<h2 data-number="10.2" id="pourquoi-un-langage-de-haut-niveau"><span
class="header-section-number">10.2</span> Pourquoi un Langage de Haut
Niveau ?</h2>
<h3 data-number="10.2.1" id="le-problème-de-lassembleur"><span
class="header-section-number">10.2.1</span> Le problème de
l’assembleur</h3>
<pre><code>Assembleur                           C32
───────────                          ───
MOV R0, #0                          int sum = 0;
MOV R1, #1                          for (int i = 1; i &lt;= 10; i = i + 1) {
loop:                                   sum = sum + i;
  CMP R1, #10                       }
  B.GT done
  ADD R0, R0, R1
  ADD R1, R1, #1
  B loop
done:</code></pre>
<p>Le C32 est : - <strong>Plus lisible</strong> : Variables nommées,
structures de contrôle - <strong>Plus maintenable</strong> : Moins de
code, moins de bugs - <strong>Portable</strong> : Le même code peut
cibler différentes architectures</p>
<h3 data-number="10.2.2" id="labstraction"><span
class="header-section-number">10.2.2</span> L’abstraction</h3>
<pre><code>[ Pensée Humaine ]  →  &quot;Calculer la moyenne&quot;
        ↓
[ Langage C32 ]     →  sum = sum + tab[i];
        ↓
[ Assembleur A32 ]  →  LDR R0, [R1, R2]; ADD R3, R3, R0...
        ↓
[ Code Machine ]    →  0xE0833000...</code></pre>
<hr />
<h2 data-number="10.3" id="spécification-du-langage-c32"><span
class="header-section-number">10.3</span> Spécification du Langage
C32</h2>
<h3 data-number="10.3.1" id="les-types-de-données"><span
class="header-section-number">10.3.1</span> Les Types de Données</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Taille</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>int</code></td>
<td style="text-align: left;">32 bits</td>
<td style="text-align: left;">Entier signé (complément à 2)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>uint</code></td>
<td style="text-align: left;">32 bits</td>
<td style="text-align: left;">Entier non-signé</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>char</code></td>
<td style="text-align: left;">8 bits</td>
<td style="text-align: left;">Caractère ASCII</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>bool</code></td>
<td style="text-align: left;">1 bit</td>
<td style="text-align: left;"><code>true</code> ou
<code>false</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>void</code></td>
<td style="text-align: left;">—</td>
<td style="text-align: left;">Pour les fonctions sans retour</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>type*</code></td>
<td style="text-align: left;">32 bits</td>
<td style="text-align: left;">Pointeur (adresse mémoire)</td>
</tr>
</tbody>
</table>
<h3 data-number="10.3.2" id="variables"><span
class="header-section-number">10.3.2</span> Variables</h3>
<div class="sourceCode" id="cb138"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">42</span><span class="op">;</span>           <span class="co">// Variable globale ou locale</span></span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> tab<span class="op">[</span><span class="dv">10</span><span class="op">];</span>          <span class="co">// Tableau de 10 entiers</span></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span><span class="op">*</span> p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span>          <span class="co">// Pointeur vers x</span></span></code></pre></div>
<h3 data-number="10.3.3" id="portée-des-variables"><span
class="header-section-number">10.3.3</span> Portée des variables</h3>
<ul>
<li><strong>Globales</strong> : Déclarées hors des fonctions,
accessibles partout</li>
<li><strong>Locales</strong> : Déclarées dans une fonction, vivent sur
la pile</li>
</ul>
<hr />
<h2 data-number="10.4" id="opérateurs"><span
class="header-section-number">10.4</span> Opérateurs</h2>
<h3 data-number="10.4.1" id="arithmétiques"><span
class="header-section-number">10.4.1</span> Arithmétiques</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Opérateur</th>
<th style="text-align: left;">Signification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>+</code></td>
<td style="text-align: left;">Addition</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>-</code></td>
<td style="text-align: left;">Soustraction</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>*</code></td>
<td style="text-align: left;">Multiplication</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>/</code></td>
<td style="text-align: left;">Division</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>%</code></td>
<td style="text-align: left;">Modulo (reste)</td>
</tr>
</tbody>
</table>
<h3 data-number="10.4.2" id="comparaison"><span
class="header-section-number">10.4.2</span> Comparaison</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Opérateur</th>
<th style="text-align: left;">Signification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>==</code></td>
<td style="text-align: left;">Égal</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>!=</code></td>
<td style="text-align: left;">Différent</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>&lt;</code></td>
<td style="text-align: left;">Inférieur</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>&gt;</code></td>
<td style="text-align: left;">Supérieur</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>&lt;=</code></td>
<td style="text-align: left;">Inférieur ou égal</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>&gt;=</code></td>
<td style="text-align: left;">Supérieur ou égal</td>
</tr>
</tbody>
</table>
<h3 data-number="10.4.3" id="logiques"><span
class="header-section-number">10.4.3</span> Logiques</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Opérateur</th>
<th style="text-align: left;">Signification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>&amp;&amp;</code></td>
<td style="text-align: left;">ET logique</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>\|\|</code></td>
<td style="text-align: left;">OU logique</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>!</code></td>
<td style="text-align: left;">NON logique</td>
</tr>
</tbody>
</table>
<h3 data-number="10.4.4" id="binaires"><span
class="header-section-number">10.4.4</span> Binaires</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Opérateur</th>
<th style="text-align: left;">Signification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>&amp;</code></td>
<td style="text-align: left;">ET bit à bit</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>\|</code></td>
<td style="text-align: left;">OU bit à bit</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>^</code></td>
<td style="text-align: left;">XOR bit à bit</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>~</code></td>
<td style="text-align: left;">Inversion</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>&lt;&lt;</code></td>
<td style="text-align: left;">Décalage gauche</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>&gt;&gt;</code></td>
<td style="text-align: left;">Décalage droite</td>
</tr>
</tbody>
</table>
<hr />
<h2 data-number="10.5" id="structures-de-contrôle"><span
class="header-section-number">10.5</span> Structures de Contrôle</h2>
<h3 data-number="10.5.1" id="if-else-1"><span
class="header-section-number">10.5.1</span> If / Else</h3>
<div class="sourceCode" id="cb139"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>score <span class="op">&gt;</span> <span class="dv">100</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>    win<span class="op">();</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>score <span class="op">&gt;</span> <span class="dv">50</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>    try_again<span class="op">();</span></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>    game_over<span class="op">();</span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="10.5.2" id="while"><span
class="header-section-number">10.5.2</span> While</h3>
<div class="sourceCode" id="cb140"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>x <span class="op">&lt;</span> <span class="dv">10</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> x <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="10.5.3" id="for"><span
class="header-section-number">10.5.3</span> For</h3>
<div class="sourceCode" id="cb141"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>    sum <span class="op">=</span> sum <span class="op">+</span> i<span class="op">;</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="10.5.4" id="do-while"><span
class="header-section-number">10.5.4</span> Do-While</h3>
<div class="sourceCode" id="cb142"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span> <span class="op">{</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> x <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">while</span> <span class="op">(</span>x <span class="op">&gt;</span> <span class="dv">0</span><span class="op">);</span></span></code></pre></div>
<hr />
<h2 data-number="10.6" id="fonctions"><span
class="header-section-number">10.6</span> Fonctions</h2>
<h3 data-number="10.6.1" id="définition"><span
class="header-section-number">10.6.1</span> Définition</h3>
<div class="sourceCode" id="cb143"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> greet<span class="op">()</span> <span class="op">{</span></span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>    putchar<span class="op">(</span><span class="ch">&#39;H&#39;</span><span class="op">);</span></span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>    putchar<span class="op">(</span><span class="ch">&#39;i&#39;</span><span class="op">);</span></span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="10.6.2" id="appel"><span
class="header-section-number">10.6.2</span> Appel</h3>
<div class="sourceCode" id="cb144"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> result <span class="op">=</span> add<span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>greet<span class="op">();</span></span></code></pre></div>
<h3 data-number="10.6.3" id="récursion"><span
class="header-section-number">10.6.3</span> Récursion</h3>
<div class="sourceCode" id="cb145"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> factorial<span class="op">(</span><span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&lt;=</span> <span class="dv">1</span><span class="op">)</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n <span class="op">*</span> factorial<span class="op">(</span>n <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h2 data-number="10.7" id="pointeurs-et-tableaux"><span
class="header-section-number">10.7</span> Pointeurs et Tableaux</h2>
<h3 data-number="10.7.1" id="pointeurs"><span
class="header-section-number">10.7.1</span> Pointeurs</h3>
<p>Un pointeur contient une <strong>adresse mémoire</strong> :</p>
<div class="sourceCode" id="cb146"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">42</span><span class="op">;</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span><span class="op">*</span> p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span>    <span class="co">// p contient l&#39;adresse de x</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>p <span class="op">=</span> <span class="dv">100</span><span class="op">;</span>       <span class="co">// x vaut maintenant 100</span></span></code></pre></div>
<h3 data-number="10.7.2" id="tableaux"><span
class="header-section-number">10.7.2</span> Tableaux</h3>
<p>Un tableau est une suite de valeurs consécutives en mémoire :</p>
<div class="sourceCode" id="cb147"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> scores<span class="op">[</span><span class="dv">5</span><span class="op">];</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>scores<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>scores<span class="op">[</span><span class="dv">4</span><span class="op">]</span> <span class="op">=</span> <span class="dv">50</span><span class="op">;</span></span></code></pre></div>
<h3 data-number="10.7.3" id="lien-entre-pointeurs-et-tableaux"><span
class="header-section-number">10.7.3</span> Lien entre pointeurs et
tableaux</h3>
<div class="sourceCode" id="cb148"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> tab<span class="op">[</span><span class="dv">10</span><span class="op">];</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span><span class="op">*</span> p <span class="op">=</span> tab<span class="op">;</span>      <span class="co">// Équivalent à &amp;tab[0]</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>p<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="dv">42</span><span class="op">;</span>         <span class="co">// Équivalent à tab[3] = 42</span></span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a><span class="op">*(</span>p <span class="op">+</span> <span class="dv">3</span><span class="op">)</span> <span class="op">=</span> <span class="dv">42</span><span class="op">;</span>     <span class="co">// Même chose !</span></span></code></pre></div>
<h3 data-number="10.7.4" id="arithmétique-des-pointeurs"><span
class="header-section-number">10.7.4</span> Arithmétique des
Pointeurs</h3>
<p>C’est un concept <strong>crucial</strong> mais souvent mal compris.
Quand vous ajoutez 1 à un pointeur, il n’avance pas d’un octet, mais
d’un <strong>élément</strong> !</p>
<h4 data-number="10.7.4.1" id="le-principe-scaling-par-sizeof"><span
class="header-section-number">10.7.4.1</span> Le Principe : Scaling par
sizeof</h4>
<div class="sourceCode" id="cb149"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span><span class="op">*</span> p<span class="op">;</span>      <span class="co">// Pointeur vers int (4 octets)</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span><span class="op">*</span> c<span class="op">;</span>     <span class="co">// Pointeur vers char (1 octet)</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> p <span class="op">+</span> <span class="dv">1</span><span class="op">;</span>   <span class="co">// Avance de 4 octets (sizeof(int))</span></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> c <span class="op">+</span> <span class="dv">1</span><span class="op">;</span>   <span class="co">// Avance de 1 octet (sizeof(char))</span></span></code></pre></div>
<p><strong>Pourquoi ?</strong> Parce que <code>p + 1</code> signifie
“l’élément suivant”, pas “l’octet suivant”.</p>
<h4 data-number="10.7.4.2" id="exemple-en-mémoire"><span
class="header-section-number">10.7.4.2</span> Exemple en Mémoire</h4>
<pre><code>Adresse :    0x1000  0x1004  0x1008  0x100C
             ┌──────┬──────┬──────┬──────┐
int tab[4] = │  10  │  20  │  30  │  40  │
             └──────┴──────┴──────┴──────┘
                p     p+1    p+2    p+3</code></pre>
<p>Si <code>p = &amp;tab[0]</code> (adresse 0x1000) : -
<code>p + 1</code> = 0x1004 (pas 0x1001 !) - <code>p + 2</code> = 0x1008
- <code>*p</code> = 10 - <code>*(p + 2)</code> = 30 =
<code>p[2]</code></p>
<h4 data-number="10.7.4.3" id="équivalence-pointeurtableau"><span
class="header-section-number">10.7.4.3</span> Équivalence
Pointeur/Tableau</h4>
<p>Ces expressions sont <strong>identiques</strong> :</p>
<table>
<thead>
<tr class="header">
<th>Forme tableau</th>
<th>Forme pointeur</th>
<th>Signification</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>tab[i]</code></td>
<td><code>*(tab + i)</code></td>
<td>Valeur à l’indice i</td>
</tr>
<tr class="even">
<td><code>&amp;tab[i]</code></td>
<td><code>tab + i</code></td>
<td>Adresse de l’indice i</td>
</tr>
</tbody>
</table>
<h4 data-number="10.7.4.4" id="différence-p-1-vs-p-1"><span
class="header-section-number">10.7.4.4</span> Différence
<code>*p + 1</code> vs <code>*(p + 1)</code></h4>
<p><strong>Attention aux parenthèses !</strong></p>
<div class="sourceCode" id="cb151"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> tab<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">30</span><span class="op">};</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span><span class="op">*</span> p <span class="op">=</span> tab<span class="op">;</span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>p <span class="op">+</span> <span class="dv">1</span>     <span class="co">// = 10 + 1 = 11  (valeur + 1)</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a><span class="op">*(</span>p <span class="op">+</span> <span class="dv">1</span><span class="op">)</span>   <span class="co">// = 20           (élément suivant)</span></span></code></pre></div>
<h4 data-number="10.7.4.5" id="soustraction-de-pointeurs"><span
class="header-section-number">10.7.4.5</span> Soustraction de
Pointeurs</h4>
<p>La différence entre deux pointeurs donne le <strong>nombre
d’éléments</strong> :</p>
<div class="sourceCode" id="cb152"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> tab<span class="op">[</span><span class="dv">10</span><span class="op">];</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span><span class="op">*</span> debut <span class="op">=</span> <span class="op">&amp;</span>tab<span class="op">[</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span><span class="op">*</span> fin <span class="op">=</span> <span class="op">&amp;</span>tab<span class="op">[</span><span class="dv">7</span><span class="op">];</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> distance <span class="op">=</span> fin <span class="op">-</span> debut<span class="op">;</span>  <span class="co">// = 7 (éléments), pas 28 (octets)</span></span></code></pre></div>
<h4 data-number="10.7.4.6" id="parcours-de-tableau-avec-pointeurs"><span
class="header-section-number">10.7.4.6</span> Parcours de Tableau avec
Pointeurs</h4>
<p>Deux façons équivalentes de parcourir :</p>
<div class="sourceCode" id="cb153"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Style indexation</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>    tab<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> tab<span class="op">[</span>i<span class="op">]</span> <span class="op">*</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Style pointeur</span></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span><span class="op">*</span> p <span class="op">=</span> tab<span class="op">;</span></span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span><span class="op">*</span> end <span class="op">=</span> tab <span class="op">+</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>p <span class="op">&lt;</span> end<span class="op">)</span> <span class="op">{</span></span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>p <span class="op">=</span> <span class="op">*</span>p <span class="op">*</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> p <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 data-number="10.7.4.7" id="pointeurs-vers-différents-types"><span
class="header-section-number">10.7.4.7</span> Pointeurs vers Différents
Types</h4>
<div class="sourceCode" id="cb154"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Même adresse, interprétation différente</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> val <span class="op">=</span> <span class="bn">0x41424344</span><span class="op">;</span>    <span class="co">// &#39;ABCD&#39; en ASCII</span></span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span><span class="op">*</span> pi <span class="op">=</span> <span class="op">&amp;</span>val<span class="op">;</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span><span class="op">*</span> pc <span class="op">=</span> <span class="op">(</span><span class="dt">char</span><span class="op">*)&amp;</span>val<span class="op">;</span>  <span class="co">// Cast nécessaire</span></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>pi       <span class="co">// = 0x41424344 (un int de 4 octets)</span></span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a>pc<span class="op">[</span><span class="dv">0</span><span class="op">]</span>     <span class="co">// = 0x44 = &#39;D&#39; (premier octet, little-endian)</span></span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a>pc<span class="op">[</span><span class="dv">1</span><span class="op">]</span>     <span class="co">// = 0x43 = &#39;C&#39;</span></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a>pc<span class="op">[</span><span class="dv">2</span><span class="op">]</span>     <span class="co">// = 0x42 = &#39;B&#39;</span></span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a>pc<span class="op">[</span><span class="dv">3</span><span class="op">]</span>     <span class="co">// = 0x41 = &#39;A&#39;</span></span></code></pre></div>
<hr />
<h2 data-number="10.8" id="accès-au-matériel-mmio"><span
class="header-section-number">10.8</span> Accès au Matériel (MMIO)</h2>
<h3 data-number="10.8.1" id="lécran"><span
class="header-section-number">10.8.1</span> L’écran</h3>
<div class="sourceCode" id="cb155"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co">// L&#39;écran commence à 0x00400000</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="co">// 320×240 pixels, 1 bit par pixel</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> set_pixel<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb155-5"><a href="#cb155-5" aria-hidden="true" tabindex="-1"></a>    uint<span class="op">*</span> screen <span class="op">=</span> <span class="op">(</span>uint<span class="op">*)</span><span class="bn">0x00400000</span><span class="op">;</span></span>
<span id="cb155-6"><a href="#cb155-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> offset <span class="op">=</span> y <span class="op">*</span> <span class="dv">10</span> <span class="op">+</span> <span class="op">(</span>x <span class="op">/</span> <span class="dv">32</span><span class="op">);</span></span>
<span id="cb155-7"><a href="#cb155-7" aria-hidden="true" tabindex="-1"></a>    uint mask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="op">(</span><span class="dv">31</span> <span class="op">-</span> <span class="op">(</span>x <span class="op">%</span> <span class="dv">32</span><span class="op">));</span></span>
<span id="cb155-8"><a href="#cb155-8" aria-hidden="true" tabindex="-1"></a>    screen<span class="op">[</span>offset<span class="op">]</span> <span class="op">=</span> screen<span class="op">[</span>offset<span class="op">]</span> <span class="op">|</span> mask<span class="op">;</span></span>
<span id="cb155-9"><a href="#cb155-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb155-10"><a href="#cb155-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-11"><a href="#cb155-11" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> clear_screen<span class="op">()</span> <span class="op">{</span></span>
<span id="cb155-12"><a href="#cb155-12" aria-hidden="true" tabindex="-1"></a>    uint<span class="op">*</span> screen <span class="op">=</span> <span class="op">(</span>uint<span class="op">*)</span><span class="bn">0x00400000</span><span class="op">;</span></span>
<span id="cb155-13"><a href="#cb155-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">2400</span><span class="op">;</span> i <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb155-14"><a href="#cb155-14" aria-hidden="true" tabindex="-1"></a>        screen<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb155-15"><a href="#cb155-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb155-16"><a href="#cb155-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="10.8.2" id="le-clavier"><span
class="header-section-number">10.8.2</span> Le clavier</h3>
<div class="sourceCode" id="cb156"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Le clavier est à 0x00402600</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> get_key<span class="op">()</span> <span class="op">{</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span><span class="op">*</span> keyboard <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">*)</span><span class="bn">0x00402600</span><span class="op">;</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">*</span>keyboard<span class="op">;</span></span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> wait_key<span class="op">()</span> <span class="op">{</span></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>get_key<span class="op">()</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Attendre</span></span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h2 data-number="10.9" id="exemple-complet-1"><span
class="header-section-number">10.9</span> Exemple Complet</h2>
<div class="sourceCode" id="cb157"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Programme qui dessine un rectangle et attend une touche</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="kw">extern</span> <span class="dt">void</span> putchar<span class="op">(</span><span class="dt">char</span> c<span class="op">);</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Dessiner un rectangle 10×5 à la position (20, 30)</span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>    uint<span class="op">*</span> screen <span class="op">=</span> <span class="op">(</span>uint<span class="op">*)</span><span class="bn">0x00400000</span><span class="op">;</span></span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> y <span class="op">=</span> <span class="dv">30</span><span class="op">;</span> y <span class="op">&lt;</span> <span class="dv">35</span><span class="op">;</span> y <span class="op">=</span> y <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> x <span class="op">=</span> <span class="dv">20</span><span class="op">;</span> x <span class="op">&lt;</span> <span class="dv">30</span><span class="op">;</span> x <span class="op">=</span> x <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> offset <span class="op">=</span> y <span class="op">*</span> <span class="dv">10</span> <span class="op">+</span> <span class="op">(</span>x <span class="op">/</span> <span class="dv">32</span><span class="op">);</span></span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>            uint mask <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="op">(</span><span class="dv">31</span> <span class="op">-</span> <span class="op">(</span>x <span class="op">%</span> <span class="dv">32</span><span class="op">));</span></span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a>            screen<span class="op">[</span>offset<span class="op">]</span> <span class="op">=</span> screen<span class="op">[</span>offset<span class="op">]</span> <span class="op">|</span> mask<span class="op">;</span></span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-17"><a href="#cb157-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Afficher un message</span></span>
<span id="cb157-18"><a href="#cb157-18" aria-hidden="true" tabindex="-1"></a>    putchar<span class="op">(</span><span class="ch">&#39;D&#39;</span><span class="op">);</span></span>
<span id="cb157-19"><a href="#cb157-19" aria-hidden="true" tabindex="-1"></a>    putchar<span class="op">(</span><span class="ch">&#39;o&#39;</span><span class="op">);</span></span>
<span id="cb157-20"><a href="#cb157-20" aria-hidden="true" tabindex="-1"></a>    putchar<span class="op">(</span><span class="ch">&#39;n&#39;</span><span class="op">);</span></span>
<span id="cb157-21"><a href="#cb157-21" aria-hidden="true" tabindex="-1"></a>    putchar<span class="op">(</span><span class="ch">&#39;e&#39;</span><span class="op">);</span></span>
<span id="cb157-22"><a href="#cb157-22" aria-hidden="true" tabindex="-1"></a>    putchar<span class="op">(</span><span class="ch">&#39;!&#39;</span><span class="op">);</span></span>
<span id="cb157-23"><a href="#cb157-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-24"><a href="#cb157-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Attendre une touche</span></span>
<span id="cb157-25"><a href="#cb157-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span><span class="op">*</span> kbd <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">*)</span><span class="bn">0x00402600</span><span class="op">;</span></span>
<span id="cb157-26"><a href="#cb157-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(*</span>kbd <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{}</span></span>
<span id="cb157-27"><a href="#cb157-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-28"><a href="#cb157-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb157-29"><a href="#cb157-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h2 data-number="10.10" id="exercices-pratiques-7"><span
class="header-section-number">10.10</span> Exercices Pratiques</h2>
<h3 data-number="10.10.1" id="exercices-sur-le-simulateur-web-7"><span
class="header-section-number">10.10.1</span> Exercices sur le Simulateur
Web</h3>
<p>La section <strong>C32</strong> contient de nombreux exercices
progressifs :</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Catégorie</th>
<th style="text-align: left;">Exercices clés</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Bases</strong></td>
<td style="text-align: left;">Variables, Expressions, Modulo</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Contrôle</strong></td>
<td style="text-align: left;">Conditions, Else-If, Opérateurs
Logiques</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Boucles</strong></td>
<td style="text-align: left;">For, While, Imbriquées</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Fonctions</strong></td>
<td style="text-align: left;">Paramètres, Valeur Absolue, Min/Max</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Tableaux</strong></td>
<td style="text-align: left;">Accès, Maximum, Comptage</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Pointeurs</strong></td>
<td style="text-align: left;">Adresses, Swap</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Récursion</strong></td>
<td style="text-align: left;">Factorielle, Fibonacci, PGCD</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Algorithmes</strong></td>
<td style="text-align: left;">Tri à Bulles, Recherche Binaire</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Graphique</strong></td>
<td style="text-align: left;">Pixel, Ligne, Rectangle, Damier</td>
</tr>
</tbody>
</table>
<h3 data-number="10.10.2" id="défis-suggérés"><span
class="header-section-number">10.10.2</span> Défis suggérés</h3>
<ol type="1">
<li><p><strong>Hello World</strong> : Affichez votre nom à
l’écran</p></li>
<li><p><strong>Jeu de devinette</strong> : Le programme choisit un
nombre, l’utilisateur devine</p></li>
<li><p><strong>Calculatrice</strong> : Lisez deux nombres et affichez
leur somme</p></li>
</ol>
<hr />
<h2 data-number="10.11" id="les-structures-structs"><span
class="header-section-number">10.11</span> Les Structures (Structs)</h2>
<p>Le C32 supporte les structures (structs) pour regrouper plusieurs
variables.</p>
<h3 data-number="10.11.1" id="définition-dune-structure"><span
class="header-section-number">10.11.1</span> Définition d’une
structure</h3>
<div class="sourceCode" id="cb158"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Point <span class="op">{</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">;</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> y<span class="op">;</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h3 data-number="10.11.2" id="utilisation-1"><span
class="header-section-number">10.11.2</span> Utilisation</h3>
<div class="sourceCode" id="cb159"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Point p<span class="op">;</span>     <span class="co">// Déclarer une variable de type struct</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>p<span class="op">.</span>x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span>           <span class="co">// Accéder aux champs avec .</span></span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>p<span class="op">.</span>y <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span></code></pre></div>
<h3 data-number="10.11.3" id="organisation-en-mémoire"><span
class="header-section-number">10.11.3</span> Organisation en
Mémoire</h3>
<p><strong>Concept clé</strong> : Les champs d’une structure sont placés
<strong>consécutivement</strong> en mémoire.</p>
<div class="sourceCode" id="cb160"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Point <span class="op">{</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">;</span>    <span class="co">// Offset 0, taille 4</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> y<span class="op">;</span>    <span class="co">// Offset 4, taille 4</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span>            <span class="co">// Taille totale : 8 octets</span></span></code></pre></div>
<p>En mémoire (si <code>p</code> est à l’adresse 0x1000) :</p>
<pre><code>Adresse :   0x1000        0x1004
            ┌─────────────┬─────────────┐
struct p =  │     x       │     y       │
            │   (4 oct)   │   (4 oct)   │
            └─────────────┴─────────────┘
            &amp;p            &amp;p + 4
            &amp;p.x          &amp;p.y</code></pre>
<h3 data-number="10.11.4" id="calcul-des-offsets"><span
class="header-section-number">10.11.4</span> Calcul des Offsets</h3>
<p>Le compilateur calcule l’<strong>offset</strong> de chaque champ
:</p>
<div class="sourceCode" id="cb162"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Player <span class="op">{</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> health<span class="op">;</span>     <span class="co">// Offset 0</span></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">;</span>          <span class="co">// Offset 4</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> y<span class="op">;</span>          <span class="co">// Offset 8</span></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">16</span><span class="op">];</span>  <span class="co">// Offset 12</span></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span>                  <span class="co">// Taille totale : 28 octets</span></span></code></pre></div>
<p>Quand vous écrivez <code>player.y</code>, le compilateur génère :</p>
<div class="sourceCode" id="cb163"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co">; player.y = 100</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="co">; Si R0 contient l&#39;adresse de player :</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span> R1<span class="op">,</span> <span class="op">#</span><span class="dv">100</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a><span class="bu">STR</span> R1<span class="op">,</span> <span class="op">[</span>R0<span class="op">,</span> <span class="op">#</span><span class="dv">8</span><span class="op">]</span>   <span class="co">; Offset de y = 8</span></span></code></pre></div>
<h3 data-number="10.11.5" id="alignement-padding"><span
class="header-section-number">10.11.5</span> Alignement (Padding)</h3>
<p>En C standard, les structures peuvent avoir du “padding” pour
l’alignement. En C32, on suppose un alignement simple sur 4 octets pour
les int.</p>
<div class="sourceCode" id="cb164"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Mixed <span class="op">{</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> a<span class="op">;</span>    <span class="co">// Offset 0, taille 1</span></span>
<span id="cb164-3"><a href="#cb164-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// (3 octets de padding)</span></span>
<span id="cb164-4"><a href="#cb164-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> b<span class="op">;</span>     <span class="co">// Offset 4, taille 4</span></span>
<span id="cb164-5"><a href="#cb164-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> c<span class="op">;</span>    <span class="co">// Offset 8, taille 1</span></span>
<span id="cb164-6"><a href="#cb164-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// (3 octets de padding)</span></span>
<span id="cb164-7"><a href="#cb164-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span>             <span class="co">// Taille : 12 octets (pas 6 !)</span></span></code></pre></div>
<h3 data-number="10.11.6" id="tableaux-de-structures"><span
class="header-section-number">10.11.6</span> Tableaux de Structures</h3>
<div class="sourceCode" id="cb165"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Point points<span class="op">[</span><span class="dv">3</span><span class="op">];</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="co">// En mémoire (chaque Point = 8 octets) :</span></span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a><span class="co">// points[0] à offset 0</span></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a><span class="co">// points[1] à offset 8</span></span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a><span class="co">// points[2] à offset 16</span></span></code></pre></div>
<p>Pour accéder à <code>points[i].y</code> :</p>
<pre><code>adresse = base + i * sizeof(struct Point) + offset_y
        = base + i * 8 + 4</code></pre>
<h3 data-number="10.11.7" id="pointeur-vers-structure"><span
class="header-section-number">10.11.7</span> Pointeur vers
structure</h3>
<div class="sourceCode" id="cb167"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Point <span class="op">*</span>ptr <span class="op">=</span> <span class="op">&amp;</span>p<span class="op">;</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>ptr<span class="op">-&gt;</span>x <span class="op">=</span> <span class="dv">30</span><span class="op">;</span>        <span class="co">// Accéder via pointeur avec -&gt;</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>ptr<span class="op">-&gt;</span>y <span class="op">=</span> <span class="dv">40</span><span class="op">;</span></span></code></pre></div>
<h3 data-number="10.11.8" id="exemple-complet-2"><span
class="header-section-number">10.11.8</span> Exemple complet</h3>
<div class="sourceCode" id="cb168"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Point <span class="op">{</span> <span class="dt">int</span> x<span class="op">;</span> <span class="dt">int</span> y<span class="op">;</span> <span class="op">};</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> distance_sq<span class="op">(</span><span class="kw">struct</span> Point <span class="op">*</span>p<span class="op">)</span> <span class="op">{</span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> p<span class="op">-&gt;</span>x <span class="op">*</span> p<span class="op">-&gt;</span>x <span class="op">+</span> p<span class="op">-&gt;</span>y <span class="op">*</span> p<span class="op">-&gt;</span>y<span class="op">;</span></span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Point p<span class="op">;</span></span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>    p<span class="op">.</span>x <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>    p<span class="op">.</span>y <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> distance_sq<span class="op">(&amp;</span>p<span class="op">);</span>  <span class="co">// Retourne 25</span></span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="10.11.9" id="structures-imbriquées"><span
class="header-section-number">10.11.9</span> Structures imbriquées</h3>
<div class="sourceCode" id="cb169"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Point <span class="op">{</span> <span class="dt">int</span> x<span class="op">;</span> <span class="dt">int</span> y<span class="op">;</span> <span class="op">};</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Rectangle <span class="op">{</span></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Point corner<span class="op">;</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> width<span class="op">;</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> height<span class="op">;</span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Rectangle r<span class="op">;</span></span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a>    r<span class="op">.</span>corner<span class="op">.</span>x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a>    r<span class="op">.</span>corner<span class="op">.</span>y <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>    r<span class="op">.</span>width <span class="op">=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a>    r<span class="op">.</span>height <span class="op">=</span> <span class="dv">50</span><span class="op">;</span></span>
<span id="cb169-14"><a href="#cb169-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r<span class="op">.</span>width <span class="op">*</span> r<span class="op">.</span>height<span class="op">;</span>  <span class="co">// Retourne 5000</span></span>
<span id="cb169-15"><a href="#cb169-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h2 data-number="10.12" id="limitations-du-c32"><span
class="header-section-number">10.12</span> Limitations du C32</h2>
<p>Pour rester simple et pédagogique, le C32 a quelques limites :</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Fonctionnalité</th>
<th style="text-align: left;">État</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>struct</code></td>
<td style="text-align: left;">Supporté</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>float</code>,
<code>double</code></td>
<td style="text-align: left;">Non supporté</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>malloc</code>/<code>free</code></td>
<td style="text-align: left;">Via OS uniquement</td>
</tr>
<tr class="even">
<td style="text-align: left;">Chaînes de caractères</td>
<td style="text-align: left;">Basique</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Préprocesseur</td>
<td style="text-align: left;">Minimal</td>
</tr>
</tbody>
</table>
<hr />
<h2 data-number="10.13" id="ce-quil-faut-retenir-7"><span
class="header-section-number">10.13</span> Ce qu’il faut retenir</h2>
<ol type="1">
<li><p><strong>C32 simplifie la programmation</strong> : Variables
nommées, structures de contrôle</p></li>
<li><p><strong>Les types de base</strong> : <code>int</code>,
<code>char</code>, <code>bool</code>, <code>void</code>,
pointeurs</p></li>
<li><p><strong>Pointeurs = adresses</strong> : Accès direct à la
mémoire</p></li>
<li><p><strong>MMIO</strong> : Écran à 0x00400000, clavier à
0x00402600</p></li>
<li><p><strong>Fonctions</strong> : Modularité et réutilisation du
code</p></li>
</ol>
<p><strong>Prochaine étape</strong> : Au Chapitre 9, nous construirons
un <strong>Système d’Exploitation</strong> minimal — gestion mémoire,
graphiques, entrées/sorties.</p>
<hr />
<p><strong>Conseil</strong> : Le C32 est proche du C. Si vous voulez
aller plus loin, apprenez le C — c’est le langage de base de Linux,
Windows, et de presque tous les systèmes embarqués !</p>
<hr />
<h2 data-number="10.14" id="auto-évaluation-7"><span
class="header-section-number">10.14</span> Auto-évaluation</h2>
<p>Testez votre compréhension avant de passer au chapitre suivant.</p>
<h3 data-number="10.14.1" id="questions-de-compréhension-7"><span
class="header-section-number">10.14.1</span> Questions de
compréhension</h3>
<p><strong>Q1.</strong> Quelle est la différence entre <code>int</code>
et <code>uint</code> en C32 ?</p>
<p><strong>Q2.</strong> Qu’est-ce qu’un pointeur et comment
l’utilise-t-on ?</p>
<p><strong>Q3.</strong> Comment accède-t-on à l’écran en C32 ?</p>
<p><strong>Q4.</strong> Quelle est la syntaxe d’une boucle
<code>for</code> en C32 ?</p>
<p><strong>Q5.</strong> Comment définit-on et utilise-t-on un tableau en
C32 ?</p>
<h3 data-number="10.14.2" id="mini-défi-pratique-7"><span
class="header-section-number">10.14.2</span> Mini-défi pratique</h3>
<p>Écrivez une fonction C32 qui calcule la somme des éléments d’un
tableau :</p>
<div class="sourceCode" id="cb170"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sum<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>arr<span class="op">,</span> <span class="dt">int</span> len<span class="op">)</span> <span class="op">{</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// À compléter</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><em>Les solutions se trouvent dans le document
<strong>Codex_Solutions</strong>.</em></p>
<h3 data-number="10.14.3" id="checklist-de-validation-7"><span
class="header-section-number">10.14.3</span> Checklist de
validation</h3>
<p>Avant de passer au chapitre 9, assurez-vous de pouvoir :</p>
<ul class="task-list">
<li><label><input type="checkbox" />Utiliser les types de base :
<code>int</code>, <code>uint</code>, <code>char</code>,
<code>bool</code></label></li>
<li><label><input type="checkbox" />Déclarer et utiliser des
pointeurs</label></li>
<li><label><input type="checkbox" />Accéder à la mémoire mappée (écran,
clavier)</label></li>
<li><label><input type="checkbox" />Écrire des boucles <code>for</code>
et <code>while</code></label></li>
<li><label><input type="checkbox" />Manipuler des tableaux et des
chaînes de caractères</label></li>
</ul>
<h1 data-number="11" id="système-dexploitation"><span
class="header-section-number">11</span> Système d’Exploitation</h1>
<blockquote>
<p>“Un OS est ce qui reste quand on a enlevé tout ce qui est utile.” —
Ken Thompson</p>
</blockquote>
<p>Félicitations ! Vous avez construit le matériel, l’assembleur et le
compilateur. Votre machine Codex est fonctionnelle. Mais pour l’instant,
chaque programmeur doit réinventer la roue : comment dessiner un cercle
? comment lire une chaîne de caractères ?</p>
<p>Dans ce dernier chapitre, nous allons construire une
<strong>Bibliothèque Système</strong> qui simplifie l’accès au
matériel.</p>
<hr />
<h2 data-number="11.1" id="où-en-sommes-nous-8"><span
class="header-section-number">11.1</span> Où en sommes-nous ?</h2>
<figure>
<img src="images/architecture-stack.svg"
alt="Position dans l’architecture" />
<figcaption aria-hidden="true">Position dans l’architecture</figcaption>
</figure>
<p><em>Nous sommes à la Couche 6 : Système d’Exploitation - Le sommet de
la pyramide logicielle !</em></p>
<p>C’est le <strong>sommet de la pyramide</strong> logicielle ! L’OS
cache la complexité du matériel et offre des services de haut niveau aux
applications.</p>
<hr />
<h2 data-number="11.2" id="quest-ce-quun-système-dexploitation"><span
class="header-section-number">11.2</span> Qu’est-ce qu’un Système
d’Exploitation ?</h2>
<h3 data-number="11.2.1" id="la-hiérarchie-logicielle"><span
class="header-section-number">11.2.1</span> La hiérarchie
logicielle</h3>
<figure>
<img src="images/software-hierarchy.svg" alt="Hiérarchie logicielle" />
<figcaption aria-hidden="true">Hiérarchie logicielle</figcaption>
</figure>
<h3 data-number="11.2.2" id="ce-que-fait-un-os"><span
class="header-section-number">11.2.2</span> Ce que fait un OS</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Fonction</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Gestion mémoire</strong></td>
<td style="text-align: left;">Allouer/libérer de la mémoire
dynamiquement</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Graphiques</strong></td>
<td style="text-align: left;">Dessiner des formes, du texte</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Entrées/Sorties</strong></td>
<td style="text-align: left;">Lire le clavier, afficher à l’écran</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Fichiers</strong></td>
<td style="text-align: left;">Sauvegarder/charger des données
(avancé)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Multitâche</strong></td>
<td style="text-align: left;">Exécuter plusieurs programmes
(avancé)</td>
</tr>
</tbody>
</table>
<p>Notre OS Codex implémente les trois premiers points.</p>
<hr />
<h2 data-number="11.3" id="gestion-de-la-mémoire-le-tas-heap"><span
class="header-section-number">11.3</span> Gestion de la Mémoire (Le Tas
/ Heap)</h2>
<h3 data-number="11.3.1" id="le-problème-2"><span
class="header-section-number">11.3.1</span> Le problème</h3>
<p>Jusqu’à présent, nous utilisions :</p>
<ul>
<li><strong>Variables globales</strong> : Taille fixée à la
compilation</li>
<li><strong>Variables locales</strong> : Sur la pile, libérées
automatiquement</li>
</ul>
<p>Mais que faire si on veut allouer une taille <strong>inconnue à
l’avance</strong> ?</p>
<h3 data-number="11.3.2" id="lallocateur-bump-simple"><span
class="header-section-number">11.3.2</span> L’allocateur “Bump”
(Simple)</h3>
<p>L’allocateur le plus simple : un pointeur qui avance à chaque
allocation.</p>
<div class="sourceCode" id="cb171"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span><span class="op">*</span> heap_ptr <span class="op">=</span> <span class="op">(</span><span class="dt">char</span><span class="op">*)</span>HEAP_START<span class="op">;</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span><span class="op">*</span> malloc<span class="op">(</span><span class="dt">int</span> size<span class="op">)</span> <span class="op">{</span></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span><span class="op">*</span> result <span class="op">=</span> heap_ptr<span class="op">;</span></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>    heap_ptr <span class="op">=</span> heap_ptr <span class="op">+</span> size<span class="op">;</span></span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> free<span class="op">(</span><span class="dt">char</span><span class="op">*</span> ptr<span class="op">)</span> <span class="op">{</span></span>
<span id="cb171-10"><a href="#cb171-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Ne fait rien ! La mémoire n&#39;est jamais récupérée.</span></span>
<span id="cb171-11"><a href="#cb171-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Avantage</strong> : Très simple, très rapide.
<strong>Inconvénient</strong> : On ne peut pas réutiliser la mémoire
libérée.</p>
<h3 data-number="11.3.3" id="lallocateur-par-liste-chaînée-avancé"><span
class="header-section-number">11.3.3</span> L’allocateur par Liste
Chaînée (Avancé)</h3>
<p>Pour réutiliser la mémoire, chaque bloc contient : - Sa taille - Un
pointeur vers le bloc libre suivant</p>
<pre><code>┌────────────────────────────────────────────────────┐
│ [size|next] [données...]  [size|next] [données...] │
└────────────────────────────────────────────────────┘</code></pre>
<p>Quand on libère un bloc, on l’ajoute à la liste des blocs libres.
Quand on alloue, on cherche un bloc de taille suffisante.</p>
<hr />
<h2 data-number="11.4" id="bibliothèque-graphique"><span
class="header-section-number">11.4</span> Bibliothèque Graphique</h2>
<h3 data-number="11.4.1" id="le-problème-3"><span
class="header-section-number">11.4.1</span> Le problème</h3>
<p>Pour allumer un pixel, il faut :</p>
<ol type="1">
<li>Calculer l’adresse de l’octet</li>
<li>Calculer la position du bit</li>
<li>Faire un OR pour allumer (ou AND + NOT pour éteindre)</li>
</ol>
<p>C’est fastidieux et source d’erreurs.</p>
<h3 data-number="11.4.2" id="les-fonctions-graphiques"><span
class="header-section-number">11.4.2</span> Les fonctions
graphiques</h3>
<div class="sourceCode" id="cb173"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> screen_init<span class="op">();</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> screen_clear<span class="op">();</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> screen_set_color<span class="op">(</span><span class="dt">int</span> color<span class="op">);</span></span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> screen_draw_pixel<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">);</span></span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> screen_draw_line<span class="op">(</span><span class="dt">int</span> x1<span class="op">,</span> <span class="dt">int</span> y1<span class="op">,</span> <span class="dt">int</span> x2<span class="op">,</span> <span class="dt">int</span> y2<span class="op">);</span></span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> screen_draw_rect<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">,</span> <span class="dt">int</span> w<span class="op">,</span> <span class="dt">int</span> h<span class="op">);</span></span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> screen_draw_circle<span class="op">(</span><span class="dt">int</span> cx<span class="op">,</span> <span class="dt">int</span> cy<span class="op">,</span> <span class="dt">int</span> r<span class="op">);</span></span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> screen_print<span class="op">(</span><span class="dt">char</span><span class="op">*</span> text<span class="op">,</span> <span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">);</span></span></code></pre></div>
<h3 data-number="11.4.3" id="lalgorithme-de-bresenham"><span
class="header-section-number">11.4.3</span> L’algorithme de
Bresenham</h3>
<p>Pour dessiner des lignes droites avec uniquement des additions et des
comparaisons:</p>
<div class="sourceCode" id="cb174"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> screen_draw_line<span class="op">(</span><span class="dt">int</span> x1<span class="op">,</span> <span class="dt">int</span> y1<span class="op">,</span> <span class="dt">int</span> x2<span class="op">,</span> <span class="dt">int</span> y2<span class="op">)</span> <span class="op">{</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> dx <span class="op">=</span> abs<span class="op">(</span>x2 <span class="op">-</span> x1<span class="op">);</span></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> dy <span class="op">=</span> abs<span class="op">(</span>y2 <span class="op">-</span> y1<span class="op">);</span></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> sx <span class="op">=</span> x1 <span class="op">&lt;</span> x2 <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> sy <span class="op">=</span> y1 <span class="op">&lt;</span> y2 <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> err <span class="op">=</span> dx <span class="op">-</span> dy<span class="op">;</span></span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a>        screen_draw_pixel<span class="op">(</span>x1<span class="op">,</span> y1<span class="op">);</span></span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>x1 <span class="op">==</span> x2 <span class="op">&amp;&amp;</span> y1 <span class="op">==</span> y2<span class="op">)</span> <span class="cf">break</span><span class="op">;</span></span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> e2 <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> err<span class="op">;</span></span>
<span id="cb174-12"><a href="#cb174-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>e2 <span class="op">&gt;</span> <span class="op">-</span>dy<span class="op">)</span> <span class="op">{</span> err <span class="op">=</span> err <span class="op">-</span> dy<span class="op">;</span> x1 <span class="op">=</span> x1 <span class="op">+</span> sx<span class="op">;</span> <span class="op">}</span></span>
<span id="cb174-13"><a href="#cb174-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>e2 <span class="op">&lt;</span> dx<span class="op">)</span>  <span class="op">{</span> err <span class="op">=</span> err <span class="op">+</span> dx<span class="op">;</span> y1 <span class="op">=</span> y1 <span class="op">+</span> sy<span class="op">;</span> <span class="op">}</span></span>
<span id="cb174-14"><a href="#cb174-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb174-15"><a href="#cb174-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Pas de multiplication, pas de division — uniquement des opérations
que notre CPU fait rapidement !</p>
<hr />
<h2 data-number="11.5" id="entrées-sorties"><span
class="header-section-number">11.5</span> Entrées / Sorties</h2>
<h3 data-number="11.5.1" id="printf-simplifié"><span
class="header-section-number">11.5.1</span> Printf simplifié</h3>
<div class="sourceCode" id="cb175"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> putchar<span class="op">(</span><span class="dt">char</span> c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Appel système SVC pour afficher un caractère</span></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> puts<span class="op">(</span><span class="dt">char</span><span class="op">*</span> s<span class="op">)</span> <span class="op">{</span></span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(*</span>s <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>        putchar<span class="op">(*</span>s<span class="op">);</span></span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a>        s <span class="op">=</span> s <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb175-11"><a href="#cb175-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-12"><a href="#cb175-12" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_int<span class="op">(</span><span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb175-13"><a href="#cb175-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb175-14"><a href="#cb175-14" aria-hidden="true" tabindex="-1"></a>        putchar<span class="op">(</span><span class="ch">&#39;-&#39;</span><span class="op">);</span></span>
<span id="cb175-15"><a href="#cb175-15" aria-hidden="true" tabindex="-1"></a>        n <span class="op">=</span> <span class="op">-</span>n<span class="op">;</span></span>
<span id="cb175-16"><a href="#cb175-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb175-17"><a href="#cb175-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">&gt;=</span> <span class="dv">10</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb175-18"><a href="#cb175-18" aria-hidden="true" tabindex="-1"></a>        print_int<span class="op">(</span>n <span class="op">/</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb175-19"><a href="#cb175-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb175-20"><a href="#cb175-20" aria-hidden="true" tabindex="-1"></a>    putchar<span class="op">(</span><span class="ch">&#39;0&#39;</span> <span class="op">+</span> <span class="op">(</span>n <span class="op">%</span> <span class="dv">10</span><span class="op">));</span></span>
<span id="cb175-21"><a href="#cb175-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="11.5.2" id="lecture-du-clavier"><span
class="header-section-number">11.5.2</span> Lecture du clavier</h3>
<div class="sourceCode" id="cb176"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> keyboard_read<span class="op">()</span> <span class="op">{</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span><span class="op">*</span> kbd <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">*)</span><span class="bn">0x00402600</span><span class="op">;</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">*</span>kbd<span class="op">;</span></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> keyboard_wait<span class="op">()</span> <span class="op">{</span></span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> key<span class="op">;</span></span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">((</span>key <span class="op">=</span> keyboard_read<span class="op">())</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Attendre</span></span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> key<span class="op">;</span></span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h2 data-number="11.6" id="interruptions-et-timer-concepts"><span
class="header-section-number">11.6</span> Interruptions et Timer
(Concepts)</h2>
<h3 data-number="11.6.1" id="le-problème-du-polling"><span
class="header-section-number">11.6.1</span> Le problème du polling</h3>
<p>Dans notre approche actuelle, le CPU vérifie constamment le clavier
:</p>
<div class="sourceCode" id="cb177"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>keyboard_read<span class="op">()</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{}</span>  <span class="co">// CPU occupe à ne rien faire !</span></span></code></pre></div>
<h3 data-number="11.6.2" id="les-interruptions"><span
class="header-section-number">11.6.2</span> Les interruptions</h3>
<p>Avec les interruptions, le matériel <strong>signale</strong> au CPU
qu’un événement s’est produit:</p>
<ol type="1">
<li>Le CPU exécute le programme</li>
<li>Une touche est pressée → Le matériel déclenche une
<strong>interruption</strong></li>
<li>Le CPU s’arrête et saute vers le <strong>handler
d’interruption</strong></li>
<li>Le handler traite l’événement</li>
<li>Le CPU reprend le programme là où il s’était arrêté</li>
</ol>
<p>C’est la base du multitâche et des systèmes réactifs !</p>
<hr />
<h2 data-number="11.7" id="applications-démo"><span
class="header-section-number">11.7</span> Applications Démo</h2>
<p>Le répertoire <code>demos/</code> contient des exemples complets
:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Démo</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>01_hello</code></td>
<td style="text-align: left;">Hello World classique</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>02_counter</code></td>
<td style="text-align: left;">Compteur avec affichage</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>03_graphics</code></td>
<td style="text-align: left;">Dessins géométriques</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>04_snake</code></td>
<td style="text-align: left;">Jeu du serpent complet !</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>05_shell</code></td>
<td style="text-align: left;">Interface en ligne de commande</td>
</tr>
</tbody>
</table>
<h3 data-number="11.7.1" id="compiler-et-exécuter-une-démo"><span
class="header-section-number">11.7.1</span> Compiler et exécuter une
démo</h3>
<div class="sourceCode" id="cb178"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compiler</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> run <span class="at">-p</span> c32_cli <span class="at">--</span> demos/04_snake/main.c <span class="at">-o</span> snake.bin</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Exécuter</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> run <span class="at">-p</span> a32_runner <span class="at">--</span> snake.bin</span></code></pre></div>
<p>Ou utilisez le <strong>Simulateur Web</strong> pour une expérience
visuelle !</p>
<hr />
<h2 data-number="11.8" id="exercices-pratiques-8"><span
class="header-section-number">11.8</span> Exercices Pratiques</h2>
<h3 data-number="11.8.1" id="exercices-sur-le-simulateur-web-8"><span
class="header-section-number">11.8.1</span> Exercices sur le Simulateur
Web</h3>
<p>La section <strong>OS</strong> contient des exercices interactifs
:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>Calculatrice</code></td>
<td style="text-align: left;">Calculatrice interactive avec clavier</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Variables</code></td>
<td style="text-align: left;">Shell pour définir des variables</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Timer</code></td>
<td style="text-align: left;">Affichage d’un compteur animé</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Scheduler</code></td>
<td style="text-align: left;">Simulation d’un ordonnanceur</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>Projet Mini-OS</code></td>
<td style="text-align: left;">Shell multi-applications</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>Task Manager</code></td>
<td style="text-align: left;">Gestionnaire de tâches visuel</td>
</tr>
</tbody>
</table>
<h3 data-number="11.8.2" id="défis-suggérés-1"><span
class="header-section-number">11.8.2</span> Défis suggérés</h3>
<ol type="1">
<li><p><strong>Étendre l’OS</strong> : Ajoutez
<code>screen_draw_triangle()</code> en utilisant trois appels à
<code>screen_draw_line()</code>.</p></li>
<li><p><strong>Gestion mémoire</strong> : Testez l’allocateur avec
plusieurs <code>malloc()</code> et observez le comportement.</p></li>
<li><p><strong>Projet final</strong> : Créez votre propre application
dans <code>demos/</code> en utilisant tout ce que vous avez appris
!</p></li>
</ol>
<hr />
<h2 data-number="11.9" id="le-parcours-complet-1"><span
class="header-section-number">11.9</span> Le Parcours Complet</h2>
<p>Vous avez parcouru tout le chemin :</p>
<pre><code>Chapitre 0 : Introduction
    ↓
Chapitre 1-5 : MATÉRIEL
    NAND → Portes → ALU → Mémoire → CPU
    ↓
Chapitre 6-9 : LOGICIEL
    Assembleur → Compilateur → C32 → OS
    ↓
Applications : Jeux, Calculatrices, Shell...</code></pre>
<p>Vous comprenez maintenant que l’ordinateur n’est pas une boîte
magique, mais une <strong>pyramide d’abstractions</strong>
magnifiquement ordonnées.</p>
<hr />
<h2 data-number="11.10" id="ce-quil-faut-retenir-8"><span
class="header-section-number">11.10</span> Ce qu’il faut retenir</h2>
<ol type="1">
<li><p><strong>L’OS cache le matériel</strong> :
<code>draw_circle()</code> au lieu de manipuler des bits</p></li>
<li><p><strong>Gestion mémoire dynamique</strong> :
<code>malloc()</code> et <code>free()</code></p></li>
<li><p><strong>Bibliothèque graphique</strong> : Lignes, rectangles,
cercles, texte</p></li>
<li><p><strong>Entrées/Sorties</strong> : <code>putchar()</code>,
<code>keyboard_read()</code></p></li>
<li><p><strong>Interruptions</strong> : Le matériel peut signaler des
événements au CPU</p></li>
</ol>
<hr />
<h2 data-number="11.11" id="félicitations"><span
class="header-section-number">11.11</span> Félicitations !</h2>
<p>Vous avez parcouru tout le chemin, de la <strong>porte NAND</strong>
au <strong>système d’exploitation</strong>. Vous comprenez maintenant
:</p>
<ul>
<li><p>Comment les bits deviennent des calculs (ALU)</p></li>
<li><p>Comment les calculs deviennent de la mémoire (RAM)</p></li>
<li><p>Comment la mémoire devient un programme (CPU)</p></li>
<li><p>Comment un programme devient une application (Compilateur +
OS)</p></li>
</ul>
<p>Quand vous verrez du code s’exécuter, vous saurez
<strong>exactement</strong> ce qui se passe dans la machine. Ce n’est
plus de la magie — c’est de l’ingénierie que vous maîtrisez.</p>
<hr />
<p><strong>Et maintenant ?</strong></p>
<ul>
<li>Apprenez le C pour approfondir la programmation système</li>
<li>Étudiez le noyau Linux pour voir un vrai OS</li>
<li>Explorez les architectures ARM/RISC-V modernes</li>
<li>Construisez vos propres projets sur la base de Codex !</li>
</ul>
<hr />
<h2 data-number="11.12" id="auto-évaluation-8"><span
class="header-section-number">11.12</span> Auto-évaluation</h2>
<p>Testez votre compréhension de l’ensemble du parcours.</p>
<h3 data-number="11.12.1" id="questions-de-compréhension-8"><span
class="header-section-number">11.12.1</span> Questions de
compréhension</h3>
<p><strong>Q1.</strong> Qu’est-ce qu’un allocateur mémoire et pourquoi
en a-t-on besoin ?</p>
<p><strong>Q2.</strong> Comment fonctionne l’affichage graphique via
MMIO ?</p>
<p><strong>Q3.</strong> Quelle est la différence entre polling et
interruptions ?</p>
<p><strong>Q4.</strong> Pourquoi sépare-t-on le code en bibliothèques
(Math, String, Screen, etc.) ?</p>
<p><strong>Q5.</strong> Résumez le chemin complet du code source à
l’exécution.</p>
<p><em>Les solutions se trouvent dans le document
<strong>Codex_Solutions</strong>.</em></p>
<h3 data-number="11.12.2" id="réflexion-finale"><span
class="header-section-number">11.12.2</span> Réflexion finale</h3>
<p>Vous avez maintenant une vision complète de comment fonctionne un
ordinateur :</p>
<table>
<thead>
<tr class="header">
<th>Couche</th>
<th>Ce que vous avez appris</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Portes logiques</td>
<td>NAND → NOT, AND, OR, XOR, MUX</td>
</tr>
<tr class="even">
<td>Arithmétique</td>
<td>Half Adder → Full Adder → ALU</td>
</tr>
<tr class="odd">
<td>Mémoire</td>
<td>DFF → Registre → RAM → PC</td>
</tr>
<tr class="even">
<td>CPU</td>
<td>Fetch-Decode-Execute, pipeline</td>
</tr>
<tr class="odd">
<td>ISA</td>
<td>Instructions A32, encodage binaire</td>
</tr>
<tr class="even">
<td>Assembleur</td>
<td>Texte → Binaire (2 passes)</td>
</tr>
<tr class="odd">
<td>Compilateur</td>
<td>C32 → Assembleur (lexer, parser, codegen)</td>
</tr>
<tr class="even">
<td>OS</td>
<td>Allocation mémoire, graphiques, I/O</td>
</tr>
</tbody>
</table>
<p><strong>Vous n’êtes plus un utilisateur passif de la technologie —
vous comprenez comment elle fonctionne !</strong></p>
<h3 data-number="11.12.3" id="checklist-de-validation-finale"><span
class="header-section-number">11.12.3</span> Checklist de validation
finale</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Je peux expliquer comment NAND
permet de construire toutes les portes</label></li>
<li><label><input type="checkbox" />Je comprends le complément à 2 et
les drapeaux NZCV</label></li>
<li><label><input type="checkbox" />Je sais tracer l’exécution d’une
instruction dans le CPU</label></li>
<li><label><input type="checkbox" />Je peux écrire et déboguer un
programme en assembleur A32</label></li>
<li><label><input type="checkbox" />Je comprends comment le compilateur
traduit C32 en assembleur</label></li>
<li><label><input type="checkbox" />Je sais utiliser le MMIO pour
l’écran et le clavier</label></li>
<li><label><input type="checkbox" />Je peux expliquer la hiérarchie
mémoire (registres → cache → RAM)</label></li>
</ul>
<h1 data-number="12" id="annexe-tous-les-exercices"><span
class="header-section-number">12</span> Annexe : Tous les Exercices</h1>
<p>Cette annexe contient les enonces de tous les exercices disponibles
sur le simulateur web.</p>
<hr />
<h2 data-number="12.1" id="a.-exercices-hdl-portes-logiques"><span
class="header-section-number">12.1</span> A. Exercices HDL (Portes
Logiques)</h2>
<p>Ces exercices construisent progressivement un ordinateur a partir de
la porte NAND.</p>
<h3 data-number="12.1.1" id="projet-1-portes-de-base"><span
class="header-section-number">12.1.1</span> Projet 1 : Portes de
Base</h3>
<table>
<colgroup>
<col style="width: 43%" />
<col style="width: 56%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Inv</td>
<td style="text-align: left;">Inverseur (NOT) :
<code>Inv(a) = Nand(a, a)</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">And2</td>
<td style="text-align: left;">Porte AND :
<code>And2(a,b) = Inv(Nand(a,b))</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Or2</td>
<td style="text-align: left;">Porte OR :
<code>Or2(a,b) = Nand(Inv(a), Inv(b))</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">Xor2</td>
<td style="text-align: left;">Porte XOR :
<code>Xor2(a,b) = Or2(And2(a, Inv(b)), And2(Inv(a), b))</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mux</td>
<td style="text-align: left;">Multiplexeur : si sel=0 alors y=a sinon
y=b</td>
</tr>
<tr class="even">
<td style="text-align: left;">DMux</td>
<td style="text-align: left;">Demultiplexeur : distribue x vers a ou b
selon sel</td>
</tr>
</tbody>
</table>
<h3 data-number="12.1.2" id="projet-2-arithmetique"><span
class="header-section-number">12.1.2</span> Projet 2 : Arithmetique</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">HalfAdder</td>
<td style="text-align: left;">Demi-additionneur : sum = a XOR b, carry =
a AND b</td>
</tr>
<tr class="even">
<td style="text-align: left;">FullAdder</td>
<td style="text-align: left;">Additionneur complet avec retenue
entrante</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Add32</td>
<td style="text-align: left;">Additionneur 32 bits (ripple carry)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Inc32</td>
<td style="text-align: left;">Incrementeur : ajoute 1 a l’entree</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Alu32</td>
<td style="text-align: left;">ALU 32 bits avec 6 operations</td>
</tr>
</tbody>
</table>
<h3 data-number="12.1.3" id="projet-3-memoire"><span
class="header-section-number">12.1.3</span> Projet 3 : Memoire</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">DFF</td>
<td style="text-align: left;">D Flip-Flop (fourni)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Bit</td>
<td style="text-align: left;">Registre 1 bit avec load</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Register</td>
<td style="text-align: left;">Registre 32 bits</td>
</tr>
<tr class="even">
<td style="text-align: left;">RAM8</td>
<td style="text-align: left;">8 registres avec adressage 3 bits</td>
</tr>
<tr class="odd">
<td style="text-align: left;">RAM64</td>
<td style="text-align: left;">64 registres avec adressage 6 bits</td>
</tr>
<tr class="even">
<td style="text-align: left;">PC</td>
<td style="text-align: left;">Compteur de programme avec
inc/load/reset</td>
</tr>
</tbody>
</table>
<h3 data-number="12.1.4" id="projet-5-cpu"><span
class="header-section-number">12.1.4</span> Projet 5 : CPU</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CPU</td>
<td style="text-align: left;">Processeur complet A32</td>
</tr>
</tbody>
</table>
<h3 data-number="12.1.5" id="projet-6-cpu-pipeline-avance"><span
class="header-section-number">12.1.5</span> Projet 6 : CPU Pipeline
(Avance)</h3>
<p>Ces exercices construisent un CPU pipeline 5 etages avec gestion des
aleas.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">IF_ID_Reg</td>
<td style="text-align: left;">Registre pipeline IF/ID avec stall et
flush</td>
</tr>
<tr class="even">
<td style="text-align: left;">HazardDetect</td>
<td style="text-align: left;">Detection des aleas load-use</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ForwardUnit</td>
<td style="text-align: left;">Bypass des donnees (forwarding)</td>
</tr>
<tr class="even">
<td style="text-align: left;">CPU_Pipeline</td>
<td style="text-align: left;">CPU pipeline 5 etages complet</td>
</tr>
</tbody>
</table>
<h3 data-number="12.1.6" id="projet-7-cache-l1"><span
class="header-section-number">12.1.6</span> Projet 7 : Cache L1</h3>
<p>Ces exercices implementent un cache memoire direct-mapped.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CacheLine</td>
<td style="text-align: left;">Ligne de cache (valid, dirty, tag,
data)</td>
</tr>
<tr class="even">
<td style="text-align: left;">TagCompare</td>
<td style="text-align: left;">Comparateur de tags pour detecter
hit/miss</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WordSelect</td>
<td style="text-align: left;">Selecteur de mot dans une ligne de 128
bits</td>
</tr>
<tr class="even">
<td style="text-align: left;">CacheController</td>
<td style="text-align: left;">Machine a etats (IDLE, FETCH,
WRITEBACK)</td>
</tr>
</tbody>
</table>
<hr />
<h2 data-number="12.2" id="b.-exercices-assembleur-a32"><span
class="header-section-number">12.2</span> B. Exercices Assembleur
A32</h2>
<p>Ces exercices enseignent la programmation en assembleur A32.</p>
<h3 data-number="12.2.1" id="bases"><span
class="header-section-number">12.2.1</span> Bases</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Hello World</td>
<td style="text-align: left;">Charger 42 dans R0</td>
<td style="text-align: left;">R0 = 42</td>
</tr>
<tr class="even">
<td style="text-align: left;">Addition</td>
<td style="text-align: left;">Calculer 15 + 27</td>
<td style="text-align: left;">R0 = 42</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Soustraction</td>
<td style="text-align: left;">Calculer 100 - 58</td>
<td style="text-align: left;">R0 = 42</td>
</tr>
<tr class="even">
<td style="text-align: left;">Logique</td>
<td style="text-align: left;">0xFF AND 0x0F</td>
<td style="text-align: left;">R0 = 15</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Doubler</td>
<td style="text-align: left;">21 * 2 sans MUL</td>
<td style="text-align: left;">R0 = 42</td>
</tr>
</tbody>
</table>
<h3 data-number="12.2.2" id="controle-de-flux"><span
class="header-section-number">12.2.2</span> Controle de Flux</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Conditions</td>
<td style="text-align: left;">Maximum de 25 et 17</td>
<td style="text-align: left;">R0 = 25</td>
</tr>
<tr class="even">
<td style="text-align: left;">Valeur Absolue</td>
<td style="text-align: left;">Calculer</td>
<td style="text-align: left;">-42</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Boucles</td>
<td style="text-align: left;">Somme 1 + 2 + … + 10</td>
<td style="text-align: left;">R0 = 55</td>
</tr>
<tr class="even">
<td style="text-align: left;">Multiplication</td>
<td style="text-align: left;">6 * 7 par additions</td>
<td style="text-align: left;">R0 = 42</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fibonacci</td>
<td style="text-align: left;">Calculer F(10)</td>
<td style="text-align: left;">R0 = 55</td>
</tr>
</tbody>
</table>
<h3 data-number="12.2.3" id="memoire"><span
class="header-section-number">12.2.3</span> Memoire</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tableaux</td>
<td style="text-align: left;">Somme de {10, 20, 30, 40, 50}</td>
<td style="text-align: left;">R0 = 150</td>
</tr>
<tr class="even">
<td style="text-align: left;">Maximum Tableau</td>
<td style="text-align: left;">Max de {12, 45, 7, 89, 23}</td>
<td style="text-align: left;">R0 = 89</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Memoire</td>
<td style="text-align: left;">Store puis Load</td>
<td style="text-align: left;">R0 = 30</td>
</tr>
</tbody>
</table>
<h3 data-number="12.2.4" id="structures"><span
class="header-section-number">12.2.4</span> Structures</h3>
<p>Ces exercices preparent aux structs en C en montrant comment les
donnees structurees sont organisees en memoire.</p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Structure Simple</td>
<td style="text-align: left;">Lire champs d’un Point (x+y)</td>
<td style="text-align: left;">R0 = 42</td>
</tr>
<tr class="even">
<td style="text-align: left;">Initialiser Structure</td>
<td style="text-align: left;">Ecrire dans les champs d’un Point</td>
<td style="text-align: left;">R0 = 42</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Structure Rectangle</td>
<td style="text-align: left;">Structure avec 4 champs, calcul aire</td>
<td style="text-align: left;">R0 = 42</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tableau de Structures</td>
<td style="text-align: left;">Parcourir tableau de Points, somme des
x</td>
<td style="text-align: left;">R0 = 33</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Somme x+y Structures</td>
<td style="text-align: left;">Acceder aux deux champs de chaque
Point</td>
<td style="text-align: left;">R0 = 42</td>
</tr>
</tbody>
</table>
<h3 data-number="12.2.5" id="fonctions-1"><span
class="header-section-number">12.2.5</span> Fonctions</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Fonctions</td>
<td style="text-align: left;">Fonction double(21)</td>
<td style="text-align: left;">R0 = 42</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fonction Add3</td>
<td style="text-align: left;">add3(10, 15, 17)</td>
<td style="text-align: left;">R0 = 42</td>
</tr>
</tbody>
</table>
<h3 data-number="12.2.6" id="entreessorties"><span
class="header-section-number">12.2.6</span> Entrees/Sorties</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Ecrire Caractere</td>
<td style="text-align: left;">Ecrire ‘A’ a PUTC</td>
<td style="text-align: left;">R0 = 65</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hello String</td>
<td style="text-align: left;">Afficher “Hi”</td>
<td style="text-align: left;">R0 = 2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Print Loop</td>
<td style="text-align: left;">Afficher “ABCD” avec boucle</td>
<td style="text-align: left;">R0 = 4</td>
</tr>
</tbody>
</table>
<h3 data-number="12.2.7" id="ecran-320x240-1-bitpixel"><span
class="header-section-number">12.2.7</span> Ecran (320x240, 1
bit/pixel)</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Pixel</td>
<td style="text-align: left;">Allumer pixel (0,0)</td>
<td style="text-align: left;">R0 = 0x80</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ligne Horizontale</td>
<td style="text-align: left;">8 pixels horizontaux</td>
<td style="text-align: left;">R0 = 0xFF</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ligne Verticale</td>
<td style="text-align: left;">8 pixels verticaux</td>
<td style="text-align: left;">R0 = 8</td>
</tr>
<tr class="even">
<td style="text-align: left;">Rectangle</td>
<td style="text-align: left;">Carre 8x8</td>
<td style="text-align: left;">R0 = 8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Damier</td>
<td style="text-align: left;">Motif en damier</td>
<td style="text-align: left;">R0 = 8</td>
</tr>
</tbody>
</table>
<h3 data-number="12.2.8" id="jeux-interactifs"><span
class="header-section-number">12.2.8</span> Jeux Interactifs</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Lire Caractere</td>
<td style="text-align: left;">Lire clavier et convertir ASCII</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lire 2 Chiffres</td>
<td style="text-align: left;">Former un nombre a 2 chiffres</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Deviner Nombre</td>
<td style="text-align: left;">Jeu de devinette (secret = 7)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Degrade</td>
<td style="text-align: left;">Effet dithering sur ecran</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Recherche Dichotomique</td>
<td style="text-align: left;">Trouver 42 en 7 essais</td>
</tr>
</tbody>
</table>
<h3 data-number="12.2.9" id="cache-patterns-dacces-memoire"><span
class="header-section-number">12.2.9</span> Cache (Patterns d’Acces
Memoire)</h3>
<p>Ces exercices illustrent l’impact des patterns d’acces memoire sur
les performances cache.</p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Acces Sequentiel</td>
<td style="text-align: left;">Parcours cache-friendly (adresses
consecutives)</td>
<td style="text-align: left;">R0 = 100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Acces avec Stride</td>
<td style="text-align: left;">Parcours avec sauts de 16 bytes (moins
efficace)</td>
<td style="text-align: left;">R0 = 28</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Reutilisation Registre</td>
<td style="text-align: left;">Charger une fois, reutiliser plusieurs
fois</td>
<td style="text-align: left;">R0 = 91</td>
</tr>
</tbody>
</table>
<hr />
<h2 data-number="12.3" id="c.-exercices-c32"><span
class="header-section-number">12.3</span> C. Exercices C32</h2>
<p>Ces exercices enseignent la programmation en C32.</p>
<h3 data-number="12.3.1" id="bases-1"><span
class="header-section-number">12.3.1</span> Bases</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Variables</td>
<td style="text-align: left;">x=10, y=32, retourner x+y</td>
<td style="text-align: left;">42</td>
</tr>
<tr class="even">
<td style="text-align: left;">Expressions</td>
<td style="text-align: left;">(5+3)*(10-4)/2</td>
<td style="text-align: left;">24</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Modulo</td>
<td style="text-align: left;">(100%7) + (45%8)</td>
<td style="text-align: left;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">Incrementation</td>
<td style="text-align: left;">5 -&gt; +3 -&gt; *2 -&gt; -1</td>
<td style="text-align: left;">15</td>
</tr>
</tbody>
</table>
<h3 data-number="12.3.2" id="conditions"><span
class="header-section-number">12.3.2</span> Conditions</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Conditions</td>
<td style="text-align: left;">Maximum de 25 et 17</td>
<td style="text-align: left;">25</td>
</tr>
<tr class="even">
<td style="text-align: left;">Else-If</td>
<td style="text-align: left;">Classifier note 75</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Operateurs Logiques</td>
<td style="text-align: left;">15 dans [10,20] ?</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Maximum de 3</td>
<td style="text-align: left;">Max de 15, 42, 27</td>
<td style="text-align: left;">42</td>
</tr>
</tbody>
</table>
<h3 data-number="12.3.3" id="boucles"><span
class="header-section-number">12.3.3</span> Boucles</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Boucle For</td>
<td style="text-align: left;">Somme 1 a 10</td>
<td style="text-align: left;">55</td>
</tr>
<tr class="even">
<td style="text-align: left;">Boucle While</td>
<td style="text-align: left;">Compter chiffres de 12345</td>
<td style="text-align: left;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Boucles Imbriquees</td>
<td style="text-align: left;">Double boucle i*j</td>
<td style="text-align: left;">60</td>
</tr>
<tr class="even">
<td style="text-align: left;">Multiplication</td>
<td style="text-align: left;">7<em>8 sans operateur </em></td>
<td style="text-align: left;">56</td>
</tr>
</tbody>
</table>
<h3 data-number="12.3.4" id="fonctions-2"><span
class="header-section-number">12.3.4</span> Fonctions</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Fonctions</td>
<td style="text-align: left;">square(7)</td>
<td style="text-align: left;">49</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parametres Multiples</td>
<td style="text-align: left;">add3(10, 20, 12)</td>
<td style="text-align: left;">42</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Valeur Absolue</td>
<td style="text-align: left;">abs(-15) + abs(10)</td>
<td style="text-align: left;">25</td>
</tr>
<tr class="even">
<td style="text-align: left;">Min et Max</td>
<td style="text-align: left;">max(10,25) - min(10,25)</td>
<td style="text-align: left;">15</td>
</tr>
</tbody>
</table>
<h3 data-number="12.3.5" id="tableaux-1"><span
class="header-section-number">12.3.5</span> Tableaux</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Tableaux</td>
<td style="text-align: left;">Somme de {3,7,2,9,5}</td>
<td style="text-align: left;">26</td>
</tr>
<tr class="even">
<td style="text-align: left;">Maximum Tableau</td>
<td style="text-align: left;">Max de 6 elements</td>
<td style="text-align: left;">56</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Compter Elements</td>
<td style="text-align: left;">Nombres pairs</td>
<td style="text-align: left;">4</td>
</tr>
</tbody>
</table>
<h3 data-number="12.3.6" id="pointeurs-1"><span
class="header-section-number">12.3.6</span> Pointeurs</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Pointeurs</td>
<td style="text-align: left;">Modifier via *p</td>
<td style="text-align: left;">42</td>
</tr>
<tr class="even">
<td style="text-align: left;">Swap</td>
<td style="text-align: left;">Echanger x et y</td>
<td style="text-align: left;">20</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Pointeurs et Tableaux</td>
<td style="text-align: left;">Somme avec *(p+i)</td>
<td style="text-align: left;">50</td>
</tr>
</tbody>
</table>
<h3 data-number="12.3.7" id="operations-binaires"><span
class="header-section-number">12.3.7</span> Operations Binaires</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Operations Binaires</td>
<td style="text-align: left;">(10&amp;12)</td>
<td style="text-align: left;">(10^12)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Puissance de 2</td>
<td style="text-align: left;">is_pow2(16)+is_pow2(15)+is_pow2(32)</td>
<td style="text-align: left;">2</td>
</tr>
</tbody>
</table>
<h3 data-number="12.3.8" id="recursion"><span
class="header-section-number">12.3.8</span> Recursion</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Factorielle</td>
<td style="text-align: left;">fact(5)</td>
<td style="text-align: left;">120</td>
</tr>
<tr class="even">
<td style="text-align: left;">Fibonacci</td>
<td style="text-align: left;">fib(10)</td>
<td style="text-align: left;">55</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Somme Recursive</td>
<td style="text-align: left;">sum(10)</td>
<td style="text-align: left;">55</td>
</tr>
</tbody>
</table>
<h3 data-number="12.3.9" id="algorithmes-avances"><span
class="header-section-number">12.3.9</span> Algorithmes Avances</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PGCD (Euclide)</td>
<td style="text-align: left;">gcd(48, 18)</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">Puissance</td>
<td style="text-align: left;">power(2, 10)</td>
<td style="text-align: left;">1024</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Test Primalite</td>
<td style="text-align: left;">Premiers &lt;= 20</td>
<td style="text-align: left;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">Tri a Bulles</td>
<td style="text-align: left;">Trier et retourner min</td>
<td style="text-align: left;">12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Recherche Binaire</td>
<td style="text-align: left;">Trouver 23 dans tableau</td>
<td style="text-align: left;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Inverser Tableau</td>
<td style="text-align: left;">Inverser {1,2,3,4,5}</td>
<td style="text-align: left;">35</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Somme Chiffres</td>
<td style="text-align: left;">digit_sum(12345)</td>
<td style="text-align: left;">15</td>
</tr>
<tr class="even">
<td style="text-align: left;">Palindrome</td>
<td style="text-align: left;">12321 + 1221 + 123</td>
<td style="text-align: left;">2</td>
</tr>
</tbody>
</table>
<h3 data-number="12.3.10" id="structures-1"><span
class="header-section-number">12.3.10</span> Structures</h3>
<p>Les structures permettent de regrouper plusieurs variables liees.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Definition Struct</td>
<td style="text-align: left;">struct Point, p.x + p.y</td>
<td style="text-align: left;">42</td>
</tr>
<tr class="even">
<td style="text-align: left;">Pointeur Struct</td>
<td style="text-align: left;">Utiliser l’operateur -&gt;</td>
<td style="text-align: left;">42</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Struct et Fonctions</td>
<td style="text-align: left;">distance_sq(Point*)</td>
<td style="text-align: left;">25</td>
</tr>
<tr class="even">
<td style="text-align: left;">Structs Imbriquees</td>
<td style="text-align: left;">Rectangle avec Point</td>
<td style="text-align: left;">42</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Tableau de Structs</td>
<td style="text-align: left;">Point[3], somme des x</td>
<td style="text-align: left;">33</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sizeof Struct</td>
<td style="text-align: left;">Taille des structures</td>
<td style="text-align: left;">16</td>
</tr>
</tbody>
</table>
<h3 data-number="12.3.11" id="cache-patterns-dacces-memoire-1"><span
class="header-section-number">12.3.11</span> Cache (Patterns d’Acces
Memoire)</h3>
<p>Ces exercices illustrent l’impact de la localite sur les performances
cache.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Parcours en Ligne</td>
<td style="text-align: left;">Parcours row-major (cache-friendly)</td>
<td style="text-align: left;">120</td>
</tr>
<tr class="even">
<td style="text-align: left;">Parcours en Colonne</td>
<td style="text-align: left;">Parcours column-major (moins
efficace)</td>
<td style="text-align: left;">120</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Traitement par Blocs</td>
<td style="text-align: left;">Technique de blocking</td>
<td style="text-align: left;">120</td>
</tr>
<tr class="even">
<td style="text-align: left;">Localite Temporelle</td>
<td style="text-align: left;">Reutiliser les donnees en cache</td>
<td style="text-align: left;">30</td>
</tr>
</tbody>
</table>
<h3 data-number="12.3.12" id="entreessorties-1"><span
class="header-section-number">12.3.12</span> Entrees/Sorties</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Ecrire Caractere</td>
<td style="text-align: left;">putchar(65)</td>
<td style="text-align: left;">65</td>
</tr>
<tr class="even">
<td style="text-align: left;">Afficher Chaine</td>
<td style="text-align: left;">print(“HI”)</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Afficher Nombre</td>
<td style="text-align: left;">print_int(42)</td>
<td style="text-align: left;">42</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dessiner Pixel</td>
<td style="text-align: left;">Pixel (0,0)</td>
<td style="text-align: left;">128</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ligne Horizontale</td>
<td style="text-align: left;">16 pixels</td>
<td style="text-align: left;">16</td>
</tr>
<tr class="even">
<td style="text-align: left;">Dessiner Rectangle</td>
<td style="text-align: left;">Carre 8x8</td>
<td style="text-align: left;">64</td>
</tr>
</tbody>
</table>
<h3 data-number="12.3.13" id="projets-avances"><span
class="header-section-number">12.3.13</span> Projets Avances</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Objectif</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Crible Eratosthene</td>
<td style="text-align: left;">Premiers &lt;= 50</td>
<td style="text-align: left;">15</td>
</tr>
<tr class="even">
<td style="text-align: left;">Suite Collatz</td>
<td style="text-align: left;">Longueur pour n=27</td>
<td style="text-align: left;">112</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Projet Final</td>
<td style="text-align: left;">Diviseurs de 28</td>
<td style="text-align: left;">28</td>
</tr>
</tbody>
</table>
<hr />
<h2 data-number="12.4" id="d.-construction-du-compilateur"><span
class="header-section-number">12.4</span> D. Construction du
Compilateur</h2>
<p>Ces exercices construisent progressivement un compilateur C -&gt;
A32.</p>
<h3 data-number="12.4.1" id="phase-1-lexer"><span
class="header-section-number">12.4.1</span> Phase 1 : Lexer</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1.1 Reconnaitre Chiffre</td>
<td style="text-align: left;"><code>is_digit(c)</code> : retourne 1 si
‘0’-‘9’</td>
</tr>
<tr class="even">
<td style="text-align: left;">1.2 Lire Nombre</td>
<td style="text-align: left;"><code>parse_number(s, pos)</code> :
extrait un entier</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1.3 Identifier Tokens</td>
<td style="text-align: left;"><code>next_token()</code> : retourne type
du token</td>
</tr>
</tbody>
</table>
<h3 data-number="12.4.2" id="phase-2-parser"><span
class="header-section-number">12.4.2</span> Phase 2 : Parser</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">2.1 Evaluer a + b</td>
<td style="text-align: left;">Parser et calculer une operation</td>
</tr>
<tr class="even">
<td style="text-align: left;">2.2 Evaluer a + b + c</td>
<td style="text-align: left;">Chaine d’operations gauche a droite</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2.3 Precedence</td>
<td style="text-align: left;">Descente recursive : <code>*</code> avant
<code>+</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">2.4 Parentheses</td>
<td style="text-align: left;">Supporter <code>(2 + 3) * 4</code></td>
</tr>
</tbody>
</table>
<h3 data-number="12.4.3" id="phase-3-emission-asm"><span
class="header-section-number">12.4.3</span> Phase 3 : Emission ASM</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">3.1 Generer MOV</td>
<td style="text-align: left;">Produire <code>"MOV R0, #42"</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">3.2 Operation Binaire</td>
<td style="text-align: left;">Mapper <code>+</code> -&gt;
<code>ADD</code>, <code>*</code> -&gt; <code>MUL</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">3.3 Comparaison</td>
<td style="text-align: left;">Generer <code>CMP</code> et
conditions</td>
</tr>
</tbody>
</table>
<h3 data-number="12.4.4" id="phase-4-codegen-expressions-1"><span
class="header-section-number">12.4.4</span> Phase 4 : CodeGen
Expressions</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">4.1 Constante -&gt; A32</td>
<td style="text-align: left;">Code pour charger une constante</td>
</tr>
<tr class="even">
<td style="text-align: left;">4.2 Addition -&gt; A32</td>
<td style="text-align: left;"><code>a + b</code> -&gt;
<code>MOV/MOV/ADD</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;">4.3 Expression -&gt; A32</td>
<td style="text-align: left;">Expression complete avec precedence</td>
</tr>
</tbody>
</table>
<h3 data-number="12.4.5" id="phase-5-structures-de-controle"><span
class="header-section-number">12.4.5</span> Phase 5 : Structures de
Controle</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">5.1 If/Else -&gt; A32</td>
<td style="text-align: left;">Sauts conditionnels et labels</td>
</tr>
<tr class="even">
<td style="text-align: left;">5.2 While -&gt; A32</td>
<td style="text-align: left;">Boucles avec labels</td>
</tr>
</tbody>
</table>
<h3 data-number="12.4.6" id="phase-6-fonctions-1"><span
class="header-section-number">12.4.6</span> Phase 6 : Fonctions</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">6.1 Prologue/Epilogue</td>
<td style="text-align: left;">Sauvegarder LR, reserver pile</td>
</tr>
<tr class="even">
<td style="text-align: left;">6.2 Appel de Fonction</td>
<td style="text-align: left;">Arguments et BL</td>
</tr>
</tbody>
</table>
<h3 data-number="12.4.7" id="phase-7-projet-final-1"><span
class="header-section-number">12.4.7</span> Phase 7 : Projet Final</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">7.1 Mini-Compilateur</td>
<td style="text-align: left;">Compiler expression en A32 executable</td>
</tr>
</tbody>
</table>
<hr />
<h2 data-number="12.5" id="e.-systeme-dexploitation"><span
class="header-section-number">12.5</span> E. Systeme d’Exploitation</h2>
<p>Ces exercices introduisent les concepts OS.</p>
<h3 data-number="12.5.1" id="initialisation"><span
class="header-section-number">12.5.1</span> Initialisation</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Bootstrap</td>
<td style="text-align: left;">Initialiser SP, effacer BSS, appeler
main</td>
<td style="text-align: left;">42</td>
</tr>
</tbody>
</table>
<h3 data-number="12.5.2" id="gestion-memoire"><span
class="header-section-number">12.5.2</span> Gestion Memoire</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Bump Allocator</td>
<td style="text-align: left;">Allocation simple par incrementation</td>
<td style="text-align: left;">100</td>
</tr>
<tr class="even">
<td style="text-align: left;">Free List</td>
<td style="text-align: left;">Allocateur avec liberation</td>
<td style="text-align: left;">1</td>
</tr>
</tbody>
</table>
<h3 data-number="12.5.3" id="drivers"><span
class="header-section-number">12.5.3</span> Drivers</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Driver Ecran</td>
<td style="text-align: left;">Fonctions set_pixel, clear_screen</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">Police Bitmap</td>
<td style="text-align: left;">Dessiner caracteres 8x8</td>
<td style="text-align: left;">51</td>
</tr>
</tbody>
</table>
<h3 data-number="12.5.4" id="console-et-clavier"><span
class="header-section-number">12.5.4</span> Console et Clavier</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Console</td>
<td style="text-align: left;">Console texte avec curseur (40x30)</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Driver Clavier</td>
<td style="text-align: left;">Lire les touches, buffer clavier</td>
<td style="text-align: left;">3</td>
</tr>
</tbody>
</table>
<h3 data-number="12.5.5" id="shell-et-applications"><span
class="header-section-number">12.5.5</span> Shell et Applications</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Shell</td>
<td style="text-align: left;">Interpreteur de commandes basique</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Calculatrice</td>
<td style="text-align: left;">Evaluer expressions arithmetiques</td>
<td style="text-align: left;">42</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Variables Shell</td>
<td style="text-align: left;">Variables dans le shell ($x, $y)</td>
<td style="text-align: left;">15</td>
</tr>
<tr class="even">
<td style="text-align: left;">Compte a Rebours</td>
<td style="text-align: left;">Timer avec affichage</td>
<td style="text-align: left;">0</td>
</tr>
</tbody>
</table>
<h3 data-number="12.5.6" id="multitache"><span
class="header-section-number">12.5.6</span> Multitache</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Resultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Interruptions</td>
<td style="text-align: left;">Gestion des interruptions timer</td>
<td style="text-align: left;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">Coroutines</td>
<td style="text-align: left;">Changement de contexte manuel</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Scheduler</td>
<td style="text-align: left;">Ordonnanceur round-robin</td>
<td style="text-align: left;">6</td>
</tr>
</tbody>
</table>
<h3 data-number="12.5.7" id="projets-os"><span
class="header-section-number">12.5.7</span> Projets OS</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Projet 1: Mini-OS Shell</td>
<td style="text-align: left;">Shell complet avec commandes</td>
</tr>
<tr class="even">
<td style="text-align: left;">Projet 2: Task Manager</td>
<td style="text-align: left;">Gestionnaire de taches multiples</td>
</tr>
</tbody>
</table>
<hr />
<h2 data-number="12.6" id="conseils-pour-les-exercices"><span
class="header-section-number">12.6</span> Conseils pour les
Exercices</h2>
<ol type="1">
<li><strong>Commencez simple</strong> : Les premiers exercices de chaque
section sont accessibles</li>
<li><strong>Lisez l’enonce</strong> : Chaque exercice contient des
indices</li>
<li><strong>Testez souvent</strong> : Le simulateur execute votre code
instantanement</li>
<li><strong>Consultez les solutions</strong> : Apres avoir essaye,
comparez avec la solution</li>
<li><strong>Progressez</strong> : Chaque exercice prepare le
suivant</li>
</ol>
<hr />
<p><strong>Bon courage !</strong></p>
<h1 data-number="13" id="lart-du-débogage"><span
class="header-section-number">13</span> L’Art du Débogage</h1>
<blockquote>
<p>“Le débogage, c’est comme être détective dans un film policier où
vous êtes aussi le meurtrier.” — Filipe Fortes</p>
</blockquote>
<p>Le débogage est une compétence fondamentale en programmation. Ce
chapitre vous apprend à trouver et corriger les erreurs de manière
méthodique.</p>
<hr />
<h2 data-number="13.1" id="pourquoi-ce-chapitre"><span
class="header-section-number">13.1</span> Pourquoi ce Chapitre ?</h2>
<p>Vous avez appris à construire des circuits, écrire de l’assembleur,
et utiliser un compilateur. Mais que faire quand <strong>ça ne marche
pas</strong> ?</p>
<p>Ce chapitre couvre : 1. Comment lire les messages d’erreur 2. Comment
utiliser le simulateur pas-à-pas 3. Les erreurs les plus courantes et
leurs solutions 4. Une méthodologie systématique de débogage</p>
<hr />
<h2 data-number="13.2" id="comprendre-les-messages-derreur"><span
class="header-section-number">13.2</span> 1. Comprendre les Messages
d’Erreur</h2>
<h3 data-number="13.2.1" id="codes-derreur-du-projet-codex"><span
class="header-section-number">13.2.1</span> Codes d’Erreur du Projet
Codex</h3>
<p>Les outils du projet utilisent des codes d’erreur standardisés :</p>
<table>
<thead>
<tr class="header">
<th>Préfixe</th>
<th>Source</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>E1xxx</strong></td>
<td>Assembleur</td>
<td>Erreurs d’assemblage</td>
</tr>
<tr class="even">
<td><strong>E2xxx</strong></td>
<td>Compilateur C32</td>
<td>Erreurs de compilation</td>
</tr>
<tr class="odd">
<td><strong>E3xxx</strong></td>
<td>Linker</td>
<td>Erreurs de liaison</td>
</tr>
</tbody>
</table>
<h3 data-number="13.2.2" id="erreurs-dassemblage-e1xxx"><span
class="header-section-number">13.2.2</span> Erreurs d’Assemblage
(E1xxx)</h3>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 48%" />
<col style="width: 32%" />
</colgroup>
<thead>
<tr class="header">
<th>Code</th>
<th>Signification</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>E1001</td>
<td>Mnémonique inconnu</td>
<td>Vérifiez l’orthographe de l’instruction</td>
</tr>
<tr class="even">
<td>E1002</td>
<td>Opérande invalide</td>
<td>Vérifiez le format des registres/immédiats</td>
</tr>
<tr class="odd">
<td>E1003</td>
<td>Label non défini</td>
<td>Ajoutez le label ou corrigez son nom</td>
</tr>
<tr class="even">
<td>E1004</td>
<td>Immédiat hors plage</td>
<td>Utilisez <code>LDR R0, =value</code> pour les grandes valeurs</td>
</tr>
<tr class="odd">
<td>E1005</td>
<td>Registre invalide</td>
<td>Utilisez R0-R15 uniquement</td>
</tr>
<tr class="even">
<td>E1008</td>
<td>Literal pool overflow</td>
<td>Placez <code>.ltorg</code> plus tôt dans le code</td>
</tr>
</tbody>
</table>
<p><strong>Exemple</strong> : Erreur E1004</p>
<div class="sourceCode" id="cb180"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co">; ERREUR : L&#39;immédiat 0x12345678 ne tient pas sur 12 bits</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span> R0<span class="op">,</span> <span class="op">#</span><span class="bn">0x12345678</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a><span class="co">; SOLUTION : Utiliser le literal pool</span></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>LDR R0<span class="op">,</span> <span class="op">=</span><span class="bn">0x12345678</span></span></code></pre></div>
<h3 data-number="13.2.3" id="erreurs-de-compilation-e2xxx"><span
class="header-section-number">13.2.3</span> Erreurs de Compilation
(E2xxx)</h3>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 48%" />
<col style="width: 32%" />
</colgroup>
<thead>
<tr class="header">
<th>Code</th>
<th>Signification</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>E2001</td>
<td>Erreur de syntaxe</td>
<td>Vérifiez les parenthèses, points-virgules</td>
</tr>
<tr class="even">
<td>E2002</td>
<td>Type incompatible</td>
<td>Vérifiez les types des opérandes</td>
</tr>
<tr class="odd">
<td>E2003</td>
<td>Variable non déclarée</td>
<td>Déclarez la variable avant utilisation</td>
</tr>
<tr class="even">
<td>E2004</td>
<td>Fonction non définie</td>
<td>Définissez la fonction ou incluez le header</td>
</tr>
<tr class="odd">
<td>E2008</td>
<td>Return manquant</td>
<td>Ajoutez <code>return</code> à la fin de la fonction</td>
</tr>
</tbody>
</table>
<p><strong>Exemple</strong> : Erreur E2003</p>
<div class="sourceCode" id="cb181"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ERREUR : &#39;x&#39; non déclaré</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="dv">5</span><span class="op">;</span>  <span class="co">// E2003: Variable &#39;x&#39; non déclarée</span></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a><span class="co">// SOLUTION : Déclarer la variable</span></span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">;</span></span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb181-11"><a href="#cb181-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb181-12"><a href="#cb181-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="13.2.4" id="erreurs-de-liaison-e3xxx"><span
class="header-section-number">13.2.4</span> Erreurs de Liaison
(E3xxx)</h3>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 48%" />
<col style="width: 32%" />
</colgroup>
<thead>
<tr class="header">
<th>Code</th>
<th>Signification</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>E3001</td>
<td>Symbole non résolu</td>
<td>Définissez le symbole ou liez la bibliothèque</td>
</tr>
<tr class="even">
<td>E3002</td>
<td>Point d’entrée manquant</td>
<td>Ajoutez <code>_start:</code> ou <code>main()</code></td>
</tr>
<tr class="odd">
<td>E3004</td>
<td>Débordement mémoire</td>
<td>Réduisez la taille du programme</td>
</tr>
</tbody>
</table>
<hr />
<h2 data-number="13.3" id="utiliser-le-simulateur-pas-à-pas"><span
class="header-section-number">13.3</span> 2. Utiliser le Simulateur
Pas-à-Pas</h2>
<h3 data-number="13.3.1" id="le-visualiseur-cpu"><span
class="header-section-number">13.3.1</span> Le Visualiseur CPU</h3>
<p>Le visualiseur web (<code>web/visualizer.html</code>) est votre
meilleur ami pour déboguer.</p>
<p><strong>Fonctionnalités clés</strong> : - <strong>Step (N ou
F10)</strong> : Exécute une instruction - <strong>Registres</strong> :
Voir R0-R15, SP, LR, PC et les flags - <strong>Mémoire</strong> :
Inspecter la RAM - <strong>Code</strong> : Ligne courante surlignée</p>
<h3 data-number="13.3.2" id="méthodologie-de-débogage-pas-à-pas"><span
class="header-section-number">13.3.2</span> Méthodologie de Débogage
Pas-à-Pas</h3>
<ol type="1">
<li><strong>Chargez votre programme</strong> dans le visualiseur</li>
<li><strong>Identifiez le symptôme</strong> : Qu’est-ce qui ne va pas
?</li>
<li><strong>Formulez une hypothèse</strong> : Où le bug pourrait-il être
?</li>
<li><strong>Placez-vous avant</strong> la zone suspecte</li>
<li><strong>Exécutez pas-à-pas</strong> en vérifiant les registres</li>
<li><strong>Trouvez la divergence</strong> : Où le comportement
diffère-t-il de l’attendu ?</li>
</ol>
<h3 data-number="13.3.3" id="exemple-pratique"><span
class="header-section-number">13.3.3</span> Exemple Pratique</h3>
<p><strong>Programme bugué</strong> :</p>
<div class="sourceCode" id="cb182"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co">; Censé calculer 5 + 3 = 8</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">5</span></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> R1<span class="op">,</span> <span class="op">#</span><span class="dv">3</span></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">SUB</span> R2<span class="op">,</span> R0<span class="op">,</span> R1   <span class="co">; </span><span class="al">BUG</span><span class="co"> : devrait être ADD !</span></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>    SVC <span class="op">#</span><span class="dv">0</span></span></code></pre></div>
<p><strong>Débogage</strong> : 1. Après <code>MOV R0, #5</code> : R0 = 5
✓ 2. Après <code>MOV R1, #3</code> : R1 = 3 ✓ 3. Après
<code>SUB R2, R0, R1</code> : R2 = 2 ✗ (attendu : 8)</p>
<p>→ <strong>Bug trouvé</strong> : <code>SUB</code> au lieu de
<code>ADD</code></p>
<hr />
<h2 data-number="13.4" id="erreurs-courantes-et-solutions"><span
class="header-section-number">13.4</span> 3. Erreurs Courantes et
Solutions</h2>
<h3 data-number="13.4.1" id="assembleur"><span
class="header-section-number">13.4.1</span> 3.1 Assembleur</h3>
<h4 data-number="13.4.1.1" id="oubli-de-sauvegarder-lr"><span
class="header-section-number">13.4.1.1</span> Oubli de sauvegarder
LR</h4>
<p><strong>Symptôme</strong> : Le programme ne retourne pas correctement
d’une fonction.</p>
<div class="sourceCode" id="cb183"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co">; BUGUÉ</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="fu">my_func:</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>    BL other_func    <span class="co">; LR est écrasé !</span></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>    BX LR            <span class="co">; Retourne... où ?</span></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a><span class="co">; CORRECT</span></span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a><span class="fu">my_func:</span></span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">PUSH</span> <span class="op">{</span>LR<span class="op">}</span>        <span class="co">; Sauvegarder LR</span></span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a>    BL other_func</span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">POP</span> <span class="op">{</span>LR<span class="op">}</span>         <span class="co">; Restaurer LR</span></span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a>    BX LR</span></code></pre></div>
<h4 data-number="13.4.1.2" id="off-by-one-dans-les-boucles"><span
class="header-section-number">13.4.1.2</span> Off-by-one dans les
boucles</h4>
<p><strong>Symptôme</strong> : La boucle s’exécute une fois de trop ou
de moins.</p>
<div class="sourceCode" id="cb184"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co">; BUGUÉ : S&#39;arrête à 9 au lieu de 10</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">0</span></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loop:</span></span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">CMP</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">10</span></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>    B<span class="op">.</span>EQ done         <span class="co">; B.EQ : si R0 == 10, sauter</span></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">; ... corps de la boucle ...</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">ADD</span> R0<span class="op">,</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">1</span></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>    B loop</span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a><span class="fu">done:</span></span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a><span class="co">; Vérifiez toujours : combien d&#39;itérations attendues ?</span></span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a><span class="co">; R0 va de 0 à 9 = 10 itérations ✓</span></span></code></pre></div>
<h4 data-number="13.4.1.3" id="mauvais-alignement-mémoire"><span
class="header-section-number">13.4.1.3</span> Mauvais alignement
mémoire</h4>
<p><strong>Symptôme</strong> : Erreur MISALIGNED ou données
corrompues.</p>
<div class="sourceCode" id="cb185"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co">; BUGUÉ : Adresse non alignée sur 4 octets</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>    LDR R0<span class="op">,</span> <span class="op">[</span>R1<span class="op">,</span> <span class="op">#</span><span class="dv">3</span><span class="op">]</span>   <span class="co">; 3 n&#39;est pas multiple de 4 !</span></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a><span class="co">; CORRECT</span></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>    LDR R0<span class="op">,</span> <span class="op">[</span>R1<span class="op">,</span> <span class="op">#</span><span class="dv">4</span><span class="op">]</span>   <span class="co">; OK : 4 est multiple de 4</span></span></code></pre></div>
<h3 data-number="13.4.2" id="compilateur-c32"><span
class="header-section-number">13.4.2</span> 3.2 Compilateur C32</h3>
<h4 data-number="13.4.2.1" id="oubli-du-return"><span
class="header-section-number">13.4.2.1</span> Oubli du return</h4>
<p><strong>Symptôme</strong> : Valeur de retour incorrecte ou
aléatoire.</p>
<div class="sourceCode" id="cb186"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co">// BUGUÉ</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> c <span class="op">=</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Oops, pas de return !</span></span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a><span class="co">// CORRECT</span></span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb186-9"><a href="#cb186-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> c <span class="op">=</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb186-10"><a href="#cb186-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> c<span class="op">;</span></span>
<span id="cb186-11"><a href="#cb186-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 data-number="13.4.2.2" id="confusion-pointeurvaleur"><span
class="header-section-number">13.4.2.2</span> Confusion
pointeur/valeur</h4>
<p><strong>Symptôme</strong> : Crash ou données incorrectes.</p>
<div class="sourceCode" id="cb187"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co">// BUGUÉ</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> increment<span class="op">(</span><span class="dt">int</span> x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> x <span class="op">+</span> <span class="dv">1</span><span class="op">;</span>  <span class="co">// Modifie la COPIE, pas l&#39;original !</span></span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a><span class="co">// CORRECT</span></span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> increment<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>x <span class="op">=</span> <span class="op">*</span>x <span class="op">+</span> <span class="dv">1</span><span class="op">;</span>  <span class="co">// Modifie la valeur POINTÉE</span></span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Appel</span></span>
<span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb187-13"><a href="#cb187-13" aria-hidden="true" tabindex="-1"></a>increment<span class="op">(&amp;</span>n<span class="op">);</span>  <span class="co">// Passer l&#39;ADRESSE</span></span></code></pre></div>
<h4 data-number="13.4.2.3" id="division-par-zéro"><span
class="header-section-number">13.4.2.3</span> Division par zéro</h4>
<p><strong>Symptôme</strong> : Trap DIV_ZERO ou résultat infini.</p>
<div class="sourceCode" id="cb188"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co">// BUGUÉ</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> divide<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">/</span> b<span class="op">;</span>  <span class="co">// Et si b == 0 ?</span></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a><span class="co">// CORRECT</span></span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> divide<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>b <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span>  <span class="co">// Ou gérer l&#39;erreur autrement</span></span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">/</span> b<span class="op">;</span></span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="13.4.3" id="hdl"><span
class="header-section-number">13.4.3</span> 3.3 HDL</h3>
<h4 data-number="13.4.3.1" id="signal-non-connecté"><span
class="header-section-number">13.4.3.1</span> Signal non connecté</h4>
<p><strong>Symptôme</strong> : Sortie toujours à 0 ou X (indéfini).</p>
<div class="sourceCode" id="cb189"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- BUGUÉ : &#39;result&#39; n&#39;est jamais assigné</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="cf">entity</span> <span class="dv">Adder</span> <span class="kw">is</span></span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">port</span>(a<span class="ot">,</span> b <span class="ot">:</span> <span class="kw">in</span> <span class="dt">bit</span>; result <span class="ot">:</span> <span class="kw">out</span> <span class="dt">bit</span>);</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a><span class="cf">end entity;</span></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a><span class="cf">architecture</span> <span class="dv">rtl</span> <span class="kw">of</span> <span class="fu">Adder</span> <span class="kw">is</span></span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a><span class="cf">begin</span></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Oops, rien ici !</span></span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a><span class="cf">end architecture;</span></span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a><span class="co">-- CORRECT</span></span>
<span id="cb189-12"><a href="#cb189-12" aria-hidden="true" tabindex="-1"></a><span class="cf">architecture</span> <span class="dv">rtl</span> <span class="kw">of</span> <span class="fu">Adder</span> <span class="kw">is</span></span>
<span id="cb189-13"><a href="#cb189-13" aria-hidden="true" tabindex="-1"></a><span class="cf">begin</span></span>
<span id="cb189-14"><a href="#cb189-14" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;=</span> a <span class="kw">xor</span> b;  <span class="co">-- Connexion explicite</span></span>
<span id="cb189-15"><a href="#cb189-15" aria-hidden="true" tabindex="-1"></a><span class="cf">end architecture;</span></span></code></pre></div>
<h4 data-number="13.4.3.2" id="boucle-combinatoire"><span
class="header-section-number">13.4.3.2</span> Boucle combinatoire</h4>
<p><strong>Symptôme</strong> : Le simulateur ne converge pas ou donne
des résultats instables.</p>
<div class="sourceCode" id="cb190"><pre
class="sourceCode vhdl"><code class="sourceCode vhdl"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- BUGUÉ : &#39;x&#39; dépend de lui-même instantanément</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="ot">signal</span> x <span class="ot">:</span> <span class="dt">bit</span>;</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;=</span> <span class="kw">not</span> x;  <span class="co">-- Boucle infinie !</span></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- CORRECT : Utiliser une DFF pour la rétroaction</span></span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a><span class="co">-- x(t+1) &lt;= not x(t)  -- Via une DFF</span></span></code></pre></div>
<hr />
<h2 data-number="13.5" id="méthodologie-systématique"><span
class="header-section-number">13.5</span> 4. Méthodologie
Systématique</h2>
<h3 data-number="13.5.1" id="la-méthode-scientifique-du-débogage"><span
class="header-section-number">13.5.1</span> La Méthode Scientifique du
Débogage</h3>
<ol type="1">
<li><strong>Observer</strong> : Quel est le symptôme exact ?
<ul>
<li>Message d’erreur ?</li>
<li>Mauvais résultat ?</li>
<li>Crash ?</li>
</ul></li>
<li><strong>Hypothétiser</strong> : Quelle pourrait être la cause ?
<ul>
<li>Erreur de logique ?</li>
<li>Mauvaise valeur ?</li>
<li>Condition incorrecte ?</li>
</ul></li>
<li><strong>Tester</strong> : Vérifier l’hypothèse
<ul>
<li>Ajouter des prints/traces</li>
<li>Exécuter pas-à-pas</li>
<li>Simplifier le code</li>
</ul></li>
<li><strong>Conclure</strong> : L’hypothèse était-elle correcte ?
<ul>
<li>Si oui → corriger</li>
<li>Si non → nouvelle hypothèse</li>
</ul></li>
</ol>
<h3 data-number="13.5.2" id="la-technique-de-la-bissection"><span
class="header-section-number">13.5.2</span> La Technique de la
Bissection</h3>
<p>Quand le bug est difficile à trouver :</p>
<ol type="1">
<li><strong>Divisez</strong> le code en deux moitiés</li>
<li><strong>Testez</strong> chaque moitié indépendamment</li>
<li><strong>Identifiez</strong> quelle moitié contient le bug</li>
<li><strong>Répétez</strong> jusqu’à isoler le problème</li>
</ol>
<pre><code>Code complet (bug quelque part)
    ├── Première moitié
    │   └── ✓ OK
    └── Deuxième moitié
        └── ✗ Bug ici !
            ├── Premier quart → ✓ OK
            └── Deuxième quart → ✗ Bug trouvé !</code></pre>
<h3 data-number="13.5.3" id="ajouter-des-traces"><span
class="header-section-number">13.5.3</span> Ajouter des Traces</h3>
<p>En C32 :</p>
<div class="sourceCode" id="cb192"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> debug_print<span class="op">(</span><span class="dt">int</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Afficher la valeur pour debug</span></span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>    putc<span class="op">(</span><span class="ch">&#39;[&#39;</span><span class="op">);</span></span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ... afficher value ...</span></span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>    putc<span class="op">(</span><span class="ch">&#39;]&#39;</span><span class="op">);</span></span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>    putc<span class="op">(</span><span class="ch">&#39;</span><span class="sc">\n</span><span class="ch">&#39;</span><span class="op">);</span></span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb192-8"><a href="#cb192-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-9"><a href="#cb192-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb192-10"><a href="#cb192-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x <span class="op">=</span> compute_something<span class="op">();</span></span>
<span id="cb192-11"><a href="#cb192-11" aria-hidden="true" tabindex="-1"></a>    debug_print<span class="op">(</span>x<span class="op">);</span>  <span class="co">// Voir la valeur</span></span>
<span id="cb192-12"><a href="#cb192-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb192-13"><a href="#cb192-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>En assembleur :</p>
<div class="sourceCode" id="cb193"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co">; Afficher R0 pour debug (caractère ASCII)</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">ADD</span> R0<span class="op">,</span> R0<span class="op">,</span> <span class="op">#</span><span class="st">&#39;0&#39;</span>   <span class="co">; Convertir en ASCII</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>    LDR R1<span class="op">,</span> <span class="op">=</span><span class="bn">0xFFFF0000</span></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">STR</span> R0<span class="op">,</span> <span class="op">[</span>R1<span class="op">]</span>       <span class="co">; Afficher</span></span></code></pre></div>
<hr />
<h2 data-number="13.6" id="erreurs-de-traps-et-leur-diagnostic"><span
class="header-section-number">13.6</span> 5. Erreurs de Traps et leur
Diagnostic</h2>
<h3 data-number="13.6.1" id="types-de-traps"><span
class="header-section-number">13.6.1</span> Types de Traps</h3>
<table>
<thead>
<tr class="header">
<th>Trap</th>
<th>Cause</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>DIV_ZERO</td>
<td>Division par 0</td>
<td>Vérifier le diviseur avant</td>
</tr>
<tr class="even">
<td>MEM_FAULT</td>
<td>Accès mémoire invalide</td>
<td>Vérifier les pointeurs</td>
</tr>
<tr class="odd">
<td>MISALIGNED</td>
<td>Adresse non alignée</td>
<td>Aligner sur 4 octets</td>
</tr>
<tr class="even">
<td>ILLEGAL</td>
<td>Instruction invalide</td>
<td>Vérifier l’encodage</td>
</tr>
</tbody>
</table>
<h3 data-number="13.6.2" id="déboguer-un-mem_fault"><span
class="header-section-number">13.6.2</span> Déboguer un MEM_FAULT</h3>
<ol type="1">
<li><strong>Notez l’adresse</strong> du PC quand le trap se produit</li>
<li><strong>Trouvez l’instruction</strong> à cette adresse</li>
<li><strong>Examinez les registres</strong> utilisés pour
l’adressage</li>
<li><strong>Questions à se poser</strong> :
<ul>
<li>Le pointeur est-il initialisé ?</li>
<li>Est-il dans la plage valide (0 - RAM_SIZE) ?</li>
<li>A-t-il été corrompu par une autre partie du code ?</li>
</ul></li>
</ol>
<hr />
<h2 data-number="13.7" id="checklist-de-débogage"><span
class="header-section-number">13.7</span> 6. Checklist de Débogage</h2>
<p>Avant de chercher un bug complexe, vérifiez ces points simples :</p>
<h3 data-number="13.7.1" id="assembleur-1"><span
class="header-section-number">13.7.1</span> Assembleur</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Toutes les instructions sont
correctement orthographiées ?</label></li>
<li><label><input type="checkbox" />Les registres sont dans la plage
R0-R15 ?</label></li>
<li><label><input type="checkbox" />Les immédiats sont dans la plage
autorisée ?</label></li>
<li><label><input type="checkbox" />LR est sauvegardé avant les appels
de fonction ?</label></li>
<li><label><input type="checkbox" />La pile est équilibrée (PUSH = POP)
?</label></li>
<li><label><input type="checkbox" />Les accès mémoire sont alignés sur 4
octets ?</label></li>
</ul>
<h3 data-number="13.7.2" id="c32"><span
class="header-section-number">13.7.2</span> C32</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Toutes les variables sont déclarées
?</label></li>
<li><label><input type="checkbox" />Toutes les fonctions ont un return
?</label></li>
<li><label><input type="checkbox" />Les pointeurs sont initialisés avant
déréférencement ?</label></li>
<li><label><input type="checkbox" />Pas de division par zéro possible
?</label></li>
<li><label><input type="checkbox" />Les indices de tableau sont dans les
bornes ?</label></li>
</ul>
<h3 data-number="13.7.3" id="hdl-1"><span
class="header-section-number">13.7.3</span> HDL</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Toutes les sorties sont assignées
?</label></li>
<li><label><input type="checkbox" />Pas de boucles combinatoires
?</label></li>
<li><label><input type="checkbox" />Les signaux sont de la bonne largeur
(bit vs bits) ?</label></li>
<li><label><input type="checkbox" />Les port maps connectent les bons
signaux ?</label></li>
</ul>
<hr />
<h2 data-number="13.8" id="exercices-de-débogage"><span
class="header-section-number">13.8</span> 7. Exercices de Débogage</h2>
<h3 data-number="13.8.1" id="exercice-1-trouvez-le-bug"><span
class="header-section-number">13.8.1</span> Exercice 1 : Trouvez le
bug</h3>
<div class="sourceCode" id="cb194"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="co">; Programme censé afficher &quot;Hello&quot;</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>    LDR R0<span class="op">,</span> <span class="op">=</span>message</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>    LDR R1<span class="op">,</span> <span class="op">=</span><span class="bn">0xFFFF0000</span></span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a><span class="fu">loop:</span></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a>    LDRB R2<span class="op">,</span> <span class="op">[</span>R0<span class="op">]</span></span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">CMP</span> R2<span class="op">,</span> <span class="op">#</span><span class="dv">0</span></span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a>    B<span class="op">.</span>EQ done</span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">STR</span> R2<span class="op">,</span> <span class="op">[</span>R1<span class="op">]</span></span>
<span id="cb194-9"><a href="#cb194-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">ADD</span> R0<span class="op">,</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">1</span></span>
<span id="cb194-10"><a href="#cb194-10" aria-hidden="true" tabindex="-1"></a>    B done            <span class="co">; &lt;-- Bug ici !</span></span>
<span id="cb194-11"><a href="#cb194-11" aria-hidden="true" tabindex="-1"></a><span class="fu">done:</span></span>
<span id="cb194-12"><a href="#cb194-12" aria-hidden="true" tabindex="-1"></a>    SVC <span class="op">#</span><span class="dv">0</span></span>
<span id="cb194-13"><a href="#cb194-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-14"><a href="#cb194-14" aria-hidden="true" tabindex="-1"></a><span class="fu">message:</span> .asciz <span class="st">&quot;Hello&quot;</span></span></code></pre></div>
<details>
<summary>
Voir la solution
</summary>
<p>Le bug est <code>B done</code> qui devrait être <code>B loop</code>.
Le programme n’affiche que le premier caractère car il saute directement
à <code>done</code> au lieu de boucler.</p>
<div class="sourceCode" id="cb195"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>    B loop    <span class="co">; CORRECT : retourner au début de la boucle</span></span></code></pre></div>
</details>
<h3 data-number="13.8.2" id="exercice-2-trouvez-le-bug"><span
class="header-section-number">13.8.2</span> Exercice 2 : Trouvez le
bug</h3>
<div class="sourceCode" id="cb196"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> factorial<span class="op">(</span><span class="dt">int</span> n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> n <span class="op">*</span> factorial<span class="op">(</span>n<span class="op">);</span>  <span class="co">// &lt;-- Bug ici !</span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<details>
<summary>
Voir la solution
</summary>
<p>Le bug est <code>factorial(n)</code> qui devrait être
<code>factorial(n - 1)</code>. Sans décrémenter n, la récursion est
infinie → stack overflow.</p>
<div class="sourceCode" id="cb197"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> n <span class="op">*</span> factorial<span class="op">(</span>n <span class="op">-</span> <span class="dv">1</span><span class="op">);</span>  <span class="co">// CORRECT</span></span></code></pre></div>
</details>
<h3 data-number="13.8.3" id="exercice-3-trouvez-le-bug"><span
class="header-section-number">13.8.3</span> Exercice 3 : Trouvez le
bug</h3>
<div class="sourceCode" id="cb198"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> swap<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> temp <span class="op">=</span> a<span class="op">;</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>    a <span class="op">=</span> b<span class="op">;</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>    b <span class="op">=</span> temp<span class="op">;</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> y <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a>    swap<span class="op">(</span>x<span class="op">,</span> y<span class="op">);</span></span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// x est toujours 5, y toujours 10 !</span></span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<details>
<summary>
Voir la solution
</summary>
<p>Le bug est le passage par valeur au lieu de passage par pointeur. Les
modifications de <code>a</code> et <code>b</code> n’affectent pas
<code>x</code> et <code>y</code>.</p>
<div class="sourceCode" id="cb199"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> swap<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> temp <span class="op">=</span> <span class="op">*</span>a<span class="op">;</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>a <span class="op">=</span> <span class="op">*</span>b<span class="op">;</span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">*</span>b <span class="op">=</span> temp<span class="op">;</span></span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb199-9"><a href="#cb199-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> y <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb199-10"><a href="#cb199-10" aria-hidden="true" tabindex="-1"></a>    swap<span class="op">(&amp;</span>x<span class="op">,</span> <span class="op">&amp;</span>y<span class="op">);</span>  <span class="co">// Passer les adresses</span></span>
<span id="cb199-11"><a href="#cb199-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb199-12"><a href="#cb199-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</details>
<hr />
<h2 data-number="13.9" id="ce-quil-faut-retenir-9"><span
class="header-section-number">13.9</span> Ce qu’il faut retenir</h2>
<ol type="1">
<li><strong>Lisez les messages d’erreur</strong> : Ils contiennent
souvent la solution</li>
<li><strong>Utilisez le pas-à-pas</strong> : Le visualiseur est votre
meilleur outil</li>
<li><strong>Formulez des hypothèses</strong> : Approche
scientifique</li>
<li><strong>Connaissez les erreurs courantes</strong> : Elles
représentent 90% des bugs</li>
<li><strong>Simplifiez</strong> : Réduisez le problème au minimum
reproductible</li>
</ol>
<p>Le débogage est une compétence qui s’améliore avec la pratique.
Chaque bug que vous trouvez vous rend meilleur !</p>
<h1 data-number="14"
id="le-cache-pourquoi-votre-ordinateur-semble-rapide"><span
class="header-section-number">14</span> Le Cache : Pourquoi Votre
Ordinateur Semble Rapide</h1>
<p>Imaginez que vous travaillez dans un bureau et que vous avez besoin
de consulter des documents. Vous avez deux options : - <strong>Votre
bureau</strong> : les documents sont juste devant vous, vous pouvez les
lire instantanément - <strong>Les archives au sous-sol</strong> : il
faut descendre 5 étages, chercher le bon dossier, remonter… cela prend
plusieurs minutes</p>
<p>Le <strong>cache</strong> est exactement comme votre bureau : une
petite zone de stockage très rapide où l’on garde les documents
(données) les plus utilisés, pour éviter d’aller constamment aux
archives (la mémoire RAM).</p>
<hr />
<h2 data-number="14.1" id="le-problème-la-ram-est-lente"><span
class="header-section-number">14.1</span> Le Problème : La RAM est Lente
!</h2>
<h3 data-number="14.1.1" id="la-hiérarchie-mémoire"><span
class="header-section-number">14.1.1</span> La Hiérarchie Mémoire</h3>
<p>Voici comment est organisée la mémoire dans un ordinateur, du plus
rapide au plus lent :</p>
<figure>
<img src="images/memory-hierarchy.svg" alt="Hiérarchie mémoire" />
<figcaption aria-hidden="true">Hiérarchie mémoire</figcaption>
</figure>
<h3 data-number="14.1.2" id="lécart-de-vitesse-visualisé"><span
class="header-section-number">14.1.2</span> L’écart de vitesse
visualisé</h3>
<p>Si on convertissait ces temps en échelle humaine, les registres
seraient comme cligner des yeux (0.3 seconde), le cache L1 comme une
seconde, le cache L2 comme 4 secondes, la RAM comme 1 minute 40
secondes, et accéder au SSD prendrait… <strong>27 heures</strong> !</p>
<p>Sans cache, le processeur passerait <strong>99% de son temps à
attendre</strong> !</p>
<hr />
<h2 data-number="14.2" id="la-solution-le-principe-de-localité"><span
class="header-section-number">14.2</span> La Solution : Le Principe de
Localité</h2>
<p>Les programmes ne lisent pas la mémoire au hasard. Ils suivent des
<strong>patterns</strong> prévisibles.</p>
<h3 data-number="14.2.1" id="localité-temporelle"><span
class="header-section-number">14.2.1</span> Localité Temporelle</h3>
<p><strong>“Si j’utilise une donnée maintenant, je vais probablement la
réutiliser bientôt”</strong></p>
<figure>
<img src="images/temporal-locality.svg" alt="Localité temporelle" />
<figcaption aria-hidden="true">Localité temporelle</figcaption>
</figure>
<h3 data-number="14.2.2" id="localité-spatiale"><span
class="header-section-number">14.2.2</span> Localité Spatiale</h3>
<p><strong>“Si j’utilise une donnée, je vais probablement utiliser ses
voisines”</strong></p>
<figure>
<img src="images/spatial-locality.svg" alt="Localité spatiale" />
<figcaption aria-hidden="true">Localité spatiale</figcaption>
</figure>
<hr />
<h2 data-number="14.3" id="comment-fonctionne-le-cache"><span
class="header-section-number">14.3</span> Comment Fonctionne le Cache
?</h2>
<h3 data-number="14.3.1" id="les-lignes-de-cache"><span
class="header-section-number">14.3.1</span> Les Lignes de Cache</h3>
<p>Le cache stocke des <strong>blocs</strong> de données appelés
<strong>lignes de cache</strong>, pas des octets individuels.</p>
<p>Quand vous demandez l’adresse 100, le cache charge <strong>16 octets
ensemble</strong> (adresses 100 à 115). Ensuite, si vous demandez 101,
102, 103… c’est gratuit car déjà en cache !</p>
<h3 data-number="14.3.2" id="structure-dune-ligne-de-cache"><span
class="header-section-number">14.3.2</span> Structure d’une Ligne de
Cache</h3>
<figure>
<img src="images/cache-line-structure.svg"
alt="Structure d’une ligne de cache" />
<figcaption aria-hidden="true">Structure d’une ligne de
cache</figcaption>
</figure>
<h3 data-number="14.3.3" id="découpage-dune-adresse"><span
class="header-section-number">14.3.3</span> Découpage d’une Adresse</h3>
<p>Quand le CPU demande l’adresse <code>0x00001234</code>, comment le
cache la trouve-t-il ?</p>
<figure>
<img src="images/address-decomposition.svg"
alt="Décomposition d’une adresse" />
<figcaption aria-hidden="true">Décomposition d’une adresse</figcaption>
</figure>
<h3 data-number="14.3.4" id="structure-complète-du-cache"><span
class="header-section-number">14.3.4</span> Structure Complète du
Cache</h3>
<figure>
<img src="images/cache-direct-mapped.svg" alt="Cache direct-mapped" />
<figcaption aria-hidden="true">Cache direct-mapped</figcaption>
</figure>
<hr />
<h2 data-number="14.4" id="hit-ou-miss-que-se-passe-t-il"><span
class="header-section-number">14.4</span> Hit ou Miss : Que se
passe-t-il ?</h2>
<h3 data-number="14.4.1" id="scénario-1-cache-hit-succès"><span
class="header-section-number">14.4.1</span> Scénario 1 : Cache HIT
(Succès)</h3>
<figure>
<img src="images/cache-hit-scenario.svg" alt="Scénario Cache HIT" />
<figcaption aria-hidden="true">Scénario Cache HIT</figcaption>
</figure>
<h3 data-number="14.4.2" id="scénario-2-cache-miss-échec"><span
class="header-section-number">14.4.2</span> Scénario 2 : Cache MISS
(Échec)</h3>
<figure>
<img src="images/cache-miss-scenario.svg" alt="Scénario Cache MISS" />
<figcaption aria-hidden="true">Scénario Cache MISS</figcaption>
</figure>
<h3 data-number="14.4.3" id="diagramme-de-flux-complet"><span
class="header-section-number">14.4.3</span> Diagramme de Flux
Complet</h3>
<figure>
<img src="images/cache-flowchart.svg"
alt="Algorithme de lecture cache" />
<figcaption aria-hidden="true">Algorithme de lecture cache</figcaption>
</figure>
<hr />
<h2 data-number="14.5" id="politiques-décriture"><span
class="header-section-number">14.5</span> Politiques d’Écriture</h2>
<h3 data-number="14.5.1" id="write-through-écriture-directe"><span
class="header-section-number">14.5.1</span> Write-Through (Écriture
Directe)</h3>
<figure>
<img src="images/write-through.svg" alt="Write-Through" />
<figcaption aria-hidden="true">Write-Through</figcaption>
</figure>
<h3 data-number="14.5.2" id="write-back-écriture-différée"><span
class="header-section-number">14.5.2</span> Write-Back (Écriture
Différée)</h3>
<figure>
<img src="images/write-back.svg" alt="Write-Back" />
<figcaption aria-hidden="true">Write-Back</figcaption>
</figure>
<hr />
<h2 data-number="14.6"
id="types-de-cache-direct-mapped-vs-associatif"><span
class="header-section-number">14.6</span> Types de Cache : Direct-Mapped
vs Associatif</h2>
<h3 data-number="14.6.1"
id="cache-direct-mapped-correspondance-directe"><span
class="header-section-number">14.6.1</span> Cache Direct-Mapped
(Correspondance Directe)</h3>
<p>Dans un cache <strong>direct-mapped</strong>, chaque adresse mémoire
correspond à <strong>une seule ligne</strong> possible dans le cache.
C’est simple et rapide, mais peut causer des
<strong>conflits</strong>.</p>
<pre><code>Adresse → Index = (Adresse / Taille_Ligne) mod Nombre_Lignes

Exemple avec 4 lignes de cache :
- Adresse 0x000 → Ligne 0
- Adresse 0x100 → Ligne 0  ← Conflit !
- Adresse 0x200 → Ligne 0  ← Conflit !</code></pre>
<p><strong>Problème</strong> : Si votre programme alterne entre les
adresses 0x000 et 0x100, chaque accès provoque un <strong>miss</strong>
car elles partagent la même ligne !</p>
<h3 data-number="14.6.2" id="cache-fully-associatif"><span
class="header-section-number">14.6.2</span> Cache Fully-Associatif</h3>
<p>Un cache <strong>fully-associatif</strong> permet à chaque bloc de se
placer <strong>n’importe où</strong> dans le cache.</p>
<pre><code>┌─────────────────────────────────────────────────┐
│ Cache Fully-Associatif (4 lignes)              │
├─────────┬─────────┬─────────┬─────────┬────────┤
│ Entrée  │ Valid   │ Tag     │ Data    │ LRU    │
├─────────┼─────────┼─────────┼─────────┼────────┤
│ 0       │ 1       │ 0x000   │ ...     │ 3      │
│ 1       │ 1       │ 0x100   │ ...     │ 1      │  ← Coexistent !
│ 2       │ 1       │ 0x200   │ ...     │ 0      │
│ 3       │ 0       │ ---     │ ---     │ 2      │
└─────────┴─────────┴─────────┴─────────┴────────┘</code></pre>
<p><strong>Avantage</strong> : Pas de conflits, les adresses 0x000,
0x100 et 0x200 coexistent. <strong>Inconvénient</strong> : Comparaison
parallèle de tous les tags = hardware complexe et lent.</p>
<h3 data-number="14.6.3" id="cache-set-associatif-n-way"><span
class="header-section-number">14.6.3</span> Cache Set-Associatif
(N-Way)</h3>
<p>Compromis entre les deux : le cache est divisé en <strong>ensembles
(sets)</strong>, chaque adresse peut aller dans <strong>N
lignes</strong> différentes au sein de son set.</p>
<pre><code>Cache 2-Way Set-Associatif (4 sets × 2 ways = 8 lignes)
┌────────────────────────────────────────────────────┐
│ Set 0: │ Way 0: [0x000, data] │ Way 1: [0x100, data] │
│ Set 1: │ Way 0: [0x040, data] │ Way 1: [libre]       │
│ Set 2: │ Way 0: [0x080, data] │ Way 1: [0x280, data] │
│ Set 3: │ Way 0: [0x0C0, data] │ Way 1: [libre]       │
└────────────────────────────────────────────────────┘

Index du Set = (Adresse / Taille_Ligne) mod Nombre_Sets</code></pre>
<p><strong>Caches typiques des processeurs modernes</strong> : - L1 :
8-way associatif - L2 : 8-16 way associatif - L3 : 16-20 way
associatif</p>
<hr />
<h2 data-number="14.7" id="politiques-de-remplacement"><span
class="header-section-number">14.7</span> Politiques de
Remplacement</h2>
<p>Quand le cache est plein et qu’un nouveau bloc doit être chargé,
<strong>quel bloc évincer</strong> ?</p>
<h3 data-number="14.7.1" id="lru-least-recently-used"><span
class="header-section-number">14.7.1</span> LRU (Least Recently
Used)</h3>
<p><strong>Principe</strong> : Évincer le bloc qui n’a pas été utilisé
depuis le plus longtemps.</p>
<pre><code>État initial (cache 4 lignes, ordre LRU : 3→2→1→0) :
┌────────┬──────────┬─────────┐
│ Ligne  │ Donnée   │ LRU     │
├────────┼──────────┼─────────┤
│ 0      │ Bloc A   │ 0 (MRU) │  ← Most Recently Used
│ 1      │ Bloc B   │ 1       │
│ 2      │ Bloc C   │ 2       │
│ 3      │ Bloc D   │ 3 (LRU) │  ← Least Recently Used
└────────┴──────────┴─────────┘

Accès au Bloc E (miss) → Évincer Bloc D (LRU = 3)
┌────────┬──────────┬─────────┐
│ 0      │ Bloc A   │ 1       │
│ 1      │ Bloc B   │ 2       │
│ 2      │ Bloc C   │ 3 (LRU) │
│ 3      │ Bloc E   │ 0 (MRU) │  ← Nouveau !
└────────┴──────────┴─────────┘</code></pre>
<p><strong>Avantage</strong> : Exploite bien la localité temporelle.
<strong>Inconvénient</strong> : Coûteux à implémenter pour N élevé (N!
états possibles).</p>
<h3 data-number="14.7.2" id="pseudo-lru-tree-plru"><span
class="header-section-number">14.7.2</span> Pseudo-LRU (Tree-PLRU)</h3>
<p>Approximation de LRU utilisant un arbre binaire de bits.</p>
<pre><code>Cache 4-way avec 3 bits de direction :

        [bit0]
       /      \
   [bit1]    [bit2]
   /   \     /   \
Way0  Way1 Way2  Way3

Chaque bit pointe vers le sous-arbre &quot;moins récent&quot;.
Pour évincer : suivre les bits jusqu&#39;à une feuille.
Pour mettre à jour : inverser les bits sur le chemin vers le way accédé.</code></pre>
<h3 data-number="14.7.3" id="fifo-first-in-first-out"><span
class="header-section-number">14.7.3</span> FIFO (First-In
First-Out)</h3>
<p><strong>Principe</strong> : Évincer le bloc qui est dans le cache
depuis le plus longtemps.</p>
<pre><code>Ordre d&#39;arrivée : A → B → C → D
Prochain miss : Évincer A (premier arrivé)</code></pre>
<p><strong>Simple</strong> mais ne tient pas compte de la fréquence
d’utilisation.</p>
<h3 data-number="14.7.4" id="random-aléatoire"><span
class="header-section-number">14.7.4</span> Random (Aléatoire)</h3>
<p><strong>Principe</strong> : Évincer un bloc au hasard.</p>
<pre><code>Utilisé par : ARM Cortex-A9, certains L2 caches</code></pre>
<p><strong>Avantage</strong> : Hardware très simple, pas d’état à
maintenir. <strong>Inconvénient</strong> : Peut évincer des données
utiles.</p>
<p><strong>Fait surprenant</strong> : Random est souvent proche de LRU
en pratique !</p>
<h3 data-number="14.7.5" id="comparaison-des-politiques"><span
class="header-section-number">14.7.5</span> Comparaison des
Politiques</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Politique</th>
<th style="text-align: left;">Complexité HW</th>
<th style="text-align: left;">Performance</th>
<th style="text-align: left;">Cas d’utilisation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">LRU</td>
<td style="text-align: left;">Élevée</td>
<td style="text-align: left;">Excellente</td>
<td style="text-align: left;">L1 cache (petit)</td>
</tr>
<tr class="even">
<td style="text-align: left;">PLRU</td>
<td style="text-align: left;">Moyenne</td>
<td style="text-align: left;">Très bonne</td>
<td style="text-align: left;">L2/L3 cache</td>
</tr>
<tr class="odd">
<td style="text-align: left;">FIFO</td>
<td style="text-align: left;">Faible</td>
<td style="text-align: left;">Bonne</td>
<td style="text-align: left;">TLB, caches simples</td>
</tr>
<tr class="even">
<td style="text-align: left;">Random</td>
<td style="text-align: left;">Très faible</td>
<td style="text-align: left;">Correcte</td>
<td style="text-align: left;">Grands caches</td>
</tr>
</tbody>
</table>
<hr />
<h2 data-number="14.8" id="caches-multi-niveaux-l1l2l3"><span
class="header-section-number">14.8</span> Caches Multi-Niveaux
(L1/L2/L3)</h2>
<p>Les processeurs modernes utilisent une <strong>hiérarchie de
caches</strong> :</p>
<pre><code>┌─────────────────────────────────────────────────────────┐
│                      CPU Core 0                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │    L1-I (32 KB)        L1-D (32 KB)             │   │
│  │    Instructions        Données                   │   │
│  │    ~4 cycles           ~4 cycles                 │   │
│  └─────────────────────────────────────────────────┘   │
│                          ↓                              │
│  ┌─────────────────────────────────────────────────┐   │
│  │              L2 Unifié (256 KB)                  │   │
│  │              ~12 cycles                          │   │
│  └─────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────┐
│                 L3 Partagé (8-32 MB)                    │
│                 ~40 cycles                              │
│            (partagé entre tous les cores)               │
└─────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────┐
│                    RAM (DDR4/DDR5)                      │
│                    ~200+ cycles                         │
└─────────────────────────────────────────────────────────┘</code></pre>
<h3 data-number="14.8.1" id="caractéristiques-typiques-2024"><span
class="header-section-number">14.8.1</span> Caractéristiques Typiques
(2024)</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Niveau</th>
<th style="text-align: left;">Taille</th>
<th style="text-align: left;">Latence</th>
<th style="text-align: left;">Associativité</th>
<th style="text-align: left;">Partagé</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">L1-I</td>
<td style="text-align: left;">32-64 KB</td>
<td style="text-align: left;">4 cycles</td>
<td style="text-align: left;">8-way</td>
<td style="text-align: left;">Non (par core)</td>
</tr>
<tr class="even">
<td style="text-align: left;">L1-D</td>
<td style="text-align: left;">32-64 KB</td>
<td style="text-align: left;">4-5 cycles</td>
<td style="text-align: left;">8-12 way</td>
<td style="text-align: left;">Non (par core)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">L2</td>
<td style="text-align: left;">256 KB-1 MB</td>
<td style="text-align: left;">12-14 cycles</td>
<td style="text-align: left;">8-16 way</td>
<td style="text-align: left;">Non (par core)</td>
</tr>
<tr class="even">
<td style="text-align: left;">L3</td>
<td style="text-align: left;">8-96 MB</td>
<td style="text-align: left;">30-50 cycles</td>
<td style="text-align: left;">16-20 way</td>
<td style="text-align: left;">Oui (tous cores)</td>
</tr>
</tbody>
</table>
<h3 data-number="14.8.2" id="politiques-dinclusion"><span
class="header-section-number">14.8.2</span> Politiques d’Inclusion</h3>
<p><strong>Inclusive</strong> : Tout ce qui est dans L1 est aussi dans
L2 et L3. - Avantage : Cohérence simple - Inconvénient : Gaspillage
d’espace</p>
<p><strong>Exclusive</strong> : Les données ne sont que dans UN niveau à
la fois. - Avantage : Capacité totale = L1 + L2 + L3 - Inconvénient :
Gestion plus complexe</p>
<p><strong>NINE (Non-Inclusive Non-Exclusive)</strong> : Pas de
garantie. - Utilisé par Intel depuis Skylake pour les grands L3</p>
<hr />
<h2 data-number="14.9" id="patterns-de-code-et-localité"><span
class="header-section-number">14.9</span> Patterns de Code et
Localité</h2>
<h3 data-number="14.9.1"
id="pattern-1-parcours-séquentiel-localité-spatiale"><span
class="header-section-number">14.9.1</span> Pattern 1 : Parcours
Séquentiel (Localité Spatiale)</h3>
<div class="sourceCode" id="cb208"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co">// EXCELLENT : Accès séquentiels</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sum <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">1000</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a>    sum <span class="op">+=</span> array<span class="op">[</span>i<span class="op">];</span>  <span class="co">// Adresses consécutives</span></span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Hit rate ~94% (1 miss pour 16 hits si ligne = 64 octets, int = 4 octets)</span></span></code></pre></div>
<h3 data-number="14.9.2"
id="pattern-2-accès-avec-stride-mauvaise-localité"><span
class="header-section-number">14.9.2</span> Pattern 2 : Accès avec
Stride (Mauvaise Localité)</h3>
<div class="sourceCode" id="cb209"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co">// MAUVAIS : Stride de 64 octets = 1 ligne de cache</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">1000</span><span class="op">;</span> i <span class="op">+=</span> <span class="dv">16</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a>    sum <span class="op">+=</span> array<span class="op">[</span>i<span class="op">];</span>  <span class="co">// Saute une ligne entière !</span></span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Hit rate ~0% : chaque accès est un miss</span></span></code></pre></div>
<h3 data-number="14.9.3"
id="pattern-3-réutilisation-de-variables-localité-temporelle"><span
class="header-section-number">14.9.3</span> Pattern 3 : Réutilisation de
Variables (Localité Temporelle)</h3>
<div class="sourceCode" id="cb210"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="co">// BON : Même variable réutilisée</span></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> accumulator <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">1000</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>    accumulator <span class="op">+=</span> array<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a>    accumulator <span class="op">*=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a>    accumulator <span class="op">-=</span> <span class="dv">1</span><span class="op">;</span>  <span class="co">// &#39;accumulator&#39; reste en registre/L1</span></span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb210-8"><a href="#cb210-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-9"><a href="#cb210-9" aria-hidden="true" tabindex="-1"></a><span class="co">// MAUVAIS : Variable différente à chaque fois</span></span>
<span id="cb210-10"><a href="#cb210-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">1000</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb210-11"><a href="#cb210-11" aria-hidden="true" tabindex="-1"></a>    temps<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> array<span class="op">[</span>i<span class="op">]</span> <span class="op">*</span> <span class="dv">2</span><span class="op">;</span>  <span class="co">// Écrit dans tout le tableau</span></span>
<span id="cb210-12"><a href="#cb210-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb210-13"><a href="#cb210-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">1000</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb210-14"><a href="#cb210-14" aria-hidden="true" tabindex="-1"></a>    result <span class="op">+=</span> temps<span class="op">[</span>i<span class="op">];</span>       <span class="co">// Relit tout le tableau</span></span>
<span id="cb210-15"><a href="#cb210-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="14.9.4"
id="pattern-4-structure-de-données-cache-friendly"><span
class="header-section-number">14.9.4</span> Pattern 4 : Structure de
Données Cache-Friendly</h3>
<div class="sourceCode" id="cb211"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co">// MAUVAIS : Array of Structures (AoS)</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Particule <span class="op">{</span></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> x<span class="op">,</span> y<span class="op">,</span> z<span class="op">;</span>      <span class="co">// Position</span></span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> vx<span class="op">,</span> vy<span class="op">,</span> vz<span class="op">;</span>   <span class="co">// Vitesse (souvent inutilisé)</span></span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> mass<span class="op">;</span></span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> type<span class="op">;</span></span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a>Particule particles<span class="op">[</span><span class="dv">10000</span><span class="op">];</span></span>
<span id="cb211-9"><a href="#cb211-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-10"><a href="#cb211-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10000</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb211-11"><a href="#cb211-11" aria-hidden="true" tabindex="-1"></a>    particles<span class="op">[</span>i<span class="op">].</span>x <span class="op">+=</span> particles<span class="op">[</span>i<span class="op">].</span>vx<span class="op">;</span>  <span class="co">// Charge 32 octets, utilise 8</span></span>
<span id="cb211-12"><a href="#cb211-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb211-13"><a href="#cb211-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-14"><a href="#cb211-14" aria-hidden="true" tabindex="-1"></a><span class="co">// BON : Structure of Arrays (SoA)</span></span>
<span id="cb211-15"><a href="#cb211-15" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Particules <span class="op">{</span></span>
<span id="cb211-16"><a href="#cb211-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> x<span class="op">[</span><span class="dv">10000</span><span class="op">];</span></span>
<span id="cb211-17"><a href="#cb211-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> y<span class="op">[</span><span class="dv">10000</span><span class="op">];</span></span>
<span id="cb211-18"><a href="#cb211-18" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> z<span class="op">[</span><span class="dv">10000</span><span class="op">];</span></span>
<span id="cb211-19"><a href="#cb211-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> vx<span class="op">[</span><span class="dv">10000</span><span class="op">];</span></span>
<span id="cb211-20"><a href="#cb211-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb211-21"><a href="#cb211-21" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb211-22"><a href="#cb211-22" aria-hidden="true" tabindex="-1"></a>Particules p<span class="op">;</span></span>
<span id="cb211-23"><a href="#cb211-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-24"><a href="#cb211-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10000</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb211-25"><a href="#cb211-25" aria-hidden="true" tabindex="-1"></a>    p<span class="op">.</span>x<span class="op">[</span>i<span class="op">]</span> <span class="op">+=</span> p<span class="op">.</span>vx<span class="op">[</span>i<span class="op">];</span>  <span class="co">// Accès séquentiel, 100% utile</span></span>
<span id="cb211-26"><a href="#cb211-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="14.9.5" id="pattern-5-loop-tiling-blocking"><span
class="header-section-number">14.9.5</span> Pattern 5 : Loop Tiling /
Blocking</h3>
<div class="sourceCode" id="cb212"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co">// NAÏF : Multiplication de matrices</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> N<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> N<span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> N<span class="op">;</span> k<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a>            C<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">+=</span> A<span class="op">[</span>i<span class="op">][</span>k<span class="op">]</span> <span class="op">*</span> B<span class="op">[</span>k<span class="op">][</span>j<span class="op">];</span>  <span class="co">// B[k][j] : accès par colonne !</span></span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-10"><a href="#cb212-10" aria-hidden="true" tabindex="-1"></a><span class="co">// OPTIMISÉ : Blocking (blocs de 32×32)</span></span>
<span id="cb212-11"><a href="#cb212-11" aria-hidden="true" tabindex="-1"></a><span class="pp">#define BLOCK </span><span class="dv">32</span></span>
<span id="cb212-12"><a href="#cb212-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> ii <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> ii <span class="op">&lt;</span> N<span class="op">;</span> ii <span class="op">+=</span> BLOCK<span class="op">)</span> <span class="op">{</span></span>
<span id="cb212-13"><a href="#cb212-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> jj <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> jj <span class="op">&lt;</span> N<span class="op">;</span> jj <span class="op">+=</span> BLOCK<span class="op">)</span> <span class="op">{</span></span>
<span id="cb212-14"><a href="#cb212-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> kk <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> kk <span class="op">&lt;</span> N<span class="op">;</span> kk <span class="op">+=</span> BLOCK<span class="op">)</span> <span class="op">{</span></span>
<span id="cb212-15"><a href="#cb212-15" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Traiter le bloc [ii:ii+BLOCK, jj:jj+BLOCK]</span></span>
<span id="cb212-16"><a href="#cb212-16" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> ii<span class="op">;</span> i <span class="op">&lt;</span> ii <span class="op">+</span> BLOCK<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb212-17"><a href="#cb212-17" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> jj<span class="op">;</span> j <span class="op">&lt;</span> jj <span class="op">+</span> BLOCK<span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb212-18"><a href="#cb212-18" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> k <span class="op">=</span> kk<span class="op">;</span> k <span class="op">&lt;</span> kk <span class="op">+</span> BLOCK<span class="op">;</span> k<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb212-19"><a href="#cb212-19" aria-hidden="true" tabindex="-1"></a>                        C<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">+=</span> A<span class="op">[</span>i<span class="op">][</span>k<span class="op">]</span> <span class="op">*</span> B<span class="op">[</span>k<span class="op">][</span>j<span class="op">];</span></span>
<span id="cb212-20"><a href="#cb212-20" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb212-21"><a href="#cb212-21" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb212-22"><a href="#cb212-22" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb212-23"><a href="#cb212-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb212-24"><a href="#cb212-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb212-25"><a href="#cb212-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb212-26"><a href="#cb212-26" aria-hidden="true" tabindex="-1"></a><span class="co">// Le bloc de B tient en cache → réutilisé N/BLOCK fois</span></span></code></pre></div>
<hr />
<h2 data-number="14.10" id="modélisation-des-performances"><span
class="header-section-number">14.10</span> Modélisation des
Performances</h2>
<h3 data-number="14.10.1" id="temps-daccès-moyen-amat"><span
class="header-section-number">14.10.1</span> Temps d’Accès Moyen
(AMAT)</h3>
<pre><code>AMAT = Hit_Time + Miss_Rate × Miss_Penalty

Exemple :
- Hit Time L1 = 4 cycles
- Miss Rate L1 = 5%
- Miss Penalty (accès L2) = 12 cycles

AMAT = 4 + 0.05 × 12 = 4.6 cycles</code></pre>
<h3 data-number="14.10.2" id="amat-multi-niveaux"><span
class="header-section-number">14.10.2</span> AMAT Multi-Niveaux</h3>
<pre><code>AMAT = Hit_Time_L1 + Miss_Rate_L1 × (
         Hit_Time_L2 + Miss_Rate_L2 × (
           Hit_Time_L3 + Miss_Rate_L3 × RAM_Latency
         )
       )

Exemple réaliste :
- L1 : 4 cycles, 5% miss
- L2 : 12 cycles, 20% miss (de ce qui arrive en L2)
- L3 : 40 cycles, 30% miss
- RAM : 200 cycles

AMAT = 4 + 0.05 × (12 + 0.20 × (40 + 0.30 × 200))
     = 4 + 0.05 × (12 + 0.20 × (40 + 60))
     = 4 + 0.05 × (12 + 20)
     = 4 + 0.05 × 32
     = 4 + 1.6
     = 5.6 cycles

Sans cache : 200 cycles → Le cache accélère par 35× !</code></pre>
<h3 data-number="14.10.3" id="exercice-de-calcul"><span
class="header-section-number">14.10.3</span> Exercice de Calcul</h3>
<p>Calculez l’AMAT pour ce système : - L1 : 3 cycles, miss rate 8% - L2
: 10 cycles, miss rate 25% - RAM : 150 cycles</p>
<p>Solution :</p>
<pre><code>AMAT = 3 + 0.08 × (10 + 0.25 × 150)
     = 3 + 0.08 × (10 + 37.5)
     = 3 + 0.08 × 47.5
     = 3 + 3.8
     = 6.8 cycles</code></pre>
<hr />
<h2 data-number="14.11" id="impact-sur-vos-programmes"><span
class="header-section-number">14.11</span> Impact sur vos
Programmes</h2>
<h3 data-number="14.11.1"
id="parcours-de-tableaux-2d-lordre-compte"><span
class="header-section-number">14.11.1</span> Parcours de Tableaux 2D :
L’Ordre Compte !</h3>
<p>Une matrice 4x4 est stockée <strong>ligne par ligne</strong> en
mémoire (row-major) :</p>
<figure>
<img src="images/matrix-storage.svg"
alt="Stockage mémoire d’une matrice" />
<figcaption aria-hidden="true">Stockage mémoire d’une
matrice</figcaption>
</figure>
<h3 data-number="14.11.2"
id="parcours-row-major-en-ligne---efficace"><span
class="header-section-number">14.11.2</span> Parcours Row-Major (En
Ligne) - EFFICACE</h3>
<figure>
<img src="images/row-major-traversal.svg" alt="Parcours Row-Major" />
<figcaption aria-hidden="true">Parcours Row-Major</figcaption>
</figure>
<h3 data-number="14.11.3"
id="parcours-column-major-en-colonne---inefficace"><span
class="header-section-number">14.11.3</span> Parcours Column-Major (En
Colonne) - INEFFICACE</h3>
<figure>
<img src="images/column-major-traversal.svg"
alt="Parcours Column-Major" />
<figcaption aria-hidden="true">Parcours Column-Major</figcaption>
</figure>
<h3 data-number="14.11.4" id="comparaison-visuelle"><span
class="header-section-number">14.11.4</span> Comparaison Visuelle</h3>
<figure>
<img src="images/cache-comparison.svg"
alt="Comparaison Row-Major vs Column-Major" />
<figcaption aria-hidden="true">Comparaison Row-Major vs
Column-Major</figcaption>
</figure>
<h3 data-number="14.11.5" id="technique-du-blocking"><span
class="header-section-number">14.11.5</span> Technique du Blocking</h3>
<figure>
<img src="images/blocking-technique.svg" alt="Technique de Blocking" />
<figcaption aria-hidden="true">Technique de Blocking</figcaption>
</figure>
<hr />
<h2 data-number="14.12" id="implémentation-hdl-du-cache"><span
class="header-section-number">14.12</span> Implémentation HDL du
Cache</h2>
<h3 data-number="14.12.1" id="architecture-globale"><span
class="header-section-number">14.12.1</span> Architecture Globale</h3>
<figure>
<img src="images/cache-architecture-hdl.svg"
alt="Architecture du cache HDL" />
<figcaption aria-hidden="true">Architecture du cache HDL</figcaption>
</figure>
<h3 data-number="14.12.2" id="machine-à-états-du-contrôleur"><span
class="header-section-number">14.12.2</span> Machine à États du
Contrôleur</h3>
<figure>
<img src="images/cache-controller-fsm.svg"
alt="Machine à états du CacheController" />
<figcaption aria-hidden="true">Machine à états du
CacheController</figcaption>
</figure>
<h3 data-number="14.12.3" id="wordselect-sélection-du-mot"><span
class="header-section-number">14.12.3</span> WordSelect : Sélection du
Mot</h3>
<figure>
<img src="images/word-select.svg" alt="WordSelect" />
<figcaption aria-hidden="true">WordSelect</figcaption>
</figure>
<hr />
<h2 data-number="14.13" id="statistiques-et-performance"><span
class="header-section-number">14.13</span> Statistiques et
Performance</h2>
<h3 data-number="14.13.1" id="calcul-du-hit-rate"><span
class="header-section-number">14.13.1</span> Calcul du Hit Rate</h3>
<figure>
<img src="images/hit-rate-calculation.svg" alt="Calcul du Hit Rate" />
<figcaption aria-hidden="true">Calcul du Hit Rate</figcaption>
</figure>
<hr />
<h2 data-number="14.14"
id="visualiser-le-cache-avec-le-cpu-visualizer"><span
class="header-section-number">14.14</span> Visualiser le Cache avec le
CPU Visualizer</h2>
<p>Le <strong>CPU Visualizer</strong> vous permet d’observer le
comportement du cache en temps réel pendant l’exécution d’un
programme.</p>
<h3 data-number="14.14.1" id="accéder-au-visualizer-1"><span
class="header-section-number">14.14.1</span> Accéder au Visualizer</h3>
<div class="sourceCode" id="cb216"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> web</span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> run dev</span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ouvrir http://localhost:5173 -&gt; CPU Visualizer</span></span></code></pre></div>
<h3 data-number="14.14.2" id="la-démo-cache"><span
class="header-section-number">14.14.2</span> La Démo “Cache”</h3>
<p>Chargez la démo <strong>“7. Cache”</strong> dans le menu déroulant.
Ce programme : 1. Parcourt un tableau de 16 éléments une première fois
(cache misses) 2. Parcourt le même tableau une seconde fois (cache
hits)</p>
<h3 data-number="14.14.3" id="ce-que-vous-verrez"><span
class="header-section-number">14.14.3</span> Ce que vous verrez</h3>
<p><strong>Panneau “Cache L1”</strong> : - <strong>Hits</strong> :
Nombre d’accès trouvés dans le cache - <strong>Misses</strong> : Nombre
d’accès qui ont dû aller en RAM - <strong>Taux</strong> : Pourcentage de
hits (ex: “94.2%”) - <strong>Indicateur HIT/MISS</strong> : Flash vert
pour hit, rouge pour miss</p>
<p><strong>Contenu du cache</strong> : - <strong>Ligne</strong> : Numéro
de la ligne (0-63) - <strong>Valid</strong> : 1 si la ligne contient des
données valides - <strong>Tag</strong> : Identifie quelle zone mémoire
est stockée - <strong>Données</strong> : Le mot stocké dans la ligne</p>
<h3 data-number="14.14.4" id="exercice-pratique-1"><span
class="header-section-number">14.14.4</span> Exercice Pratique</h3>
<ol type="1">
<li>Lancez la démo “Cache” et observez :
<ul>
<li>Au premier parcours : beaucoup de <strong>MISS</strong> (flash
rouge)</li>
<li>Au second parcours : beaucoup de <strong>HIT</strong> (flash
vert)</li>
</ul></li>
<li>Regardez le taux de hits évoluer :
<ul>
<li>Début : ~0% (cache vide)</li>
<li>Après premier parcours : ~50%</li>
<li>Fin : ~85-95%</li>
</ul></li>
<li>Observez les lignes de cache se remplir :
<ul>
<li>Les bits Valid passent de 0 à 1</li>
<li>Les Tags s’affichent</li>
<li>Les données apparaissent</li>
</ul></li>
</ol>
<hr />
<h2 data-number="14.15" id="exercices"><span
class="header-section-number">14.15</span> Exercices</h2>
<h3 data-number="14.15.1" id="exercices-hdl"><span
class="header-section-number">14.15.1</span> Exercices HDL</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>CacheLine</strong></td>
<td style="text-align: left;">Implémenter une ligne de cache avec valid,
tag, data</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>TagCompare</strong></td>
<td style="text-align: left;">Comparateur de tags pour détecter
hit/miss</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>WordSelect</strong></td>
<td style="text-align: left;">Sélecteur de mot (4:1) dans une ligne 128
bits</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>CacheController</strong></td>
<td style="text-align: left;">Machine à états (IDLE, FETCH,
WRITEBACK)</td>
</tr>
</tbody>
</table>
<h3 data-number="14.15.2" id="exercices-assembleur-a32"><span
class="header-section-number">14.15.2</span> Exercices Assembleur
A32</h3>
<table>
<colgroup>
<col style="width: 30%" />
<col style="width: 39%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Résultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Accès Séquentiel</strong></td>
<td style="text-align: left;">Parcours cache-friendly d’un tableau</td>
<td style="text-align: left;">R0 = 100</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Accès avec Stride</strong></td>
<td style="text-align: left;">Parcours avec sauts (moins efficace)</td>
<td style="text-align: left;">R0 = 28</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Réutilisation
Registre</strong></td>
<td style="text-align: left;">Garder les données en registre</td>
<td style="text-align: left;">R0 = 91</td>
</tr>
</tbody>
</table>
<h3 data-number="14.15.3" id="exercices-c32"><span
class="header-section-number">14.15.3</span> Exercices C32</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exercice</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Résultat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Parcours en Ligne</strong></td>
<td style="text-align: left;">Accès row-major (cache-friendly)</td>
<td style="text-align: left;">120</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Parcours en Colonne</strong></td>
<td style="text-align: left;">Accès column-major (moins efficace)</td>
<td style="text-align: left;">120</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Traitement par Blocs</strong></td>
<td style="text-align: left;">Technique de blocking</td>
<td style="text-align: left;">120</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Localité Temporelle</strong></td>
<td style="text-align: left;">Réutiliser les données</td>
<td style="text-align: left;">30</td>
</tr>
</tbody>
</table>
<hr />
<h2 data-number="14.16" id="résumé-visuel"><span
class="header-section-number">14.16</span> Résumé Visuel</h2>
<figure>
<img src="images/cache-summary.svg" alt="Résumé du cache" />
<figcaption aria-hidden="true">Résumé du cache</figcaption>
</figure>
<hr />
<h2 data-number="14.17" id="points-clés-à-retenir"><span
class="header-section-number">14.17</span> Points Clés à Retenir</h2>
<ol type="1">
<li><strong>La RAM est lente</strong> : ~100x plus lente que le
cache</li>
<li><strong>Le cache exploite la localité</strong> : temporelle et
spatiale</li>
<li><strong>L’ordre d’accès compte</strong> : row-major &gt;&gt;
column-major</li>
<li><strong>Réutilisez les données</strong> : gardez-les en registre ou
en cache</li>
<li><strong>Pensez en blocs</strong> : traitez des données qui tiennent
dans le cache</li>
</ol>
<p>Ces principes s’appliquent à tous les niveaux de programmation, du
code assembleur aux applications modernes !</p>
<hr />
<h2 data-number="14.18" id="auto-évaluation-9"><span
class="header-section-number">14.18</span> Auto-évaluation</h2>
<p>Testez votre compréhension du cache.</p>
<h3 data-number="14.18.1" id="questions-de-compréhension-9"><span
class="header-section-number">14.18.1</span> Questions de
compréhension</h3>
<p><strong>Q1.</strong> Qu’est-ce que la localité temporelle et la
localité spatiale ?</p>
<p><strong>Q2.</strong> Pourquoi le parcours en ligne (row-major) est-il
plus efficace que le parcours en colonne ?</p>
<p><strong>Q3.</strong> Qu’est-ce qu’un cache hit et un cache miss ?</p>
<p><strong>Q4.</strong> Comment fonctionne un cache direct-mapped ?</p>
<p><strong>Q5.</strong> Qu’est-ce que la technique de “blocking” ?</p>
<h3 data-number="14.18.2" id="mini-défi-pratique-8"><span
class="header-section-number">14.18.2</span> Mini-défi pratique</h3>
<p>Calculez le hit rate pour ce pattern d’accès avec un cache de 4
lignes de 16 octets :</p>
<p>Accès séquentiels aux adresses : 0, 4, 8, 12, 16, 20, 24, 28, 0, 4,
8, 12</p>
<p><em>Les solutions se trouvent dans le document
<strong>Codex_Solutions</strong>.</em></p>
<h3 data-number="14.18.3" id="checklist-de-validation-8"><span
class="header-section-number">14.18.3</span> Checklist de
validation</h3>
<ul class="task-list">
<li><label><input type="checkbox" />Expliquer la différence entre
localité temporelle et spatiale</label></li>
<li><label><input type="checkbox" />Comprendre pourquoi le cache existe
(hiérarchie mémoire)</label></li>
<li><label><input type="checkbox" />Calculer un hit rate
simple</label></li>
<li><label><input type="checkbox" />Optimiser un parcours de tableau
pour le cache</label></li>
<li><label><input type="checkbox" />Appliquer la technique de blocking
sur une matrice</label></li>
</ul>
<h1 data-number="15"
id="les-interruptions-quand-le-monde-extérieur-frappe-à-la-porte"><span
class="header-section-number">15</span> Les Interruptions : Quand le
Monde Extérieur Frappe à la Porte</h1>
<p>Imaginez que vous êtes concentré sur un travail important quand
soudain : - Votre téléphone sonne - Quelqu’un frappe à la porte -
L’alarme incendie se déclenche</p>
<p>Dans chaque cas, vous devez <strong>interrompre</strong> votre
travail actuel, <strong>gérer</strong> l’événement, puis
<strong>reprendre</strong> où vous en étiez.</p>
<p>Les <strong>interruptions</strong> en informatique fonctionnent
exactement de la même façon : elles permettent au CPU de réagir à des
événements externes sans avoir à constamment vérifier leur état.</p>
<hr />
<h2 data-number="15.1" id="pourquoi-les-interruptions"><span
class="header-section-number">15.1</span> Pourquoi les Interruptions
?</h2>
<h3 data-number="15.1.1" id="le-problème-le-polling"><span
class="header-section-number">15.1.1</span> Le Problème : Le
Polling</h3>
<p>Sans interruptions, le CPU doit constamment vérifier si quelque chose
s’est passé :</p>
<div class="sourceCode" id="cb217"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="co">// MAUVAIS : Polling (attente active)</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>keyboard_has_key<span class="op">())</span> <span class="op">{</span></span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>        handle_key<span class="op">();</span></span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>timer_expired<span class="op">())</span> <span class="op">{</span></span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a>        handle_timer<span class="op">();</span></span>
<span id="cb217-8"><a href="#cb217-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb217-9"><a href="#cb217-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>network_has_data<span class="op">())</span> <span class="op">{</span></span>
<span id="cb217-10"><a href="#cb217-10" aria-hidden="true" tabindex="-1"></a>        handle_network<span class="op">();</span></span>
<span id="cb217-11"><a href="#cb217-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb217-12"><a href="#cb217-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Le CPU ne peut rien faire d&#39;autre !</span></span>
<span id="cb217-13"><a href="#cb217-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p><strong>Problèmes du polling</strong> : - Gaspille des cycles CPU -
Latence variable (peut rater des événements) - Plus il y a de
périphériques, pire c’est</p>
<h3 data-number="15.1.2" id="la-solution-les-interruptions"><span
class="header-section-number">15.1.2</span> La Solution : Les
Interruptions</h3>
<pre><code>┌──────────────────────────────────────────────────────────────┐
│                        CPU                                    │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  Programme principal                                  │   │
│  │                                                       │   │
│  │  instruction 1                                        │   │
│  │  instruction 2      ←── INTERRUPTION !               │   │
│  │  instruction 3           │                            │   │
│  │  ...                     ↓                            │   │
│  │                   ┌─────────────────┐                 │   │
│  │                   │  Sauvegarde PC  │                 │   │
│  │                   │  Sauvegarde CPSR│                 │   │
│  │                   │  Jump to ISR    │                 │   │
│  │                   └────────┬────────┘                 │   │
│  │                            ↓                          │   │
│  │                   ┌─────────────────┐                 │   │
│  │                   │  Handler (ISR)  │                 │   │
│  │                   │  Traite l&#39;IRQ   │                 │   │
│  │                   └────────┬────────┘                 │   │
│  │                            ↓                          │   │
│  │                   ┌─────────────────┐                 │   │
│  │                   │ Restore PC/CPSR │                 │   │
│  │                   │     RETI        │                 │   │
│  │  instruction 3  ←─┴─────────────────┘                 │   │
│  │  instruction 4                                        │   │
│  └──────────────────────────────────────────────────────┘   │
└──────────────────────────────────────────────────────────────┘</code></pre>
<p><strong>Avantages</strong> : - Le CPU travaille normalement jusqu’à
l’événement - Réponse immédiate (latence minimale) - Scale bien avec le
nombre de périphériques</p>
<hr />
<h2 data-number="15.2" id="types-dinterruptions"><span
class="header-section-number">15.2</span> Types d’Interruptions</h2>
<h3 data-number="15.2.1" id="interruptions-matérielles-irq"><span
class="header-section-number">15.2.1</span> Interruptions Matérielles
(IRQ)</h3>
<p>Déclenchées par des périphériques externes :</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Source</th>
<th style="text-align: left;">Exemple</th>
<th style="text-align: left;">Priorité Typique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Timer</td>
<td style="text-align: left;">Tick système (100 Hz - 1 kHz)</td>
<td style="text-align: left;">Haute</td>
</tr>
<tr class="even">
<td style="text-align: left;">Clavier</td>
<td style="text-align: left;">Touche pressée</td>
<td style="text-align: left;">Moyenne</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Souris</td>
<td style="text-align: left;">Mouvement, clic</td>
<td style="text-align: left;">Moyenne</td>
</tr>
<tr class="even">
<td style="text-align: left;">Disque</td>
<td style="text-align: left;">Transfert DMA terminé</td>
<td style="text-align: left;">Haute</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Réseau</td>
<td style="text-align: left;">Paquet reçu</td>
<td style="text-align: left;">Haute</td>
</tr>
<tr class="even">
<td style="text-align: left;">USB</td>
<td style="text-align: left;">Périphérique connecté</td>
<td style="text-align: left;">Basse</td>
</tr>
</tbody>
</table>
<h3 data-number="15.2.2" id="interruptions-logicielles-trapsswi"><span
class="header-section-number">15.2.2</span> Interruptions Logicielles
(Traps/SWI)</h3>
<p>Déclenchées intentionnellement par le programme :</p>
<div class="sourceCode" id="cb219"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co">; Appel système (syscall)</span></span>
<span id="cb219-2"><a href="#cb219-2" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">1</span>      <span class="co">; Code syscall = write</span></span>
<span id="cb219-3"><a href="#cb219-3" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span> R1<span class="op">,</span> <span class="op">#</span>buffer <span class="co">; Adresse buffer</span></span>
<span id="cb219-4"><a href="#cb219-4" aria-hidden="true" tabindex="-1"></a><span class="bu">MOV</span> R2<span class="op">,</span> <span class="op">#</span><span class="dv">10</span>     <span class="co">; Longueur</span></span>
<span id="cb219-5"><a href="#cb219-5" aria-hidden="true" tabindex="-1"></a>SWI <span class="op">#</span><span class="dv">0</span>          <span class="co">; Software Interrupt → appelle l&#39;OS</span></span></code></pre></div>
<h3 data-number="15.2.3" id="exceptions"><span
class="header-section-number">15.2.3</span> Exceptions</h3>
<p>Erreurs pendant l’exécution :</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Exception</th>
<th style="text-align: left;">Cause</th>
<th style="text-align: left;">Récupérable ?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Division par zéro</td>
<td style="text-align: left;"><code>DIV R0, R1, #0</code></td>
<td style="text-align: left;">Oui</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adresse invalide</td>
<td style="text-align: left;">Accès hors mémoire</td>
<td style="text-align: left;">Parfois</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Instruction invalide</td>
<td style="text-align: left;">Opcode inconnu</td>
<td style="text-align: left;">Non</td>
</tr>
<tr class="even">
<td style="text-align: left;">Page fault</td>
<td style="text-align: left;">Page non en RAM</td>
<td style="text-align: left;">Oui (MMU)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Breakpoint</td>
<td style="text-align: left;">Débogage</td>
<td style="text-align: left;">Oui</td>
</tr>
</tbody>
</table>
<hr />
<h2 data-number="15.3"
id="architecture-dun-système-dinterruptions"><span
class="header-section-number">15.3</span> Architecture d’un Système
d’Interruptions</h2>
<h3 data-number="15.3.1" id="le-contrôleur-dinterruptions-picapic"><span
class="header-section-number">15.3.1</span> Le Contrôleur
d’Interruptions (PIC/APIC)</h3>
<pre><code>┌──────────────────────────────────────────────────────────────┐
│              Peripheral Interrupt Controller                  │
│                                                               │
│   IRQ0 (Timer)    ──┐                                        │
│   IRQ1 (Keyboard) ──┼──→ ┌──────────────┐                    │
│   IRQ2 (Cascade)  ──┤    │   Priorité   │                    │
│   IRQ3 (COM2)     ──┤    │   Encoder    │ ──→ INT (CPU)      │
│   IRQ4 (COM1)     ──┤    │              │                    │
│   IRQ5 (LPT2)     ──┤    │  Mask Reg    │                    │
│   IRQ6 (Floppy)   ──┤    │              │                    │
│   IRQ7 (LPT1)     ──┘    └──────────────┘                    │
│                                                               │
│   Registres :                                                 │
│   - IMR (Interrupt Mask Register) : Active/désactive IRQs     │
│   - IRR (Interrupt Request Register) : IRQs en attente        │
│   - ISR (In-Service Register) : IRQ en cours de traitement    │
└──────────────────────────────────────────────────────────────┘</code></pre>
<h3 data-number="15.3.2"
id="la-table-des-vecteurs-dinterruption-ivt"><span
class="header-section-number">15.3.2</span> La Table des Vecteurs
d’Interruption (IVT)</h3>
<p>Chaque interruption a un <strong>numéro</strong> qui indexe une table
de pointeurs vers les handlers :</p>
<pre><code>┌─────────────────────────────────────────────────┐
│     Interrupt Vector Table (IVT)                │
│     Adresse : 0x00000000 - 0x000003FF           │
├────────┬───────────────────────────────────────┤
│ Vect # │ Adresse du Handler                    │
├────────┼───────────────────────────────────────┤
│ 0      │ 0x00001000  → Reset Handler          │
│ 1      │ 0x00001100  → Undefined Instruction  │
│ 2      │ 0x00001200  → Software Interrupt     │
│ 3      │ 0x00001300  → Prefetch Abort         │
│ 4      │ 0x00001400  → Data Abort             │
│ 5      │ 0x00001500  → Reserved               │
│ 6      │ 0x00001600  → IRQ Handler            │
│ 7      │ 0x00001700  → FIQ Handler            │
│ ...    │ ...                                   │
└────────┴───────────────────────────────────────┘</code></pre>
<hr />
<h2 data-number="15.4" id="le-cycle-de-vie-dune-interruption"><span
class="header-section-number">15.4</span> Le Cycle de Vie d’une
Interruption</h2>
<h3 data-number="15.4.1" id="détection"><span
class="header-section-number">15.4.1</span> 1. Détection</h3>
<pre><code>┌─────────────┐      ┌─────────────┐      ┌─────────────┐
│ Périphérique│      │     PIC     │      │     CPU     │
│   (Timer)   │      │             │      │             │
└──────┬──────┘      └──────┬──────┘      └──────┬──────┘
       │                    │                    │
       │ IRQ0 = 1           │                    │
       │───────────────────&gt;│                    │
       │                    │                    │
       │                    │ INT = 1            │
       │                    │───────────────────&gt;│
       │                    │                    │</code></pre>
<h3 data-number="15.4.2" id="reconnaissance"><span
class="header-section-number">15.4.2</span> 2. Reconnaissance</h3>
<pre><code>       │                    │                    │
       │                    │                    │ Fin instruction
       │                    │                    │ courante
       │                    │                    │
       │                    │  INTA (Interrupt   │
       │                    │&lt;───────────────────│
       │                    │    Acknowledge)    │
       │                    │                    │
       │                    │  Vector # = 0x20   │
       │                    │───────────────────&gt;│</code></pre>
<h3 data-number="15.4.3" id="sauvegarde-du-contexte"><span
class="header-section-number">15.4.3</span> 3. Sauvegarde du
Contexte</h3>
<p>Le CPU sauvegarde automatiquement :</p>
<div class="sourceCode" id="cb224"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co">; Ce que le CPU fait automatiquement :</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="co">; 1. Désactive les interruptions (I flag = 1)</span></span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a><span class="co">; 2. Sauvegarde PC dans LR_irq</span></span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a><span class="co">; 3. Sauvegarde CPSR dans SPSR_irq</span></span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a><span class="co">; 4. Passe en mode IRQ</span></span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a><span class="co">; 5. PC = adresse du handler (depuis IVT)</span></span></code></pre></div>
<h3 data-number="15.4.4" id="exécution-du-handler-isr"><span
class="header-section-number">15.4.4</span> 4. Exécution du Handler
(ISR)</h3>
<div class="sourceCode" id="cb225"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">irq_handler:</span></span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Sauvegarder les registres utilisés</span></span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">PUSH</span> <span class="op">{</span>R0<span class="op">-</span>R3<span class="op">,</span> <span class="kw">R12</span><span class="op">,</span> LR<span class="op">}</span></span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Identifier la source de l&#39;IRQ</span></span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a>    LDR R0<span class="op">,</span> <span class="op">=</span>PIC_BASE</span>
<span id="cb225-7"><a href="#cb225-7" aria-hidden="true" tabindex="-1"></a>    LDR R1<span class="op">,</span> <span class="op">[</span>R0<span class="op">,</span> <span class="op">#</span>IRR_OFFSET<span class="op">]</span>    <span class="co">; Lire les IRQ en attente</span></span>
<span id="cb225-8"><a href="#cb225-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-9"><a href="#cb225-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Dispatcher vers le bon handler</span></span>
<span id="cb225-10"><a href="#cb225-10" aria-hidden="true" tabindex="-1"></a>    TST R1<span class="op">,</span> <span class="op">#</span><span class="bn">0x01</span>                 <span class="co">; IRQ0 (Timer) ?</span></span>
<span id="cb225-11"><a href="#cb225-11" aria-hidden="true" tabindex="-1"></a>    B<span class="op">.</span>NE timer_handler</span>
<span id="cb225-12"><a href="#cb225-12" aria-hidden="true" tabindex="-1"></a>    TST R1<span class="op">,</span> <span class="op">#</span><span class="bn">0x02</span>                 <span class="co">; IRQ1 (Keyboard) ?</span></span>
<span id="cb225-13"><a href="#cb225-13" aria-hidden="true" tabindex="-1"></a>    B<span class="op">.</span>NE keyboard_handler</span>
<span id="cb225-14"><a href="#cb225-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">; ...</span></span>
<span id="cb225-15"><a href="#cb225-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-16"><a href="#cb225-16" aria-hidden="true" tabindex="-1"></a>    B irq_done</span>
<span id="cb225-17"><a href="#cb225-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-18"><a href="#cb225-18" aria-hidden="true" tabindex="-1"></a><span class="fu">timer_handler:</span></span>
<span id="cb225-19"><a href="#cb225-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Traiter le timer</span></span>
<span id="cb225-20"><a href="#cb225-20" aria-hidden="true" tabindex="-1"></a>    BL handle_timer_tick</span>
<span id="cb225-21"><a href="#cb225-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Acquitter l&#39;IRQ au PIC</span></span>
<span id="cb225-22"><a href="#cb225-22" aria-hidden="true" tabindex="-1"></a>    LDR R0<span class="op">,</span> <span class="op">=</span>PIC_BASE</span>
<span id="cb225-23"><a href="#cb225-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> R1<span class="op">,</span> <span class="op">#</span><span class="bn">0x20</span>                 <span class="co">; EOI (End Of Interrupt)</span></span>
<span id="cb225-24"><a href="#cb225-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">STR</span> R1<span class="op">,</span> <span class="op">[</span>R0<span class="op">,</span> <span class="op">#</span>EOI_OFFSET<span class="op">]</span></span>
<span id="cb225-25"><a href="#cb225-25" aria-hidden="true" tabindex="-1"></a>    B irq_done</span>
<span id="cb225-26"><a href="#cb225-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-27"><a href="#cb225-27" aria-hidden="true" tabindex="-1"></a><span class="fu">keyboard_handler:</span></span>
<span id="cb225-28"><a href="#cb225-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Lire la touche</span></span>
<span id="cb225-29"><a href="#cb225-29" aria-hidden="true" tabindex="-1"></a>    LDR R0<span class="op">,</span> <span class="op">=</span>KEYBOARD_BASE</span>
<span id="cb225-30"><a href="#cb225-30" aria-hidden="true" tabindex="-1"></a>    LDR R1<span class="op">,</span> <span class="op">[</span>R0<span class="op">]</span>                  <span class="co">; Scancode</span></span>
<span id="cb225-31"><a href="#cb225-31" aria-hidden="true" tabindex="-1"></a>    BL handle_keypress</span>
<span id="cb225-32"><a href="#cb225-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Acquitter</span></span>
<span id="cb225-33"><a href="#cb225-33" aria-hidden="true" tabindex="-1"></a>    LDR R0<span class="op">,</span> <span class="op">=</span>PIC_BASE</span>
<span id="cb225-34"><a href="#cb225-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> R1<span class="op">,</span> <span class="op">#</span><span class="bn">0x20</span></span>
<span id="cb225-35"><a href="#cb225-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">STR</span> R1<span class="op">,</span> <span class="op">[</span>R0<span class="op">,</span> <span class="op">#</span>EOI_OFFSET<span class="op">]</span></span>
<span id="cb225-36"><a href="#cb225-36" aria-hidden="true" tabindex="-1"></a>    B irq_done</span>
<span id="cb225-37"><a href="#cb225-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-38"><a href="#cb225-38" aria-hidden="true" tabindex="-1"></a><span class="fu">irq_done:</span></span>
<span id="cb225-39"><a href="#cb225-39" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Restaurer les registres</span></span>
<span id="cb225-40"><a href="#cb225-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">POP</span> <span class="op">{</span>R0<span class="op">-</span>R3<span class="op">,</span> <span class="kw">R12</span><span class="op">,</span> LR<span class="op">}</span></span>
<span id="cb225-41"><a href="#cb225-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Retour d&#39;interruption</span></span>
<span id="cb225-42"><a href="#cb225-42" aria-hidden="true" tabindex="-1"></a>    SUBS PC<span class="op">,</span> LR<span class="op">,</span> <span class="op">#</span><span class="dv">4</span>               <span class="co">; RETI : restore PC et CPSR</span></span></code></pre></div>
<h3 data-number="15.4.5" id="retour-reti"><span
class="header-section-number">15.4.5</span> 5. Retour (RETI)</h3>
<pre><code>SUBS PC, LR, #4
; Cette instruction spéciale :
; 1. Restaure PC depuis LR (moins 4 pour pipeline)
; 2. Restaure CPSR depuis SPSR
; 3. Réactive les interruptions
; 4. Reprend le programme interrompu</code></pre>
<hr />
<h2 data-number="15.5" id="gestion-des-priorités"><span
class="header-section-number">15.5</span> Gestion des Priorités</h2>
<h3 data-number="15.5.1" id="priorité-fixe-vs-programmable"><span
class="header-section-number">15.5.1</span> Priorité Fixe vs
Programmable</h3>
<pre><code>┌────────────────────────────────────────────────────────────┐
│               Système de Priorités                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Priorité 0 (Haute) : Reset, NMI                           │
│  Priorité 1         : Data Abort                           │
│  Priorité 2         : FIQ (Fast Interrupt)                 │
│  Priorité 3         : IRQ                                  │
│  Priorité 4 (Basse) : Software Interrupt                   │
│                                                             │
│  Règle : Une IRQ de priorité N peut interrompre            │
│          un handler de priorité &lt; N                         │
└─────────────────────────────────────────────────────────────┘</code></pre>
<h3 data-number="15.5.2" id="interruptions-imbriquées-nested"><span
class="header-section-number">15.5.2</span> Interruptions Imbriquées
(Nested)</h3>
<pre><code>Programme principal
       │
       ▼ IRQ1 (basse priorité)
   ┌───────────────────────┐
   │ Handler IRQ1          │
   │    │                  │
   │    ▼ IRQ2 (haute)     │
   │ ┌─────────────────┐   │
   │ │ Handler IRQ2    │   │
   │ │                 │   │
   │ │ RETI            │   │
   │ └────────┬────────┘   │
   │          │            │
   │    ◄─────┘            │
   │ (continue IRQ1)       │
   │                       │
   │ RETI                  │
   └───────────┬───────────┘
               │
       ◄───────┘
(continue programme)</code></pre>
<p>Pour autoriser les interruptions imbriquées :</p>
<div class="sourceCode" id="cb229"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nested_irq_handler:</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Sauver le contexte</span></span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">SUB</span> LR<span class="op">,</span> LR<span class="op">,</span> <span class="op">#</span><span class="dv">4</span></span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">PUSH</span> <span class="op">{</span>LR<span class="op">}</span></span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a>    MRS LR<span class="op">,</span> SPSR</span>
<span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">PUSH</span> <span class="op">{</span>LR<span class="op">}</span></span>
<span id="cb229-7"><a href="#cb229-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">PUSH</span> <span class="op">{</span>R0<span class="op">-</span><span class="kw">R12</span><span class="op">}</span></span>
<span id="cb229-8"><a href="#cb229-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-9"><a href="#cb229-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">; IMPORTANT : Réactiver les interruptions</span></span>
<span id="cb229-10"><a href="#cb229-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">; pour permettre le nesting</span></span>
<span id="cb229-11"><a href="#cb229-11" aria-hidden="true" tabindex="-1"></a>    MRS R0<span class="op">,</span> CPSR</span>
<span id="cb229-12"><a href="#cb229-12" aria-hidden="true" tabindex="-1"></a>    BIC R0<span class="op">,</span> R0<span class="op">,</span> <span class="op">#</span><span class="bn">0x80</span>    <span class="co">; Clear I bit</span></span>
<span id="cb229-13"><a href="#cb229-13" aria-hidden="true" tabindex="-1"></a>    MSR CPSR_c<span class="op">,</span> R0</span>
<span id="cb229-14"><a href="#cb229-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-15"><a href="#cb229-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Traiter l&#39;IRQ...</span></span>
<span id="cb229-16"><a href="#cb229-16" aria-hidden="true" tabindex="-1"></a>    BL do_irq_work</span>
<span id="cb229-17"><a href="#cb229-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-18"><a href="#cb229-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Désactiver avant de restaurer</span></span>
<span id="cb229-19"><a href="#cb229-19" aria-hidden="true" tabindex="-1"></a>    MRS R0<span class="op">,</span> CPSR</span>
<span id="cb229-20"><a href="#cb229-20" aria-hidden="true" tabindex="-1"></a>    ORR R0<span class="op">,</span> R0<span class="op">,</span> <span class="op">#</span><span class="bn">0x80</span></span>
<span id="cb229-21"><a href="#cb229-21" aria-hidden="true" tabindex="-1"></a>    MSR CPSR_c<span class="op">,</span> R0</span>
<span id="cb229-22"><a href="#cb229-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-23"><a href="#cb229-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Restaurer</span></span>
<span id="cb229-24"><a href="#cb229-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">POP</span> <span class="op">{</span>R0<span class="op">-</span><span class="kw">R12</span><span class="op">}</span></span>
<span id="cb229-25"><a href="#cb229-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">POP</span> <span class="op">{</span>LR<span class="op">}</span></span>
<span id="cb229-26"><a href="#cb229-26" aria-hidden="true" tabindex="-1"></a>    MSR SPSR_cxsf<span class="op">,</span> LR</span>
<span id="cb229-27"><a href="#cb229-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">POP</span> <span class="op">{</span>PC<span class="op">}</span>^            <span class="co">; Restore avec SPSR</span></span></code></pre></div>
<hr />
<h2 data-number="15.6" id="latence-dinterruption"><span
class="header-section-number">15.6</span> Latence d’Interruption</h2>
<h3 data-number="15.6.1" id="composants-de-la-latence"><span
class="header-section-number">15.6.1</span> Composants de la
Latence</h3>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│              Temps de Réponse Total                          │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│ T_total = T_recognition + T_save + T_vector + T_handler     │
│                                                              │
│ T_recognition : Temps pour terminer l&#39;instruction courante  │
│                 (1-N cycles selon l&#39;instruction)            │
│                                                              │
│ T_save : Sauvegarde automatique PC/CPSR                     │
│          (~3-5 cycles)                                       │
│                                                              │
│ T_vector : Lecture de l&#39;IVT + jump                          │
│            (~2-4 cycles)                                     │
│                                                              │
│ T_handler : Première instruction utile du handler           │
│                                                              │
│ Total typique : 10-50 cycles (quelques µs)                  │
└─────────────────────────────────────────────────────────────┘</code></pre>
<h3 data-number="15.6.2" id="optimiser-la-latence"><span
class="header-section-number">15.6.2</span> Optimiser la Latence</h3>
<ol type="1">
<li><p><strong>FIQ (Fast Interrupt Request)</strong> : Registres banqués
dédiés</p>
<pre><code>Mode FIQ : R8_fiq à R14_fiq sont séparés
→ Pas besoin de PUSH/POP = gain de 20+ cycles</code></pre></li>
<li><p><strong>Handlers courts</strong> : Faire le minimum, déférer le
reste</p>
<div class="sourceCode" id="cb232"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co">// MAUVAIS : tout dans l&#39;ISR</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> timer_isr<span class="op">()</span> <span class="op">{</span></span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>    update_all_timers<span class="op">();</span>     <span class="co">// Long !</span></span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>    recalculate_scheduling<span class="op">();</span> <span class="co">// Très long !</span></span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a>    ack_interrupt<span class="op">();</span></span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-8"><a href="#cb232-8" aria-hidden="true" tabindex="-1"></a><span class="co">// BON : flag + traitement différé</span></span>
<span id="cb232-9"><a href="#cb232-9" aria-hidden="true" tabindex="-1"></a><span class="dt">volatile</span> <span class="dt">int</span> timer_pending <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb232-10"><a href="#cb232-10" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> timer_isr<span class="op">()</span> <span class="op">{</span></span>
<span id="cb232-11"><a href="#cb232-11" aria-hidden="true" tabindex="-1"></a>    timer_pending <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb232-12"><a href="#cb232-12" aria-hidden="true" tabindex="-1"></a>    ack_interrupt<span class="op">();</span></span>
<span id="cb232-13"><a href="#cb232-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb232-14"><a href="#cb232-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Dans la boucle principale ou thread dédié :</span></span>
<span id="cb232-15"><a href="#cb232-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>timer_pending<span class="op">)</span> <span class="op">{</span></span>
<span id="cb232-16"><a href="#cb232-16" aria-hidden="true" tabindex="-1"></a>    timer_pending <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb232-17"><a href="#cb232-17" aria-hidden="true" tabindex="-1"></a>    do_heavy_work<span class="op">();</span></span>
<span id="cb232-18"><a href="#cb232-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
<li><p><strong>Interrupt coalescing</strong> : Regrouper plusieurs
événements</p>
<pre><code>Au lieu de : 1 IRQ par paquet réseau
Faire      : 1 IRQ pour N paquets ou après T ms</code></pre></li>
</ol>
<hr />
<h2 data-number="15.7"
id="interruptions-et-systèmes-dexploitation"><span
class="header-section-number">15.7</span> Interruptions et Systèmes
d’Exploitation</h2>
<h3 data-number="15.7.1" id="le-timer-le-coeur-battant-de-los"><span
class="header-section-number">15.7.1</span> Le Timer : Le Coeur Battant
de l’OS</h3>
<div class="sourceCode" id="cb234"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Tick système (ex: 1000 Hz = toutes les 1 ms)</span></span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> timer_handler<span class="op">()</span> <span class="op">{</span></span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 1. Incrémenter le compteur système</span></span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>    system_ticks<span class="op">++;</span></span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2. Vérifier les timeouts</span></span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a>    check_sleeping_threads<span class="op">();</span></span>
<span id="cb234-8"><a href="#cb234-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-9"><a href="#cb234-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 3. Time-slice scheduling</span></span>
<span id="cb234-10"><a href="#cb234-10" aria-hidden="true" tabindex="-1"></a>    current_thread<span class="op">-&gt;</span>time_remaining<span class="op">--;</span></span>
<span id="cb234-11"><a href="#cb234-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>current_thread<span class="op">-&gt;</span>time_remaining <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb234-12"><a href="#cb234-12" aria-hidden="true" tabindex="-1"></a>        schedule<span class="op">();</span>  <span class="co">// Préemption !</span></span>
<span id="cb234-13"><a href="#cb234-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb234-14"><a href="#cb234-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-15"><a href="#cb234-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 4. Mise à jour des statistiques</span></span>
<span id="cb234-16"><a href="#cb234-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>in_user_mode<span class="op">)</span> user_time<span class="op">++;</span></span>
<span id="cb234-17"><a href="#cb234-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> kernel_time<span class="op">++;</span></span>
<span id="cb234-18"><a href="#cb234-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="15.7.2"
id="changement-de-contexte-context-switch"><span
class="header-section-number">15.7.2</span> Changement de Contexte
(Context Switch)</h3>
<p>Quand le scheduler décide de changer de thread :</p>
<div class="sourceCode" id="cb235"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">context_switch:</span></span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Sauver le contexte du thread courant</span></span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>    LDR R0<span class="op">,</span> <span class="op">=</span>current_thread</span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>    LDR R0<span class="op">,</span> <span class="op">[</span>R0<span class="op">]</span></span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Sauver tous les registres dans la structure thread</span></span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a>    STMIA R0<span class="op">,</span> <span class="op">{</span>R0<span class="op">-</span><span class="kw">R14</span><span class="op">}</span>^    <span class="co">; Registres user mode</span></span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a>    MRS R1<span class="op">,</span> CPSR</span>
<span id="cb235-9"><a href="#cb235-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">STR</span> R1<span class="op">,</span> <span class="op">[</span>R0<span class="op">,</span> <span class="op">#</span><span class="dv">60</span><span class="op">]</span>      <span class="co">; Sauver CPSR</span></span>
<span id="cb235-10"><a href="#cb235-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-11"><a href="#cb235-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Charger le nouveau thread</span></span>
<span id="cb235-12"><a href="#cb235-12" aria-hidden="true" tabindex="-1"></a>    LDR R0<span class="op">,</span> <span class="op">=</span>next_thread</span>
<span id="cb235-13"><a href="#cb235-13" aria-hidden="true" tabindex="-1"></a>    LDR R0<span class="op">,</span> <span class="op">[</span>R0<span class="op">]</span></span>
<span id="cb235-14"><a href="#cb235-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-15"><a href="#cb235-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Restaurer son contexte</span></span>
<span id="cb235-16"><a href="#cb235-16" aria-hidden="true" tabindex="-1"></a>    LDR R1<span class="op">,</span> <span class="op">[</span>R0<span class="op">,</span> <span class="op">#</span><span class="dv">60</span><span class="op">]</span></span>
<span id="cb235-17"><a href="#cb235-17" aria-hidden="true" tabindex="-1"></a>    MSR CPSR_cxsf<span class="op">,</span> R1</span>
<span id="cb235-18"><a href="#cb235-18" aria-hidden="true" tabindex="-1"></a>    LDMIA R0<span class="op">,</span> <span class="op">{</span>R0<span class="op">-</span><span class="kw">R14</span><span class="op">}</span>^</span>
<span id="cb235-19"><a href="#cb235-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-20"><a href="#cb235-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Mettre à jour current_thread</span></span>
<span id="cb235-21"><a href="#cb235-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">; ...</span></span>
<span id="cb235-22"><a href="#cb235-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-23"><a href="#cb235-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Retour (au nouveau thread)</span></span>
<span id="cb235-24"><a href="#cb235-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOVS</span> PC<span class="op">,</span> LR</span></code></pre></div>
<hr />
<h2 data-number="15.8" id="problèmes-de-concurrence"><span
class="header-section-number">15.8</span> Problèmes de Concurrence</h2>
<h3 data-number="15.8.1" id="race-conditions"><span
class="header-section-number">15.8.1</span> Race Conditions</h3>
<div class="sourceCode" id="cb236"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co">// PROBLÈME : variable partagée sans protection</span></span>
<span id="cb236-2"><a href="#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="dt">volatile</span> <span class="dt">int</span> counter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb236-3"><a href="#cb236-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-4"><a href="#cb236-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> main_program<span class="op">()</span> <span class="op">{</span></span>
<span id="cb236-5"><a href="#cb236-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Peut être interrompu entre ces opérations !</span></span>
<span id="cb236-6"><a href="#cb236-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> temp <span class="op">=</span> counter<span class="op">;</span>    <span class="co">// ← IRQ ICI ?</span></span>
<span id="cb236-7"><a href="#cb236-7" aria-hidden="true" tabindex="-1"></a>    temp <span class="op">=</span> temp <span class="op">+</span> <span class="dv">1</span><span class="op">;</span>       <span class="co">// ← OU ICI ?</span></span>
<span id="cb236-8"><a href="#cb236-8" aria-hidden="true" tabindex="-1"></a>    counter <span class="op">=</span> temp<span class="op">;</span>        <span class="co">// ← OU ICI ?</span></span>
<span id="cb236-9"><a href="#cb236-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb236-10"><a href="#cb236-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-11"><a href="#cb236-11" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> irq_handler<span class="op">()</span> <span class="op">{</span></span>
<span id="cb236-12"><a href="#cb236-12" aria-hidden="true" tabindex="-1"></a>    counter<span class="op">++;</span>  <span class="co">// Modification pendant que main lit ?</span></span>
<span id="cb236-13"><a href="#cb236-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb236-14"><a href="#cb236-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-15"><a href="#cb236-15" aria-hidden="true" tabindex="-1"></a><span class="co">// Résultat possible :</span></span>
<span id="cb236-16"><a href="#cb236-16" aria-hidden="true" tabindex="-1"></a><span class="co">// main lit counter = 5</span></span>
<span id="cb236-17"><a href="#cb236-17" aria-hidden="true" tabindex="-1"></a><span class="co">// IRQ: counter = 6</span></span>
<span id="cb236-18"><a href="#cb236-18" aria-hidden="true" tabindex="-1"></a><span class="co">// main écrit counter = 6  ← Incrémentation perdue !</span></span></code></pre></div>
<h3 data-number="15.8.2" id="sections-critiques"><span
class="header-section-number">15.8.2</span> Sections Critiques</h3>
<div class="sourceCode" id="cb237"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="co">// SOLUTION : désactiver les interruptions</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> safe_increment<span class="op">()</span> <span class="op">{</span></span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>    disable_interrupts<span class="op">();</span>   <span class="co">// CLI</span></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a>    counter<span class="op">++;</span></span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>    enable_interrupts<span class="op">();</span>    <span class="co">// STI</span></span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb237-7"><a href="#cb237-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-8"><a href="#cb237-8" aria-hidden="true" tabindex="-1"></a><span class="co">// En assembleur A32 :</span></span>
<span id="cb237-9"><a href="#cb237-9" aria-hidden="true" tabindex="-1"></a>safe_increment<span class="op">:</span></span>
<span id="cb237-10"><a href="#cb237-10" aria-hidden="true" tabindex="-1"></a>    MRS R1<span class="op">,</span> CPSR</span>
<span id="cb237-11"><a href="#cb237-11" aria-hidden="true" tabindex="-1"></a>    ORR R2<span class="op">,</span> R1<span class="op">,</span> #<span class="bn">0x80</span>      <span class="op">;</span> Set I bit</span>
<span id="cb237-12"><a href="#cb237-12" aria-hidden="true" tabindex="-1"></a>    MSR CPSR_c<span class="op">,</span> R2         <span class="op">;</span> Disable IRQ</span>
<span id="cb237-13"><a href="#cb237-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-14"><a href="#cb237-14" aria-hidden="true" tabindex="-1"></a>    LDR R0<span class="op">,</span> <span class="op">=</span>counter</span>
<span id="cb237-15"><a href="#cb237-15" aria-hidden="true" tabindex="-1"></a>    LDR R3<span class="op">,</span> <span class="op">[</span>R0<span class="op">]</span></span>
<span id="cb237-16"><a href="#cb237-16" aria-hidden="true" tabindex="-1"></a>    ADD R3<span class="op">,</span> R3<span class="op">,</span> #<span class="dv">1</span></span>
<span id="cb237-17"><a href="#cb237-17" aria-hidden="true" tabindex="-1"></a>    STR R3<span class="op">,</span> <span class="op">[</span>R0<span class="op">]</span></span>
<span id="cb237-18"><a href="#cb237-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-19"><a href="#cb237-19" aria-hidden="true" tabindex="-1"></a>    MSR CPSR_c<span class="op">,</span> R1         <span class="op">;</span> Restore <span class="op">(</span>enable <span class="cf">if</span> was<span class="op">)</span></span>
<span id="cb237-20"><a href="#cb237-20" aria-hidden="true" tabindex="-1"></a>    BX LR</span></code></pre></div>
<h3 data-number="15.8.3"
id="attention-ne-pas-rester-trop-longtemps"><span
class="header-section-number">15.8.3</span> Attention : Ne Pas Rester
Trop Longtemps !</h3>
<div class="sourceCode" id="cb238"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co">// MAUVAIS : interruptions désactivées trop longtemps</span></span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> bad_function<span class="op">()</span> <span class="op">{</span></span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a>    disable_interrupts<span class="op">();</span></span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a>    do_long_operation<span class="op">();</span>    <span class="co">// 10 ms !</span></span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a>    enable_interrupts<span class="op">();</span></span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Risque : perte d&#39;IRQ, latence horrible</span></span>
<span id="cb238-8"><a href="#cb238-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-9"><a href="#cb238-9" aria-hidden="true" tabindex="-1"></a><span class="co">// BON : minimiser la section critique</span></span>
<span id="cb238-10"><a href="#cb238-10" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> good_function<span class="op">()</span> <span class="op">{</span></span>
<span id="cb238-11"><a href="#cb238-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Préparation hors section critique</span></span>
<span id="cb238-12"><a href="#cb238-12" aria-hidden="true" tabindex="-1"></a>    prepare_data<span class="op">();</span></span>
<span id="cb238-13"><a href="#cb238-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-14"><a href="#cb238-14" aria-hidden="true" tabindex="-1"></a>    disable_interrupts<span class="op">();</span></span>
<span id="cb238-15"><a href="#cb238-15" aria-hidden="true" tabindex="-1"></a>    quick_update<span class="op">();</span>         <span class="co">// &lt; 10 µs</span></span>
<span id="cb238-16"><a href="#cb238-16" aria-hidden="true" tabindex="-1"></a>    enable_interrupts<span class="op">();</span></span>
<span id="cb238-17"><a href="#cb238-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-18"><a href="#cb238-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Traitement hors section critique</span></span>
<span id="cb238-19"><a href="#cb238-19" aria-hidden="true" tabindex="-1"></a>    process_result<span class="op">();</span></span>
<span id="cb238-20"><a href="#cb238-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<hr />
<h2 data-number="15.9" id="exercices-pratiques-9"><span
class="header-section-number">15.9</span> Exercices Pratiques</h2>
<h3 data-number="15.9.1" id="exercices-sur-le-simulateur-web-9"><span
class="header-section-number">15.9.1</span> Exercices sur le Simulateur
Web</h3>
<p>Lancez le <strong>Simulateur Web</strong> et allez dans
<strong>Exercices OS</strong> pour pratiquer les concepts de ce chapitre
:</p>
<table>
<colgroup>
<col style="width: 30%" />
<col style="width: 39%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="header">
<th>Exercice</th>
<th>Description</th>
<th>Concepts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>os-timer</code></td>
<td>Compte à rebours visuel</td>
<td>Timer, compteurs</td>
</tr>
<tr class="even">
<td><code>os-irq</code></td>
<td>Interruptions visuelles (T/K/S)</td>
<td>Handlers, dispatch, acquittement</td>
</tr>
</tbody>
</table>
<p>Ces exercices interactifs vous permettent de voir les interruptions
en action avec un retour visuel immédiat.</p>
<h3 data-number="15.9.2"
id="exercice-1-gestionnaire-de-timer-simple"><span
class="header-section-number">15.9.2</span> Exercice 1 : Gestionnaire de
Timer Simple</h3>
<p>Implémentez un handler de timer qui compte les secondes :</p>
<div class="sourceCode" id="cb239"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="co">; Variables globales</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>.<span class="bu">data</span></span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ticks:</span>      .<span class="dt">word</span> <span class="dv">0</span></span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a><span class="fu">seconds:</span>    .<span class="dt">word</span> <span class="dv">0</span></span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a>.text</span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a><span class="co">; </span><span class="al">TODO</span><span class="co">: Implémenter timer_handler</span></span>
<span id="cb239-8"><a href="#cb239-8" aria-hidden="true" tabindex="-1"></a><span class="co">; - Incrémenter ticks</span></span>
<span id="cb239-9"><a href="#cb239-9" aria-hidden="true" tabindex="-1"></a><span class="co">; - Si ticks == 1000, incrémenter seconds et reset ticks</span></span>
<span id="cb239-10"><a href="#cb239-10" aria-hidden="true" tabindex="-1"></a><span class="co">; - Acquitter l&#39;interruption</span></span>
<span id="cb239-11"><a href="#cb239-11" aria-hidden="true" tabindex="-1"></a><span class="fu">timer_handler:</span></span>
<span id="cb239-12"><a href="#cb239-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Votre code ici</span></span></code></pre></div>
<h3 data-number="15.9.3"
id="exercice-2-buffer-circulaire-pour-clavier"><span
class="header-section-number">15.9.3</span> Exercice 2 : Buffer
Circulaire pour Clavier</h3>
<div class="sourceCode" id="cb240"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Implémenter un buffer circulaire pour stocker les touches</span></span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define BUFFER_SIZE </span><span class="dv">16</span></span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> data<span class="op">[</span>BUFFER_SIZE<span class="op">];</span></span>
<span id="cb240-6"><a href="#cb240-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> head<span class="op">;</span>  <span class="co">// Prochain emplacement d&#39;écriture (ISR)</span></span>
<span id="cb240-7"><a href="#cb240-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> tail<span class="op">;</span>  <span class="co">// Prochain emplacement de lecture (main)</span></span>
<span id="cb240-8"><a href="#cb240-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> RingBuffer<span class="op">;</span></span>
<span id="cb240-9"><a href="#cb240-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-10"><a href="#cb240-10" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="al">TODO</span><span class="co">: Implémenter</span></span>
<span id="cb240-11"><a href="#cb240-11" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> keyboard_isr<span class="op">();</span>        <span class="co">// Ajoute une touche au buffer</span></span>
<span id="cb240-12"><a href="#cb240-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> get_key<span class="op">();</span>              <span class="co">// Lit une touche (bloquant ou non)</span></span>
<span id="cb240-13"><a href="#cb240-13" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> buffer_empty<span class="op">();</span>         <span class="co">// Test si vide</span></span></code></pre></div>
<h3 data-number="15.9.4" id="exercice-3-ordonnanceur-simple"><span
class="header-section-number">15.9.4</span> Exercice 3 : Ordonnanceur
Simple</h3>
<div class="sourceCode" id="cb241"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb241-1"><a href="#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Implémenter un scheduler round-robin basé sur timer</span></span>
<span id="cb241-2"><a href="#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAX_THREADS </span><span class="dv">4</span></span>
<span id="cb241-3"><a href="#cb241-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define TIME_SLICE </span><span class="dv">10</span><span class="pp">  </span><span class="co">// ms</span></span>
<span id="cb241-4"><a href="#cb241-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-5"><a href="#cb241-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb241-6"><a href="#cb241-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id<span class="op">;</span></span>
<span id="cb241-7"><a href="#cb241-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> state<span class="op">;</span>          <span class="co">// READY, RUNNING, BLOCKED</span></span>
<span id="cb241-8"><a href="#cb241-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span><span class="op">*</span> stack_ptr<span class="op">;</span></span>
<span id="cb241-9"><a href="#cb241-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> time_remaining<span class="op">;</span></span>
<span id="cb241-10"><a href="#cb241-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Thread<span class="op">;</span></span>
<span id="cb241-11"><a href="#cb241-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-12"><a href="#cb241-12" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="al">TODO</span><span class="co">: Implémenter</span></span>
<span id="cb241-13"><a href="#cb241-13" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> scheduler_init<span class="op">();</span></span>
<span id="cb241-14"><a href="#cb241-14" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> timer_isr<span class="op">();</span>           <span class="co">// Décrémente time_remaining, schedule si 0</span></span>
<span id="cb241-15"><a href="#cb241-15" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> schedule<span class="op">();</span>            <span class="co">// Choisit le prochain thread</span></span>
<span id="cb241-16"><a href="#cb241-16" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> context_switch<span class="op">();</span>      <span class="co">// Change de thread</span></span></code></pre></div>
<h3 data-number="15.9.5" id="exercice-4-analyse-de-latence"><span
class="header-section-number">15.9.5</span> Exercice 4 : Analyse de
Latence</h3>
<p>Calculez la latence d’interruption pour : - Instruction en cours :
LDM (chargement de 8 registres) - Sauvegarde automatique : 3 cycles -
Fetch du vecteur : 2 cycles - Handler : PUSH de 6 registres</p>
<hr />
<h2 data-number="15.10" id="auto-évaluation-10"><span
class="header-section-number">15.10</span> Auto-évaluation</h2>
<h3 data-number="15.10.1" id="quiz"><span
class="header-section-number">15.10.1</span> Quiz</h3>
<p><strong>Q1.</strong> Quelle est la différence entre une interruption
matérielle et une exception ?</p>
<p><strong>Q2.</strong> Pourquoi le polling est-il inefficace comparé
aux interruptions ?</p>
<p><strong>Q3.</strong> Que contient la table des vecteurs
d’interruption (IVT) ?</p>
<p><strong>Q4.</strong> Qu’est-ce qu’une race condition et comment
l’éviter ?</p>
<p><strong>Q5.</strong> Pourquoi est-il important que les handlers
d’interruption soient courts ?</p>
<p><strong>Q6.</strong> Expliquez le rôle de l’instruction RETI (ou
équivalent).</p>
<p><strong>Q7.</strong> Qu’est-ce que le FIQ et pourquoi est-il plus
rapide que l’IRQ ?</p>
<h3 data-number="15.10.2" id="exercice-de-réflexion"><span
class="header-section-number">15.10.2</span> Exercice de Réflexion</h3>
<p>Un système a les caractéristiques suivantes : - Timer IRQ toutes les
1 ms - Chaque IRQ timer prend 50 µs à traiter - Un thread doit répondre
à des événements réseau en moins de 100 µs</p>
<p>Ce système peut-il garantir la latence réseau demandée ?
Justifiez.</p>
<hr />
<h2 data-number="15.11" id="résumé"><span
class="header-section-number">15.11</span> Résumé</h2>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│                    INTERRUPTIONS                             │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  TYPES :                                                     │
│  • IRQ  - Matériel externe (timer, clavier, réseau)         │
│  • Trap - Logiciel intentionnel (syscall)                   │
│  • Exception - Erreur (div/0, page fault)                   │
│                                                              │
│  CYCLE :                                                     │
│  1. Événement déclenche l&#39;IRQ                               │
│  2. CPU termine l&#39;instruction courante                      │
│  3. Sauvegarde PC, CPSR                                     │
│  4. Consulte IVT, jump au handler                           │
│  5. Handler traite l&#39;événement                              │
│  6. RETI restaure et reprend                                │
│                                                              │
│  BONNES PRATIQUES :                                          │
│  • Handlers courts (defer le travail lourd)                 │
│  • Protéger les sections critiques                          │
│  • Acquitter les IRQ                                        │
│  • Minimiser le temps interruptions désactivées             │
│                                                              │
└─────────────────────────────────────────────────────────────┘</code></pre>
<p>Les interruptions sont fondamentales pour tout système réactif. Elles
permettent au matériel de communiquer efficacement avec le logiciel, et
sont la base de concepts avancés comme le multitâche préemptif et les
systèmes temps réel.</p>
<h1 data-number="16"
id="concepts-avancés-du-code-source-à-lexécution"><span
class="header-section-number">16</span> Concepts Avancés : Du Code
Source à l’Exécution</h1>
<p>Ce chapitre explore des concepts essentiels qui relient le code que
vous écrivez à son exécution réelle : comment les programmes sont
assemblés et liés, comment gérer les erreurs proprement, et comment
faire tourner plusieurs tâches “en parallèle”.</p>
<hr />
<h2 data-number="16.1" id="partie-1-compilation-et-linking"><span
class="header-section-number">16.1</span> Partie 1 : Compilation et
Linking</h2>
<h3 data-number="16.1.1" id="le-voyage-du-code-source"><span
class="header-section-number">16.1.1</span> Le Voyage du Code
Source</h3>
<pre><code>┌──────────────────────────────────────────────────────────────────┐
│                    Pipeline de Compilation                        │
└──────────────────────────────────────────────────────────────────┘

  main.c          math.c          stdio.h
    │               │                │
    ▼               ▼                │
┌────────┐     ┌────────┐           │
│Préproc.│     │Préproc.│ ◄─────────┘
└───┬────┘     └───┬────┘
    │               │
    ▼               ▼
┌────────┐     ┌────────┐
│Compil. │     │Compil. │
└───┬────┘     └───┬────┘
    │               │
    ▼               ▼
  main.s          math.s
    │               │
    ▼               ▼
┌────────┐     ┌────────┐
│Assemb. │     │Assemb. │
└───┬────┘     └───┬────┘
    │               │
    ▼               ▼
  main.o          math.o       libc.a
    │               │             │
    └───────┬───────┴─────────────┘
            │
            ▼
       ┌────────┐
       │ Linker │
       └───┬────┘
            │
            ▼
       programme.exe</code></pre>
<h3 data-number="16.1.2" id="le-préprocesseur"><span
class="header-section-number">16.1.2</span> Le Préprocesseur</h3>
<p>Le préprocesseur traite le code <strong>avant</strong> la compilation
:</p>
<div class="sourceCode" id="cb244"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Inclusion de fichiers</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span><span class="pp">      </span><span class="co">// Fichiers système : /usr/include/</span></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&quot;myheader.h&quot;</span><span class="pp">   </span><span class="co">// Fichiers locaux : ./</span></span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Macros de substitution</span></span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MAX_SIZE </span><span class="dv">100</span></span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SQUARE</span><span class="op">(</span><span class="pp">x</span><span class="op">)</span><span class="pp"> </span><span class="op">((</span><span class="pp">x</span><span class="op">)</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">x</span><span class="op">))</span></span>
<span id="cb244-8"><a href="#cb244-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-9"><a href="#cb244-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> arr<span class="op">[</span>MAX_SIZE<span class="op">];</span>          <span class="co">// → int arr[100];</span></span>
<span id="cb244-10"><a href="#cb244-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> y <span class="op">=</span> SQUARE<span class="op">(</span><span class="dv">5</span><span class="op">);</span>          <span class="co">// → int y = ((5) * (5));</span></span>
<span id="cb244-11"><a href="#cb244-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> z <span class="op">=</span> SQUARE<span class="op">(</span>a <span class="op">+</span> b<span class="op">);</span>      <span class="co">// → int z = ((a + b) * (a + b));</span></span>
<span id="cb244-12"><a href="#cb244-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-13"><a href="#cb244-13" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="al">ATTENTION</span><span class="co"> aux pièges des macros !</span></span>
<span id="cb244-14"><a href="#cb244-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#define BAD_SQUARE</span><span class="op">(</span><span class="pp">x</span><span class="op">)</span><span class="pp"> x </span><span class="op">*</span><span class="pp"> x</span></span>
<span id="cb244-15"><a href="#cb244-15" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> bad <span class="op">=</span> BAD_SQUARE<span class="op">(</span>a <span class="op">+</span> b<span class="op">);</span>  <span class="co">// → int bad = a + b * a + b; FAUX !</span></span>
<span id="cb244-16"><a href="#cb244-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-17"><a href="#cb244-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Compilation conditionnelle</span></span>
<span id="cb244-18"><a href="#cb244-18" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef DEBUG</span></span>
<span id="cb244-19"><a href="#cb244-19" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;Variable x = </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb244-20"><a href="#cb244-20" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb244-21"><a href="#cb244-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-22"><a href="#cb244-22" aria-hidden="true" tabindex="-1"></a><span class="pp">#if PLATFORM == WINDOWS</span></span>
<span id="cb244-23"><a href="#cb244-23" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;win32.h&quot;</span></span>
<span id="cb244-24"><a href="#cb244-24" aria-hidden="true" tabindex="-1"></a><span class="pp">#elif PLATFORM == LINUX</span></span>
<span id="cb244-25"><a href="#cb244-25" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&quot;linux.h&quot;</span></span>
<span id="cb244-26"><a href="#cb244-26" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span>
<span id="cb244-27"><a href="#cb244-27" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#error &quot;Platform non supportée&quot;</span></span>
<span id="cb244-28"><a href="#cb244-28" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb244-29"><a href="#cb244-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-30"><a href="#cb244-30" aria-hidden="true" tabindex="-1"></a><span class="co">// Protection contre les inclusions multiples</span></span>
<span id="cb244-31"><a href="#cb244-31" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef MYHEADER_H</span></span>
<span id="cb244-32"><a href="#cb244-32" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MYHEADER_H</span></span>
<span id="cb244-33"><a href="#cb244-33" aria-hidden="true" tabindex="-1"></a><span class="co">// ... contenu du header ...</span></span>
<span id="cb244-34"><a href="#cb244-34" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div>
<p>Voir le résultat du préprocesseur :</p>
<div class="sourceCode" id="cb245"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-E</span> main.c <span class="at">-o</span> main.i    <span class="co"># Sortie préprocessée</span></span></code></pre></div>
<h3 data-number="16.1.3" id="les-fichiers-objets-.o"><span
class="header-section-number">16.1.3</span> Les Fichiers Objets
(.o)</h3>
<p>Un fichier objet contient :</p>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│                    Structure d&#39;un .o                         │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  Header                                                      │
│  ├── Magic number (identifie le format)                     │
│  ├── Architecture cible (ARM, x86, etc.)                    │
│  └── Taille des sections                                    │
│                                                              │
│  Section .text (code)                                        │
│  │  0x0000: PUSH {R4, LR}                                   │
│  │  0x0004: MOV R4, R0                                      │
│  │  0x0008: BL ????         ← Adresse de printf inconnue   │
│  │  ...                                                      │
│                                                              │
│  Section .data (variables initialisées)                      │
│  │  0x0000: message: .asciz &quot;Hello&quot;                         │
│  │  0x0008: count:   .word 42                               │
│                                                              │
│  Section .bss (variables non-initialisées)                   │
│  │  0x0000: buffer: .space 1024                             │
│                                                              │
│  Section .rodata (constantes)                                │
│  │  0x0000: pi: .float 3.14159                              │
│                                                              │
│  Table des Symboles                                          │
│  │  main        : .text + 0x0000  (GLOBAL, DEFINED)         │
│  │  helper      : .text + 0x0040  (LOCAL, DEFINED)          │
│  │  printf      : ???             (GLOBAL, UNDEFINED)  ←    │
│  │  malloc      : ???             (GLOBAL, UNDEFINED)  ←    │
│                                                              │
│  Table de Relocation                                         │
│  │  .text+0x0008 : référence à &#39;printf&#39;                     │
│  │  .text+0x0020 : référence à &#39;message&#39; (.data)            │
│  │  ...                                                      │
│                                                              │
└─────────────────────────────────────────────────────────────┘</code></pre>
<h3 data-number="16.1.4" id="le-linker-éditeur-de-liens"><span
class="header-section-number">16.1.4</span> Le Linker (Éditeur de
Liens)</h3>
<p>Le linker combine les fichiers objets :</p>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│                   Travail du Linker                          │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  1. COLLECTE : Rassembler toutes les sections                │
│                                                              │
│     main.o            math.o            libc.a              │
│     ┌────────┐        ┌────────┐        ┌────────┐          │
│     │ .text  │        │ .text  │        │ printf │          │
│     │ .data  │   +    │ .data  │   +    │ malloc │          │
│     │ .bss   │        │ .bss   │        │ ...    │          │
│     └────────┘        └────────┘        └────────┘          │
│                                                              │
│  2. FUSION : Combiner les sections de même type              │
│                                                              │
│     Exécutable final :                                       │
│     ┌──────────────────────────────────┐                    │
│     │ .text : main.o.text              │ 0x00001000         │
│     │         math.o.text              │ 0x00001200         │
│     │         libc.text (printf, etc.) │ 0x00001400         │
│     ├──────────────────────────────────┤                    │
│     │ .data : main.o.data              │ 0x00002000         │
│     │         math.o.data              │ 0x00002100         │
│     ├──────────────────────────────────┤                    │
│     │ .bss  : (alloué mais pas stocké) │ 0x00003000         │
│     └──────────────────────────────────┘                    │
│                                                              │
│  3. RELOCATION : Résoudre les adresses                       │
│                                                              │
│     Avant : BL ????        (printf non résolu)              │
│     Après : BL 0x00001480  (adresse finale de printf)       │
│                                                              │
│  4. RÉSOLUTION : Vérifier que tout est défini                │
│                                                              │
│     Si un symbole reste UNDEFINED → Erreur de link !        │
│     &quot;undefined reference to &#39;foo&#39;&quot;                           │
│                                                              │
└─────────────────────────────────────────────────────────────┘</code></pre>
<h3 data-number="16.1.5" id="linking-statique-vs-dynamique"><span
class="header-section-number">16.1.5</span> Linking Statique vs
Dynamique</h3>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│              LINKING STATIQUE                                │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  gcc main.o -static -o programme                            │
│                                                              │
│  Exécutable contient TOUT :                                  │
│  ┌─────────────────────────────┐                            │
│  │  Code de main()             │                            │
│  │  Code de printf()    ← copié de libc.a                   │
│  │  Code de malloc()    ← copié de libc.a                   │
│  │  ...toute la libc... ← GROS fichier !                    │
│  └─────────────────────────────┘                            │
│                                                              │
│  + Autonome, pas de dépendances                              │
│  + Légèrement plus rapide (pas de résolution runtime)        │
│  - Gros exécutable (plusieurs MB)                            │
│  - Pas de mise à jour de libc sans recompiler                │
│  - Duplication si plusieurs programmes utilisent libc        │
│                                                              │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│              LINKING DYNAMIQUE                               │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  gcc main.o -o programme                                    │
│                                                              │
│  Exécutable minimal + références :                           │
│  ┌─────────────────────────────┐                            │
│  │  Code de main()             │                            │
│  │  REF: printf → libc.so      │                            │
│  │  REF: malloc → libc.so      │                            │
│  └─────────────────────────────┘                            │
│                                                              │
│  Au chargement (runtime) :                                   │
│  ┌─────────────────────────────┐     ┌──────────────┐       │
│  │     programme               │     │   libc.so    │       │
│  │  ┌───────────────────────┐  │     │  printf()    │       │
│  │  │ printf ─────────────────────────→            │       │
│  │  │ malloc ─────────────────────────→ malloc()   │       │
│  │  └───────────────────────┘  │     └──────────────┘       │
│  └─────────────────────────────┘                            │
│                                                              │
│  + Petit exécutable                                          │
│  + Libc partagée entre tous les programmes                   │
│  + Mises à jour de libc automatiques                         │
│  - Dépendance externe (DLL hell)                             │
│  - Légère overhead au démarrage                              │
│                                                              │
└─────────────────────────────────────────────────────────────┘</code></pre>
<h3 data-number="16.1.6" id="plt-et-got-comment-ça-marche"><span
class="header-section-number">16.1.6</span> PLT et GOT : Comment ça
Marche</h3>
<p>Pour le linking dynamique, le loader utilise deux tables :</p>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│         PLT (Procedure Linkage Table)                        │
│         GOT (Global Offset Table)                            │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  Programme                      Mémoire partagée            │
│  ┌────────────────────┐        ┌─────────────────┐          │
│  │ main:              │        │    libc.so      │          │
│  │   ...              │        │                 │          │
│  │   BL printf@plt ───────┐    │  printf:        │          │
│  │   ...              │   │    │    PUSH ...     │          │
│  └────────────────────┘   │    │    ...          │          │
│                           │    └─────────────────┘          │
│  ┌────────────────────┐   │           ↑                     │
│  │ PLT:               │   │           │                     │
│  │  printf@plt:       │←──┘           │                     │
│  │    LDR PC, [GOT+8]─────────────────┼──┐                  │
│  └────────────────────┘               │  │                  │
│                                       │  │                  │
│  ┌────────────────────┐               │  │                  │
│  │ GOT:               │               │  │                  │
│  │  [0]: &amp;_DYNAMIC    │               │  │                  │
│  │  [4]: link_map     │               │  │                  │
│  │  [8]: 0x7f4a2000 ──────────────────┘  │ (adresse réelle) │
│  │       ↑                               │                  │
│  │       │ Rempli par le loader          │                  │
│  │       │ au premier appel              │                  │
│  └────────────────────┘                  │                  │
│                                          │                  │
└──────────────────────────────────────────│──────────────────┘
                                           │
        Lazy binding : résolution au       │
        premier appel, pas au chargement   │</code></pre>
<hr />
<h2 data-number="16.2" id="partie-2-gestion-des-exceptions"><span
class="header-section-number">16.2</span> Partie 2 : Gestion des
Exceptions</h2>
<h3 data-number="16.2.1" id="quest-ce-quune-exception"><span
class="header-section-number">16.2.1</span> Qu’est-ce qu’une Exception
?</h3>
<p>Une <strong>exception</strong> signale qu’une situation anormale
s’est produite. Contrairement au retour d’erreur classique, les
exceptions <strong>déroulent la pile</strong> jusqu’à trouver un
gestionnaire approprié.</p>
<div class="sourceCode" id="cb250"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="co">// SANS exceptions (style C)</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> result<span class="op">;</span></span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span><span class="op">*</span> f <span class="op">=</span> fopen<span class="op">(</span><span class="st">&quot;data.txt&quot;</span><span class="op">,</span> <span class="st">&quot;r&quot;</span><span class="op">);</span></span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>f <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ERROR_FILE_NOT_FOUND<span class="op">;</span>  <span class="co">// Propagation manuelle</span></span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb250-7"><a href="#cb250-7" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> parse_data<span class="op">(</span>f<span class="op">);</span></span>
<span id="cb250-8"><a href="#cb250-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>result <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb250-9"><a href="#cb250-9" aria-hidden="true" tabindex="-1"></a>    fclose<span class="op">(</span>f<span class="op">);</span></span>
<span id="cb250-10"><a href="#cb250-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ERROR_PARSE_FAILED<span class="op">;</span>   <span class="co">// Oubli facile du cleanup !</span></span>
<span id="cb250-11"><a href="#cb250-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb250-12"><a href="#cb250-12" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span>
<span id="cb250-13"><a href="#cb250-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-14"><a href="#cb250-14" aria-hidden="true" tabindex="-1"></a><span class="co">// AVEC exceptions (style C++/Java/Python)</span></span>
<span id="cb250-15"><a href="#cb250-15" aria-hidden="true" tabindex="-1"></a>try <span class="op">{</span></span>
<span id="cb250-16"><a href="#cb250-16" aria-hidden="true" tabindex="-1"></a>    File f <span class="op">=</span> open<span class="op">(</span><span class="st">&quot;data.txt&quot;</span><span class="op">);</span>     <span class="co">// Peut lever FileNotFound</span></span>
<span id="cb250-17"><a href="#cb250-17" aria-hidden="true" tabindex="-1"></a>    Data d <span class="op">=</span> parse<span class="op">(</span>f<span class="op">);</span>             <span class="co">// Peut lever ParseError</span></span>
<span id="cb250-18"><a href="#cb250-18" aria-hidden="true" tabindex="-1"></a>    process<span class="op">(</span>d<span class="op">);</span>                    <span class="co">// Peut lever ProcessError</span></span>
<span id="cb250-19"><a href="#cb250-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> catch <span class="op">(</span>FileNotFound e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb250-20"><a href="#cb250-20" aria-hidden="true" tabindex="-1"></a>    log<span class="op">(</span><span class="st">&quot;Fichier non trouvé: &quot;</span> <span class="op">+</span> e<span class="op">.</span>path<span class="op">);</span></span>
<span id="cb250-21"><a href="#cb250-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> catch <span class="op">(</span>ParseError e<span class="op">)</span> <span class="op">{</span></span>
<span id="cb250-22"><a href="#cb250-22" aria-hidden="true" tabindex="-1"></a>    log<span class="op">(</span><span class="st">&quot;Erreur de parsing ligne &quot;</span> <span class="op">+</span> e<span class="op">.</span>line<span class="op">);</span></span>
<span id="cb250-23"><a href="#cb250-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> finally <span class="op">{</span></span>
<span id="cb250-24"><a href="#cb250-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Toujours exécuté, même si exception</span></span>
<span id="cb250-25"><a href="#cb250-25" aria-hidden="true" tabindex="-1"></a>    cleanup<span class="op">();</span></span>
<span id="cb250-26"><a href="#cb250-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="16.2.2" id="anatomie-dune-exception"><span
class="header-section-number">16.2.2</span> Anatomie d’une
Exception</h3>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│                 Lancement d&#39;Exception                        │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  throw new RuntimeException(&quot;Division par zéro&quot;);           │
│         │                                                    │
│         ▼                                                    │
│  1. Créer l&#39;objet exception                                 │
│     - Type de l&#39;exception                                   │
│     - Message d&#39;erreur                                      │
│     - Stack trace (où ça s&#39;est passé)                       │
│                                                              │
│  2. Rechercher un handler (stack unwinding)                  │
│                                                              │
│     ┌─────────────────────────┐                             │
│     │ main()                  │                             │
│     │  try { foo(); }         │ ← pas de catch matching     │
│     │  catch (IOError) {...}  │                             │
│     └──────────┬──────────────┘                             │
│                │                                             │
│     ┌──────────▼──────────────┐                             │
│     │ foo()                   │                             │
│     │  bar();                 │ ← pas de try/catch          │
│     └──────────┬──────────────┘                             │
│                │                                             │
│     ┌──────────▼──────────────┐                             │
│     │ bar()                   │                             │
│     │  try { baz(); }         │ ← catch (RuntimeException)  │
│     │  catch (Runtime...) { } │   TROUVÉ !                  │
│     └─────────────────────────┘                             │
│                │                                             │
│                ▼                                             │
│  3. Dérouler la pile jusqu&#39;au handler                       │
│     - Appeler les destructeurs                              │
│     - Libérer les ressources                                │
│     - Exécuter les blocs finally                            │
│                                                              │
│  4. Exécuter le handler                                      │
│     - catch block reçoit l&#39;objet exception                  │
│     - Peut re-throw si nécessaire                           │
│                                                              │
└─────────────────────────────────────────────────────────────┘</code></pre>
<h3 data-number="16.2.3" id="implémentation-bas-niveau-sjlj"><span
class="header-section-number">16.2.3</span> Implémentation Bas Niveau
(SJLJ)</h3>
<p>La méthode <strong>setjmp/longjmp</strong> est une façon simple
d’implémenter les exceptions en C :</p>
<div class="sourceCode" id="cb252"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;setjmp.h&gt;</span></span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>jmp_buf exception_env<span class="op">;</span></span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> exception_code<span class="op">;</span></span>
<span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-6"><a href="#cb252-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Équivalent de &quot;try&quot;</span></span>
<span id="cb252-7"><a href="#cb252-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>setjmp<span class="op">(</span>exception_env<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb252-8"><a href="#cb252-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Code normal</span></span>
<span id="cb252-9"><a href="#cb252-9" aria-hidden="true" tabindex="-1"></a>    risky_operation<span class="op">();</span></span>
<span id="cb252-10"><a href="#cb252-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb252-11"><a href="#cb252-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Handler (équivalent de &quot;catch&quot;)</span></span>
<span id="cb252-12"><a href="#cb252-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;Exception </span><span class="sc">%d</span><span class="st"> attrapée!</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> exception_code<span class="op">);</span></span>
<span id="cb252-13"><a href="#cb252-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb252-14"><a href="#cb252-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-15"><a href="#cb252-15" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> risky_operation<span class="op">()</span> <span class="op">{</span></span>
<span id="cb252-16"><a href="#cb252-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>error_condition<span class="op">)</span> <span class="op">{</span></span>
<span id="cb252-17"><a href="#cb252-17" aria-hidden="true" tabindex="-1"></a>        exception_code <span class="op">=</span> <span class="dv">42</span><span class="op">;</span></span>
<span id="cb252-18"><a href="#cb252-18" aria-hidden="true" tabindex="-1"></a>        longjmp<span class="op">(</span>exception_env<span class="op">,</span> <span class="dv">1</span><span class="op">);</span>  <span class="co">// &quot;throw&quot;</span></span>
<span id="cb252-19"><a href="#cb252-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb252-20"><a href="#cb252-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Comment ça marche au niveau assembleur :</p>
<div class="sourceCode" id="cb253"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co">; setjmp : sauvegarde le contexte</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setjmp:</span></span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">; Sauver tous les registres callee-saved</span></span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">STR</span> <span class="kw">SP</span><span class="op">,</span> <span class="op">[</span>R0<span class="op">,</span> <span class="op">#</span><span class="dv">0</span><span class="op">]</span>      <span class="co">; Stack pointer</span></span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">STR</span> LR<span class="op">,</span> <span class="op">[</span>R0<span class="op">,</span> <span class="op">#</span><span class="dv">4</span><span class="op">]</span>      <span class="co">; Return address</span></span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">STR</span> R4<span class="op">,</span> <span class="op">[</span>R0<span class="op">,</span> <span class="op">#</span><span class="dv">8</span><span class="op">]</span></span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">STR</span> R5<span class="op">,</span> <span class="op">[</span>R0<span class="op">,</span> <span class="op">#</span><span class="dv">12</span><span class="op">]</span></span>
<span id="cb253-8"><a href="#cb253-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">; ... R6-R11 ...</span></span>
<span id="cb253-9"><a href="#cb253-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">0</span>            <span class="co">; Retourne 0 (première fois)</span></span>
<span id="cb253-10"><a href="#cb253-10" aria-hidden="true" tabindex="-1"></a>    BX LR</span>
<span id="cb253-11"><a href="#cb253-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-12"><a href="#cb253-12" aria-hidden="true" tabindex="-1"></a><span class="co">; longjmp : restaure le contexte</span></span>
<span id="cb253-13"><a href="#cb253-13" aria-hidden="true" tabindex="-1"></a><span class="fu">longjmp:</span></span>
<span id="cb253-14"><a href="#cb253-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">; R0 = jmp_buf, R1 = valeur de retour</span></span>
<span id="cb253-15"><a href="#cb253-15" aria-hidden="true" tabindex="-1"></a>    LDR <span class="kw">SP</span><span class="op">,</span> <span class="op">[</span>R0<span class="op">,</span> <span class="op">#</span><span class="dv">0</span><span class="op">]</span>      <span class="co">; Restaurer stack pointer</span></span>
<span id="cb253-16"><a href="#cb253-16" aria-hidden="true" tabindex="-1"></a>    LDR LR<span class="op">,</span> <span class="op">[</span>R0<span class="op">,</span> <span class="op">#</span><span class="dv">4</span><span class="op">]</span>      <span class="co">; Restaurer return address</span></span>
<span id="cb253-17"><a href="#cb253-17" aria-hidden="true" tabindex="-1"></a>    LDR R4<span class="op">,</span> <span class="op">[</span>R0<span class="op">,</span> <span class="op">#</span><span class="dv">8</span><span class="op">]</span></span>
<span id="cb253-18"><a href="#cb253-18" aria-hidden="true" tabindex="-1"></a>    LDR R5<span class="op">,</span> <span class="op">[</span>R0<span class="op">,</span> <span class="op">#</span><span class="dv">12</span><span class="op">]</span></span>
<span id="cb253-19"><a href="#cb253-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">; ... R6-R11 ...</span></span>
<span id="cb253-20"><a href="#cb253-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> R0<span class="op">,</span> R1            <span class="co">; Retourne la valeur passée</span></span>
<span id="cb253-21"><a href="#cb253-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">CMP</span> R0<span class="op">,</span> <span class="op">#</span><span class="dv">0</span></span>
<span id="cb253-22"><a href="#cb253-22" aria-hidden="true" tabindex="-1"></a>    MOVEQ R0<span class="op">,</span> <span class="op">#</span><span class="dv">1</span>          <span class="co">; Ne jamais retourner 0</span></span>
<span id="cb253-23"><a href="#cb253-23" aria-hidden="true" tabindex="-1"></a>    BX LR                 <span class="co">; &quot;Retourne&quot; à setjmp !</span></span></code></pre></div>
<h3 data-number="16.2.4"
id="table-driven-exception-handling-moderne"><span
class="header-section-number">16.2.4</span> Table-Driven Exception
Handling (Moderne)</h3>
<p>Les compilateurs modernes utilisent des tables plutôt que du code
:</p>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│              Exception Tables (.eh_frame)                    │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  Pour chaque fonction :                                      │
│  ┌─────────────────────────────────────┐                    │
│  │ FDE (Frame Description Entry)       │                    │
│  │                                     │                    │
│  │ PC_begin: 0x00001000               │ Début fonction     │
│  │ PC_end:   0x00001080               │ Fin fonction       │
│  │                                     │                    │
│  │ Unwind info:                        │                    │
│  │   0x1000-0x1010: CFA = SP + 0       │                    │
│  │   0x1010-0x1020: CFA = SP + 16      │ Après PUSH        │
│  │   0x1020-0x1070: CFA = SP + 32      │ Après alloca      │
│  │                                     │                    │
│  │ LSDA (Language-Specific Data):      │                    │
│  │   Try range: 0x1030-0x1050          │                    │
│  │   Catch type: std::exception        │                    │
│  │   Handler: 0x1060                   │                    │
│  └─────────────────────────────────────┘                    │
│                                                              │
│  Avantages :                                                 │
│  • Pas d&#39;overhead en cas normal (zero-cost exceptions)       │
│  • Tables générées à la compilation                          │
│  • Coût uniquement quand une exception est levée             │
│                                                              │
└─────────────────────────────────────────────────────────────┘</code></pre>
<hr />
<h2 data-number="16.3" id="partie-3-threads-et-concurrence"><span
class="header-section-number">16.3</span> Partie 3 : Threads et
Concurrence</h2>
<h3 data-number="16.3.1" id="processus-vs-threads"><span
class="header-section-number">16.3.1</span> Processus vs Threads</h3>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│                     PROCESSUS                                │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌─────────────────────┐    ┌─────────────────────┐         │
│  │   Processus A       │    │   Processus B       │         │
│  │                     │    │                     │         │
│  │  ┌───────────────┐  │    │  ┌───────────────┐  │         │
│  │  │ Espace virtuel│  │    │  │ Espace virtuel│  │         │
│  │  │ 0x0000-0xFFFF │  │    │  │ 0x0000-0xFFFF │  │         │
│  │  │  (isolé)      │  │    │  │  (isolé)      │  │         │
│  │  └───────────────┘  │    │  └───────────────┘  │         │
│  │                     │    │                     │         │
│  │  Code, Data, Heap   │    │  Code, Data, Heap   │         │
│  │  Stack              │    │  Stack              │         │
│  │  File descriptors   │    │  File descriptors   │         │
│  └─────────────────────┘    └─────────────────────┘         │
│                                                              │
│  • Isolation complète (mémoire protégée)                    │
│  • Communication via IPC (pipes, sockets, shared memory)     │
│  • Création coûteuse (fork = copie de tout)                  │
│                                                              │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                      THREADS                                 │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                    Processus                         │    │
│  │                                                      │    │
│  │  ┌────────────────────────────────────────────────┐ │    │
│  │  │     Mémoire partagée                           │ │    │
│  │  │     Code, Data, Heap, File descriptors         │ │    │
│  │  └────────────────────────────────────────────────┘ │    │
│  │                                                      │    │
│  │  ┌──────────┐   ┌──────────┐   ┌──────────┐        │    │
│  │  │ Thread 1 │   │ Thread 2 │   │ Thread 3 │        │    │
│  │  │          │   │          │   │          │        │    │
│  │  │ Stack    │   │ Stack    │   │ Stack    │        │    │
│  │  │ Registres│   │ Registres│   │ Registres│        │    │
│  │  │ PC       │   │ PC       │   │ PC       │        │    │
│  │  └──────────┘   └──────────┘   └──────────┘        │    │
│  │                                                      │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                              │
│  • Partagent le même espace mémoire                          │
│  • Communication directe (variables partagées)               │
│  • Création légère (juste une nouvelle stack)                │
│  • ATTENTION : Synchronisation nécessaire !                  │
│                                                              │
└─────────────────────────────────────────────────────────────┘</code></pre>
<h3 data-number="16.3.2" id="création-de-threads"><span
class="header-section-number">16.3.2</span> Création de Threads</h3>
<div class="sourceCode" id="cb256"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="co">// POSIX Threads (pthreads)</span></span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span><span class="op">*</span> thread_function<span class="op">(</span><span class="dt">void</span><span class="op">*</span> arg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> id <span class="op">=</span> <span class="op">*(</span><span class="dt">int</span><span class="op">*)</span>arg<span class="op">;</span></span>
<span id="cb256-6"><a href="#cb256-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;Thread </span><span class="sc">%d</span><span class="st"> démarre</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> id<span class="op">);</span></span>
<span id="cb256-7"><a href="#cb256-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Travail...</span></span>
<span id="cb256-8"><a href="#cb256-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb256-9"><a href="#cb256-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb256-10"><a href="#cb256-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-11"><a href="#cb256-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb256-12"><a href="#cb256-12" aria-hidden="true" tabindex="-1"></a>    pthread_t threads<span class="op">[</span><span class="dv">4</span><span class="op">];</span></span>
<span id="cb256-13"><a href="#cb256-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> ids<span class="op">[</span><span class="dv">4</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">};</span></span>
<span id="cb256-14"><a href="#cb256-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-15"><a href="#cb256-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Créer 4 threads</span></span>
<span id="cb256-16"><a href="#cb256-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">4</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb256-17"><a href="#cb256-17" aria-hidden="true" tabindex="-1"></a>        pthread_create<span class="op">(&amp;</span>threads<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">,</span> thread_function<span class="op">,</span> <span class="op">&amp;</span>ids<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb256-18"><a href="#cb256-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb256-19"><a href="#cb256-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-20"><a href="#cb256-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Attendre qu&#39;ils terminent</span></span>
<span id="cb256-21"><a href="#cb256-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">4</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb256-22"><a href="#cb256-22" aria-hidden="true" tabindex="-1"></a>        pthread_join<span class="op">(</span>threads<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">);</span></span>
<span id="cb256-23"><a href="#cb256-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb256-24"><a href="#cb256-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-25"><a href="#cb256-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb256-26"><a href="#cb256-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="16.3.3" id="le-problème-race-conditions"><span
class="header-section-number">16.3.3</span> Le Problème : Race
Conditions</h3>
<div class="sourceCode" id="cb257"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="al">DANGER</span><span class="co"> : Accès concurrent non protégé</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> counter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span><span class="op">*</span> increment<span class="op">(</span><span class="dt">void</span><span class="op">*</span> arg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">1000000</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a>        counter<span class="op">++;</span>  <span class="co">// NON ATOMIQUE !</span></span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb257-8"><a href="#cb257-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb257-9"><a href="#cb257-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb257-10"><a href="#cb257-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-11"><a href="#cb257-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Avec 2 threads : résultat attendu = 2,000,000</span></span>
<span id="cb257-12"><a href="#cb257-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Résultat réel : souvent ~1,500,000 !</span></span>
<span id="cb257-13"><a href="#cb257-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-14"><a href="#cb257-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Pourquoi ? counter++ se décompose en :</span></span>
<span id="cb257-15"><a href="#cb257-15" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. LOAD  R0, [counter]   ← Thread A lit 42</span></span>
<span id="cb257-16"><a href="#cb257-16" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. ADD   R0, R0, #1      ← Thread A calcule 43</span></span>
<span id="cb257-17"><a href="#cb257-17" aria-hidden="true" tabindex="-1"></a><span class="co">//    --- CONTEXT SWITCH ---</span></span>
<span id="cb257-18"><a href="#cb257-18" aria-hidden="true" tabindex="-1"></a><span class="co">// 1. LOAD  R0, [counter]   ← Thread B lit AUSSI 42</span></span>
<span id="cb257-19"><a href="#cb257-19" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. ADD   R0, R0, #1      ← Thread B calcule 43</span></span>
<span id="cb257-20"><a href="#cb257-20" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. STORE R0, [counter]   ← Thread B écrit 43</span></span>
<span id="cb257-21"><a href="#cb257-21" aria-hidden="true" tabindex="-1"></a><span class="co">//    --- CONTEXT SWITCH ---</span></span>
<span id="cb257-22"><a href="#cb257-22" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. STORE R0, [counter]   ← Thread A écrit 43</span></span>
<span id="cb257-23"><a href="#cb257-23" aria-hidden="true" tabindex="-1"></a><span class="co">// Résultat : counter = 43 au lieu de 44 !</span></span></code></pre></div>
<h3 data-number="16.3.4" id="synchronisation-mutex"><span
class="header-section-number">16.3.4</span> Synchronisation : Mutex</h3>
<div class="sourceCode" id="cb258"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;pthread.h&gt;</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>pthread_mutex_t lock <span class="op">=</span> PTHREAD_MUTEX_INITIALIZER<span class="op">;</span></span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> counter <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span><span class="op">*</span> safe_increment<span class="op">(</span><span class="dt">void</span><span class="op">*</span> arg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">1000000</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb258-8"><a href="#cb258-8" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_lock<span class="op">(&amp;</span>lock<span class="op">);</span>    <span class="co">// Acquérir le verrou</span></span>
<span id="cb258-9"><a href="#cb258-9" aria-hidden="true" tabindex="-1"></a>        counter<span class="op">++;</span>                     <span class="co">// Section critique</span></span>
<span id="cb258-10"><a href="#cb258-10" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_unlock<span class="op">(&amp;</span>lock<span class="op">);</span>   <span class="co">// Libérer le verrou</span></span>
<span id="cb258-11"><a href="#cb258-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb258-12"><a href="#cb258-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb258-13"><a href="#cb258-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Implémentation bas niveau d’un mutex (spinlock) :</p>
<div class="sourceCode" id="cb259"><pre
class="sourceCode asm"><code class="sourceCode fasm"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="co">; Test-and-Set atomique</span></span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a><span class="co">; R0 = adresse du lock, R1 = valeur à écrire</span></span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a><span class="fu">acquire_lock:</span></span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> R1<span class="op">,</span> <span class="op">#</span><span class="dv">1</span></span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a><span class="fu">spin:</span></span>
<span id="cb259-6"><a href="#cb259-6" aria-hidden="true" tabindex="-1"></a>    LDREX R2<span class="op">,</span> <span class="op">[</span>R0<span class="op">]</span>        <span class="co">; Load Exclusive</span></span>
<span id="cb259-7"><a href="#cb259-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">CMP</span> R2<span class="op">,</span> <span class="op">#</span><span class="dv">0</span>            <span class="co">; Lock libre ?</span></span>
<span id="cb259-8"><a href="#cb259-8" aria-hidden="true" tabindex="-1"></a>    B<span class="op">.</span>NE spin              <span class="co">; Non, réessayer</span></span>
<span id="cb259-9"><a href="#cb259-9" aria-hidden="true" tabindex="-1"></a>    STREX R3<span class="op">,</span> R1<span class="op">,</span> <span class="op">[</span>R0<span class="op">]</span>    <span class="co">; Store Exclusive</span></span>
<span id="cb259-10"><a href="#cb259-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">CMP</span> R3<span class="op">,</span> <span class="op">#</span><span class="dv">0</span>            <span class="co">; Succès ?</span></span>
<span id="cb259-11"><a href="#cb259-11" aria-hidden="true" tabindex="-1"></a>    B<span class="op">.</span>NE spin              <span class="co">; Non, quelqu&#39;un d&#39;autre a gagné</span></span>
<span id="cb259-12"><a href="#cb259-12" aria-hidden="true" tabindex="-1"></a>    DMB                   <span class="co">; Memory barrier</span></span>
<span id="cb259-13"><a href="#cb259-13" aria-hidden="true" tabindex="-1"></a>    BX LR</span>
<span id="cb259-14"><a href="#cb259-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-15"><a href="#cb259-15" aria-hidden="true" tabindex="-1"></a><span class="fu">release_lock:</span></span>
<span id="cb259-16"><a href="#cb259-16" aria-hidden="true" tabindex="-1"></a>    DMB                   <span class="co">; Memory barrier</span></span>
<span id="cb259-17"><a href="#cb259-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">MOV</span> R1<span class="op">,</span> <span class="op">#</span><span class="dv">0</span></span>
<span id="cb259-18"><a href="#cb259-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">STR</span> R1<span class="op">,</span> <span class="op">[</span>R0<span class="op">]</span>          <span class="co">; Libérer le lock</span></span>
<span id="cb259-19"><a href="#cb259-19" aria-hidden="true" tabindex="-1"></a>    BX LR</span></code></pre></div>
<h3 data-number="16.3.5" id="autres-primitives-de-synchronisation"><span
class="header-section-number">16.3.5</span> Autres Primitives de
Synchronisation</h3>
<div class="sourceCode" id="cb260"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="co">// SÉMAPHORE : Compteur de ressources</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>sem_t slots<span class="op">;</span></span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>sem_init<span class="op">(&amp;</span>slots<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">5</span><span class="op">);</span>      <span class="co">// 5 slots disponibles</span></span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>sem_wait<span class="op">(&amp;</span>slots<span class="op">);</span>            <span class="co">// Décrémenter (bloque si 0)</span></span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a>use_resource<span class="op">();</span></span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a>sem_post<span class="op">(&amp;</span>slots<span class="op">);</span>            <span class="co">// Incrémenter</span></span>
<span id="cb260-8"><a href="#cb260-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-9"><a href="#cb260-9" aria-hidden="true" tabindex="-1"></a><span class="co">// CONDITION VARIABLE : Attendre un événement</span></span>
<span id="cb260-10"><a href="#cb260-10" aria-hidden="true" tabindex="-1"></a>pthread_mutex_t mutex<span class="op">;</span></span>
<span id="cb260-11"><a href="#cb260-11" aria-hidden="true" tabindex="-1"></a>pthread_cond_t cond<span class="op">;</span></span>
<span id="cb260-12"><a href="#cb260-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> data_ready <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb260-13"><a href="#cb260-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-14"><a href="#cb260-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Thread producteur</span></span>
<span id="cb260-15"><a href="#cb260-15" aria-hidden="true" tabindex="-1"></a>pthread_mutex_lock<span class="op">(&amp;</span>mutex<span class="op">);</span></span>
<span id="cb260-16"><a href="#cb260-16" aria-hidden="true" tabindex="-1"></a>produce_data<span class="op">();</span></span>
<span id="cb260-17"><a href="#cb260-17" aria-hidden="true" tabindex="-1"></a>data_ready <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb260-18"><a href="#cb260-18" aria-hidden="true" tabindex="-1"></a>pthread_cond_signal<span class="op">(&amp;</span>cond<span class="op">);</span>  <span class="co">// Réveiller un consommateur</span></span>
<span id="cb260-19"><a href="#cb260-19" aria-hidden="true" tabindex="-1"></a>pthread_mutex_unlock<span class="op">(&amp;</span>mutex<span class="op">);</span></span>
<span id="cb260-20"><a href="#cb260-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-21"><a href="#cb260-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Thread consommateur</span></span>
<span id="cb260-22"><a href="#cb260-22" aria-hidden="true" tabindex="-1"></a>pthread_mutex_lock<span class="op">(&amp;</span>mutex<span class="op">);</span></span>
<span id="cb260-23"><a href="#cb260-23" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(!</span>data_ready<span class="op">)</span> <span class="op">{</span>        <span class="co">// Boucle pour éviter spurious wakeups</span></span>
<span id="cb260-24"><a href="#cb260-24" aria-hidden="true" tabindex="-1"></a>    pthread_cond_wait<span class="op">(&amp;</span>cond<span class="op">,</span> <span class="op">&amp;</span>mutex<span class="op">);</span>  <span class="co">// Attend + libère/réacquiert mutex</span></span>
<span id="cb260-25"><a href="#cb260-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb260-26"><a href="#cb260-26" aria-hidden="true" tabindex="-1"></a>consume_data<span class="op">();</span></span>
<span id="cb260-27"><a href="#cb260-27" aria-hidden="true" tabindex="-1"></a>pthread_mutex_unlock<span class="op">(&amp;</span>mutex<span class="op">);</span></span>
<span id="cb260-28"><a href="#cb260-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-29"><a href="#cb260-29" aria-hidden="true" tabindex="-1"></a><span class="co">// READ-WRITE LOCK : Plusieurs lecteurs OU un écrivain</span></span>
<span id="cb260-30"><a href="#cb260-30" aria-hidden="true" tabindex="-1"></a>pthread_rwlock_t rwlock<span class="op">;</span></span>
<span id="cb260-31"><a href="#cb260-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-32"><a href="#cb260-32" aria-hidden="true" tabindex="-1"></a><span class="co">// Lecteurs (peuvent être multiples)</span></span>
<span id="cb260-33"><a href="#cb260-33" aria-hidden="true" tabindex="-1"></a>pthread_rwlock_rdlock<span class="op">(&amp;</span>rwlock<span class="op">);</span></span>
<span id="cb260-34"><a href="#cb260-34" aria-hidden="true" tabindex="-1"></a>read_data<span class="op">();</span></span>
<span id="cb260-35"><a href="#cb260-35" aria-hidden="true" tabindex="-1"></a>pthread_rwlock_unlock<span class="op">(&amp;</span>rwlock<span class="op">);</span></span>
<span id="cb260-36"><a href="#cb260-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-37"><a href="#cb260-37" aria-hidden="true" tabindex="-1"></a><span class="co">// Écrivain (exclusif)</span></span>
<span id="cb260-38"><a href="#cb260-38" aria-hidden="true" tabindex="-1"></a>pthread_rwlock_wrlock<span class="op">(&amp;</span>rwlock<span class="op">);</span></span>
<span id="cb260-39"><a href="#cb260-39" aria-hidden="true" tabindex="-1"></a>write_data<span class="op">();</span></span>
<span id="cb260-40"><a href="#cb260-40" aria-hidden="true" tabindex="-1"></a>pthread_rwlock_unlock<span class="op">(&amp;</span>rwlock<span class="op">);</span></span></code></pre></div>
<h3 data-number="16.3.6" id="deadlocks"><span
class="header-section-number">16.3.6</span> Deadlocks</h3>
<div class="sourceCode" id="cb261"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="co">// DEADLOCK : Deux threads qui s&#39;attendent mutuellement</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>pthread_mutex_t lockA<span class="op">,</span> lockB<span class="op">;</span></span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Thread 1                     // Thread 2</span></span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a>lock<span class="op">(&amp;</span>lockA<span class="op">);</span>                   lock<span class="op">(&amp;</span>lockB<span class="op">);</span></span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a>lock<span class="op">(&amp;</span>lockB<span class="op">);</span>  <span class="co">// BLOQUÉ !      lock(&amp;lockA);  // BLOQUÉ !</span></span>
<span id="cb261-8"><a href="#cb261-8" aria-hidden="true" tabindex="-1"></a><span class="co">//             ↑                               ↑</span></span>
<span id="cb261-9"><a href="#cb261-9" aria-hidden="true" tabindex="-1"></a><span class="co">//             └──── Attend lockB ─────────────┘</span></span>
<span id="cb261-10"><a href="#cb261-10" aria-hidden="true" tabindex="-1"></a><span class="co">//                   qui attend lockA</span></span>
<span id="cb261-11"><a href="#cb261-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-12"><a href="#cb261-12" aria-hidden="true" tabindex="-1"></a><span class="co">// SOLUTION 1 : Ordre fixe d&#39;acquisition</span></span>
<span id="cb261-13"><a href="#cb261-13" aria-hidden="true" tabindex="-1"></a><span class="co">// Toujours acquérir lockA avant lockB</span></span>
<span id="cb261-14"><a href="#cb261-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-15"><a href="#cb261-15" aria-hidden="true" tabindex="-1"></a><span class="co">// SOLUTION 2 : trylock avec timeout</span></span>
<span id="cb261-16"><a href="#cb261-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>pthread_mutex_trylock<span class="op">(&amp;</span>lockB<span class="op">)</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb261-17"><a href="#cb261-17" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_unlock<span class="op">(&amp;</span>lockA<span class="op">);</span>  <span class="co">// Libérer et réessayer</span></span>
<span id="cb261-18"><a href="#cb261-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">goto</span> retry<span class="op">;</span></span>
<span id="cb261-19"><a href="#cb261-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb261-20"><a href="#cb261-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-21"><a href="#cb261-21" aria-hidden="true" tabindex="-1"></a><span class="co">// SOLUTION 3 : Lock hierarchies</span></span>
<span id="cb261-22"><a href="#cb261-22" aria-hidden="true" tabindex="-1"></a><span class="co">// Chaque lock a un niveau, on ne peut acquérir que des niveaux croissants</span></span></code></pre></div>
<h3 data-number="16.3.7" id="modèles-de-concurrence"><span
class="header-section-number">16.3.7</span> Modèles de Concurrence</h3>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│              MODÈLES DE CONCURRENCE                          │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  1. SHARED MEMORY (ce qu&#39;on a vu)                           │
│     • Threads partagent la mémoire                          │
│     • Synchronisation par mutex, sémaphores                 │
│     • Difficile à raisonner, bugs subtils                   │
│                                                              │
│  2. MESSAGE PASSING                                          │
│     • Pas de mémoire partagée                               │
│     • Processus communiquent par messages                    │
│     • Plus sûr mais overhead de copie                       │
│                                                              │
│     Thread A                    Thread B                    │
│     ┌──────────┐               ┌──────────┐                │
│     │ send(B,  │──────────────→│ recv()   │                │
│     │   data)  │               │ → data   │                │
│     └──────────┘               └──────────┘                │
│                                                              │
│  3. ACTEURS (Erlang, Akka)                                  │
│     • Chaque acteur a sa mailbox                            │
│     • Messages asynchrones                                  │
│     • Pas de lock, pas de deadlock                          │
│                                                              │
│  4. COROUTINES / ASYNC-AWAIT                                │
│     • Concurrence coopérative (pas préemptive)              │
│     • Un seul thread, mais plusieurs tâches                 │
│     • Pas de race condition sur les données                 │
│                                                              │
│     async function fetch() {                                │
│         let a = await fetchA();  // Suspend, pas de block   │
│         let b = await fetchB();                             │
│         return a + b;                                        │
│     }                                                        │
│                                                              │
└─────────────────────────────────────────────────────────────┘</code></pre>
<hr />
<h2 data-number="16.4" id="exercices-pratiques-10"><span
class="header-section-number">16.4</span> Exercices Pratiques</h2>
<h3 data-number="16.4.1" id="exercices-sur-le-simulateur-web-10"><span
class="header-section-number">16.4.1</span> Exercices sur le Simulateur
Web</h3>
<p>Lancez le <strong>Simulateur Web</strong> et allez dans
<strong>Exercices OS</strong> pour pratiquer les concepts de ce chapitre
:</p>
<table>
<colgroup>
<col style="width: 30%" />
<col style="width: 39%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="header">
<th>Exercice</th>
<th>Description</th>
<th>Concepts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>os-coro</code></td>
<td>Coroutines visuelles (alternance A/B)</td>
<td>Changement de contexte, yield</td>
</tr>
<tr class="even">
<td><code>os-sched</code></td>
<td>Scheduler avec préemption</td>
<td>Ordonnancement, time slices</td>
</tr>
<tr class="odd">
<td><code>os-project2</code></td>
<td>Projet: Task Manager</td>
<td>Threads, scheduler complet</td>
</tr>
</tbody>
</table>
<p>Ces exercices montrent visuellement comment les threads/coroutines
alternent l’exécution.</p>
<h3 data-number="16.4.2" id="exercice-1-analyse-dun-fichier-objet"><span
class="header-section-number">16.4.2</span> Exercice 1 : Analyse d’un
Fichier Objet</h3>
<p>Utilisez <code>objdump</code> ou <code>readelf</code> pour analyser
un fichier <code>.o</code> :</p>
<div class="sourceCode" id="cb263"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compiler sans linker</span></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> hello.c <span class="at">-o</span> hello.o</span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Examiner les sections</span></span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a><span class="ex">objdump</span> <span class="at">-h</span> hello.o</span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-7"><a href="#cb263-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Voir les symboles</span></span>
<span id="cb263-8"><a href="#cb263-8" aria-hidden="true" tabindex="-1"></a><span class="fu">nm</span> hello.o</span>
<span id="cb263-9"><a href="#cb263-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-10"><a href="#cb263-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Désassembler</span></span>
<span id="cb263-11"><a href="#cb263-11" aria-hidden="true" tabindex="-1"></a><span class="ex">objdump</span> <span class="at">-d</span> hello.o</span></code></pre></div>
<p>Questions : 1. Quels symboles sont définis ? Lesquels sont indéfinis
? 2. Quelle taille fait la section <code>.text</code> ? 3. Où est
stockée la chaîne “Hello World” ?</p>
<h3 data-number="16.4.3" id="exercice-2-linking-manuel"><span
class="header-section-number">16.4.3</span> Exercice 2 : Linking
Manuel</h3>
<p>Créez deux fichiers :</p>
<div class="sourceCode" id="cb264"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co">// main.c</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="kw">extern</span> <span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">);</span></span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> add<span class="op">(</span><span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb264-6"><a href="#cb264-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-7"><a href="#cb264-7" aria-hidden="true" tabindex="-1"></a><span class="co">// math.c</span></span>
<span id="cb264-8"><a href="#cb264-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb264-9"><a href="#cb264-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb264-10"><a href="#cb264-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<ol type="1">
<li>Compilez séparément : <code>gcc -c main.c</code> et
<code>gcc -c math.c</code></li>
<li>Examinez les symboles de chaque <code>.o</code></li>
<li>Linkez manuellement :
<code>ld main.o math.o -o programme</code></li>
<li>Que se passe-t-il ? Pourquoi ? (Indice : <code>_start</code>,
libc)</li>
</ol>
<h3 data-number="16.4.4" id="exercice-3-exception-handling-en-c"><span
class="header-section-number">16.4.4</span> Exercice 3 : Exception
Handling en C</h3>
<p>Implémentez un système d’exceptions simple avec setjmp/longjmp :</p>
<div class="sourceCode" id="cb265"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="al">TODO</span><span class="co">: Implémenter TRY, CATCH, THROW</span></span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Utilisation souhaitée :</span></span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a>TRY <span class="op">{</span></span>
<span id="cb265-4"><a href="#cb265-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>error<span class="op">)</span> THROW<span class="op">(</span><span class="dv">42</span><span class="op">);</span></span>
<span id="cb265-5"><a href="#cb265-5" aria-hidden="true" tabindex="-1"></a>    do_work<span class="op">();</span></span>
<span id="cb265-6"><a href="#cb265-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> CATCH<span class="op">(</span>code<span class="op">)</span> <span class="op">{</span></span>
<span id="cb265-7"><a href="#cb265-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;Exception </span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> code<span class="op">);</span></span>
<span id="cb265-8"><a href="#cb265-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> END_TRY<span class="op">;</span></span></code></pre></div>
<h3 data-number="16.4.5" id="exercice-4-producteur-consommateur"><span
class="header-section-number">16.4.5</span> Exercice 4 :
Producteur-Consommateur</h3>
<p>Implémentez le problème classique producteur-consommateur :</p>
<div class="sourceCode" id="cb266"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define BUFFER_SIZE </span><span class="dv">10</span></span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> buffer<span class="op">[</span>BUFFER_SIZE<span class="op">];</span></span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a><span class="co">// </span><span class="al">TODO</span><span class="co">: Implémenter avec mutex et condition variables</span></span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span><span class="op">*</span> producer<span class="op">(</span><span class="dt">void</span><span class="op">*</span> arg<span class="op">);</span>   <span class="co">// Produit des items</span></span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span><span class="op">*</span> consumer<span class="op">(</span><span class="dt">void</span><span class="op">*</span> arg<span class="op">);</span>   <span class="co">// Consomme des items</span></span></code></pre></div>
<h3 data-number="16.4.6" id="exercice-5-détection-de-deadlock"><span
class="header-section-number">16.4.6</span> Exercice 5 : Détection de
Deadlock</h3>
<p>Analysez ce code et identifiez le deadlock potentiel :</p>
<div class="sourceCode" id="cb267"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a>pthread_mutex_t m1<span class="op">,</span> m2<span class="op">,</span> m3<span class="op">;</span></span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span><span class="op">*</span> thread_a<span class="op">(</span><span class="dt">void</span><span class="op">*</span> arg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a>    lock<span class="op">(&amp;</span>m1<span class="op">);</span> lock<span class="op">(&amp;</span>m2<span class="op">);</span></span>
<span id="cb267-5"><a href="#cb267-5" aria-hidden="true" tabindex="-1"></a>    work<span class="op">();</span></span>
<span id="cb267-6"><a href="#cb267-6" aria-hidden="true" tabindex="-1"></a>    unlock<span class="op">(&amp;</span>m2<span class="op">);</span> unlock<span class="op">(&amp;</span>m1<span class="op">);</span></span>
<span id="cb267-7"><a href="#cb267-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb267-8"><a href="#cb267-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-9"><a href="#cb267-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span><span class="op">*</span> thread_b<span class="op">(</span><span class="dt">void</span><span class="op">*</span> arg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb267-10"><a href="#cb267-10" aria-hidden="true" tabindex="-1"></a>    lock<span class="op">(&amp;</span>m2<span class="op">);</span> lock<span class="op">(&amp;</span>m3<span class="op">);</span></span>
<span id="cb267-11"><a href="#cb267-11" aria-hidden="true" tabindex="-1"></a>    work<span class="op">();</span></span>
<span id="cb267-12"><a href="#cb267-12" aria-hidden="true" tabindex="-1"></a>    unlock<span class="op">(&amp;</span>m3<span class="op">);</span> unlock<span class="op">(&amp;</span>m2<span class="op">);</span></span>
<span id="cb267-13"><a href="#cb267-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb267-14"><a href="#cb267-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-15"><a href="#cb267-15" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span><span class="op">*</span> thread_c<span class="op">(</span><span class="dt">void</span><span class="op">*</span> arg<span class="op">)</span> <span class="op">{</span></span>
<span id="cb267-16"><a href="#cb267-16" aria-hidden="true" tabindex="-1"></a>    lock<span class="op">(&amp;</span>m3<span class="op">);</span> lock<span class="op">(&amp;</span>m1<span class="op">);</span></span>
<span id="cb267-17"><a href="#cb267-17" aria-hidden="true" tabindex="-1"></a>    work<span class="op">();</span></span>
<span id="cb267-18"><a href="#cb267-18" aria-hidden="true" tabindex="-1"></a>    unlock<span class="op">(&amp;</span>m1<span class="op">);</span> unlock<span class="op">(&amp;</span>m3<span class="op">);</span></span>
<span id="cb267-19"><a href="#cb267-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<ol type="1">
<li>Y a-t-il un deadlock possible ?</li>
<li>Dessinez le graphe de dépendance</li>
<li>Proposez une solution</li>
</ol>
<hr />
<h2 data-number="16.5" id="auto-évaluation-11"><span
class="header-section-number">16.5</span> Auto-évaluation</h2>
<h3 data-number="16.5.1" id="quiz-1"><span
class="header-section-number">16.5.1</span> Quiz</h3>
<p><strong>Q1.</strong> Quelle est la différence entre linking statique
et dynamique ?</p>
<p><strong>Q2.</strong> Qu’est-ce que la table des symboles dans un
fichier objet ?</p>
<p><strong>Q3.</strong> Que fait le préprocesseur avec
<code>#include</code> et <code>#define</code> ?</p>
<p><strong>Q4.</strong> Expliquez le concept de “stack unwinding” lors
d’une exception.</p>
<p><strong>Q5.</strong> Quelle est la différence entre un processus et
un thread ?</p>
<p><strong>Q6.</strong> Qu’est-ce qu’une race condition et comment
l’éviter ?</p>
<p><strong>Q7.</strong> Qu’est-ce qu’un deadlock ? Donnez les quatre
conditions nécessaires.</p>
<p><strong>Q8.</strong> Pourquoi les opérations atomiques sont-elles
nécessaires pour les mutex ?</p>
<h3 data-number="16.5.2" id="défi"><span
class="header-section-number">16.5.2</span> Défi</h3>
<p>Implémentez un pool de threads simple :</p>
<div class="sourceCode" id="cb268"><pre
class="sourceCode c"><code class="sourceCode c"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// </span><span class="al">TODO</span><span class="co">: votre structure</span></span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> ThreadPool<span class="op">;</span></span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-5"><a href="#cb268-5" aria-hidden="true" tabindex="-1"></a>ThreadPool<span class="op">*</span> pool_create<span class="op">(</span><span class="dt">int</span> num_threads<span class="op">);</span></span>
<span id="cb268-6"><a href="#cb268-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> pool_submit<span class="op">(</span>ThreadPool<span class="op">*</span> pool<span class="op">,</span> <span class="dt">void</span> <span class="op">(*</span>task<span class="op">)(</span><span class="dt">void</span><span class="op">*),</span> <span class="dt">void</span><span class="op">*</span> arg<span class="op">);</span></span>
<span id="cb268-7"><a href="#cb268-7" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> pool_destroy<span class="op">(</span>ThreadPool<span class="op">*</span> pool<span class="op">);</span></span></code></pre></div>
<hr />
<h2 data-number="16.6" id="résumé-1"><span
class="header-section-number">16.6</span> Résumé</h2>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│                  CONCEPTS AVANCÉS                            │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  COMPILATION :                                               │
│  Source → Préprocesseur → Compilateur → Assembleur → Linker │
│                                                              │
│  FICHIERS OBJETS :                                           │
│  • Sections : .text, .data, .bss, .rodata                   │
│  • Symboles : définis ou indéfinis (externes)               │
│  • Relocations : références à résoudre                       │
│                                                              │
│  LINKING :                                                   │
│  • Statique : tout dans l&#39;exécutable                        │
│  • Dynamique : résolution au runtime (PLT/GOT)              │
│                                                              │
│  EXCEPTIONS :                                                │
│  • try/catch/finally pour gérer les erreurs                 │
│  • Stack unwinding pour trouver le handler                  │
│  • Zero-cost (tables) vs SJLJ (runtime)                     │
│                                                              │
│  THREADS :                                                   │
│  • Partagent la mémoire (contrairement aux processus)       │
│  • Race conditions : accès concurrent non protégé           │
│  • Synchronisation : mutex, sémaphores, conditions          │
│  • Deadlocks : attention à l&#39;ordre d&#39;acquisition !          │
│                                                              │
└─────────────────────────────────────────────────────────────┘</code></pre>
<p>Ces concepts sont fondamentaux pour comprendre comment les programmes
réels fonctionnent, du code source jusqu’à l’exécution multi-threadée.
La maîtrise de la compilation/linking aide au débogage, tandis que la
compréhension de la concurrence est essentielle pour écrire des
programmes corrects et performants.</p>
</body>
</html>
